---
title: ファイルに書き込むためのベスト プラクティス
description: FileIO と PathIO クラスのメソッドを記述するさまざまなファイルを使用するためのベスト プラクティスについて説明します。
ms.date: 02/06/2019
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: f8bed97e060015f92ff95c9f7d797bbcb83db431
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2019
ms.locfileid: "57605837"
---
# <a name="best-practices-for-writing-to-files"></a><span data-ttu-id="46043-104">ファイルに書き込むためのベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="46043-104">Best practices for writing to files</span></span>

<span data-ttu-id="46043-105">**重要な API**</span><span class="sxs-lookup"><span data-stu-id="46043-105">**Important APIs**</span></span>

* [<span data-ttu-id="46043-106">**FileIO クラス**</span><span class="sxs-lookup"><span data-stu-id="46043-106">**FileIO class**</span></span>](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO)
* [<span data-ttu-id="46043-107">**PathIO クラス**</span><span class="sxs-lookup"><span data-stu-id="46043-107">**PathIO class**</span></span>](https://docs.microsoft.com/uwp/api/windows.storage.pathio)

<span data-ttu-id="46043-108">開発者の一般的な問題のセットに実行を使用する場合、**書き込み**のメソッド、 [ **FileIO** ](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO)と[ **PathIO**](https://docs.microsoft.com/uwp/api/windows.storage.pathio)クラス ファイル システム I/O 操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="46043-108">Developers sometimes run into a set of common problems when using the **Write** methods of the [**FileIO**](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO) and [**PathIO**](https://docs.microsoft.com/uwp/api/windows.storage.pathio) classes to perform file system I/O operations.</span></span> <span data-ttu-id="46043-109">たとえば、一般的な問題が含まれます。</span><span class="sxs-lookup"><span data-stu-id="46043-109">For example, common problems include:</span></span>

<span data-ttu-id="46043-110">• ファイルには、メソッドのいずれかを呼び出して例外を受け取った • アプリ部分的に書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="46043-110">•   A file is partially written •   The app receives an exception when calling one of the methods.</span></span> <span data-ttu-id="46043-111">• の背後にある操作のままにします。ターゲット ファイル名のようなファイル名を持つ TMP ファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="46043-111">•   The operations leave behind .TMP files  with a file name similar to the target file name.</span></span>

<span data-ttu-id="46043-112">**書き込み**のメソッド、 [ **FileIO** ](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO)と[ **PathIO** ](https://docs.microsoft.com/uwp/api/windows.storage.pathio)クラスには、次が含まれます。</span><span class="sxs-lookup"><span data-stu-id="46043-112">The **Write** methods of the [**FileIO**](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO) and [**PathIO**](https://docs.microsoft.com/uwp/api/windows.storage.pathio) classes include the following:</span></span>

* <span data-ttu-id="46043-113">**WriteBufferAsync**</span><span class="sxs-lookup"><span data-stu-id="46043-113">**WriteBufferAsync**</span></span>
* <span data-ttu-id="46043-114">**WriteBytesAsync**</span><span class="sxs-lookup"><span data-stu-id="46043-114">**WriteBytesAsync**</span></span>
* <span data-ttu-id="46043-115">**WriteLinesAsync**</span><span class="sxs-lookup"><span data-stu-id="46043-115">**WriteLinesAsync**</span></span>
* <span data-ttu-id="46043-116">**WriteTextAsync**</span><span class="sxs-lookup"><span data-stu-id="46043-116">**WriteTextAsync**</span></span>

 <span data-ttu-id="46043-117">この記事では、それらを使用するタイミングと方法は開発者のこれらのメソッドの動作に関する詳細情報をより深く理解します。</span><span class="sxs-lookup"><span data-stu-id="46043-117">This article provides details about how these methods work so developers understand better when and how to use them.</span></span> <span data-ttu-id="46043-118">この記事では、ガイドラインを提供し、すべての使用可能なファイル I/O の問題に対するソリューションを提供しようとはしません。</span><span class="sxs-lookup"><span data-stu-id="46043-118">This article provides guidelines and does not attempt to provide a solution for all possible file I/O problems.</span></span> 

> [!NOTE]
><span data-ttu-id="46043-119"> この記事の重点、 *\*FileIO*\*メソッドの例やディスカッション。</span><span class="sxs-lookup"><span data-stu-id="46043-119"> This article focuses on the *\*FileIO** methods in examples and discussions.</span></span> <span data-ttu-id="46043-120">ただし、 **PathIO**メソッドと同様のパターンに従うし、この記事のガイダンスのほとんどがもこれらのメソッドに適用されます。</span><span class="sxs-lookup"><span data-stu-id="46043-120">However, the **PathIO** methods follow a similar pattern and most of the guidance in this article applies to those methods too.</span></span> 

## <a name="conveience-vs-control"></a><span data-ttu-id="46043-121">コントロールと Conveience</span><span class="sxs-lookup"><span data-stu-id="46043-121">Conveience vs. control</span></span>

<span data-ttu-id="46043-122">A [ **StorageFile** ](https://docs.microsoft.com/uwp/api/windows.storage.storagefile)オブジェクトは、ネイティブの Win32 プログラミング モデルのようなファイル ハンドルではありません。</span><span class="sxs-lookup"><span data-stu-id="46043-122">A [**StorageFile**](https://docs.microsoft.com/uwp/api/windows.storage.storagefile) object is not a file handle like the native Win32 programming model.</span></span> <span data-ttu-id="46043-123">代わりに、 [ **StorageFile** ](https://docs.microsoft.com/uwp/api/windows.storage.storagefile)はその内容を操作するメソッドを使用するファイルの表現です。</span><span class="sxs-lookup"><span data-stu-id="46043-123">Instead, a [**StorageFile**](https://docs.microsoft.com/uwp/api/windows.storage.storagefile) is a representation of a file with methods to manipulate its contents.</span></span>

<span data-ttu-id="46043-124">この概念を理解することは、I/O を実行する場合に役立ちます、 **StorageFile**します。</span><span class="sxs-lookup"><span data-stu-id="46043-124">Understanding this concept is useful when performing I/O with a **StorageFile**.</span></span> <span data-ttu-id="46043-125">など、[ファイルへの書き込み](quickstart-reading-and-writing-files.md#writing-to-a-file)ファイルへの書き込みに 3 つの方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="46043-125">For example, the [Writing to a file](quickstart-reading-and-writing-files.md#writing-to-a-file) section presents three ways to write to a file:</span></span>

* <span data-ttu-id="46043-126">使用して、 [ **FileIO.WriteTextAsync** ](https://docs.microsoft.com/uwp/api/windows.storage.fileio.writetextasync)メソッド。</span><span class="sxs-lookup"><span data-stu-id="46043-126">Using the [**FileIO.WriteTextAsync**](https://docs.microsoft.com/uwp/api/windows.storage.fileio.writetextasync) method.</span></span>
* <span data-ttu-id="46043-127">バッファーを作成し、呼び出すことによって、 [ **FileIO.WriteBufferAsync** ](https://docs.microsoft.com/en-us/uwp/api/windows.storage.fileio.writebufferasync)メソッド。</span><span class="sxs-lookup"><span data-stu-id="46043-127">By creating a buffer and then calling the [**FileIO.WriteBufferAsync**](https://docs.microsoft.com/en-us/uwp/api/windows.storage.fileio.writebufferasync) method.</span></span>
* <span data-ttu-id="46043-128">ストリームを使用して 4 つのステップ モデル:</span><span class="sxs-lookup"><span data-stu-id="46043-128">The four-step model using a stream:</span></span>
  1. <span data-ttu-id="46043-129">[開いている](https://docs.microsoft.com/uwp/api/windows.storage.storagefile.openasync)ファイル ストリームを取得します。</span><span class="sxs-lookup"><span data-stu-id="46043-129">[Open](https://docs.microsoft.com/uwp/api/windows.storage.storagefile.openasync) the file to get a stream.</span></span>
  2. <span data-ttu-id="46043-130">[取得](https://docs.microsoft.com/uwp/api/windows.storage.streams.irandomaccessstream.getoutputstreamat)出力ストリーム。</span><span class="sxs-lookup"><span data-stu-id="46043-130">[Get](https://docs.microsoft.com/uwp/api/windows.storage.streams.irandomaccessstream.getoutputstreamat) an output stream.</span></span>
  3. <span data-ttu-id="46043-131">作成、 [ **datawriter の各**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datawriter)オブジェクトし、対応する呼び出し**書き込み**メソッド。</span><span class="sxs-lookup"><span data-stu-id="46043-131">Create a [**DataWriter**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datawriter) object and call the corresponding **Write** method.</span></span>
  4. <span data-ttu-id="46043-132">[コミット](https://docs.microsoft.com/uwp/api/windows.storage.streams.datawriter.storeasync)データ ライターのデータと[フラッシュ](https://docs.microsoft.com/uwp/api/windows.storage.streams.ioutputstream.flushasync)出力ストリーム。</span><span class="sxs-lookup"><span data-stu-id="46043-132">[Commit](https://docs.microsoft.com/uwp/api/windows.storage.streams.datawriter.storeasync) the data in the data writer and [flush](https://docs.microsoft.com/uwp/api/windows.storage.streams.ioutputstream.flushasync) the output stream.</span></span>

<span data-ttu-id="46043-133">最初の 2 つのシナリオとは、アプリで最もよく使用されるものです。</span><span class="sxs-lookup"><span data-stu-id="46043-133">The first two scenarios are the ones most commonly used by apps.</span></span> <span data-ttu-id="46043-134">1 回の操作でファイルへの書き込みが簡単にコーディングし、保守、およびファイル I/O の複雑さの多くを扱うからアプリの役目が削除されます。</span><span class="sxs-lookup"><span data-stu-id="46043-134">Writing to the file in a single operation is easier to code and maintain, and it also removes the responsibility of the app from dealing with many of the complexities of file I/O.</span></span> <span data-ttu-id="46043-135">ただし、この便利な機能はコストがかかります。 制御操作全体や特定の時点でエラーをキャッチする機能が失われる。</span><span class="sxs-lookup"><span data-stu-id="46043-135">However, this convenience comes at a cost: the loss of control over the entire operation and the ability to catch errors at specific points.</span></span>

## <a name="the-transactional-model"></a><span data-ttu-id="46043-136">トランザクション モデル</span><span class="sxs-lookup"><span data-stu-id="46043-136">The transactional model</span></span>

<span data-ttu-id="46043-137">**書き込み**のメソッド、 [ **FileIO** ](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO)と[ **PathIO** ](https://docs.microsoft.com/uwp/api/windows.storage.pathio)クラス、3 番目の書き込み時に、手順をラップします。追加のレイヤーで、上記で説明したモデル。</span><span class="sxs-lookup"><span data-stu-id="46043-137">The **Write** methods of the [**FileIO**](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO) and [**PathIO**](https://docs.microsoft.com/uwp/api/windows.storage.pathio) classes wrap the steps on the third write model described above, with an added layer.</span></span> <span data-ttu-id="46043-138">このレイヤーは、ストレージ トランザクションにカプセル化します。</span><span class="sxs-lookup"><span data-stu-id="46043-138">This layer is encapsulated in a storage transaction.</span></span>

<span data-ttu-id="46043-139">データの書き込み中に問題が発生した場合、元のファイルの整合性を保護する、**書き込み**メソッドを使用してファイルを開くことで、トランザクションのモデルを使用して[ **OpenTransactedWriteAsync**](https://docs.microsoft.com/uwp/api/windows.storage.storagefile.opentransactedwriteasync).</span><span class="sxs-lookup"><span data-stu-id="46043-139">To protect the integrity of the original file in case something goes wrong while writing the data, the **Write** methods use a transactional model by opening the file using [**OpenTransactedWriteAsync**](https://docs.microsoft.com/uwp/api/windows.storage.storagefile.opentransactedwriteasync).</span></span> <span data-ttu-id="46043-140">このプロセスを作成、 [ **StorageStreamTransaction** ](https://docs.microsoft.com/uwp/api/windows.storage.storagestreamtransaction)オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="46043-140">This process creates a [**StorageStreamTransaction**](https://docs.microsoft.com/uwp/api/windows.storage.storagestreamtransaction) object.</span></span> <span data-ttu-id="46043-141">Api と同様の方法を次データの書き込みはこのトランザクション オブジェクトの作成後、[ファイル アクセス](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/FileAccess)サンプルやコード例で、 [ **StorageStreamTransaction** ](https://docs.microsoft.com/uwp/api/windows.storage.storagestreamtransaction)記事。</span><span class="sxs-lookup"><span data-stu-id="46043-141">After this transaction object is created, the APIs write the data following a similar fashion to the [File Access](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/FileAccess) sample or the code example in the [**StorageStreamTransaction**](https://docs.microsoft.com/uwp/api/windows.storage.storagestreamtransaction) article.</span></span>

<span data-ttu-id="46043-142">次の図で実行される基になるタスクを示しています。、、 **WriteTextAsync**成功した書き込み操作のメソッド。</span><span class="sxs-lookup"><span data-stu-id="46043-142">The following diagram illustrates the underlying tasks performed by the the **WriteTextAsync** method in a successful write operation.</span></span> <span data-ttu-id="46043-143">この図では、操作の簡略化されたビューを提供します。</span><span class="sxs-lookup"><span data-stu-id="46043-143">This illustration provides a simplified view of the operation.</span></span> <span data-ttu-id="46043-144">たとえば、異なるスレッドでテキストのエンコードと非同期の完了などの手順をスキップします。</span><span class="sxs-lookup"><span data-stu-id="46043-144">For example, it skips steps such as text encoding and async completion on different threads.</span></span>

![ファイルへの書き込みの UWP API 呼び出しのシーケンス図](images/file-write-call-sequence.svg)

<span data-ttu-id="46043-146">使用する利点、**書き込み**のメソッド、 [ **FileIO** ](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO)と[ **PathIO** ](https://docs.microsoft.com/uwp/api/windows.storage.pathio)クラスの代わりにストリームを使用してより複雑な 4 つのステップのモデルの次のようには。</span><span class="sxs-lookup"><span data-stu-id="46043-146">The advantages of using the **Write** methods of the [**FileIO**](https://docs.microsoft.com/uwp/api/Windows.Storage.FileIO) and [**PathIO**](https://docs.microsoft.com/uwp/api/windows.storage.pathio) classes instead of the more complex four-step model using a stream are:</span></span>

* <span data-ttu-id="46043-147">中間すべてのステップをエラーなどの処理を 1 回の API 呼び出し。</span><span class="sxs-lookup"><span data-stu-id="46043-147">One API call to handle all the intermediate steps, including errors.</span></span>
* <span data-ttu-id="46043-148">問題が発生した場合、元のファイルは保持されます。</span><span class="sxs-lookup"><span data-stu-id="46043-148">The original file is kept if something goes wrong.</span></span>
* <span data-ttu-id="46043-149">システム状態は保持可能な限りクリーンアップしようとします。</span><span class="sxs-lookup"><span data-stu-id="46043-149">The system state will try to be kept as clean as possible.</span></span>

<span data-ttu-id="46043-150">ただし、多く可能な中間一点障害は、障害の可能性が高くがあります。</span><span class="sxs-lookup"><span data-stu-id="46043-150">However, with so many possible intermediate points of failure, there’s an increased chance of failure.</span></span> <span data-ttu-id="46043-151">エラーが発生したときに、プロセスが失敗した場所を理解しにくい場合があります。</span><span class="sxs-lookup"><span data-stu-id="46043-151">When an error occurs it may be difficult to understand where the process failed.</span></span> <span data-ttu-id="46043-152">次のセクションでは、表示を使用する場合に発生する可能性がエラーのいくつか、**書き込み**メソッドと考えられる解決策を提供します。</span><span class="sxs-lookup"><span data-stu-id="46043-152">The following sections present some of the failures you might encounter when using the **Write** methods and provide possible solutions.</span></span>

## <a name="common-error-codes-for-write-methods-of-the-fileio-and-pathio-classes"></a><span data-ttu-id="46043-153">FileIO と PathIO クラスの Write メソッドの一般的なエラー コード</span><span class="sxs-lookup"><span data-stu-id="46043-153">Common error codes for Write methods of the FileIO and PathIO classes</span></span>

<span data-ttu-id="46043-154">このテーブルを使用する場合、アプリの開発者が直面する一般的なエラー コードの表示、**書き込み**メソッド。</span><span class="sxs-lookup"><span data-stu-id="46043-154">This table presents common error codes that app developers encounter when using the **Write** methods.</span></span> <span data-ttu-id="46043-155">表の手順は、前の図の手順に対応します。</span><span class="sxs-lookup"><span data-stu-id="46043-155">The steps in the table correspond to steps in the previous diagram.</span></span>

|  <span data-ttu-id="46043-156">エラー名 (値)</span><span class="sxs-lookup"><span data-stu-id="46043-156">Error name (value)</span></span>  |  <span data-ttu-id="46043-157">手順</span><span class="sxs-lookup"><span data-stu-id="46043-157">Steps</span></span>  |  <span data-ttu-id="46043-158">原因</span><span class="sxs-lookup"><span data-stu-id="46043-158">Causes</span></span>  |  <span data-ttu-id="46043-159">解決策</span><span class="sxs-lookup"><span data-stu-id="46043-159">Solutions</span></span>  |
|----------------------|---------|----------|-------------|
|  <span data-ttu-id="46043-160">ERROR_ACCESS_DENIED (0X80070005)</span><span class="sxs-lookup"><span data-stu-id="46043-160">ERROR_ACCESS_DENIED (0X80070005)</span></span>  |  <span data-ttu-id="46043-161">5</span><span class="sxs-lookup"><span data-stu-id="46043-161">5</span></span>  |  <span data-ttu-id="46043-162">場合によって、前の操作からの削除元のファイルをマークする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="46043-162">The original file might be marked for deletion, possibly from a previous operation.</span></span>  |  <span data-ttu-id="46043-163">操作を再試行します。</span><span class="sxs-lookup"><span data-stu-id="46043-163">Retry the operation.</span></span></br><span data-ttu-id="46043-164">ファイルへのアクセスが同期されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="46043-164">Ensure access to the file is synchronized.</span></span>  |
|  <span data-ttu-id="46043-165">ERROR_SHARING_VIOLATION (0x80070020)</span><span class="sxs-lookup"><span data-stu-id="46043-165">ERROR_SHARING_VIOLATION (0x80070020)</span></span>  |  <span data-ttu-id="46043-166">5</span><span class="sxs-lookup"><span data-stu-id="46043-166">5</span></span>  |  <span data-ttu-id="46043-167">元のファイルが別の排他的書き込みによって開かれます。</span><span class="sxs-lookup"><span data-stu-id="46043-167">The original file is opened by another exclusive write.</span></span>   |  <span data-ttu-id="46043-168">操作を再試行します。</span><span class="sxs-lookup"><span data-stu-id="46043-168">Retry the operation.</span></span></br><span data-ttu-id="46043-169">ファイルへのアクセスが同期されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="46043-169">Ensure access to the file is synchronized.</span></span>  |
|  <span data-ttu-id="46043-170">ERROR_UNABLE_TO_REMOVE_REPLACED (0x80070497)</span><span class="sxs-lookup"><span data-stu-id="46043-170">ERROR_UNABLE_TO_REMOVE_REPLACED (0x80070497)</span></span>  |  <span data-ttu-id="46043-171">19-20</span><span class="sxs-lookup"><span data-stu-id="46043-171">19-20</span></span>  |  <span data-ttu-id="46043-172">使用されているために、元のファイル (file.txt) を置き換えられませんでした。</span><span class="sxs-lookup"><span data-stu-id="46043-172">The original file (file.txt) could not be replaced because it is in use.</span></span> <span data-ttu-id="46043-173">別のプロセスまたは操作は、ファイルへのアクセスを獲得してから、前に、置き換えることができます。</span><span class="sxs-lookup"><span data-stu-id="46043-173">Another process or operation gained access to the file before it could be replaced.</span></span>  |  <span data-ttu-id="46043-174">操作を再試行します。</span><span class="sxs-lookup"><span data-stu-id="46043-174">Retry the operation.</span></span></br><span data-ttu-id="46043-175">ファイルへのアクセスが同期されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="46043-175">Ensure access to the file is synchronized.</span></span>  |
|  <span data-ttu-id="46043-176">ERROR_DISK_FULL (0X80070070)</span><span class="sxs-lookup"><span data-stu-id="46043-176">ERROR_DISK_FULL (0x80070070)</span></span>  |  <span data-ttu-id="46043-177">7, 14, 16, 20</span><span class="sxs-lookup"><span data-stu-id="46043-177">7, 14, 16, 20</span></span>  |  <span data-ttu-id="46043-178">トランザクション モデルが、余分なファイルを作成し、これは追加の記憶域を消費します。</span><span class="sxs-lookup"><span data-stu-id="46043-178">The transacted model creates an extra file, and this consumes extra storage.</span></span>  |    |
|  <span data-ttu-id="46043-179">ERROR_OUTOFMEMORY (0x8007000E)</span><span class="sxs-lookup"><span data-stu-id="46043-179">ERROR_OUTOFMEMORY (0x8007000E)</span></span>  |  <span data-ttu-id="46043-180">14, 16</span><span class="sxs-lookup"><span data-stu-id="46043-180">14, 16</span></span>  |  <span data-ttu-id="46043-181">これは、複数の未処理の I/O 操作またはより大きなファイル サイズのため発生することができます。</span><span class="sxs-lookup"><span data-stu-id="46043-181">This can happen due to multiple outstanding I/O operations or large file sizes.</span></span>  |  <span data-ttu-id="46043-182">ストリームを制御することで詳細な方法は、エラーを解決する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="46043-182">A more granular approach by controlling the stream might resolve the error.</span></span>  |
|  <span data-ttu-id="46043-183">E_FAIL (0X80004005)</span><span class="sxs-lookup"><span data-stu-id="46043-183">E_FAIL (0x80004005)</span></span> |  <span data-ttu-id="46043-184">任意</span><span class="sxs-lookup"><span data-stu-id="46043-184">Any</span></span>  |  <span data-ttu-id="46043-185">その他</span><span class="sxs-lookup"><span data-stu-id="46043-185">Miscellaneous</span></span>  |  <span data-ttu-id="46043-186">操作を再試行します。</span><span class="sxs-lookup"><span data-stu-id="46043-186">Retry the operation.</span></span> <span data-ttu-id="46043-187">まだ失敗する場合は、プラットフォームのエラーがあり、不整合な状態になっているため、アプリが終了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="46043-187">If it still fails, it might be a platform error and the app should terminate because it's in an inconsistent state.</span></span> |

## <a name="other-considerations-for-file-states-that-might-lead-to-errors"></a><span data-ttu-id="46043-188">エラーにつながる可能性のあるファイルの状態に関するその他の考慮事項</span><span class="sxs-lookup"><span data-stu-id="46043-188">Other considerations for file states that might lead to errors</span></span>

<span data-ttu-id="46043-189">によって返されるエラーとは別に、**書き込み**メソッド、ファイルに書き込むときに、アプリに期待をいくつかのガイドラインを示します。</span><span class="sxs-lookup"><span data-stu-id="46043-189">Apart from errors returned by the **Write** methods, here are some guidelines on what an app can expect when writing to a file.</span></span>

### <a name="data-was-written-to-the-file-if-and-only-if-operation-completed"></a><span data-ttu-id="46043-190">操作が完了した場合にのみ、データがファイルに書き込まれました。</span><span class="sxs-lookup"><span data-stu-id="46043-190">Data was written to the file if and only if operation completed</span></span>

<span data-ttu-id="46043-191">アプリしないでデータに関するすべての前提条件ファイルの書き込み操作の進行中。</span><span class="sxs-lookup"><span data-stu-id="46043-191">Your app should not make any assumption about data in the file while a write operation is in progress.</span></span> <span data-ttu-id="46043-192">操作が完了する前に、ファイルにアクセスしようとしています。 は、データの矛盾を生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="46043-192">Trying to access the file before an operation completes might lead to inconsistent data.</span></span> <span data-ttu-id="46043-193">アプリは、担当の未処理 I/o 数を追跡する必要があります。</span><span class="sxs-lookup"><span data-stu-id="46043-193">Your app should be responsible of tracking outstanding I/Os.</span></span>

### <a name="readers"></a><span data-ttu-id="46043-194">Readers</span><span class="sxs-lookup"><span data-stu-id="46043-194">Readers</span></span>

<span data-ttu-id="46043-195">書き込まれるになっているファイルが正常なリーダーによって使用されている場合 (では、開かれた[ **FileAccessMode.Read**](https://docs.microsoft.com/uwp/api/Windows.Storage.FileAccessMode)、それ以降の読み取りは ERROR_OPLOCK_HANDLE_CLOSED (0x80070323) エラーで失敗します。</span><span class="sxs-lookup"><span data-stu-id="46043-195">If the file that being written to is also being used by a polite reader (that is, opened with [**FileAccessMode.Read**](https://docs.microsoft.com/uwp/api/Windows.Storage.FileAccessMode), subsequent reads will fail with an error ERROR_OPLOCK_HANDLE_CLOSED (0x80070323).</span></span> <span data-ttu-id="46043-196">読み取り中にもう一度ファイルを開くをアプリが再試行することがあります、**書き込み**操作が進行中です。</span><span class="sxs-lookup"><span data-stu-id="46043-196">Sometimes apps retry opening the file for read again while the **Write** operation is ongoing.</span></span> <span data-ttu-id="46043-197">これを競合状態があります、**書き込み**に置き換えることができませんので、元のファイルを上書きしようとするときは最終的に失敗します。</span><span class="sxs-lookup"><span data-stu-id="46043-197">This might result in a race condition on which the **Write** ultimately fails when trying to overwrite the original file because it cannot be replaced.</span></span>

### <a name="files-from-knownfolders"></a><span data-ttu-id="46043-198">KnownFolders からのファイル</span><span class="sxs-lookup"><span data-stu-id="46043-198">Files from KnownFolders</span></span>

<span data-ttu-id="46043-199">アプリのいずれかに置かれているファイルへのアクセスを試行している唯一のアプリをできない可能性があります、 [ **KnownFolders**](https://docs.microsoft.com/uwp/api/Windows.Storage.KnownFolders)します。</span><span class="sxs-lookup"><span data-stu-id="46043-199">Your app might not be the only app that is trying to access a file that resides on any of the [**KnownFolders**](https://docs.microsoft.com/uwp/api/Windows.Storage.KnownFolders).</span></span> <span data-ttu-id="46043-200">操作が成功した場合、アプリがファイルに書き込んだ内容が一定に保つように保証ファイルを読み取ろうとした次の時間はありません。</span><span class="sxs-lookup"><span data-stu-id="46043-200">There’s no guarantee that if the operation is successful, the contents an app wrote to the file will remain constant the next time it tries to read the file.</span></span> <span data-ttu-id="46043-201">また、共有またはアクセスには、このシナリオでますます一般的になるエラーが拒否されました。</span><span class="sxs-lookup"><span data-stu-id="46043-201">Also, sharing or access denied errors become more common under this scenario.</span></span>

### <a name="conflicting-io"></a><span data-ttu-id="46043-202">競合している I/O</span><span class="sxs-lookup"><span data-stu-id="46043-202">Conflicting I/O</span></span>

<span data-ttu-id="46043-203">アプリで使用する場合、同時実行エラーの可能性を下げることができます、**書き込み**メソッドのローカルのデータがいくつか注意が必要でのファイルが必要です。</span><span class="sxs-lookup"><span data-stu-id="46043-203">The chances of concurrency errors can be lowered if our app uses the **Write** methods for files in its local data, but some caution is still required.</span></span> <span data-ttu-id="46043-204">複数**書き込み**操作に送信される同時に、ファイル、ファイルに最終的にどのようなデータに関する保証はありません。</span><span class="sxs-lookup"><span data-stu-id="46043-204">If multiple **Write** operations are being sent concurrently to the file, there’s no guarantee about what data ends up in the file.</span></span> <span data-ttu-id="46043-205">これを防ぐことをお勧めします、アプリがシリアル化**書き込み**ファイルを操作します。</span><span class="sxs-lookup"><span data-stu-id="46043-205">To mitigate this, we recommend that your app serializes **Write** operations to the file.</span></span>

### <a name="tmp-files"></a><span data-ttu-id="46043-206">~ TMP ファイル</span><span class="sxs-lookup"><span data-stu-id="46043-206">~TMP files</span></span>

<span data-ttu-id="46043-207">場合によっては場合 (たとえばアプリが中断または、OS によって終了場合)、操作が強制的に取り消された、トランザクションがコミットまたはいない適切に閉じられました。</span><span class="sxs-lookup"><span data-stu-id="46043-207">Occasionally, if the operation is forcefully cancelled (for example, if the app was suspended or terminated by the OS), the transaction is not committed or closed appropriately.</span></span> <span data-ttu-id="46043-208">ファイルを残すこれを (. ~ TMP) 拡張機能。</span><span class="sxs-lookup"><span data-stu-id="46043-208">This can leave behind files with a (.~TMP) extension.</span></span> <span data-ttu-id="46043-209">(アプリのローカル データに存在する) 場合は、これらの一時ファイルを削除を検討してアプリのアクティブ化を処理するときにします。</span><span class="sxs-lookup"><span data-stu-id="46043-209">Consider deleting these temporary files (if they exist in the app's local data) when handling the app activation.</span></span>

## <a name="considerations-based-on-file-types"></a><span data-ttu-id="46043-210">ファイルの種類に基づくに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="46043-210">Considerations based on file types</span></span>

<span data-ttu-id="46043-211">ファイルにアクセス中、頻度や、ファイル サイズの種類に応じてより普及しているいくつかのエラーになります。</span><span class="sxs-lookup"><span data-stu-id="46043-211">Some errors can become more prevalent depending on the type of files, the frequency on which they’re accessed, and their file size.</span></span> <span data-ttu-id="46043-212">一般に、アプリがアクセスできるファイルの 3 つに分類されます。</span><span class="sxs-lookup"><span data-stu-id="46043-212">Generally, there are three categories of files your app can access:</span></span>

* <span data-ttu-id="46043-213">ファイルが作成され、アプリのデータをローカル フォルダーにユーザーを編集します。</span><span class="sxs-lookup"><span data-stu-id="46043-213">Files created and edited by the user in your app's local data folder.</span></span> <span data-ttu-id="46043-214">これらが作成され、アプリを使用している場合にのみ編集して、アプリ内でのみ存在します。</span><span class="sxs-lookup"><span data-stu-id="46043-214">These are created and edited only while using your app, and they exist only within the app.</span></span>
* <span data-ttu-id="46043-215">アプリのメタデータ。</span><span class="sxs-lookup"><span data-stu-id="46043-215">App metadata.</span></span> <span data-ttu-id="46043-216">アプリは、独自の状態を追跡するのにこれらのファイルを使用します。</span><span class="sxs-lookup"><span data-stu-id="46043-216">Your app uses these files to keep track of its own state.</span></span>
* <span data-ttu-id="46043-217">その他のファイル、アプリがアクセスする機能を宣言されているファイル システム内の場所にします。</span><span class="sxs-lookup"><span data-stu-id="46043-217">Other files in locations of the file system where your app has declared capabilities to access.</span></span> <span data-ttu-id="46043-218">いずれかでにあるこれらは通常、 [ **KnownFolders**](https://docs.microsoft.com/uwp/api/Windows.Storage.KnownFolders)します。</span><span class="sxs-lookup"><span data-stu-id="46043-218">These are most commonly located in one of the [**KnownFolders**](https://docs.microsoft.com/uwp/api/Windows.Storage.KnownFolders).</span></span>

<span data-ttu-id="46043-219">アプリは、アプリのパッケージ ファイルの一部であるし、アプリによって排他アクセスがあるため、ファイルの最初の 2 つのカテゴリに対するフル コントロールが。</span><span class="sxs-lookup"><span data-stu-id="46043-219">Your app has full control on the first two categories of files, because they’re part of your app's package files and are accessed by your app exclusively.</span></span> <span data-ttu-id="46043-220">最後のカテゴリ内のファイル、アプリが、他のアプリと OS のサービスがファイルにアクセスする同時に注意してください必要があります。</span><span class="sxs-lookup"><span data-stu-id="46043-220">For files in the last category, your app must be aware that other apps and OS services may be accessing the files concurrently.</span></span>

<span data-ttu-id="46043-221">アプリによっては、ファイルへのアクセス頻度に変わります。</span><span class="sxs-lookup"><span data-stu-id="46043-221">Depending on the app, access to the files can vary on frequency:</span></span>

* <span data-ttu-id="46043-222">非常に低いです。</span><span class="sxs-lookup"><span data-stu-id="46043-222">Very low.</span></span> <span data-ttu-id="46043-223">通常、これらは、ファイルを開くときに、アプリの起動とが保存した後、アプリが中断されている場合です。</span><span class="sxs-lookup"><span data-stu-id="46043-223">These are usually files that are opened once when the app launches and are saved when the app is suspended.</span></span>
* <span data-ttu-id="46043-224">低。</span><span class="sxs-lookup"><span data-stu-id="46043-224">Low.</span></span> <span data-ttu-id="46043-225">これらは、ユーザーが (保存または読み込みなど) での作業を行った具体的にはファイルです。</span><span class="sxs-lookup"><span data-stu-id="46043-225">These are files that the user is specifically taking an action on (such as save or load).</span></span>
* <span data-ttu-id="46043-226">中または高です。</span><span class="sxs-lookup"><span data-stu-id="46043-226">Medium or high.</span></span> <span data-ttu-id="46043-227">これらは、アプリに更新する必要がありますのデータ (たとえば、自動保存機能または定数のメタデータを追跡) 常にファイルです。</span><span class="sxs-lookup"><span data-stu-id="46043-227">These are files in which the app must constantly update data (for example, autosave features or constant metadata tracking).</span></span>

<span data-ttu-id="46043-228">ファイルのサイズ、パフォーマンス データの次のグラフを検討してください、 **WriteBytesAsync**メソッド。</span><span class="sxs-lookup"><span data-stu-id="46043-228">For file size, consider the performance data in the following chart for the **WriteBytesAsync** method.</span></span> <span data-ttu-id="46043-229">このグラフは、完全な操作とファイル サイズは、管理された環境でのファイル サイズあたり 10,000 操作の平均のパフォーマンスを時間を比較します。</span><span class="sxs-lookup"><span data-stu-id="46043-229">This chart compares the time to complete an operation vs file size, over an average performance of 10000 operations per file size in a controlled environment.</span></span>

![WriteBytesAsync パフォーマンス](images/writebytesasync-performance.png)

<span data-ttu-id="46043-231">時刻の値、y 軸には、さまざまなハードウェアおよび構成はさまざまな絶対時刻値を生成するためこのグラフから意図的に省略されます。</span><span class="sxs-lookup"><span data-stu-id="46043-231">The time values on the y-axis are omitted intentionally from this chart because different hardware and configurations will yield different absolute time values.</span></span> <span data-ttu-id="46043-232">ただし、マイクロソフトによるテストでこのような傾向を監視していた一貫しています。</span><span class="sxs-lookup"><span data-stu-id="46043-232">However, we have consistently observed these trends in our tests:</span></span>

* <span data-ttu-id="46043-233">非常に小さなファイル (< = 1 MB)。操作を完了に時間が一貫して高速です。</span><span class="sxs-lookup"><span data-stu-id="46043-233">For very small files (<= 1 MB): The time to complete the operations is consistently fast.</span></span>
* <span data-ttu-id="46043-234">大きなファイル (> 1 MB)。操作を完了するには、指数関数的に増加を開始します。</span><span class="sxs-lookup"><span data-stu-id="46043-234">For larger files (> 1 MB): The time to complete the operations starts to increase exponentially.</span></span>

## <a name="io-during-app-suspension"></a><span data-ttu-id="46043-235">アプリの中断中に I/O</span><span class="sxs-lookup"><span data-stu-id="46043-235">I/O during app suspension</span></span>

<span data-ttu-id="46043-236">アプリは、状態情報の保持またはメタデータを以降のセッションで使用する場合は、中断を処理するために設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="46043-236">Your app must designed to handle suspension if you want to keep state information or metadata for use in later sessions.</span></span> <span data-ttu-id="46043-237">アプリの中断に関する背景情報は、[アプリのライフ サイクル](../launch-resume/app-lifecycle.md)と[このブログの投稿](https://blogs.windows.com/buildingapps/2016/04/28/the-lifecycle-of-a-uwp-app/#qLwdmV5zfkAPMEco.97)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="46043-237">For background information about app suspension, see [App lifecycle](../launch-resume/app-lifecycle.md) and [this blog post](https://blogs.windows.com/buildingapps/2016/04/28/the-lifecycle-of-a-uwp-app/#qLwdmV5zfkAPMEco.97).</span></span>

<span data-ttu-id="46043-238">OS がアプリに延長実行を許可しない限り、すべてのリソースを解放し、そのデータを保存するには、5 秒間、アプリが中断されている場合があります。</span><span class="sxs-lookup"><span data-stu-id="46043-238">Unless the OS grants extended execution to your app, when your app is suspended it has 5 seconds to release all its resources and save its data.</span></span> <span data-ttu-id="46043-239">最高の信頼性とユーザー エクスペリエンス、常に中断タスクを処理する必要がある時間は限られて前提としています。</span><span class="sxs-lookup"><span data-stu-id="46043-239">For the best reliability and user experience, always assume the time you have to handle suspension tasks is limited.</span></span> <span data-ttu-id="46043-240">5 秒間中断タスクを処理するための期間中に、次のガイドラインを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="46043-240">Keep in mind the following guidelines during the 5 second time period for handling suspension tasks:</span></span>

* <span data-ttu-id="46043-241">フラッシュとリリースの操作によって発生する競合状況を回避するために最低限に I/O を維持しようとしてください。</span><span class="sxs-lookup"><span data-stu-id="46043-241">Try to keep I/O to a minimum to avoid race conditions caused by flushing and release operations.</span></span>
* <span data-ttu-id="46043-242">数百ミリ秒以上書き込むに必要なファイルを記述しないでください。</span><span class="sxs-lookup"><span data-stu-id="46043-242">Avoid writing files that require hundreds of milliseconds or more to write.</span></span>
* <span data-ttu-id="46043-243">アプリで使用する場合、**書き込み**メソッド、留意してこれらのメソッドを必要とするすべての中間手順。</span><span class="sxs-lookup"><span data-stu-id="46043-243">If your app uses the **Write** methods, keep in mind all the intermediate steps that these methods require.</span></span>

<span data-ttu-id="46043-244">アプリの動作は、少量の状態データの中断中に場合、ほとんどの場合に使用できます、**書き込み**メソッドは、データをフラッシュします。</span><span class="sxs-lookup"><span data-stu-id="46043-244">If your app operates on a small amount of state data during suspension, in most cases you can use the **Write** methods to flush the data.</span></span> <span data-ttu-id="46043-245">ただし、アプリは、大量の状態データを使用している場合は、直接データを格納するストリームを使用して検討してください。</span><span class="sxs-lookup"><span data-stu-id="46043-245">However, if your app uses a large amount of state data, consider using streams to directly store your data.</span></span> <span data-ttu-id="46043-246">トランザクション モデルでの遅延を減らすこうと、**書き込み**メソッド。</span><span class="sxs-lookup"><span data-stu-id="46043-246">This can help reduce the delay introduced by the transactional model of the **Write** methods.</span></span> 

<span data-ttu-id="46043-247">例については、次を参照してください。、 [BasicSuspension](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/BasicSuspension)サンプル。</span><span class="sxs-lookup"><span data-stu-id="46043-247">For an example, see the [BasicSuspension](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/BasicSuspension) sample.</span></span>

## <a name="other-examples-and-resources"></a><span data-ttu-id="46043-248">その他の例とリソース</span><span class="sxs-lookup"><span data-stu-id="46043-248">Other examples and resources</span></span>

<span data-ttu-id="46043-249">いくつかの例とその他のリソースを特定のシナリオを次に示します。</span><span class="sxs-lookup"><span data-stu-id="46043-249">Here are several examples and other resources for specific scenarios.</span></span>

### <a name="code-example-for-retrying-file-io-example"></a><span data-ttu-id="46043-250">ファイル I/O の例を再試行するためのコード例</span><span class="sxs-lookup"><span data-stu-id="46043-250">Code example for retrying file I/O example</span></span>

<span data-ttu-id="46043-251">書き込みを再試行する方法の擬似コードの例を次に示します (C#)、ユーザーは保存するためのファイルを取得した後で行うには、書き込みと仮定した場合します。</span><span class="sxs-lookup"><span data-stu-id="46043-251">The following is a pseudo-code example on how to retry a write (C#), assuming the write is to be done after the user picks a file for saving:</span></span>

```csharp
Windows.Storage.Pickers.FileSavePicker savePicker = new Windows.Storage.Pickers.FileSavePicker();
savePicker.FileTypeChoices.Add("Plain Text", new List<string>() { ".txt" });
Windows.Storage.StorageFile file = await savePicker.PickSaveFileAsync();

Int32 retryAttempts = 5;

const Int32 ERROR_ACCESS_DENIED = unchecked((Int32)0x80070005);
const Int32 ERROR_SHARING_VIOLATION = unchecked((Int32)0x80070020);

if (file != null)
{
    // Application now has read/write access to the picked file.
    while (retryAttempts > 0)
    {
        try
        {
            retryAttempts--;
            await Windows.Storage.FileIO.WriteTextAsync(file, "Text to write to file");
            break;
        }
        catch (Exception ex) when ((ex.HResult == ERROR_ACCESS_DENIED) ||
                                   (ex.HResult == ERROR_SHARING_VIOLATION))
        {
            // This might be recovered by retrying, otherwise let the exception be raised.
            // The app can decide to wait before retrying.
        }
    }
}
else
{
    // The operation was cancelled in the picker dialog.
}
```

### <a name="synchronize-access-to-the-file"></a><span data-ttu-id="46043-252">ファイルへのアクセスを同期します。</span><span class="sxs-lookup"><span data-stu-id="46043-252">Synchronize access to the file</span></span>

<span data-ttu-id="46043-253">[.NET ブログでの並列プログラミング](https://blogs.msdn.microsoft.com/pfxteam/)ガイダンスについては、並列プログラミングに関する優れたリソースです。</span><span class="sxs-lookup"><span data-stu-id="46043-253">The [Parallel Programming with .NET blog](https://blogs.msdn.microsoft.com/pfxteam/) is a great resource for guidance about parallel programming.</span></span> <span data-ttu-id="46043-254">具体的には、 [AsyncReaderWriterLock について投稿](https://blogs.msdn.microsoft.com/pfxteam/2012/02/12/building-async-coordination-primitives-part-7-asyncreaderwriterlock/)同時の読み取りアクセスを許可するときに書き込み、ファイルへの排他アクセスを維持する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="46043-254">In particular, the [post about AsyncReaderWriterLock](https://blogs.msdn.microsoft.com/pfxteam/2012/02/12/building-async-coordination-primitives-part-7-asyncreaderwriterlock/) describes how to maintain exclusive access to a file for writes while allowing concurrent read access.</span></span> <span data-ttu-id="46043-255">留意そのシリアル化は I/O に影響を与えるパフォーマンス。</span><span class="sxs-lookup"><span data-stu-id="46043-255">Keep in mind that serializing I/O will impact performance.</span></span>

## <a name="see-also"></a><span data-ttu-id="46043-256">関連項目</span><span class="sxs-lookup"><span data-stu-id="46043-256">See also</span></span>

* [<span data-ttu-id="46043-257">作成、書き込み、およびファイルの読み取り</span><span class="sxs-lookup"><span data-stu-id="46043-257">Create, write, and read a file</span></span>](quickstart-reading-and-writing-files.md)
