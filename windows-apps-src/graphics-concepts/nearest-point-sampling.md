---
title: 最近点サンプリング
description: アプリケーションがテクスチャ フィルタリングを使う必要はありません。
ms.assetid: D7F88320-2C61-47E9-9B92-EC31D48DB079
keywords:
- 最近点サンプリング
author: michaelfromredmond
ms.author: mithom
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: 965660f51efc914f7ca21a5bf747fe809319eff9
ms.sourcegitcommit: e2fca6c79f31e521ba76f7ecf343cf8f278e6a15
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/15/2018
ms.locfileid: "6984137"
---
# <a name="span-iddirect3dconceptsnearest-pointsamplingspannearest-point-sampling"></a><span data-ttu-id="3a2c1-104"><span id="direct3dconcepts.nearest-point_sampling"></span>最近点サンプリング</span><span class="sxs-lookup"><span data-stu-id="3a2c1-104"><span id="direct3dconcepts.nearest-point_sampling"></span>Nearest-point sampling</span></span>


<span data-ttu-id="3a2c1-105">アプリケーションがテクスチャ フィルタリングを使う必要はありません。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-105">Applications are not required to use texture filtering.</span></span> <span data-ttu-id="3a2c1-106">Direct3D の設定により、テクセル アドレスを計算したり (これは多くの場合、整数として評価されません)、最も近い整数アドレスを持つテクセルのカラーをコピーさせたりすることができます。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-106">Direct3D can be set so that it computes the texel address, which often does not evaluate to integers, and copies the color of the texel with the closest integer address.</span></span> <span data-ttu-id="3a2c1-107">このプロセスは*最近点サンプリング*と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-107">This process is called *nearest-point sampling*.</span></span> <span data-ttu-id="3a2c1-108">最近点サンプリングは、テクスチャのサイズが画面上のプリミティブのイメージと同様の場合、テクスチャを処理するのにすばやく効率的な方法です。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-108">Nearest-point sampling can be a fast and efficient way to process textures if the size of the texture is similar to the size of the primitive's image on the screen.</span></span> <span data-ttu-id="3a2c1-109">そうでない場合、テクスチャを拡大または縮小する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-109">If not, the texture must be magnified or minified.</span></span> <span data-ttu-id="3a2c1-110">テクスチャのサイズとプリミティブ イメージのサイズが一致しない場合、イメージが太くなったり、エイリアシングされたり、ぼやけたりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-110">The result of mismatching texture sizes to primitive image size can be a chunky, aliased, or blurred image.</span></span>

<span data-ttu-id="3a2c1-111">2 つのテクセルの境界でテクスチャがサンプリングされるとグラフィックが不自然になる可能性があるため、最近点サンプリングは慎重に使ってください。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-111">Use nearest-point sampling carefully, because it can sometimes cause graphic artifacts when the texture is sampled at the boundary between two texels.</span></span> <span data-ttu-id="3a2c1-112">この境界は、サンプリングされたテクセルがあるテクセルから次のテクセルに移動するテクスチャに沿った位置 (u または v) です。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-112">This boundary is the position along the texture (u or v) at which the sampled texel transitions from one texel to the next.</span></span> <span data-ttu-id="3a2c1-113">点サンプリングを使うと、システムはいずれかのサンプル テクセルを選択するため、境界をまたぐと、あるテクセルと次のテクセルで結果が突然変わる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-113">When point sampling is used, the system chooses one sample texel or the other, and the result can change abruptly from one texel to the next texel as the boundary is crossed.</span></span> <span data-ttu-id="3a2c1-114">この効果は、表示されたテクスチャのグラフィックが不自然になって現れる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-114">This effect can appear as undesired graphic artifacts in the displayed texture.</span></span> <span data-ttu-id="3a2c1-115">リニア フィルタリングを使うと、生成されるテクセルは隣接する両方のテクセルから計算され、テクスチャ インデックスが境界をまたいで移動するとそれらのテクセルをスムーズにブレンドします。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-115">When linear filtering is used, the resulting texel is computed from both adjacent texels and smoothly blends between them as the texture index moves through the boundary.</span></span>

<span data-ttu-id="3a2c1-116">この効果は、非常に小さいテクスチャを非常に大きい多角形にマッピングすると (多くの場合、拡大と呼ばれる操作) 現れる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-116">This effect can be seen when mapping a very small texture onto a very large polygon: an operation often called magnification.</span></span> <span data-ttu-id="3a2c1-117">たとえば、チェッカーボードのようなテクスチャを使った場合、最近点サンプリングを行うと縁がはっきりした大きいチェッカーボードになります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-117">For example, when using a texture that looks like a checkerboard, nearest-point sampling results in a larger checkerboard that shows distinct edges.</span></span> <span data-ttu-id="3a2c1-118">一方、リニア テクスチャ フィルタリングを行うと、チェッカーボードの色が多角形間でスムーズに変化するイメージになります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-118">By contrast, linear texture filtering results in an image where the checkerboard colors vary smoothly across the polygon.</span></span>

<span data-ttu-id="3a2c1-119">ほとんどの場合、可能な限り最近点サンプリングを避けることでアプリケーションは最良の結果を出します。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-119">In most cases, applications receive the best results by avoiding nearest-point sample wherever possible.</span></span> <span data-ttu-id="3a2c1-120">現在のハードウェアの大部分は、リニア フィルタリングに合わせて最適化されているため、アプリケーションのパフォーマンスが低下することはありません。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-120">The majority of hardware today is optimized for linear filtering, so your application should not suffer degraded performance.</span></span> <span data-ttu-id="3a2c1-121">目的の効果を出すためにどうしても最近点サンプリングを使う必要がある場合 (読みやすいテキスト文字を表示するためにテクスチャを使う場合など)、アプリケーションがテクセル境界でサンプリングを行わないように特に注意する必要があります (望ましくない効果が現れる可能性があるため)。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-121">If the effect you desire absolutely requires the use of the nearest-point sampling - such as when using textures to display readable text characters - then your application should be extremely careful to avoid sampling at the texel boundaries, which might result in undesired effects.</span></span> <span data-ttu-id="3a2c1-122">次の図は、どのように不自然な効果が現れるかを示しています。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-122">The following illustration shows what these artifacts can look like.</span></span>

![右上の 2 つの四角形に連続しない水平線が表示されている、6 つに分割されたボックスの図](images/ptrtfct.png)

<span data-ttu-id="3a2c1-124">グループの右上にある 2 つの四角形は斜めのオフセットが通過しており、隣接する四角形と異なって表示されています。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-124">The two squares in the upper right of the group appear different than their neighbors, with diagonal offsets running through them.</span></span> <span data-ttu-id="3a2c1-125">このような不自然なグラフィックを避けるには、最近点サンプリングの Direct3D テクスチャ サンプリング ルールについて精通している必要があります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-125">To avoid graphic artifacts like these, you must be familiar with Direct3D texture sampling rules for nearest-point filtering.</span></span> <span data-ttu-id="3a2c1-126">Direct3D は、\[0.0, 1.0\] (0.0 ～ 1.0。両端を含む) の範囲の浮動小数点テクスチャ座標を、\[ - 0.5, n - 0.5\] (n はテクスチャの特定の範囲におけるテクセルの数) の範囲の整数テクセル空間値にマッピングします。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-126">Direct3D maps a floating-point texture coordinate ranging from \[0.0, 1.0\] (0.0 to 1.0, inclusive) to an integer texel space value ranging from \[ - 0.5, n - 0.5\], where n is the number of texels in a given dimension on the texture.</span></span> <span data-ttu-id="3a2c1-127">生成されたテクスチャ インデックスは最も近い整数に丸められます。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-127">The resulting texture index is rounded to the nearest integer.</span></span> <span data-ttu-id="3a2c1-128">このマッピングにより、テクセル境界でサンプリングが不正確になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-128">This mapping can introduce sampling inaccuracies at texel boundaries.</span></span>

<span data-ttu-id="3a2c1-129">シンプルな例として、ラップ テクスチャ アドレス指定モードで多角形をレンダリングするアプリケーションを想像してみてください。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-129">For a simple example, imagine an application that renders polygons with the Wrap texture addressing mode.</span></span> <span data-ttu-id="3a2c1-130">Direct3D により採用されているマッピングを使うと、次のテクスチャの図に示すように、u テクスチャ インデックスは 4 テクセルの幅にマッピングされます。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-130">Using the mapping employed by Direct3D, the u texture index maps as show in the following diagram for a texture with a width of 4 texels.</span></span>

![テクセルの境界にあるテクスチャ座標 0.0 および 1.0 の図](images/ptsmpprb.png)

<span data-ttu-id="3a2c1-132">この図のテクスチャ座標 0.0 および 1.0 は、ちょうどテクセルの境界にあります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-132">The texture coordinates, 0.0 and 1.0 for this illustration, are exactly at the boundary between texels.</span></span> <span data-ttu-id="3a2c1-133">Direct3D が値をマッピングする方法を使うと、テクスチャ座標の範囲は \[ - 0.5, 4 - 0.5\] (4 はテクスチャの幅) になります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-133">Using the method by which Direct3D maps values, the texture coordinates range from \[ - 0.5, 4 - 0.5\], where 4 is the width of the texture.</span></span> <span data-ttu-id="3a2c1-134">この場合、サンプリングされたテクセルはテクスチャ インデックスが 1.0 の 0 テクセルになります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-134">For this case, the sampled texel is the 0 texel for a texture index of 1.0.</span></span> <span data-ttu-id="3a2c1-135">ただし、テクスチャ座標が 1.0 をわずかに下回る場合、サンプリングされたテクセルは 0 テクセルではなく n テクセルになります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-135">However, if the texture coordinate was only slightly less than 1.0, the sampled texel would be the n texel instead of the 0 texel.</span></span>

<span data-ttu-id="3a2c1-136">これは、画面空間に沿った三角形で最近点フィルタリングを行って、ちょうど 0.0 および 1.0 のテクスチャ座標を使って小さいテクスチャを拡大すると、テクセルの境界でテクスチャ マップがサンプリングされるピクセルとなることを意味します。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-136">The implication of this is that magnifying a small texture using texture coordinates of exactly 0.0 and 1.0 with nearest-point filtering on a screen-space aligned triangle results in pixels for which the texture map is sampled at the boundary between texels.</span></span> <span data-ttu-id="3a2c1-137">テクスチャ座標の計算における不正確さは大きくありませんが、テクスチャ マップのテクセルの縁に対応する、レンダリングされたイメージ内の領域に沿って不自然な結果が生じます。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-137">Any inaccuracies in the computation of texture coordinates, however small, results in artifacts along the areas in the rendered image which correspond to the texel edges of the texture map.</span></span>

<span data-ttu-id="3a2c1-138">浮動小数点テクスチャ座標を完全な正確さで整数テクセルにマッピングするのは難しいだけでなく、計算に時間がかり、一般には必要ありません。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-138">Performing this mapping of floating point texture coordinates to integer texels with perfect accuracy is difficult, computationally time-consuming, and generally not necessary.</span></span> <span data-ttu-id="3a2c1-139">ほとんどのハードウェア実装では、三角形内の各ピクセル位置でテクスチャ座標を計算するために反復的な方法が使われます。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-139">Most hardware implementations use an iterative approach for computing texture coordinates at each pixel location within a triangle.</span></span> <span data-ttu-id="3a2c1-140">反復的な方法では、反復中エラーが均等に積み重なるため、このような不正確さが隠れる傾向にあります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-140">Iterative approaches tend to hide these inaccuracies because the errors are accumulated evenly during iteration.</span></span>

<span data-ttu-id="3a2c1-141">Direct3D リファレンス ラスタライザーでは、各ピクセル位置でテクスチャ インデックスを計算するために直接評価の方法が使われます。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-141">The Direct3D reference rasterizer uses a direct-evaluation approach for computing texture indexes at each pixel location.</span></span> <span data-ttu-id="3a2c1-142">直接評価は、操作の不正確さがよりランダムなエラー分布となって現れる点が反復的な方法と異なります。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-142">Direct evaluation differs from the iterative approach in that any inaccuracy in the operation exhibits a more random error distribution.</span></span> <span data-ttu-id="3a2c1-143">この結果、境界で発生したサンプリング エラーがより目立つことがあります。リファレンス ラスタライザーは、完全な正確さでこの操作を実行しないためです。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-143">The result of this is that the sampling errors that occur at the boundaries can be more noticeable because the reference rasterizer does not perform this operation with perfect accuracy.</span></span>

<span data-ttu-id="3a2c1-144">最も良い方法は、必要なときにだけ最近点フィルタリングを使うことです。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-144">The best approach is to use nearest-point filtering only when necessary.</span></span> <span data-ttu-id="3a2c1-145">使う必要がある場合は、テクスチャ座標を境界位置からわずかにオフセットして、不自然な結果を回避することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3a2c1-145">When you must use it, it is recommended that you offset texture coordinates slightly from the boundary positions to avoid artifacts.</span></span>

## <a name="span-idrelated-topicsspanrelated-topics"></a><span data-ttu-id="3a2c1-146"><span id="related-topics"></span>関連トピック</span><span class="sxs-lookup"><span data-stu-id="3a2c1-146"><span id="related-topics"></span>Related topics</span></span>


[<span data-ttu-id="3a2c1-147">テクスチャ フィルタリング</span><span class="sxs-lookup"><span data-stu-id="3a2c1-147">Texture filtering</span></span>](texture-filtering.md)

 

 




