---
title: 深度バッファー
description: 深度バッファー (z バッファー) は、ビューから隠される多角形の領域ではなく、レンダリングされるポリゴンの領域を制御する深度情報を格納します。
ms.assetid: BE83A1D7-D43D-4013-8817-EFD2B24DC58E
keywords:
- 深度バッファー
author: michaelfromredmond
ms.author: mithom
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: fb7ff4b23f9735347ce75e2e565c1b420ec936d6
ms.sourcegitcommit: 753e0a7160a88830d9908b446ef0907cc71c64e7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2018
ms.locfileid: "5768049"
---
# <a name="depth-buffers"></a><span data-ttu-id="76992-104">深度バッファー</span><span class="sxs-lookup"><span data-stu-id="76992-104">Depth buffers</span></span>


<span data-ttu-id="76992-105">*深度バッファー* (*z バッファー*) は、ビューから隠される多角形の領域ではなく、レンダリングされるポリゴンの領域を制御する深度情報を格納します。</span><span class="sxs-lookup"><span data-stu-id="76992-105">A *depth buffer*, or *z-buffer*, stores depth information to control which areas of polygons are rendered rather than hidden from view.</span></span>

## <a name="span-idoverviewspanspan-idoverviewspanspan-idoverviewspanoverview"></a><span data-ttu-id="76992-106"><span id="Overview"></span><span id="overview"></span><span id="OVERVIEW"></span>概要</span><span class="sxs-lookup"><span data-stu-id="76992-106"><span id="Overview"></span><span id="overview"></span><span id="OVERVIEW"></span>Overview</span></span>


<span data-ttu-id="76992-107">z バッファーや w バッファーとも呼ばれる、深度バッファーは、Direct3D で使用される深度情報を格納するデバイスのプロパティです。</span><span class="sxs-lookup"><span data-stu-id="76992-107">A depth buffer, often called a z-buffer or a w-buffer, is a property of the device that stores depth information to be used by Direct3D.</span></span> <span data-ttu-id="76992-108">Direct3D でターゲット サーフェスにシーンをレンダリングする場合、関連付けられた深度バッファー サーフェス内のメモリをワークスペースとして使用して、ラスタライズされた多角形のピクセルがどのように隠れるかを決定します。</span><span class="sxs-lookup"><span data-stu-id="76992-108">When Direct3D renders a scene to a target surface, it can use the memory in an associated depth-buffer surface as a workspace to determine how the pixels of rasterized polygons occlude one another.</span></span> <span data-ttu-id="76992-109">Direct3D では、最終的な色の値が書き込まれるをターゲットとして、オフスクリーンの Direct3D サーフェスを使用します。</span><span class="sxs-lookup"><span data-stu-id="76992-109">Direct3D uses an off-screen Direct3D surface as the target to which final color values are written.</span></span> <span data-ttu-id="76992-110">レンダー ターゲット サーフェスに関連付けられている深度バッファー サーフェスは、Direct3D に対してシーンに表示する各ピクセルの奥行きを知らせる深度情報を格納するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="76992-110">The depth-buffer surface that is associated with the render-target surface is used to store depth information that tells Direct3D how deep each visible pixel is in the scene.</span></span>

<span data-ttu-id="76992-111">深度バッファーを有効にしてシーンをラスタライズすると、レンダリング サーフェス上の各ポイントがテストされます。</span><span class="sxs-lookup"><span data-stu-id="76992-111">When a scene is rasterized with depth buffering enabled, each point on the rendering surface is tested.</span></span> <span data-ttu-id="76992-112">深度バッファー内の値として、ポイントの z 座標または射影空間内のポイントの位置 (x,y,z,w) の同次 w 座標を使用できます。</span><span class="sxs-lookup"><span data-stu-id="76992-112">The values in the depth buffer can be a point's z-coordinate or its homogeneous w-coordinate - from the point's (x,y,z,w) location in projection space.</span></span> <span data-ttu-id="76992-113">z 値を使う深度バッファーは通常 z バッファーと呼ばれ、w 値を使う深度バッファーは w バッファーと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="76992-113">A depth buffer that uses z values is often called a z-buffer, and one that uses w values is called a w-buffer.</span></span> <span data-ttu-id="76992-114">各種の深度バッファーには長所と短所があります。これについては後で説明します。</span><span class="sxs-lookup"><span data-stu-id="76992-114">Each type of depth buffer has advantages and disadvantages, which are discussed later.</span></span>

<span data-ttu-id="76992-115">テストの開始時に、深度バッファーの深度値はシーンの最大値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="76992-115">At the beginning of the test, the depth value in the depth buffer is set to the largest possible value for the scene.</span></span> <span data-ttu-id="76992-116">レンダリング サーフェス上の色の値は、その時点での背景色の値または背景テクスチャの色の値のいずれかに設定されます。</span><span class="sxs-lookup"><span data-stu-id="76992-116">The color value on the rendering surface is set to either the background color value or the color value of the background texture at that point.</span></span> <span data-ttu-id="76992-117">シーン内の各多角形が、レンダリング サーフェス上の現在の座標 (x,y) と交差するかどうかがテストされます。</span><span class="sxs-lookup"><span data-stu-id="76992-117">Each polygon in the scene is tested to see if it intersects with the current coordinate (x,y) on the rendering surface.</span></span>

<span data-ttu-id="76992-118">交差する場合、現在のポイントの深度値 (z バッファーでは z 座標、w バッファーでは w 座標) がテストされ、深度バッファーに格納された深度値よりも小さいかどうかが確認されます。</span><span class="sxs-lookup"><span data-stu-id="76992-118">If it does intersect, the depth value - which will be the z coordinate in a z-buffer, and the w coordinate in a w-buffer - at the current point is tested to see if it is smaller than the depth value stored in the depth buffer.</span></span> <span data-ttu-id="76992-119">多角形の深度の値が小さい場合は、その値が深度バッファーに格納され、多角形の色の値がレンダリング サーフェスの現在のポイントに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="76992-119">If the depth of the polygon value is smaller, it is stored in the depth buffer and the color value from the polygon is written to the current point on the rendering surface.</span></span> <span data-ttu-id="76992-120">そのポイントでの多角形の深度値の方が大きい場合は、リスト内の次の多角形がテストされます。</span><span class="sxs-lookup"><span data-stu-id="76992-120">If the depth value of the polygon at that point is larger, the next polygon in the list is tested.</span></span> <span data-ttu-id="76992-121">このプロセスを次の図に示します。</span><span class="sxs-lookup"><span data-stu-id="76992-121">This process is shown in the following diagram.</span></span>

![深度値のテストの図](images/zbuffer.png)

## <a name="span-idbufferingtechniquesspanspan-idbufferingtechniquesspanspan-idbufferingtechniquesspanbuffering-techniques"></a><span data-ttu-id="76992-123"><span id="Buffering_techniques"></span><span id="buffering_techniques"></span><span id="BUFFERING_TECHNIQUES"></span>バッファー処理の手法</span><span class="sxs-lookup"><span data-stu-id="76992-123"><span id="Buffering_techniques"></span><span id="buffering_techniques"></span><span id="BUFFERING_TECHNIQUES"></span>Buffering techniques</span></span>


<span data-ttu-id="76992-124">ほとんどのアプリケーションはこの機能を使用しませんが、深度バッファーに配置し、その後、レンダー ターゲット サーフェスに配置する値を決定するために Direct3D が使用する比較の方法を変更できます。</span><span class="sxs-lookup"><span data-stu-id="76992-124">Although most applications don't use this feature, you can change the comparison that Direct3D uses to determine which values are placed in the depth buffer and subsequently the render-target surface.</span></span> <span data-ttu-id="76992-125">一部のハードウェアでは、比較関数を変更すると、階層化 z テストが無効になることがあります。</span><span class="sxs-lookup"><span data-stu-id="76992-125">On some hardware, changing the compare function may disable hierarchical z testing.</span></span>

<span data-ttu-id="76992-126">市場のほぼすべてのアクセラレータは z バッファーをサポートしているため、z バッファーは、現在、最も一般的な種類の深度バッファーとなっています。</span><span class="sxs-lookup"><span data-stu-id="76992-126">Nearly all accelerators on the market support z-buffering, making z-buffers the most common type of depth buffer today.</span></span> <span data-ttu-id="76992-127">広く普及していますが、z バッファーには欠点もあります。</span><span class="sxs-lookup"><span data-stu-id="76992-127">However ubiquitous, z-buffers have their drawbacks.</span></span> <span data-ttu-id="76992-128">関連する演算の影響により、z バッファーで生成された z 値は、z バッファー範囲 (通常 0.0 ～ 1.0、両端を含む) にわたって均等に分散しない傾向があります。</span><span class="sxs-lookup"><span data-stu-id="76992-128">Due to the mathematics involved, the generated z values in a z-buffer tend not to be distributed evenly across the z-buffer range (typically 0.0 to 1.0, inclusive).</span></span>

<span data-ttu-id="76992-129">具体的には、近クリップ面と遠クリップ面との比率は、z 値が均等に分散しないことに大きく影響します。</span><span class="sxs-lookup"><span data-stu-id="76992-129">Specifically, the ratio between the far and near clipping planes strongly affects how unevenly z values are distributed.</span></span> <span data-ttu-id="76992-130">遠い面までの距離と近い面までの距離の比率を 100 とした場合、深度バッファー範囲の 90% がシーンの深度範囲の最初の 10% で消費されます。</span><span class="sxs-lookup"><span data-stu-id="76992-130">Using a far-plane distance to near-plane distance ratio of 100, 90 percent of the depth buffer range is spent on the first 10 percent of the scene depth range.</span></span> <span data-ttu-id="76992-131">エンターテイメントや屋外のシーンの視覚的シミュレーションを目的とした一般的なアプリケーションでは、通常、遠い面と近い面の比率を 1,000 ～ 10,000 にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="76992-131">Typical applications for entertainment or visual simulations with exterior scenes often require far-plane/near-plane ratios of anywhere between 1,000 to 10,000.</span></span> <span data-ttu-id="76992-132">比率が 1,000 の場合、範囲の 98% が深度範囲の最初の 2% で費やされ、比率が高くなるほど分散の状況も悪化します。</span><span class="sxs-lookup"><span data-stu-id="76992-132">At a ratio of 1,000, 98 percent of the range is spent on the first 2 percent of the depth range, and the distribution becomes worse with higher ratios.</span></span> <span data-ttu-id="76992-133">これにより、遠くのオブジェクトで、特に、最も一般的にサポートされているビット深度である 16 ビットの深度バッファーを使う場合に、陰面のアーティファクトが発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="76992-133">This can cause hidden surface artifacts in distant objects, especially when using 16-bit depth buffers, the most commonly supported bit-depth.</span></span>

<span data-ttu-id="76992-134">一方、w ベースの深度バッファーは、z バッファーと比べて、近クリップ面と遠クリップ面の間で均等に分散します。</span><span class="sxs-lookup"><span data-stu-id="76992-134">A w-based depth buffer, on the other hand, is often more evenly distributed between the near and far clip planes than a z-buffer.</span></span> <span data-ttu-id="76992-135">主なメリットは、遠クリップ面と近クリップ面の距離の比率が問題ではなくなるという点です。</span><span class="sxs-lookup"><span data-stu-id="76992-135">The key benefit is that the ratio of distances for the far and near clipping planes is no longer an issue.</span></span> <span data-ttu-id="76992-136">これにより、アプリケーションでは、広い最大範囲をサポートしながら、視点の近くで比較的正確な深度バッファー処理を実現できます。</span><span class="sxs-lookup"><span data-stu-id="76992-136">This allows applications to support large maximum ranges, while still getting relatively accurate depth buffering close to the eye point.</span></span> <span data-ttu-id="76992-137">w ベースの深度バッファーも完全ではなく、近いオブジェクトで陰面のアーティファクトが発生する場合があります。</span><span class="sxs-lookup"><span data-stu-id="76992-137">A w-based depth buffer isn't perfect, and can sometimes exhibit hidden surface artifacts for near objects.</span></span> <span data-ttu-id="76992-138">w バッファーによるアプローチのもう 1 つの欠点として、ハードウェアのサポートが挙げられます。w バッファー処理は、ハードウェアで z バッファー処理ほど広くサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="76992-138">Another drawback to the w-buffered approach is related to hardware support: w-buffering isn't supported as widely in hardware as z-buffering.</span></span>

<span data-ttu-id="76992-139">z バッファーを使うと、レンダリング中にオーバーヘッドが必要です。</span><span class="sxs-lookup"><span data-stu-id="76992-139">Using a z-buffer requires overhead during rendering.</span></span> <span data-ttu-id="76992-140">z バッファーを使用する場合、さまざまな手法でレンダリングを最適化できます。</span><span class="sxs-lookup"><span data-stu-id="76992-140">Various techniques can be used to optimize rendering when using z-buffers.</span></span> <span data-ttu-id="76992-141">アプリケーションでは、シーンが前面から順にレンダリングされるように処理することで、z バッファー処理を使用する際のパフォーマンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="76992-141">Applications can increase performance when using z-buffering and texturing by ensuring that scenes are rendered from front to back.</span></span> <span data-ttu-id="76992-142">テクスチャ処理された z バッファーのプリミティブは、スキャン ライン ベースで z バッファーについて事前にテストされます。</span><span class="sxs-lookup"><span data-stu-id="76992-142">Textured z-buffered primitives are pretested against the z-buffer on a scan line basis.</span></span> <span data-ttu-id="76992-143">スキャン ラインが以前にレンダリングされた多角形によって隠れる場合、システムは迅速かつ効率的にそれを拒否します。</span><span class="sxs-lookup"><span data-stu-id="76992-143">If a scan line is hidden by a previously rendered polygon, the system rejects it quickly and efficiently.</span></span> <span data-ttu-id="76992-144">z バッファー処理によって、パフォーマンスを向上させることもできますが、この手法はシーンで同じピクセルを複数回描画するときに最も役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="76992-144">Z-buffering can improve performance, but the technique is most useful when a scene draws the same pixels more than once.</span></span> <span data-ttu-id="76992-145">これを厳密に計算することは困難ですが、多くの場合、非常に近い結果を得ることができます。</span><span class="sxs-lookup"><span data-stu-id="76992-145">This is difficult to calculate exactly, but you can often make a close approximation.</span></span> <span data-ttu-id="76992-146">同じピクセルの描画が 2 回未満である場合は、z バッファー処理を無効にして、背面から順にシーンをレンダリングすることによって、最適なパフォーマンスを実現できます。</span><span class="sxs-lookup"><span data-stu-id="76992-146">If the same pixels are drawn less than twice, you can achieve the best performance by turning z-buffering off and rendering the scene from back to front.</span></span>

<span data-ttu-id="76992-147">深度値の実際の解釈はレンダラーに固有です。</span><span class="sxs-lookup"><span data-stu-id="76992-147">The actual interpretation of a depth value is specific to the renderer.</span></span>

## <a name="span-idrelated-topicsspanrelated-topics"></a><span data-ttu-id="76992-148"><span id="related-topics"></span>関連トピック</span><span class="sxs-lookup"><span data-stu-id="76992-148"><span id="related-topics"></span>Related topics</span></span>


[<span data-ttu-id="76992-149">深度バッファーとステンシル バッファー</span><span class="sxs-lookup"><span data-stu-id="76992-149">Depth and stencil buffers</span></span>](depth-and-stencil-buffers.md)

 

 




