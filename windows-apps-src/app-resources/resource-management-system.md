---
author: stevewhims
Description: At build time, the Resource Management System creates an index of all the different variants of the resources that are packaged up with your app. At run-time, the system detects the user and machine settings that are in effect and loads the resources that are the best match for those settings.
title: リソース管理システム
template: detail.hbs
ms.author: stwhi
ms.date: 10/20/2017
ms.topic: article
keywords: Windows 10, UWP, リソース, 画像, アセット, MRT, 修飾子
ms.localizationpriority: medium
ms.openlocfilehash: b80eda57ff700d732ba2402582ed6402acca4fc6
ms.sourcegitcommit: bdc40b08cbcd46fc379feeda3c63204290e055af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/08/2018
ms.locfileid: "6156563"
---
# <a name="resource-management-system"></a><span data-ttu-id="66dd6-103">リソース管理システム</span><span class="sxs-lookup"><span data-stu-id="66dd6-103">Resource Management System</span></span>
<span data-ttu-id="66dd6-104">リソース管理システムには、ビルド時と実行時の両方の機能があります。</span><span class="sxs-lookup"><span data-stu-id="66dd6-104">The Resource Management System has both build-time and run-time features.</span></span> <span data-ttu-id="66dd6-105">ビルド時に、システムは、アプリとしてパッケージ化されているリソースのさまざまなバリエーションすべてのインデックスを作成します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-105">At build time, the system creates an index of all the different variants of the resources that are packaged up with your app.</span></span> <span data-ttu-id="66dd6-106">このインデックスがパッケージ リソース インデックス (PRI) であり、アプリのパッケージにも含まれています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-106">This index is the Package Resource Index, or PRI, and it's also included in your app's package.</span></span> <span data-ttu-id="66dd6-107">実行時に、システムは、有効になっているユーザーやコンピューターの設定を検出し、PRI でその情報を参照して、それらの設定に最適なリソースを自動的に読み込みます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-107">At run-time, the system detects the user and machine settings that are in effect, consults the information in the PRI, and automatically loads the resources that are the best match for those settings.</span></span>

## <a name="package-resource-index-pri-file"></a><span data-ttu-id="66dd6-108">パッケージ リソース インデックス (PRI) ファイル</span><span class="sxs-lookup"><span data-stu-id="66dd6-108">Package Resource Index (PRI) file</span></span>
<span data-ttu-id="66dd6-109">すべてのアプリ パッケージには、アプリ内のリソースのバイナリ インデックスが格納されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="66dd6-109">Every app package should contain a binary index of the resources in the app.</span></span> <span data-ttu-id="66dd6-110">このインデックスはビルド時に作成され、1 つまたは複数のパッケージ リソース インデックス (PRI) ファイルに含まれています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-110">This index is created at build time and it is contained in one or more Package Resource Index (PRI) files.</span></span>

- <span data-ttu-id="66dd6-111">PRI ファイルには、実際の文字列リソースと、パッケージ内のさまざまなファイルを参照するファイル パスのインデックス付きセットが格納されます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-111">A PRI file contains actual string resources, and an indexed set of file paths that refer to various files in the package.</span></span>
- <span data-ttu-id="66dd6-112">パッケージには、通常、言語ごとに 1 つの、resources.pri という名前の PRI ファイルが含まれます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-112">A package typically contains a single PRI file per language, named resources.pri.</span></span>
- <span data-ttu-id="66dd6-113">各パッケージのルートにある resources.pri ファイルは、[**ResourceManager**](/uwp/api/windows.applicationmodel.resources.core.resourcemanager?branch=live) がインスタンス化されたときに自動的に読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-113">The resources.pri file at the root of each package is automatically loaded when the [**ResourceManager**](/uwp/api/windows.applicationmodel.resources.core.resourcemanager?branch=live) is instantiated.</span></span>
- <span data-ttu-id="66dd6-114">PRI ファイルを作成したりダンプしたりするには、[MakePRI.exe](compile-resources-manually-with-makepri.md) というツールを使います。</span><span class="sxs-lookup"><span data-stu-id="66dd6-114">PRI files can be created and dumped with the tool [MakePRI.exe](compile-resources-manually-with-makepri.md).</span></span>
- <span data-ttu-id="66dd6-115">既に Visual Studio のコンパイル ワークフローに統合されているため、一般的なアプリの開発では、MakePRI.exe は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="66dd6-115">For typical app development you won't need MakePRI.exe because it's already integrated into the Visual Studio compile workflow.</span></span> <span data-ttu-id="66dd6-116">また、Visual Studio は専用の UI で PRI ファイルの編集をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-116">And Visual Studio supports editing PRI files in a dedicated UI.</span></span> <span data-ttu-id="66dd6-117">ただし、ローカライズ担当者やローカライズ担当者が使うツールでは、MakePRI.exe が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="66dd6-117">However, your localizers and the tools they use might rely upon MakePRI.exe.</span></span>
- <span data-ttu-id="66dd6-118">各 PRI ファイルは、リソース マップと呼ばれる、リソースの名前付きコレクションを含みます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-118">Each PRI file contains a named collection of resources, referred to as a resource map.</span></span> <span data-ttu-id="66dd6-119">パッケージの PRI ファイルが読み込まれたときに、リソース マップ名がパッケージ識別名と一致するかが確認されます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-119">When a PRI file from a package is loaded, the resource map name is verified to match the package identity name.</span></span>
- <span data-ttu-id="66dd6-120">PRI ファイルにはデータのみが格納され、移植可能な実行可能ファイル (PE) 形式は使用されません。</span><span class="sxs-lookup"><span data-stu-id="66dd6-120">PRI files contain only data, so they don't use the portable executable (PE) format.</span></span> <span data-ttu-id="66dd6-121">PRI ファイルは、Windows 向けのリソース形式としてデータ専用に設計されています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-121">They are specifically designed to be data-only as the resource format for Windows.</span></span> <span data-ttu-id="66dd6-122">PRI ファイルは、Win32 アプリ モデルの DLL に含まれていたリソースに代わるものです。</span><span class="sxs-lookup"><span data-stu-id="66dd6-122">They replace resources contained within DLLs in the Win32 app model.</span></span>
- <span data-ttu-id="66dd6-123">PRI ファイルのサイズ制限は、64 キロバイトです。</span><span class="sxs-lookup"><span data-stu-id="66dd6-123">The size limit on a PRI file is 64 kilobytes.</span></span>

## <a name="uwp-api-access-to-app-resources"></a><span data-ttu-id="66dd6-124">アプリ リソースへの UWP API のアクセス</span><span class="sxs-lookup"><span data-stu-id="66dd6-124">UWP API access to app resources</span></span>

### <a name="basic-functionality-resourceloader"></a><span data-ttu-id="66dd6-125">基本機能 (ResourceLoader)</span><span class="sxs-lookup"><span data-stu-id="66dd6-125">Basic functionality (ResourceLoader)</span></span>
<span data-ttu-id="66dd6-126">プログラムによってアプリ リソースにアクセスする最も簡単な方法は、[**Windows.ApplicationModel.Resources**](/uwp/api/windows.applicationmodel.resources?branch=live) 名前空間と [**ResourceLoader**](/uwp/api/windows.applicationmodel.resources.resourceloader?branch=live) クラスを使う方法です。</span><span class="sxs-lookup"><span data-stu-id="66dd6-126">The simplest way to access your app resources programmatically is by using the [**Windows.ApplicationModel.Resources**](/uwp/api/windows.applicationmodel.resources?branch=live) namespace and the [**ResourceLoader**](/uwp/api/windows.applicationmodel.resources.resourceloader?branch=live) class.</span></span> <span data-ttu-id="66dd6-127">**ResourceLoader** を使うと、一連のリソース ファイル、参照ライブラリ、または他のパッケージの文字列リソースへの基本的なアクセスが可能になります。</span><span class="sxs-lookup"><span data-stu-id="66dd6-127">**ResourceLoader** provides you basic access to string resources from the set of resource files, referenced libraries, or other packages.</span></span>

### <a name="advanced-functionality-resourcemanager"></a><span data-ttu-id="66dd6-128">高度な機能 (ResourceManager)</span><span class="sxs-lookup"><span data-stu-id="66dd6-128">Advanced functionality (ResourceManager)</span></span>
<span data-ttu-id="66dd6-129">[**Windows.ApplicationModel.Resources.Core**](/uwp/api/windows.applicationmodel.resources.core?branch=live) 名前空間の [**ResourceManager**](/uwp/api/windows.applicationmodel.resources.core.resourcemanager?branch=live) クラスは、リソースに関する追加情報 (列挙、検査など) を提供します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-129">The [**ResourceManager**](/uwp/api/windows.applicationmodel.resources.core.resourcemanager?branch=live) class (in the [**Windows.ApplicationModel.Resources.Core**](/uwp/api/windows.applicationmodel.resources.core?branch=live) namespace) provides additional info about resources, such as enumeration and inspection.</span></span> <span data-ttu-id="66dd6-130">このクラスは、**ResourceLoader** クラスが提供する情報よりも多くの情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-130">This goes beyond what the **ResourceLoader** class provides.</span></span>

<span data-ttu-id="66dd6-131">[**NamedResource**](/uwp/api/windows.applicationmodel.resources.core.namedresource?branch=live) オブジェクトは、複数の言語またはその他の修飾されたバリアントを持つ個別の論理リソースです。</span><span class="sxs-lookup"><span data-stu-id="66dd6-131">A [**NamedResource**](/uwp/api/windows.applicationmodel.resources.core.namedresource?branch=live) object represents an individual logical resource with multiple language or other qualified variants.</span></span> <span data-ttu-id="66dd6-132">`Header1` などの文字列リソース識別子や、`logo.jpg` などのリソース ファイル名を持つ、アセットやリソースの論理ビューを記述します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-132">It describes the logical view of the asset or resource, with a string resource identifier such as `Header1`, or a resource file name such as `logo.jpg`.</span></span>

<span data-ttu-id="66dd6-133">[**ResourceCandidate**](/uwp/api/windows.applicationmodel.resources.core.resourcecandidate?branch=live) オブジェクトは、英語向けの文字列 "Hello World" や **scale-100** 解像度に固有の修飾子付きのイメージ リソースである "logo.scale-100.jpg" など、単一の具象リソース値と修飾子の組み合わせです。</span><span class="sxs-lookup"><span data-stu-id="66dd6-133">A [**ResourceCandidate**](/uwp/api/windows.applicationmodel.resources.core.resourcecandidate?branch=live) object represents a single concrete resource value and its qualifiers, such as the string "Hello World" for English, or "logo.scale-100.jpg" as a qualified image resource that's specific to the **scale-100** resolution.</span></span>

<span data-ttu-id="66dd6-134">アプリで使うことができるリソースは、[**ResourceMap**](/uwp/api/windows.applicationmodel.resources.core.resourcemap?branch=live) オブジェクトを使ってアクセスできる階層コレクションに格納されます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-134">Resources available to an app are stored in hierarchical collections, which you can access with a [**ResourceMap**](/uwp/api/windows.applicationmodel.resources.core.resourcemap?branch=live) object.</span></span> <span data-ttu-id="66dd6-135">**ResourceManager** クラスを使うと、アプリで使われる各種のトップレベルの **ResourceMap** インスタンスにアクセスできます。これらのインスタンスは、アプリのさまざまなパッケージに対応しています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-135">The **ResourceManager** class provides access to the various top-level **ResourceMap** instances used by the app, which correspond to the various packages for the app.</span></span> <span data-ttu-id="66dd6-136">[**MainResourceMap**](/uwp/api/windows.applicationmodel.resources.core.resourcemanager.MainResourceMap) の値は、参照されているフレームワーク パッケージではなく現在のアプリ パッケージのリソース マップに対応しています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-136">The [**MainResourceMap**](/uwp/api/windows.applicationmodel.resources.core.resourcemanager.MainResourceMap) value corresponds to the resource map for the current app package, and it excludes any referenced framework packages.</span></span> <span data-ttu-id="66dd6-137">それぞれの **ResourceMap** には、パッケージのマニフェストに指定されたパッケージ名に基づく名前が付けられます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-137">Each **ResourceMap** is named for the package name that is specified in the package's manifest.</span></span> <span data-ttu-id="66dd6-138">**ResourceMap** には、**NamedResource** オブジェクトが格納されているサブツリー (「[**ResourceMap.GetSubtree**](/uwp/api/windows.applicationmodel.resources.core.resourcemap.getsubtree?branch=live)」をご覧ください) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-138">Within a **ResourceMap** are subtrees (see [**ResourceMap.GetSubtree**](/uwp/api/windows.applicationmodel.resources.core.resourcemap.getsubtree?branch=live)), which further contain **NamedResource** objects.</span></span> <span data-ttu-id="66dd6-139">通常、サブツリーは、リソースが含まれるリソース ファイルに対応します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-139">The subtrees typically correspond to the resource files that contains the resource.</span></span> <span data-ttu-id="66dd6-140">詳しくは、「[UI とアプリ パッケージ マニフェスト内の文字列をローカライズする](localize-strings-ui-manifest.md)と[表示倍率、テーマ、ハイ コントラスト、その他の設定に合わせた画像とアセットの読み込み](images-tailored-for-scale-theme-contrast.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="66dd6-140">For more info see [Localize strings in your UI and app package manifest](localize-strings-ui-manifest.md) and [Load images and assets tailored for scale, theme, high contrast, and others](images-tailored-for-scale-theme-contrast.md).</span></span>

<span data-ttu-id="66dd6-141">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-141">Here's an example.</span></span>

```csharp
// using Windows.ApplicationModel.Resources.Core;
ResourceMap resourceMap =  ResourceManager.Current.MainResourceMap.GetSubtree("Resources");
ResourceContext resourceContext = ResourceContext.GetForCurrentView()
var str = resourceMap.GetValue("String1", resourceContext).ValueAsString;
```

<span data-ttu-id="66dd6-142">**注** リソース識別子は、URI (Uniform Resource Identifier) セマンティクスに応じて URI フラグメントとして処理されます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-142">**Note** The resource identifier is treated as a Uniform Resource Identifier (URI) fragment, subject to URI semantics.</span></span> <span data-ttu-id="66dd6-143">たとえば、`GetValue("Caption%20")` は `GetValue("Caption ")` として処理されます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-143">For example, `GetValue("Caption%20")` is treated as `GetValue("Caption ")`.</span></span> <span data-ttu-id="66dd6-144">リソース識別子で "?" や "#" を使うとリソース パスの評価がそこで中断されるので、使わないでください。</span><span class="sxs-lookup"><span data-stu-id="66dd6-144">Do not use "?" or "#" in resource identifiers, because they terminate the resource path evaluation.</span></span> <span data-ttu-id="66dd6-145">たとえば、"MyResource?3" は "MyResource" として扱われます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-145">For example, "MyResource?3" is treated as "MyResource".</span></span>

<span data-ttu-id="66dd6-146">**ResourceManager** は、アプリの文字列リソースへのアクセスをサポートするだけでなく、さまざまなファイル リソースを列挙し検査する機能も保持します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-146">The **ResourceManager** not only supports access to an app's string resources, it also maintains the ability to enumerate and inspect the various file resources as well.</span></span> <span data-ttu-id="66dd6-147">ファイルとその他のリソース (ファイル内から提供されるリソース) との衝突を回避するために、すべてのインデックス付きファイル パスは、予約済みの "Files" **ResourceMap** サブツリーに配置されます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-147">In order to avoid collisions between files and other resources that originate from within a file, indexed file paths all reside within a reserved "Files" **ResourceMap** subtree.</span></span> <span data-ttu-id="66dd6-148">たとえば、ファイル `\Images\logo.png` は、リソース名 `Files/images/logo.png` に対応します。</span><span class="sxs-lookup"><span data-stu-id="66dd6-148">For example, the file `\Images\logo.png` corresponds to the resource name `Files/images/logo.png`.</span></span>

<span data-ttu-id="66dd6-149">[**StorageFile**](/uwp/api/Windows.Storage.StorageFile?branch=live) API は、リソースとしてのファイルへの参照を透過的に処理するため、一般的な用法のシナリオに適しています。</span><span class="sxs-lookup"><span data-stu-id="66dd6-149">The [**StorageFile**](/uwp/api/Windows.Storage.StorageFile?branch=live) APIs transparently handle references to files as resources, and are appropriate for typical usage scenarios.</span></span> <span data-ttu-id="66dd6-150">**ResourceManager** は、現在のコンテキストをオーバーライドする必要がある場合など、高度なシナリオについてのみ使用してください。</span><span class="sxs-lookup"><span data-stu-id="66dd6-150">The **ResourceManager** should only be used for advanced scenarios, such when you want to override the current context.</span></span>

### <a name="resourcecontext"></a><span data-ttu-id="66dd6-151">ResourceContext</span><span class="sxs-lookup"><span data-stu-id="66dd6-151">ResourceContext</span></span>
<span data-ttu-id="66dd6-152">リソース候補は、リソース修飾子の値 (言語、スケール、コントラストなど) のコレクションである特定の [**ResourceContext**](/uwp/api/Windows.ApplicationModel.Resources.Core.ResourceContext?branch=live) に基づいて選ばれます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-152">Resource candidates are chosen based on a particular [**ResourceContext**](/uwp/api/Windows.ApplicationModel.Resources.Core.ResourceContext?branch=live), which is a collection of resource qualifier values (language, scale, contrast, and so on).</span></span> <span data-ttu-id="66dd6-153">既定のコンテキストでは、上書きされない限り、それぞれの修飾子の値に対してアプリの現在の構成が使われます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-153">A default context uses the app's current configuration for each qualifier value, unless overridden.</span></span> <span data-ttu-id="66dd6-154">たとえば、画像などのリソースはスケールで修飾することができます。スケールはモニターごとに異なり、したがってアプリケーション ビューごとに異なります。</span><span class="sxs-lookup"><span data-stu-id="66dd6-154">For example, resources such as images can be qualified for scale, which varies from one monitor to another and hence from one application view to another.</span></span> <span data-ttu-id="66dd6-155">この理由から、アプリケーション ビューはそれぞれ別個の既定のコンテキストを持ちます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-155">For this reason, each application view has a distinct default context.</span></span> <span data-ttu-id="66dd6-156">特定のビューの既定のコンテキストは [**ResourceContext.GetForCurrentView**](/uwp/api/windows.applicationmodel.resources.core.resourcecontext.GetForCurrentView) を使って取得することができます。</span><span class="sxs-lookup"><span data-stu-id="66dd6-156">The default context for a given view can be obtained using [**ResourceContext.GetForCurrentView**](/uwp/api/windows.applicationmodel.resources.core.resourcecontext.GetForCurrentView).</span></span> <span data-ttu-id="66dd6-157">リソース候補を取得するときは常に **ResourceContext** インスタンスを渡して、特定のビューに最も適した値を取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66dd6-157">Whenever you retrieve a resource candidate, you should pass in a **ResourceContext** instance to obtain the most appropriate value for a given view.</span></span>

## <a name="important-apis"></a><span data-ttu-id="66dd6-158">重要な API</span><span class="sxs-lookup"><span data-stu-id="66dd6-158">Important APIs</span></span>
* [<span data-ttu-id="66dd6-159">ResourceLoader</span><span class="sxs-lookup"><span data-stu-id="66dd6-159">ResourceLoader</span></span>](/uwp/api/windows.applicationmodel.resources.resourceloader?branch=live)
* [<span data-ttu-id="66dd6-160">ResourceManager</span><span class="sxs-lookup"><span data-stu-id="66dd6-160">ResourceManager</span></span>](/uwp/api/windows.applicationmodel.resources.core.resourcemanager?branch=live)
* [<span data-ttu-id="66dd6-161">ResourceContext</span><span class="sxs-lookup"><span data-stu-id="66dd6-161">ResourceContext</span></span>](/uwp/api/windows.applicationmodel.resources.core.resourcecontext?branch=live)

## <a name="related-topics"></a><span data-ttu-id="66dd6-162">関連トピック</span><span class="sxs-lookup"><span data-stu-id="66dd6-162">Related topics</span></span>
* [<span data-ttu-id="66dd6-163">UI とアプリ パッケージ マニフェスト内の文字列をローカライズする</span><span class="sxs-lookup"><span data-stu-id="66dd6-163">Localize strings in your UI and app package manifest</span></span>](localize-strings-ui-manifest.md)
* [<span data-ttu-id="66dd6-164">表示倍率、テーマ、ハイ コントラスト、その他の設定に合わせた画像とアセットの読み込み</span><span class="sxs-lookup"><span data-stu-id="66dd6-164">Load images and assets tailored for scale, theme, high contrast, and others</span></span>](images-tailored-for-scale-theme-contrast.md)
