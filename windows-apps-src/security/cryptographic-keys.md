---
title: 暗号化キー
description: この記事では、標準のキー派生関数を使ってキーを派生させる方法、および対称キーと非対称キーを使ってコンテンツを暗号化する方法について説明します。
ms.assetid: F35BEBDF-28C5-4F91-A94E-F7D862B6ED59
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp, セキュリティ
ms.localizationpriority: medium
ms.openlocfilehash: 2b74eccd5f6138e5a9d670aa3a0a93239813cf4d
ms.sourcegitcommit: b11f305dbf7649c4b68550b666487c77ea30d98f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/27/2018
ms.locfileid: "7846545"
---
# <a name="cryptographic-keys"></a><span data-ttu-id="58982-104">暗号化キー</span><span class="sxs-lookup"><span data-stu-id="58982-104">Cryptographic keys</span></span>




<span data-ttu-id="58982-105">この記事では、標準のキー派生関数を使ってキーを派生させる方法、および対称キーと非対称キーを使ってコンテンツを暗号化する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="58982-105">This article shows how to use standard key derivation functions to derive keys and how to encrypt content using symmetric and asymmetric keys.</span></span> 

## <a name="symmetric-keys"></a><span data-ttu-id="58982-106">対称キー</span><span class="sxs-lookup"><span data-stu-id="58982-106">Symmetric keys</span></span>


<span data-ttu-id="58982-107">秘密鍵の暗号化とも呼ばれる対称キーの暗号化には、暗号化にも暗号化解除にも使われるキーが必要です。</span><span class="sxs-lookup"><span data-stu-id="58982-107">Symmetric key encryption, also called secret key encryption, requires that the key used for encryption also be used for decryption.</span></span> <span data-ttu-id="58982-108">[**SymmetricKeyAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241537) クラスを使って対称アルゴリズムを指定し、キーを作成またはインポートできます。</span><span class="sxs-lookup"><span data-stu-id="58982-108">You can use a [**SymmetricKeyAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241537) class to specify a symmetric algorithm and create or import a key.</span></span> <span data-ttu-id="58982-109">[**CryptographicEngine**](https://msdn.microsoft.com/library/windows/apps/br241490) クラスで静的メソッドを使って、アルゴリズムとキーでデータを暗号化および暗号化解除できます。</span><span class="sxs-lookup"><span data-stu-id="58982-109">You can use static methods on the [**CryptographicEngine**](https://msdn.microsoft.com/library/windows/apps/br241490) class to encrypt and decrypt data by using the algorithm and key.</span></span>

<span data-ttu-id="58982-110">通常、対称キーの暗号化ではブロック暗号とブロック暗号モードを使います。</span><span class="sxs-lookup"><span data-stu-id="58982-110">Symmetric key encryption typically uses block ciphers and block cipher modes.</span></span> <span data-ttu-id="58982-111">ブロック暗号は、固定サイズのブロックで動作する対称暗号化機能です。</span><span class="sxs-lookup"><span data-stu-id="58982-111">A block cipher is a symmetric encryption function that operates on fixed size blocks.</span></span> <span data-ttu-id="58982-112">暗号化するメッセージがブロックの長さよりも長い場合は、ブロック暗号モードを使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="58982-112">If the message you want to encrypt is longer than the block length, you must use a block cipher mode.</span></span> <span data-ttu-id="58982-113">ブロック暗号モードは、ブロック暗号を使って作成された対称暗号化機能です。</span><span class="sxs-lookup"><span data-stu-id="58982-113">A block cipher mode is a symmetric encryption function built by using a block cipher.</span></span> <span data-ttu-id="58982-114">このモードでは、プレーンテキストが一連の固定サイズ ブロックとして暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="58982-114">It encrypts plaintext as a series of fixed size blocks.</span></span> <span data-ttu-id="58982-115">アプリでは、次のモードがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="58982-115">The following modes are supported for apps:</span></span>

-   <span data-ttu-id="58982-116">ECB (電子コードブック) モードでは、メッセージの各ブロックが個別に暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="58982-116">The ECB (electronic codebook) mode encrypts each block of the message separately.</span></span> <span data-ttu-id="58982-117">これは、セキュリティで保護された暗号化モードとは見なされません。</span><span class="sxs-lookup"><span data-stu-id="58982-117">This is not considered a secure encryption mode.</span></span>
-   <span data-ttu-id="58982-118">CBC (暗号ブロック チェーン) モードでは、前の暗号テキスト ブロックを使って現在のブロックを難読にします。</span><span class="sxs-lookup"><span data-stu-id="58982-118">The CBC (cipher block chaining) mode uses the previous ciphertext block to obfuscate the current block.</span></span> <span data-ttu-id="58982-119">最初のブロックに使う値を決める必要があります。</span><span class="sxs-lookup"><span data-stu-id="58982-119">You must determine what value to use for the first block.</span></span> <span data-ttu-id="58982-120">この値は初期化ベクトル (IV) と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="58982-120">This value is called the initialization vector (IV).</span></span>
-   <span data-ttu-id="58982-121">CCM (Counter with CBC-MAC) モードは、CBC ブロック暗号モードとメッセージ認証コード (MAC) が組み合わされたものです。</span><span class="sxs-lookup"><span data-stu-id="58982-121">The CCM (counter with CBC-MAC) mode combines the CBC block cipher mode with a message authentication code (MAC).</span></span>
-   <span data-ttu-id="58982-122">GCM (ガロア カウンター モード) モードは、カウンター暗号化モードとガロア認証モードが組み合わされたものです。</span><span class="sxs-lookup"><span data-stu-id="58982-122">The GCM (Galois counter mode) mode combines the counter encryption mode with the Galois authentication mode.</span></span>

<span data-ttu-id="58982-123">CBC などの一部のモードでは、最初の暗号テキスト ブロックに初期化ベクトル (IV) を使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="58982-123">Some modes such as CBC require that you use an initialization vector (IV) for the first ciphertext block.</span></span> <span data-ttu-id="58982-124">一般的な初期化ベクトルを次に示します。</span><span class="sxs-lookup"><span data-stu-id="58982-124">The following are common initialization vectors.</span></span> <span data-ttu-id="58982-125">IV は [**CryptographicEngine.Encrypt**](https://msdn.microsoft.com/library/windows/apps/br241494) を呼び出すときに指定します。</span><span class="sxs-lookup"><span data-stu-id="58982-125">You specify the IV when calling [**CryptographicEngine.Encrypt**](https://msdn.microsoft.com/library/windows/apps/br241494).</span></span> <span data-ttu-id="58982-126">多くの場合、IV は同じキーで再利用しないことが重要です。</span><span class="sxs-lookup"><span data-stu-id="58982-126">For most cases it is important that the IV never be reused with the same key.</span></span>

-   <span data-ttu-id="58982-127">"固定" では、暗号化されるすべてのメッセージで同じ IV を使います。</span><span class="sxs-lookup"><span data-stu-id="58982-127">Fixed uses the same IV for all messages to be encrypted.</span></span> <span data-ttu-id="58982-128">情報が漏れるので、この方法を使うことはお勧めできません。</span><span class="sxs-lookup"><span data-stu-id="58982-128">This leaks information and its use is not recommended.</span></span>
-   <span data-ttu-id="58982-129">"カウンター" ではブロックごとに IV を増分します。</span><span class="sxs-lookup"><span data-stu-id="58982-129">Counter increments the IV for each block.</span></span>
-   <span data-ttu-id="58982-130">"ランダム" では、擬似乱数の IV を作成します。</span><span class="sxs-lookup"><span data-stu-id="58982-130">Random creates a pseudorandom IV.</span></span> <span data-ttu-id="58982-131">[**CryptographicBuffer.GenerateRandom**](https://msdn.microsoft.com/library/windows/apps/br241392) を使って IV を追加できます。</span><span class="sxs-lookup"><span data-stu-id="58982-131">You can use [**CryptographicBuffer.GenerateRandom**](https://msdn.microsoft.com/library/windows/apps/br241392) to create the IV.</span></span>
-   <span data-ttu-id="58982-132">"nonce 生成" では、暗号化されるメッセージごとに固有の番号を使います。</span><span class="sxs-lookup"><span data-stu-id="58982-132">Nonce-Generated uses a unique number for each message to be encrypted.</span></span> <span data-ttu-id="58982-133">通常、nonce は修正されたメッセージまたはトランザクションの識別子を表します。</span><span class="sxs-lookup"><span data-stu-id="58982-133">Typically, the nonce is a modified message or transaction identifier.</span></span> <span data-ttu-id="58982-134">nonce は秘密にする必要はありませんが、同じキーで再利用できません。</span><span class="sxs-lookup"><span data-stu-id="58982-134">The nonce does not have to be kept secret, but it should never be reused under the same key.</span></span>

<span data-ttu-id="58982-135">ほとんどのモードでは、プレーンテキストの長さをブロック サイズの正確な倍数にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="58982-135">Most modes require that the length of the plaintext be an exact multiple of the block size.</span></span> <span data-ttu-id="58982-136">このため、通常はプレーンテキストをパディングして適切な長さにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="58982-136">This usually requires that you pad the plaintext to obtain the appropriate length.</span></span>

<span data-ttu-id="58982-137">ブロック暗号は固定サイズのデータ ブロックを暗号化する一方、ストリーム暗号はプレーンテキスト ビットと擬似乱数ビット ストリーム (キー ストリームと呼ばれる) を組み合わせて暗号テキストを生成する対称暗号化機能を表します。</span><span class="sxs-lookup"><span data-stu-id="58982-137">While block ciphers encrypt fixed size blocks of data, stream ciphers are symmetric encryption functions that combine plaintext bits with a pseudorandom bit stream (called a key stream) to generate the ciphertext.</span></span> <span data-ttu-id="58982-138">出力フィードバック モード (OTF) やカウンター モード (CTR) などの一部のブロック暗号モードでは、ブロック暗号がストリーム暗号に効率よく変換されます。</span><span class="sxs-lookup"><span data-stu-id="58982-138">Some block cipher modes such as output feedback mode (OTF) and counter mode (CTR) effectively turn a block cipher into a stream cipher.</span></span> <span data-ttu-id="58982-139">ただし、RC4 などの実際のストリーム暗号は通常、ブロック暗号モードよりも高速で動作します。</span><span class="sxs-lookup"><span data-stu-id="58982-139">Actual stream ciphers such as RC4, however, typically operate at higher speeds than block cipher modes are capable of achieving.</span></span>

<span data-ttu-id="58982-140">次の例に、[**SymmetricKeyAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241537) クラスを使って対称キーを作成し、それを使ってデータを暗号化および暗号化解除する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="58982-140">The following example shows how to use the [**SymmetricKeyAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241537) class to create a symmetric key and use it to encrypt and decrypt data.</span></span>

## <a name="asymmetric-keys"></a><span data-ttu-id="58982-141">非対称キー</span><span class="sxs-lookup"><span data-stu-id="58982-141">Asymmetric keys</span></span>


<span data-ttu-id="58982-142">非対称キーの暗号化 (公開キーの暗号化とも呼ばれます) は、公開キーと秘密キーを使って暗号化および暗号化解除します。</span><span class="sxs-lookup"><span data-stu-id="58982-142">Asymmetric key cryptography, also called public key cryptography, uses a public key and a private key to perform encryption and decryption.</span></span> <span data-ttu-id="58982-143">これらのキーは異なるものですが、数学的に関連性があります。</span><span class="sxs-lookup"><span data-stu-id="58982-143">The keys are different but mathematically related.</span></span> <span data-ttu-id="58982-144">通常、秘密キーは秘密として保持され、データの暗号化解除に使われます。一方、公開キーは関係者に配布され、データの暗号化に使われます。</span><span class="sxs-lookup"><span data-stu-id="58982-144">Typically the private key is kept secret and is used to decrypt data while the public key is distributed to interested parties and is used to encrypt data.</span></span> <span data-ttu-id="58982-145">非対称キーの暗号化は、データ署名にも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="58982-145">Asymmetric cryptography is also useful for signing data.</span></span>

<span data-ttu-id="58982-146">非対称暗号化方式は対称暗号化方式よりかなり遅いため、大量のデータを直接暗号化する場合にはあまり使われません。</span><span class="sxs-lookup"><span data-stu-id="58982-146">Because asymmetric cryptography is much slower than symmetric cryptography, it is seldom used to encrypt large amounts of data directly.</span></span> <span data-ttu-id="58982-147">非対称暗号化が一般に使われるのは、次のような方法でキーを暗号化する場合です。</span><span class="sxs-lookup"><span data-stu-id="58982-147">Instead, it is typically used in the following manner to encrypt keys.</span></span>

-   <span data-ttu-id="58982-148">アリスはボブに、暗号化されたメッセージだけを送るように要求します。</span><span class="sxs-lookup"><span data-stu-id="58982-148">Alice requires that Bob send her only encrypted messages.</span></span>
-   <span data-ttu-id="58982-149">アリスは秘密キー/公開キーのペアを作り、秘密キーを秘密に保有し、公開キーを公開します。</span><span class="sxs-lookup"><span data-stu-id="58982-149">Alice creates a private/public key pair, keeps her private key secret and publishes her public key.</span></span>
-   <span data-ttu-id="58982-150">ボブにはアリスに送りたいメッセージがあります。</span><span class="sxs-lookup"><span data-stu-id="58982-150">Bob has a message he wants to send to Alice.</span></span>
-   <span data-ttu-id="58982-151">ボブは対称キーを作ります。</span><span class="sxs-lookup"><span data-stu-id="58982-151">Bob creates a symmetric key.</span></span>
-   <span data-ttu-id="58982-152">ボブは、新しい対称キーを使って、アリスへのメッセージを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="58982-152">Bob uses his new symmetric key to encrypt his message to Alice.</span></span>
-   <span data-ttu-id="58982-153">ボブは、アリスの公開キーを使って、対称キーを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="58982-153">Bob uses Alice’s public key to encrypt his symmetric key.</span></span>
-   <span data-ttu-id="58982-154">ボブは、暗号化したメッセージと暗号化した対称キーを、(エンベロープにして) アリスに送ります。</span><span class="sxs-lookup"><span data-stu-id="58982-154">Bob sends the encrypted message and the encrypted symmetric key to Alice (enveloped).</span></span>
-   <span data-ttu-id="58982-155">アリスは、(秘密キー/公開キー ペアの) 自分の秘密キーを使って、ボブの対称キーを暗号化解除します。</span><span class="sxs-lookup"><span data-stu-id="58982-155">Alice uses her private key (from the private/public pair) to decrypt Bob’s symmetric key.</span></span>
-   <span data-ttu-id="58982-156">アリスは、ボブの対称キーを使って、メッセージを暗号化解除します。</span><span class="sxs-lookup"><span data-stu-id="58982-156">Alice uses Bob’s symmetric key to decrypt the message.</span></span>

<span data-ttu-id="58982-157">[**AsymmetricKeyAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241478) オブジェクトを使うと、非対称アルゴリズムまたは署名アルゴリズムの指定、短期的なキー ペアの作成またはインポート、キー ペアの公開キー部分のインポートが可能になります。</span><span class="sxs-lookup"><span data-stu-id="58982-157">You can use an [**AsymmetricKeyAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241478) object to specify an asymmetric algorithm or a signing algorithm, to create or import an ephemeral key pair, or to import the public key portion of a key pair.</span></span>

## <a name="deriving-keys"></a><span data-ttu-id="58982-158">キーの派生</span><span class="sxs-lookup"><span data-stu-id="58982-158">Deriving keys</span></span>


<span data-ttu-id="58982-159">多くの場合、共有シークレットから追加キーを派生する必要があります。</span><span class="sxs-lookup"><span data-stu-id="58982-159">It is often necessary to derive additional keys from a shared secret.</span></span> <span data-ttu-id="58982-160">[**KeyDerivationAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241518) クラスおよび [**KeyDerivationParameters**](https://msdn.microsoft.com/library/windows/apps/br241524) クラスの次の専用メソッドのいずれかを使って、キーを派生できます。</span><span class="sxs-lookup"><span data-stu-id="58982-160">You can use the [**KeyDerivationAlgorithmProvider**](https://msdn.microsoft.com/library/windows/apps/br241518) class and one of the following specialized methods in the [**KeyDerivationParameters**](https://msdn.microsoft.com/library/windows/apps/br241524) class to derive keys.</span></span>

| <span data-ttu-id="58982-161">オブジェクト</span><span class="sxs-lookup"><span data-stu-id="58982-161">Object</span></span>                                                                            | <span data-ttu-id="58982-162">説明</span><span class="sxs-lookup"><span data-stu-id="58982-162">Description</span></span>                                                                                                                                |
|-----------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| [**<span data-ttu-id="58982-163">BuildForPbkdf2</span><span class="sxs-lookup"><span data-stu-id="58982-163">BuildForPbkdf2</span></span>**](https://msdn.microsoft.com/library/windows/apps/br241525)    | <span data-ttu-id="58982-164">パスワードベースのキー派生関数 2 (PBKDF2) で使う KeyDerivationParameters オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="58982-164">Creates a KeyDerivationParameters object for use in the password-based key derivation function 2 (PBKDF2).</span></span>                                 |
| [**<span data-ttu-id="58982-165">BuildForSP800108</span><span class="sxs-lookup"><span data-stu-id="58982-165">BuildForSP800108</span></span>**](https://msdn.microsoft.com/library/windows/apps/br241526)  | <span data-ttu-id="58982-166">カウンター モードのハッシュベース メッセージ認証コード (HMAC) キー派生関数で使う KeyDerivationParameters オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="58982-166">Creates a KeyDerivationParameters object for use in a counter mode, hash-based message authentication code (HMAC) key derivation function.</span></span> |
| [**<span data-ttu-id="58982-167">BuildForSP80056a</span><span class="sxs-lookup"><span data-stu-id="58982-167">BuildForSP80056a</span></span>**](https://msdn.microsoft.com/library/windows/apps/br241527)  | <span data-ttu-id="58982-168">SP800-56A キー派生関数で使う KeyDerivationParameters オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="58982-168">Creates a KeyDerivationParameters object for use in the SP800-56A key derivation function.</span></span>                                                 |

 
