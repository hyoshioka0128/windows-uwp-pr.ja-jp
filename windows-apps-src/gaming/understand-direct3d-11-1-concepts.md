---
title: Direct3D 9 と Direct3D 11 の間の重要な変更点
description: このトピックでは、DirectX 9 と DirectX 11 の大まかな違いについて説明します。
ms.assetid: 35a9e388-b25e-2aac-0534-577b15dae364
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP, ゲーム, DirectX, Direct3D 9, Direct3D 11, 変更
ms.localizationpriority: medium
ms.openlocfilehash: ecdd8591efb3920d2cfe333aa8ec02c65c1a1465
ms.sourcegitcommit: d7613c791107f74b6a3dc12a372d9de916c0454b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2018
ms.locfileid: "8734829"
---
# <a name="important-changes-from-direct3d-9-to-direct3d-11"></a><span data-ttu-id="0a8a6-104">Direct3D 9 と Direct3D 11 の間の重要な変更点</span><span class="sxs-lookup"><span data-stu-id="0a8a6-104">Important changes from Direct3D 9 to Direct3D 11</span></span>



**<span data-ttu-id="0a8a6-105">要約</span><span class="sxs-lookup"><span data-stu-id="0a8a6-105">Summary</span></span>**

-   [<span data-ttu-id="0a8a6-106">DirectX の移植の計画</span><span class="sxs-lookup"><span data-stu-id="0a8a6-106">Plan your DirectX port</span></span>](plan-your-directx-port.md)
-   <span data-ttu-id="0a8a6-107">Direct3D 9 と Direct3D 11 の間の重要な変更点</span><span class="sxs-lookup"><span data-stu-id="0a8a6-107">Important changes from Direct3D 9 to Direct3D 11</span></span>
-   [<span data-ttu-id="0a8a6-108">機能のマッピング</span><span class="sxs-lookup"><span data-stu-id="0a8a6-108">Feature mapping</span></span>](feature-mapping.md)


<span data-ttu-id="0a8a6-109">このトピックでは、DirectX 9 と DirectX 11 の大まかな違いについて説明します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-109">This topic explains the high-level differences between DirectX 9 and DirectX 11.</span></span>

<span data-ttu-id="0a8a6-110">Direct3D 11 は、グラフィックス ハードウェアに対する下位レベルの仮想化インターフェイスである Direct3D 9 と基本的に同じ種類の API です。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-110">Direct3D 11 is fundamentally the same type of API as Direct3D 9 - a low-level, virtualized interface into graphics hardware.</span></span> <span data-ttu-id="0a8a6-111">これまでどおり、さまざまなハードウェア実装でグラフィックス描画操作を実行できます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-111">It still allows you to perform graphics drawing operations on a variety of hardware implementations.</span></span> <span data-ttu-id="0a8a6-112">グラフィックス API のレイアウトは Direct3D 9 から変更されています。具体的には、デバイス コンテキストの概念が拡張され、グラフィックス インフラストラクチャ専用の API が追加されました。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-112">The layout of the graphics API has changed since Direct3D 9; the concept of a device context has been expanded, and an API has been added specifically for graphics infrastructure.</span></span> <span data-ttu-id="0a8a6-113">Direct3D デバイスに格納されたリソースには、リソース ビューと呼ばれるデータ ポリモーフィズムの新しいメカニズムが用意されています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-113">Resources stored on the Direct3D device have a novel mechanism for data polymorphism called a resource view.</span></span>

## <a name="core-api-functions"></a><span data-ttu-id="0a8a6-114">コア API の関数</span><span class="sxs-lookup"><span data-stu-id="0a8a6-114">Core API functions</span></span>


<span data-ttu-id="0a8a6-115">Direct3D 9 では、使い始める前に、Direct3D API へのインターフェイスを作成する必要がありました。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-115">In Direct3D 9 you had to create an interface to the Direct3D API before you could start using it.</span></span> <span data-ttu-id="0a8a6-116">Direct3D 11 ユニバーサル Windows プラットフォーム (UWP) ゲームでは、[**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) という静的関数を呼び出して、デバイスとデバイス コンテキストを作成します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-116">In your Direct3D 11 Universal Windows Platform (UWP) game, you call a static function called [**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) to create the device and the device context.</span></span>

## <a name="devices-and-device-context"></a><span data-ttu-id="0a8a6-117">デバイスとデバイス コンテキスト</span><span class="sxs-lookup"><span data-stu-id="0a8a6-117">Devices and device context</span></span>


<span data-ttu-id="0a8a6-118">Direct3D 11 デバイスは、仮想化グラフィックス アダプターを表します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-118">A Direct3D 11 device represents a virtualized graphics adapter.</span></span> <span data-ttu-id="0a8a6-119">これは、GPU へのテクスチャのアップロード、テクスチャ リソースとスワップ チェーン上のビューの作成、テクスチャ サンプラーの作成など、ビデオ メモリ内にリソースを作成するために使います。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-119">It's used to create resources in video memory, for example: uploading textures to the GPU, creating views on texture resources and swap chains, and creating texture samplers.</span></span> <span data-ttu-id="0a8a6-120">Direct3D 11 デバイス インターフェイスの用途の全一覧については、「[**ID3D11Device**](https://msdn.microsoft.com/library/windows/desktop/ff476379)」と「[**ID3D11Device1**](https://msdn.microsoft.com/library/windows/desktop/hh404575)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-120">For a complete list of what a Direct3D 11 device interface is used for see [**ID3D11Device**](https://msdn.microsoft.com/library/windows/desktop/ff476379) and [**ID3D11Device1**](https://msdn.microsoft.com/library/windows/desktop/hh404575).</span></span>

<span data-ttu-id="0a8a6-121">Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="0a8a6-121">A Direct3D 11.</span></span> <span data-ttu-id="0a8a6-122">のデバイス コンテキストは、パイプラインの状態を設定し、レンダリング コマンドを生成するために使われます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-122">device context is used to set pipeline state and generate rendering commands.</span></span> <span data-ttu-id="0a8a6-123">たとえば、Direct3D 11 のレンダリング チェーンでは、デバイス コンテキストを使って、レンダリング チェーンを設定し、シーンを描画します (下記参照)。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-123">For example, a Direct3D 11 rendering chain uses a device context to set up the rendering chain and draw the scene (see below).</span></span> <span data-ttu-id="0a8a6-124">デバイス コンテキストは、Direct3D デバイス リソースで使われるビデオ メモリにアクセス (マップ) するために使われます。また、定数バッファー データなどのサブリソース データを更新するためにも使われます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-124">The device context is used to access (map) video memory used by Direct3D device resources; it's also used to update subresource data, for example constant buffer data.</span></span> <span data-ttu-id="0a8a6-125">Direct3D 11 デバイス コンテキストの用途の全一覧については、「[**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385)」と「[**ID3D11DeviceContext1**](https://msdn.microsoft.com/library/windows/desktop/hh404598)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-125">For a complete list of what a Direct3D 11 device context is used for see [**ID3D11DeviceContext**](https://msdn.microsoft.com/library/windows/desktop/ff476385) and [**ID3D11DeviceContext1**](https://msdn.microsoft.com/library/windows/desktop/hh404598).</span></span> <span data-ttu-id="0a8a6-126">ほとんどのサンプルではイミディエイト コンテキストを使ってデバイスに直接レンダリングしていますが、Direct3D 11 では主にマルチスレッドに使われる遅延デバイス コンテキストもサポートしています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-126">Note that most of our samples use an immediate context to render directly to the device, but Direct3D 11 also supports deferred device contexts, which are primarily used for multithreading.</span></span>

<span data-ttu-id="0a8a6-127">Direct3D 11 では、[**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) を呼び出して、デバイス ハンドルとデバイス コンテキスト ハンドルの両方を取得します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-127">In Direct3D 11, the device handle and device context handle are both obtained by calling [**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082).</span></span> <span data-ttu-id="0a8a6-128">また、このメソッドでは、特定のハードウェア機能を要求し、グラフィックス アダプターでサポートされている Direct3D 機能レベルの情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-128">This method is also where you request a specific set of hardware features and retrieve information on Direct3D feature levels supported by the graphics adapter.</span></span> <span data-ttu-id="0a8a6-129">デバイス、デバイス コンテキスト、スレッドの考慮事項について詳しくは、「[Direct3D 11 のデバイスについて](https://msdn.microsoft.com/library/windows/desktop/ff476880)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-129">See [Introduction to a Device in Direct3D 11](https://msdn.microsoft.com/library/windows/desktop/ff476880) for more info on devices, device contexts, and threading considerations.</span></span>

## <a name="device-infrastructure-frame-buffers-and-render-target-views"></a><span data-ttu-id="0a8a6-130">デバイス インフラストラクチャ、フレーム バッファー、レンダー ターゲット ビュー</span><span class="sxs-lookup"><span data-stu-id="0a8a6-130">Device infrastructure, frame buffers, and render target views</span></span>


<span data-ttu-id="0a8a6-131">Direct3D 11 では、[**IDXGIAdapter**](https://msdn.microsoft.com/library/windows/desktop/bb174523) と [**IDXGIDevice1**](https://msdn.microsoft.com/library/windows/desktop/hh404543) COM インターフェイスを使って、DirectX Graphic Infrastructure (DXGI) API でデバイス アダプターとハードウェア構成を設定します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-131">In Direct3D 11, the device adapter and hardware configuration are set with the DirectX Graphics Infrastructure (DXGI) API using the [**IDXGIAdapter**](https://msdn.microsoft.com/library/windows/desktop/bb174523) and [**IDXGIDevice1**](https://msdn.microsoft.com/library/windows/desktop/hh404543) COM interfaces.</span></span> <span data-ttu-id="0a8a6-132">特定の DXGI インターフェイスでバッファーなどのウィンドウ リソース (表示またはオフ スクリーン) を作成し、構成します。[**IDXGIFactory2**](https://msdn.microsoft.com/library/windows/desktop/hh404556) ファクトリ パターンの実装では、フレーム バッファーなどの DXGI リソースを取得します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-132">Buffers and other window resources (visible or offscreen) are created and configured by specific DXGI interfaces; the [**IDXGIFactory2**](https://msdn.microsoft.com/library/windows/desktop/hh404556) factory pattern implementation acquires DXGI resources such as the frame buffer.</span></span> <span data-ttu-id="0a8a6-133">DXGI がスワップ チェーンを所有するため、画面にフレームを表示するために DXGI インターフェイスが使われます (「[**IDXGISwapChain1**](https://msdn.microsoft.com/library/windows/desktop/hh404631)」をご覧ください)。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-133">Since DXGI owns the swap chain, a DXGI interface is used to present frames to the screen - see [**IDXGISwapChain1**](https://msdn.microsoft.com/library/windows/desktop/hh404631).</span></span>

<span data-ttu-id="0a8a6-134">[**IDXGIFactory2**](https://msdn.microsoft.com/library/windows/desktop/hh404556) を使って、ゲームと互換性のあるスワップ チェーンを作成します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-134">Use [**IDXGIFactory2**](https://msdn.microsoft.com/library/windows/desktop/hh404556) to create a swap chain compatible with your game.</span></span> <span data-ttu-id="0a8a6-135">HWND のスワップ チェーンを作成する代わりに、コア ウィンドウ (コンポジション (XAML の相互運用機能)) のスワップ チェーンを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-135">You need to create a swap chain for a core window, or for composition (XAML interop), instead of creating a swap chain for an HWND.</span></span>

## <a name="device-resources-and-resource-views"></a><span data-ttu-id="0a8a6-136">デバイス リソースとリソース ビュー</span><span class="sxs-lookup"><span data-stu-id="0a8a6-136">Device resources and resource views</span></span>


<span data-ttu-id="0a8a6-137">Direct3D 11 では、ビューと呼ばれるビデオ メモリ リソースに対する追加のポリモーフィズム レベルをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-137">Direct3D 11 supports an additional level of polymorphism on video memory resources known as views.</span></span> <span data-ttu-id="0a8a6-138">基本的には、テクスチャに対する Direct3D 9 オブジェクトは以前は 1 つでしたが、それが 2 つになりました。1 つはデータを保持するテクスチャ リソースで、もう 1 つはレンダリングにビューを使う方法を示すリソース ビューです。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-138">Essentially, where you had a single Direct3D 9 object for a texture, you now have two objects: the texture resource, which holds the data, and the resource view, which indicates how the view is used for rendering.</span></span> <span data-ttu-id="0a8a6-139">リソースに基づくビューでは、特定の目的にそのリソースを使うことができます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-139">A view based on a resource enables that resource to be used for a specific purpose.</span></span> <span data-ttu-id="0a8a6-140">たとえば、2D テクスチャ リソースを [**ID3D11Texture2D**](https://msdn.microsoft.com/library/windows/desktop/ff476635) として作成し、それをシェーダーのテクスチャとして使うことができるように、2D テクスチャ リソースに対してシェーダー リソース ビュー ([**ID3D11ShaderResourceView**](https://msdn.microsoft.com/library/windows/desktop/ff476628)) を作成します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-140">For example, a 2D texture resource is created as an [**ID3D11Texture2D**](https://msdn.microsoft.com/library/windows/desktop/ff476635), then a shader resource view ([**ID3D11ShaderResourceView**](https://msdn.microsoft.com/library/windows/desktop/ff476628)) is created on it so it can be used as a texture in a shader.</span></span> <span data-ttu-id="0a8a6-141">また、描画面として使うことができるように、同じ 2D テクスチャ リソースに対してレンダー ターゲット ビュー ([**ID3D11RenderTargetView**](https://msdn.microsoft.com/library/windows/desktop/ff476582)) を作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-141">A render target view ([**ID3D11RenderTargetView**](https://msdn.microsoft.com/library/windows/desktop/ff476582)) can also be created on the same 2D texture resource so that it can be used as a drawing surface.</span></span> <span data-ttu-id="0a8a6-142">別の例として、1 つのテクスチャ リソースに対して 2 つの異なるビューを使うと、同じピクセル データが 2 つの異なるピクセル形式で表されます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-142">In another example, the same pixel data is represented in 2 different pixel formats by using 2 separate views on a single texture resource.</span></span>

<span data-ttu-id="0a8a6-143">基になるリソースは、そのリソースから作成されるビューの種類と互換性のあるプロパティを使って作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-143">The underlying resource must be created with properties that are compatible with the type of views that will be created from it.</span></span> <span data-ttu-id="0a8a6-144">たとえば、[**ID3D11RenderTargetView**](https://msdn.microsoft.com/library/windows/desktop/ff476582) をサーフェスに適用する場合は、[**D3D11\_BIND\_RENDER\_TARGET**](https://msdn.microsoft.com/library/windows/desktop/ff476085) フラグを使って、そのサーフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-144">For example, if an [**ID3D11RenderTargetView**](https://msdn.microsoft.com/library/windows/desktop/ff476582) is applied to a surface, that surface is created with the [**D3D11\_BIND\_RENDER\_TARGET**](https://msdn.microsoft.com/library/windows/desktop/ff476085) flag.</span></span> <span data-ttu-id="0a8a6-145">また、サーフェスは、レンダリングと互換性のある DXGI サーフェス形式にする必要があります (「[**DXGI\_FORMAT**](https://msdn.microsoft.com/library/windows/desktop/bb173059)」をご覧ください)。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-145">The surface also has to have a DXGI surface format compatible with rendering (see [**DXGI\_FORMAT**](https://msdn.microsoft.com/library/windows/desktop/bb173059)).</span></span>

<span data-ttu-id="0a8a6-146">レンダリングに使うリソースのほとんどは、[**ID3D11Resource**](https://msdn.microsoft.com/library/windows/desktop/ff476584) インターフェイスから継承します。このインターフェイスは、[**ID3D11DeviceChild**](https://msdn.microsoft.com/library/windows/desktop/ff476380) から継承します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-146">Most of the resources you use for rendering inherit from the [**ID3D11Resource**](https://msdn.microsoft.com/library/windows/desktop/ff476584) interface, which inherits from [**ID3D11DeviceChild**](https://msdn.microsoft.com/library/windows/desktop/ff476380).</span></span> <span data-ttu-id="0a8a6-147">頂点バッファー、インデックス バッファー、定数バッファー、シェーダーはすべて Direct3D 11 リソースです。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-147">Vertex buffers, index buffers, constant buffers, and shaders are all Direct3D 11 resources.</span></span> <span data-ttu-id="0a8a6-148">入力レイアウトとサンプラーの状態は [**ID3D11DeviceChild**](https://msdn.microsoft.com/library/windows/desktop/ff476380) から直接継承します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-148">Input layouts and sampler states inherit directly from [**ID3D11DeviceChild**](https://msdn.microsoft.com/library/windows/desktop/ff476380).</span></span>

<span data-ttu-id="0a8a6-149">リソース ビューでは、DXGI\_FORMAT 列挙値を使って、ピクセル形式を指定します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-149">Resources views use a DXGI\_FORMAT enum value to indicate the pixel format.</span></span> <span data-ttu-id="0a8a6-150">すべての D3DFMT が DXGI\_FORMAT としてサポートされているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-150">Not every D3DFMT is supported as a DXGI\_FORMAT.</span></span> <span data-ttu-id="0a8a6-151">たとえば、DXGI には、D3DFMT\_R8G8B8 に相当する 24bpp RGB 形式がありません。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-151">For example, there is no 24bpp RGB format in DXGI that is equivalent to D3DFMT\_R8G8B8.</span></span> <span data-ttu-id="0a8a6-152">また、すべての RGB 形式に相当する BGR があるわけでもありません (DXGI\_FORMAT\_R10G10B10A2\_UNORM は D3DFMT\_A2B10G10R10 に相当しますが、D3DFMT\_A2R10G10B10 に直接相当する形式はありません)。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-152">There are also not BGR equivalents to every RGB format (DXGI\_FORMAT\_R10G10B10A2\_UNORM is equivalent to D3DFMT\_A2B10G10R10, but there’s no direct equivalent to D3DFMT\_A2R10G10B10).</span></span> <span data-ttu-id="0a8a6-153">これらの従来の形式のコンテンツをビルド時にサポートされている形式に変換する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-153">You should plan to convert any content in these legacy formats to supported formats at build-time.</span></span> <span data-ttu-id="0a8a6-154">DXGI 形式の全一覧については、「[**DXGI\_FORMAT**](https://msdn.microsoft.com/library/windows/desktop/bb173059)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-154">For a complete list of DXGI formats see the [**DXGI\_FORMAT**](https://msdn.microsoft.com/library/windows/desktop/bb173059) enumeration.</span></span>

<span data-ttu-id="0a8a6-155">Direct3D デバイス リソース (とリソース ビュー) は、シーンをレンダリングする前に作成します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-155">Direct3D device resources (and resource views) are created before the scene is rendered.</span></span> <span data-ttu-id="0a8a6-156">デバイス コンテキストは、後で説明するように、レンダリング チェーンを設定するために使われます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-156">Device contexts are used to set up the rendering chain, as explained below.</span></span>

## <a name="device-context-and-the-rendering-chain"></a><span data-ttu-id="0a8a6-157">デバイス コンテキストとレンダリング チェーン</span><span class="sxs-lookup"><span data-stu-id="0a8a6-157">Device context and the rendering chain</span></span>


<span data-ttu-id="0a8a6-158">Direct3D 9 と Direct3D 10.x には、リソースの作成、状態、描画を管理する単一の Direct3D デバイス オブジェクトがありました。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-158">In Direct3D 9 and Direct3D 10.x, there was a single Direct3D device object which managed resource creation, state, and drawing.</span></span> <span data-ttu-id="0a8a6-159">Direct3D 11 では、これまでどおり Direct3D デバイス インターフェイスでリソースの作成を管理しますが、すべての状態と描画操作は Direct3D デバイス コンテキストを使って処理します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-159">In Direct3D 11, the Direct3D device interface still manages resource creation, but all state and drawing operations are handled by using a Direct3D device context.</span></span> <span data-ttu-id="0a8a6-160">デバイス コンテキスト ([**ID3D11DeviceContext1**](https://msdn.microsoft.com/library/windows/desktop/hh404598) インターフェイス) を使って、レンダリング チェーンを設定する例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-160">Here's an example of how the device context ([**ID3D11DeviceContext1**](https://msdn.microsoft.com/library/windows/desktop/hh404598) interface) is used to set up the rendering chain:</span></span>

-   <span data-ttu-id="0a8a6-161">レンダー ターゲット ビュー (と深度ステンシル ビュー) の設定と消去</span><span class="sxs-lookup"><span data-stu-id="0a8a6-161">Set and clear render target views (and depth stencil view)</span></span>
-   <span data-ttu-id="0a8a6-162">入力アセンブラー ステージ (IA ステージ) の頂点バッファー、インデックス バッファー、入力レイアウトの設定</span><span class="sxs-lookup"><span data-stu-id="0a8a6-162">Set the vertex buffer, index buffer, and input layout for the input assembler stage (IA stage)</span></span>
-   <span data-ttu-id="0a8a6-163">パイプラインへの頂点シェーダーとピクセル シェーダーのバインド</span><span class="sxs-lookup"><span data-stu-id="0a8a6-163">Bind vertex and pixel shaders to the pipeline</span></span>
-   <span data-ttu-id="0a8a6-164">シェーダーへの定数バッファーのバインド</span><span class="sxs-lookup"><span data-stu-id="0a8a6-164">Bind constant buffers to shaders</span></span>
-   <span data-ttu-id="0a8a6-165">ピクセル シェーダーへのテクスチャ ビューとサンプラーのバインド</span><span class="sxs-lookup"><span data-stu-id="0a8a6-165">Bind texture views and samplers to the pixel shader</span></span>
-   <span data-ttu-id="0a8a6-166">シーンの描画</span><span class="sxs-lookup"><span data-stu-id="0a8a6-166">Draw the scene</span></span>

<span data-ttu-id="0a8a6-167">[**ID3D11DeviceContext::Draw**](https://msdn.microsoft.com/library/windows/desktop/ff476407) メソッドの 1 つを呼び出すと、レンダー ターゲット ビューにシーンが描画されます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-167">When one of the [**ID3D11DeviceContext::Draw**](https://msdn.microsoft.com/library/windows/desktop/ff476407) methods is called, the scene is drawn on the render target view.</span></span> <span data-ttu-id="0a8a6-168">すべての描画が完了したら、[**IDXGISwapChain1::Present1**](https://msdn.microsoft.com/library/windows/desktop/hh446797) を呼び出し、DXGI アダプターを使って、完成したフレームを表示します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-168">When you're done will all your drawing the DXGI adapter is used to present the completed frame by calling [**IDXGISwapChain1::Present1**](https://msdn.microsoft.com/library/windows/desktop/hh446797).</span></span>

## <a name="state-management"></a><span data-ttu-id="0a8a6-169">状態の管理</span><span class="sxs-lookup"><span data-stu-id="0a8a6-169">State management</span></span>


<span data-ttu-id="0a8a6-170">Direct3D 9 では、SetRenderState、SetSamplerState、SetTextureStageState メソッドで設定された多数の個々のトグルを使って状態の設定を管理しました。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-170">Direct3D 9 managed state settings with a large set of individual toggles set with the SetRenderState, SetSamplerState, and SetTextureStageState methods.</span></span> <span data-ttu-id="0a8a6-171">Direct3D 11 では、従来の固定関数パイプラインがサポートされないため、SetTextureStageState の代わりに、ピクセル シェーダー (PS) を記述します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-171">Since Direct3D 11 does not support the legacy fixed-function pipeline, the SetTextureStageState is replaced by writing pixel shaders (PS).</span></span> <span data-ttu-id="0a8a6-172">Direct3D 9 の状態ブロックに相当するものはありません。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-172">There is no equivalent to a Direct3D 9 state block.</span></span> <span data-ttu-id="0a8a6-173">代わりに、Direct3D 11 では、レンダリングの状態をグループ化する合理化的な方法を提供する 4 種類の状態オブジェクトを使って状態を管理します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-173">Direct3D 11 instead manages state through the use of 4 kinds of state objects which provide a more streamlined way to group the rendering state.</span></span>

<span data-ttu-id="0a8a6-174">たとえば、SetRenderState と D3DRS\_ZENABLE を使う代わりに、そうした関連する状態の設定を含む DepthStencilState オブジェクトを作成し、それを使ってレンダリング中に状態を変更します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-174">For example, instead of using SetRenderState with D3DRS\_ZENABLE, you create a DepthStencilState object with this and other related state settings and use it to change state while rendering.</span></span>

<span data-ttu-id="0a8a6-175">Direct3D 9 アプリケーションを状態オブジェクトに移植する際は、さまざまな状態の組み合わせが、変更できない状態オブジェクトとして表されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-175">When porting Direct3D 9 applications to state objects, be aware that your various state combinations are represented as immutable state objects.</span></span> <span data-ttu-id="0a8a6-176">それらは一度作成し、有効な限り再利用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-176">They should be created once and re-used as long as they are valid.</span></span>

## <a name="direct3d-feature-levels"></a><span data-ttu-id="0a8a6-177">Direct3D の機能レベル</span><span class="sxs-lookup"><span data-stu-id="0a8a6-177">Direct3D feature levels</span></span>


<span data-ttu-id="0a8a6-178">Direct3D には、機能レベルと呼ばれるハードウェア サポートを確認するための新しいメカニズムが用意されています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-178">Direct3D has a new mechanism for determining hardware support called feature levels.</span></span> <span data-ttu-id="0a8a6-179">機能レベルにより、明確に定義された一連の GPU 機能を要求できるようになるため、グラフィックス アダプターが実行できる操作を簡単に判断できます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-179">Feature levels simplify the task of figuring out what the graphics adapter can do by allowing you to request a well-defined set of GPU functionality.</span></span> <span data-ttu-id="0a8a6-180">たとえば、9\_1 機能レベルでは、シェーダー モデル 2.x など、Direct3D 9 グラフィックス アダプターで提供される機能が実装されます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-180">For example, the 9\_1 feature level implements the functionality provided by Direct3D 9 graphics adapters, including shader model 2.x.</span></span> <span data-ttu-id="0a8a6-181">9\_1 は最も低い機能レベルであるため、すべてのデバイスで頂点シェーダーとピクセル シェーダーがサポートされると考えることができます。これらは、Direct3D 9 のプログラム可能なシェーダー モデルでサポートされているのと同じステージです。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-181">Since 9\_1 is the lowest feature level, you can expect all devices to support a vertex shader and a pixel shader, which were the same stages supported by the Direct3D 9 programmable shader model.</span></span>

<span data-ttu-id="0a8a6-182">ゲームでは [**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) を使って、Direct3D デバイスとデバイス コンテキストを作成します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-182">Your game will use [**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) to create the Direct3D device and device context.</span></span> <span data-ttu-id="0a8a6-183">この関数を呼び出す際に、ゲームでサポートできる機能レベルの一覧を指定します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-183">When you call this function you provide a list of feature levels that your game can support.</span></span> <span data-ttu-id="0a8a6-184">この関数は、その一覧からサポートされる最高の機能レベルを返します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-184">It will return the highest supported feature level from that list.</span></span> <span data-ttu-id="0a8a6-185">たとえば、ゲームで BC4/BC5 テクスチャ (DirectX 10 ハードウェアの機能) を使うことができる場合は、サポートされる機能レベルの一覧に少なくとも 9\_1 と 10\_0 を含めます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-185">For example if your game can use BC4/BC5 textures (a feature of DirectX 10 hardware), you would include at least 9\_1 and 10\_0 in the list of supported feature levels.</span></span> <span data-ttu-id="0a8a6-186">ゲームが DirectX 9 ハードウェアで実行されており、BC4/BC5 テクスチャを使うことができない場合、[**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) は 9\_1 を返します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-186">If the game is running on DirectX 9 hardware and BC4/BC5 textures can't be used, then [**D3D11CreateDevice**](https://msdn.microsoft.com/library/windows/desktop/ff476082) will return 9\_1.</span></span> <span data-ttu-id="0a8a6-187">その場合は、別のテクスチャ形式 (とより小さいテクスチャ) にフォールバックできます。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-187">Then your game can fall back to a different texture format (and smaller textures).</span></span>

<span data-ttu-id="0a8a6-188">Direct3D 9 ゲームを拡張して、より高い Direct3D 機能レベルをサポートする場合は、まず、既にある Direct3D 9 グラフィックス コードの移行を完了させることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-188">If you decide to extend your Direct3D 9 game to support higher Direct3D feature levels then it's better to finish porting your existing Direct3D 9 graphics code first.</span></span> <span data-ttu-id="0a8a6-189">ゲームが Direct3D 11 で動作するようにすると、拡張グラフィックスを使った追加のレンダリング パスの追加が簡単になります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-189">After you have your game working in Direct3D 11, it's easier to add additional rendering paths with enhanced graphics.</span></span>

<span data-ttu-id="0a8a6-190">機能レベルのサポートについて詳しくは、「[Direct3D 機能レベル](https://msdn.microsoft.com/library/windows/desktop/ff476876)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-190">See [Direct3D feature levels](https://msdn.microsoft.com/library/windows/desktop/ff476876) for a detailed explanation of feature level support.</span></span> <span data-ttu-id="0a8a6-191">Direct3D 11 機能の一覧については、「[Direct3D 11 の機能](https://msdn.microsoft.com/library/windows/desktop/ff476342)」と「[Direct3D 11.1 の機能](https://msdn.microsoft.com/library/windows/desktop/hh404562)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-191">See [Direct3D 11 Features](https://msdn.microsoft.com/library/windows/desktop/ff476342) and [Direct3D 11.1 Features](https://msdn.microsoft.com/library/windows/desktop/hh404562) for a full list of Direct3D 11 features.</span></span>

## <a name="feature-levels-and-the-programmable-pipeline"></a><span data-ttu-id="0a8a6-192">機能レベルとプログラム可能なパイプライン</span><span class="sxs-lookup"><span data-stu-id="0a8a6-192">Feature levels and the programmable pipeline</span></span>


<span data-ttu-id="0a8a6-193">ハードウェアは Direct3D 9 から進化を続けており、いくつかの新しいオプション ステージがプログラム可能なグラフィックス パイプラインに追加されています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-193">Hardware has continue to evolve since Direct3D 9, and several new optional stages have been added to the programmable graphics pipeline.</span></span> <span data-ttu-id="0a8a6-194">グラフィックス パイプラインの一連のオプションは、Direct3D 機能レベルによって異なります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-194">The set of options you have for the graphics pipeline varies with the Direct3D feature level.</span></span> <span data-ttu-id="0a8a6-195">機能レベル 10.0 には、GPU でのマルチパス レンダリング用のオプションのストリーム アウトがあるジオメトリ シェーダー ステージが含まれています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-195">Feature level 10.0 includes the geometry shader stage with optional stream out for multipass rendering on the GPU.</span></span> <span data-ttu-id="0a8a6-196">機能レベル 11\_0 には、ハードウェア テセレーションで使うハル シェーダーとドメイン シェーダーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-196">Feature level 11\_0 include the hull shader and domain shader for use with hardware tessellation.</span></span> <span data-ttu-id="0a8a6-197">また、DirectCompute シェーダーの完全なサポートも含まれています。一方、機能レベル 10.x には DirectCompute の限定された形式のサポートだけが含まれています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-197">Feature level 11\_0 also includes full support for DirectCompute shaders, while feature levels 10.x only include support for a limited form of DirectCompute.</span></span>

<span data-ttu-id="0a8a6-198">すべてのシェーダーは、Direct3D 機能レベルに対応するシェーダー プロファイルを使って HLSL で記述します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-198">All shaders are written in HLSL using a shader profile that corresponds to a Direct3D feature level.</span></span> <span data-ttu-id="0a8a6-199">シェーダー プロファイルには上位互換性があるため、vs\_4\_0\_level\_9\_1 または ps\_4\_0\_level\_9\_1 を使ってコンパイルした HLSL シェーダーはすべてのデバイスで動作します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-199">Shader profiles are upwards compatible, so an HLSL shader that compiles using vs\_4\_0\_level\_9\_1 or ps\_4\_0\_level\_9\_1 will work across all devices.</span></span> <span data-ttu-id="0a8a6-200">ただし、下位互換性がないため、vs\_4\_1 を使ってコンパイルしたシェーダーは機能レベル 10\_1、11\_0、または 11\_1 のデバイスでしか動作しません。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-200">Shader profiles are not downlevel compatible, so a shader compiled using vs\_4\_1 will only work on feature level 10\_1, 11\_0, or 11\_1 devices.</span></span>

<span data-ttu-id="0a8a6-201">Direct3D 9 では、共有配列と一緒に SetVertexShaderConstant と SetPixelShaderConstant を使ってシェーダーの定数を管理していました。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-201">Direct3D 9 managed constants for shaders using a shared array with SetVertexShaderConstant and SetPixelShaderConstant.</span></span> <span data-ttu-id="0a8a6-202">Direct3D 11 では、頂点バッファーやインデックス バッファーと同じようなリソースである定数バッファーを使います。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-202">Direct3D 11 uses constant buffers, which are resources like a vertex buffer or index buffer.</span></span> <span data-ttu-id="0a8a6-203">定数バッファーは、効率的に更新できるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-203">Constant buffers are designed to be updated efficiently.</span></span> <span data-ttu-id="0a8a6-204">すべてのシェーダー定数を 1 つのグローバル配列にまとめる代わりに、定数を論理グループに整理し、1 つ以上の定数バッファーを使って管理します。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-204">Instead of having all the shader contants organized into a single global array you organize your constants into logical groupings and manage them through one or more constant buffers.</span></span> <span data-ttu-id="0a8a6-205">Direct3D 9 ゲームを Direct3D 11 に移植する場合は、定数バッファーを適切に更新できるように整理してください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-205">When you port your Direct3D 9 game to Direct3D 11, plan to organize your constant buffers so that you can update them appropriately.</span></span> <span data-ttu-id="0a8a6-206">たとえば、フレームごとに更新されないシェーダーの定数は別の定数バッファーにグループ化します。そうすると、より動的なシェーダーの定数と一緒にそのデータをグラフィックス アダプターに絶えずアップロードする必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-206">For example, group shader constants that aren't updated every frame into a separate constant buffer, so that you don't have to constantly upload that data to the graphics adapter along with your more dynamic shader constants.</span></span>

> <span data-ttu-id="0a8a6-207">**注:** ほとんどの direct3d9 アプリケーション、シェーダーの広範な使用が使用する従来の固定関数の動作で混在場合があります。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-207">**Note** Most Direct3D 9 applications made extensive use of shaders, but occasionally mixed in use of the legacy fixed-function behavior.</span></span> <span data-ttu-id="0a8a6-208">Direct3D 11 では、プログラム可能なシェーダー モデルしか使わないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-208">Note that Direct3D 11 only uses a programmable shading model.</span></span> <span data-ttu-id="0a8a6-209">Direct3D 9 の従来の固定関数機能は推奨されなくなりました。</span><span class="sxs-lookup"><span data-stu-id="0a8a6-209">The legacy fixed-function features of Direct3D 9 are deprecated.</span></span>

 

 

 




