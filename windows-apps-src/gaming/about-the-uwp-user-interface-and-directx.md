---
author: mtoepke
title: アプリ オブジェクトと DirectX
description: DirectX を使ったユニバーサル Windows プラットフォーム (UWP) ゲームでは、Windows UI ユーザー インターフェイスの要素とオブジェクトの多くが使われません。
ms.assetid: 46f92156-29f8-d65e-2587-7ba1de5b48a6
ms.author: mtoepke
ms.date: 02/08/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10, UWP, DirectX, アプリ オブジェクト
ms.localizationpriority: medium
ms.openlocfilehash: b17147d1b4985c08f49a1a5f6de306e5713e7918
ms.sourcegitcommit: 842ddba19fa3c028ea43e7922011515dbeb34e9c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/05/2018
ms.locfileid: "1488977"
---
# <a name="the-app-object-and-directx"></a><span data-ttu-id="d2c50-104">アプリ オブジェクトと DirectX</span><span class="sxs-lookup"><span data-stu-id="d2c50-104">The app object and DirectX</span></span>



<span data-ttu-id="d2c50-105">DirectX を使ったユニバーサル Windows プラットフォーム (UWP) ゲームでは、Windows UI ユーザー インターフェイスの要素とオブジェクトの多くが使われません。</span><span class="sxs-lookup"><span data-stu-id="d2c50-105">Universal Windows Platform (UWP) with DirectX games don't use many of the Windows UI user interface elements and objects.</span></span> <span data-ttu-id="d2c50-106">逆に、それらのアプリは Windows ランタイム スタックの下位レベルで実行されることから、アプリ オブジェクトに直接アクセスして相互運用するという基本的な方法でユーザー インターフェイス フレームワークと相互運用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-106">Rather, because they run at a lower level in the Windows Runtime stack, they must interoperate with the user interface framework in a more fundamental way: by accessing and interoperating with the app object directly.</span></span> <span data-ttu-id="d2c50-107">ここでは、この相互運用をいつどのように行うかと、DirectX 開発者が UWP アプリの開発でこのモデルを効果的に使う方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-107">Learn when and how this interoperation occurs, and how you, as a DirectX developer, can effectively use this model in the development of your UWP app.</span></span>

## <a name="the-important-core-user-interface-namespaces"></a><span data-ttu-id="d2c50-108">重要なコア ユーザー インターフェイスの名前空間</span><span class="sxs-lookup"><span data-stu-id="d2c50-108">The important core user interface namespaces</span></span>


<span data-ttu-id="d2c50-109">最初に、UWP アプリに (**using** を使って) 必要な Windows ランタイムの名前空間を示します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-109">First, let's note the Windows Runtime namespaces that you must include (with **using**) in your UWP app.</span></span> <span data-ttu-id="d2c50-110">後で詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-110">We get into the details in a bit.</span></span>

-   [**<span data-ttu-id="d2c50-111">Windows.ApplicationModel.Core</span><span class="sxs-lookup"><span data-stu-id="d2c50-111">Windows.ApplicationModel.Core</span></span>**](https://msdn.microsoft.com/library/windows/apps/br205865)
-   [**<span data-ttu-id="d2c50-112">Windows.ApplicationModel.Activation</span><span class="sxs-lookup"><span data-stu-id="d2c50-112">Windows.ApplicationModel.Activation</span></span>**](https://msdn.microsoft.com/library/windows/apps/br224766)
-   [**<span data-ttu-id="d2c50-113">Windows.UI.Core</span><span class="sxs-lookup"><span data-stu-id="d2c50-113">Windows.UI.Core</span></span>**](https://msdn.microsoft.com/library/windows/apps/br208383)
-   [**<span data-ttu-id="d2c50-114">Windows.System</span><span class="sxs-lookup"><span data-stu-id="d2c50-114">Windows.System</span></span>**](https://msdn.microsoft.com/library/windows/apps/br241814)
-   [**<span data-ttu-id="d2c50-115">Windows.Foundation</span><span class="sxs-lookup"><span data-stu-id="d2c50-115">Windows.Foundation</span></span>**](https://msdn.microsoft.com/library/windows/apps/br226021)

> <span data-ttu-id="d2c50-116">**注:** UWP アプリを開発していない場合は、これらの名前空間で提供されている型ではなく、JavaScript または XAML 専用のライブラリと名前空間で提供されているユーザー インターフェイス コンポーネントを使ってください。</span><span class="sxs-lookup"><span data-stu-id="d2c50-116">**Note**   If you are not developing a UWP app, use the user interface components provided in the JavaScript- or XAML-specific libraries and namespaces instead of the types provided in these namespaces.</span></span>

 

## <a name="the-windows-runtime-app-object"></a><span data-ttu-id="d2c50-117">Windows ランタイム アプリ オブジェクト</span><span class="sxs-lookup"><span data-stu-id="d2c50-117">The Windows Runtime app object</span></span>


<span data-ttu-id="d2c50-118">UWP アプリでは、ウィンドウとビュー プロバイダーを取得します。これらはビューの取得元となり、スワップ チェーン (表示バッファー) の接続先となります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-118">In your UWP app, you want to get a window and a view provider from which you can get a view and to which you can connect your swap chain (your display buffers).</span></span> <span data-ttu-id="d2c50-119">このビューは、実行中のアプリでウィンドウ固有のイベントにフックすることもできます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-119">You can also hook this view into the window-specific events for your running app.</span></span> <span data-ttu-id="d2c50-120">アプリ オブジェクトの親ウィンドウ ([**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) 型で定義) を取得するには、前のコード スニペットで行ったように、[**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482) を実装する型を作成します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-120">To get the parent window for the app object, defined by the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) type, create a type that implements [**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482), as we did in the previous code snippet.</span></span>

<span data-ttu-id="d2c50-121">コア ユーザー インターフェイス フレームワークを使ってウィンドウを取得する基本的な手順を次に示します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-121">Here's the basic set of steps to get a window using the core user interface framework:</span></span>

1.  <span data-ttu-id="d2c50-122">[**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478) を実装する型を作成します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-122">Create a type that implements [**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478).</span></span> <span data-ttu-id="d2c50-123">これがビューになります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-123">This is your view.</span></span>

    <span data-ttu-id="d2c50-124">この型で次のメソッドを定義します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-124">In this type, define:</span></span>

    -   <span data-ttu-id="d2c50-125">[**Initialize**](https://msdn.microsoft.com/library/windows/apps/hh700495) メソッド。[**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) のインスタンスをパラメーターとして使います。</span><span class="sxs-lookup"><span data-stu-id="d2c50-125">An [**Initialize**](https://msdn.microsoft.com/library/windows/apps/hh700495) method that takes an instance of [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) as a parameter.</span></span> <span data-ttu-id="d2c50-126">この型のインスタンスを取得するには、[**CoreApplication.CreateNewView**](https://msdn.microsoft.com/library/windows/apps/dn297278) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-126">You can get an instance of this type by calling [**CoreApplication.CreateNewView**](https://msdn.microsoft.com/library/windows/apps/dn297278).</span></span> <span data-ttu-id="d2c50-127">アプリ オブジェクトは、アプリ起動時にこのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-127">The app object calls it when the app is launched.</span></span>
    -   <span data-ttu-id="d2c50-128">[**SetWindow**](https://msdn.microsoft.com/library/windows/apps/hh700509) メソッド。[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) のインスタンスをパラメーターとして使います。</span><span class="sxs-lookup"><span data-stu-id="d2c50-128">A [**SetWindow**](https://msdn.microsoft.com/library/windows/apps/hh700509) method that takes an instance of [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) as a parameter.</span></span> <span data-ttu-id="d2c50-129">この型のインスタンスを取得するには、新しい [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) インスタンスの [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) プロパティにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-129">You can get an instance of this type by accessing the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) property on your new [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) instance.</span></span>
    -   <span data-ttu-id="d2c50-130">[**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501) メソッド。エントリ ポイントの文字列を唯一のパラメーターとして使います。</span><span class="sxs-lookup"><span data-stu-id="d2c50-130">A [**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501) method that takes a string for an entry point as the sole parameter.</span></span> <span data-ttu-id="d2c50-131">このメソッドを呼び出すと、アプリ オブジェクトからエントリ ポイントの文字列が提供されます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-131">The app object provides the entry point string when you call this method.</span></span> <span data-ttu-id="d2c50-132">ここでリソースをセットアップします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-132">This is where you set up resources.</span></span> <span data-ttu-id="d2c50-133">ここでデバイス リソースを作成します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-133">You create your device resources here.</span></span> <span data-ttu-id="d2c50-134">アプリ オブジェクトは、アプリ起動時にこのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-134">The app object calls it when the app is launched.</span></span>
    -   <span data-ttu-id="d2c50-135">[**Run**](https://msdn.microsoft.com/library/windows/apps/hh700505) メソッド。[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) オブジェクトをアクティブ化し、ウィンドウ イベント ディスパッチャーを開始します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-135">A [**Run**](https://msdn.microsoft.com/library/windows/apps/hh700505) method that activates the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) object and starts the window event dispatcher.</span></span> <span data-ttu-id="d2c50-136">アプリ オブジェクトは、アプリのプロセスが開始されたときにこのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-136">The app object calls it when the app's process starts.</span></span>
    -   <span data-ttu-id="d2c50-137">[**Uninitialize**](https://msdn.microsoft.com/library/windows/apps/hh700523) メソッド。[**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501)  の呼び出しでセットアップされたリソースをクリーンアップします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-137">An [**Uninitialize**](https://msdn.microsoft.com/library/windows/apps/hh700523) method that cleans up the resources set up in the call to [**Load**](https://msdn.microsoft.com/library/windows/apps/hh700501).</span></span> <span data-ttu-id="d2c50-138">アプリ オブジェクトは、アプリ終了時にこのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-138">The app object calls this method when the app is closed.</span></span>

2.  <span data-ttu-id="d2c50-139">[**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482) を実装する型を作成します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-139">Create a type that implements [**IFrameworkViewSource**](https://msdn.microsoft.com/library/windows/apps/hh700482).</span></span> <span data-ttu-id="d2c50-140">これがビュー プロバイダーになります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-140">This is your view provider.</span></span>

    <span data-ttu-id="d2c50-141">この型で次のメソッドを定義します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-141">In this type, define:</span></span>

    -   <span data-ttu-id="d2c50-142">[**CreateView**](https://msdn.microsoft.com/library/windows/apps/hh700491) メソッド。手順 1. で作成した [**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478) 実装のインスタンスを返します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-142">A method named [**CreateView**](https://msdn.microsoft.com/library/windows/apps/hh700491) that returns an instance of your [**IFrameworkView**](https://msdn.microsoft.com/library/windows/apps/hh700478) implementation, as created in Step 1.</span></span>

3.  <span data-ttu-id="d2c50-143">ビュー プロバイダーのインスタンスを、**main** から [**CoreApplication.Run**](https://msdn.microsoft.com/library/windows/apps/hh700469) に渡します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-143">Pass an instance of the view provider to [**CoreApplication.Run**](https://msdn.microsoft.com/library/windows/apps/hh700469) from **main**.</span></span>

<span data-ttu-id="d2c50-144">上記の基本事項を踏まえて、このアプローチを拡張するその他のオプションを説明します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-144">With those basics in mind, let's look at more options you have to extend this approach.</span></span>

## <a name="core-user-interface-types"></a><span data-ttu-id="d2c50-145">コア ユーザー インターフェイスの型</span><span class="sxs-lookup"><span data-stu-id="d2c50-145">Core user interface types</span></span>


<span data-ttu-id="d2c50-146">Windows ランタイムには、他にも次のような便利なコア ユーザー インターフェイスの型があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-146">Here are other core user interface types in the Windows Runtime that you might find helpful:</span></span>

-   [**<span data-ttu-id="d2c50-147">Windows.ApplicationModel.Core.CoreApplicationView</span><span class="sxs-lookup"><span data-stu-id="d2c50-147">Windows.ApplicationModel.Core.CoreApplicationView</span></span>**](https://msdn.microsoft.com/library/windows/apps/br225017)
-   [**<span data-ttu-id="d2c50-148">Windows.UI.Core.CoreWindow</span><span class="sxs-lookup"><span data-stu-id="d2c50-148">Windows.UI.Core.CoreWindow</span></span>**](https://msdn.microsoft.com/library/windows/apps/br208225)
-   [**<span data-ttu-id="d2c50-149">Windows.UI.Core.CoreDispatcher</span><span class="sxs-lookup"><span data-stu-id="d2c50-149">Windows.UI.Core.CoreDispatcher</span></span>**](https://msdn.microsoft.com/library/windows/apps/br208211)

<span data-ttu-id="d2c50-150">これらの型を使って、アプリのビュー、具体的にはアプリの親ウィンドウのコンテンツを描画するビットにアクセスし、そのウィンドウで発生したイベントを処理できます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-150">You can use these types to access your app's view, specifically, the bits that draw the contents of the app's parent window, and handle the events fired for that window.</span></span> <span data-ttu-id="d2c50-151">アプリ ウィンドウのプロセスは、すべてのコールバックを処理する独立した *アプリケーション シングルスレッド アパートメント* (ASTA) です。</span><span class="sxs-lookup"><span data-stu-id="d2c50-151">The app window's process is an *application single-threaded apartment* (ASTA) that is isolated and that handles all callbacks.</span></span>

<span data-ttu-id="d2c50-152">アプリのビューは、アプリ ウィンドウのビュー プロバイダーによって生成され、ほとんどの場合、特定のフレームワーク パッケージまたはシステム自体によって実装されるため、手動で実装する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="d2c50-152">Your app's view is generated by the view provider for your app window, and in most cases will be implemented by a specific framework package or the system itself, so you don't need to implement it yourself.</span></span> <span data-ttu-id="d2c50-153">DirectX の場合は、既に説明したように手動でシン ビュー プロバイダーを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-153">For DirectX, you need to implement a thin view provider, as discussed previously.</span></span> <span data-ttu-id="d2c50-154">次のコンポーネントと動作の間には、明確な一対一の関係があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-154">There is a specific 1-to-1 relationship between the following components and behaviors:</span></span>

-   <span data-ttu-id="d2c50-155">アプリのビュー。[**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) 型で表され、ウィンドウを更新するためのメソッドを定義します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-155">An app's view, which is represented by the [**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) type, and which defines the method(s) for updating the window.</span></span>
-   <span data-ttu-id="d2c50-156">ASTA。その属性で、アプリのスレッド動作を定義します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-156">An ASTA, the attribution of which defines the threading behavior of the app.</span></span> <span data-ttu-id="d2c50-157">ASTA で COM STA 属性型のインスタンスを作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="d2c50-157">You cannot create instances of COM STA-attributed types on an ASTA.</span></span>
-   <span data-ttu-id="d2c50-158">ビュー プロバイダー。これはアプリがシステムから取得するか、手動で実装します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-158">A view provider, which your app obtains from the system or which you implement.</span></span>
-   <span data-ttu-id="d2c50-159">親ウィンドウ。[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) 型で表されます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-159">A parent window, which is represented by the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) type.</span></span>
-   <span data-ttu-id="d2c50-160">すべてのアクティブ化イベントのソースです。</span><span class="sxs-lookup"><span data-stu-id="d2c50-160">Sourcing for all activation events.</span></span> <span data-ttu-id="d2c50-161">ビューとウィンドウの両方に、独立したアクティブ化イベントがあります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-161">Both views and windows have separate activation events.</span></span>

<span data-ttu-id="d2c50-162">要するに、アプリ オブジェクトがビュー プロバイダー ファクトリを提供します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-162">In summary, the app object provides a view provider factory.</span></span> <span data-ttu-id="d2c50-163">このファクトリがビュー プロバイダーを作成し、アプリの親ウィンドウをインスタンス化します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-163">It creates a view provider and instantiates a parent window for the app.</span></span> <span data-ttu-id="d2c50-164">ビュー プロバイダーが、アプリの親ウィンドウに対してアプリのビューを定義します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-164">The view provider defines the app's view for the parent window of the app.</span></span> <span data-ttu-id="d2c50-165">次に、ビューと親ウィンドウについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-165">Now, let's discuss the specifics of the view and the parent window.</span></span>

## <a name="coreapplicationview-behaviors-and-properties"></a><span data-ttu-id="d2c50-166">CoreApplicationView の動作とプロパティ</span><span class="sxs-lookup"><span data-stu-id="d2c50-166">CoreApplicationView behaviors and properties</span></span>


<span data-ttu-id="d2c50-167">[**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) は、現在のアプリ ビューを表します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-167">[**CoreApplicationView**](https://msdn.microsoft.com/library/windows/apps/br225017) represents the current app view.</span></span> <span data-ttu-id="d2c50-168">アプリ ビューは、初期化時にアプリ シングルトンによって作成されますが、アクティブ化されるまでアクティブになりません。</span><span class="sxs-lookup"><span data-stu-id="d2c50-168">The app singleton creates the app view during initialization, but the view remains dormant until it is activated.</span></span> <span data-ttu-id="d2c50-169">ビューを表示する [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) を取得するには、そのビューの [**CoreApplicationView.CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) プロパティにアクセスします。また、ビューのアクティブ化イベントと非アクティブ化イベントを処理するには、[**CoreApplicationView.Activated**](https://msdn.microsoft.com/library/windows/apps/br225018) イベントにデリゲートを登録します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-169">You can get the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) that displays the view by accessing the [**CoreApplicationView.CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br225019) property on it, and you can handle activation and deactivation events for the view by registering delegates with the [**CoreApplicationView.Activated**](https://msdn.microsoft.com/library/windows/apps/br225018) event.</span></span>

## <a name="corewindow-behaviors-and-properties"></a><span data-ttu-id="d2c50-170">CoreWindow の動作とプロパティ</span><span class="sxs-lookup"><span data-stu-id="d2c50-170">CoreWindow behaviors and properties</span></span>


<span data-ttu-id="d2c50-171">アプリ オブジェクトが初期化されるときに、[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) インスタンスである親ウィンドウが作成され、ビュー プロバイダーに渡されます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-171">The parent window, which is a [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) instance, is created and passed to the view provider when the app object initializes.</span></span> <span data-ttu-id="d2c50-172">アプリに表示するウィンドウがある場合はそれが表示され、そうでない場合はビューの初期化のみが行われます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-172">If the app has a window to display, it displays it; otherwise, it simply initializes the view.</span></span>

<span data-ttu-id="d2c50-173">[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) では、入力および基本のウィンドウ動作専用のイベントを多数提供しています。</span><span class="sxs-lookup"><span data-stu-id="d2c50-173">[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) provides a number of events specific to input and basic window behaviors.</span></span> <span data-ttu-id="d2c50-174">これらのイベントを処理するには、イベントに自分専用のデリゲートを登録します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-174">You can handle these events by registering your own delegates with them.</span></span>

<span data-ttu-id="d2c50-175">ウィンドウに使うウィンドウ イベント ディスパッチャーを取得することもできます。そのためには、[**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) のインスタンスを提供する [**CoreWindow.Dispatcher**](https://msdn.microsoft.com/library/windows/apps/br208264) プロパティにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-175">You can also obtain the window event dispatcher for the window by accessing the [**CoreWindow.Dispatcher**](https://msdn.microsoft.com/library/windows/apps/br208264) property, which provides an instance of [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211).</span></span>

## <a name="coredispatcher-behaviors-and-properties"></a><span data-ttu-id="d2c50-176">CoreDispatcher の動作とプロパティ</span><span class="sxs-lookup"><span data-stu-id="d2c50-176">CoreDispatcher behaviors and properties</span></span>


<span data-ttu-id="d2c50-177">[**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) 型のウィンドウに使うイベント ディスパッチのスレッド動作を決定できます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-177">You can determine the threading behavior of event dispatching for a window with the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) type.</span></span> <span data-ttu-id="d2c50-178">この型には、ウィンドウ イベント処理を開始する特に重要なメソッド [**CoreDispatcher.ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-178">On this type, there's one particularly important method: the [**CoreDispatcher.ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) method, which starts window event processing.</span></span> <span data-ttu-id="d2c50-179">アプリで間違ったオプションを指定してこのメソッドを呼び出すと、さまざまな予期しないイベント処理動作が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-179">Calling this method with the wrong option for your app can lead to all sorts of unexpected event processing behaviors.</span></span>

| <span data-ttu-id="d2c50-180">CoreProcessEventsOption のオプション</span><span class="sxs-lookup"><span data-stu-id="d2c50-180">CoreProcessEventsOption option</span></span>                                                           | <span data-ttu-id="d2c50-181">説明</span><span class="sxs-lookup"><span data-stu-id="d2c50-181">Description</span></span>                                                                                                                                                                                                                                  |
|------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**<span data-ttu-id="d2c50-182">CoreProcessEventsOption.ProcessOneAndAllPending</span><span class="sxs-lookup"><span data-stu-id="d2c50-182">CoreProcessEventsOption.ProcessOneAndAllPending</span></span>**](https://msdn.microsoft.com/library/windows/apps/br208217) | <span data-ttu-id="d2c50-183">現在キューに入っているすべてのイベントをディスパッチします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-183">Dispatch all currently available events in the queue.</span></span> <span data-ttu-id="d2c50-184">保留中のイベントがない場合は、次の新しいイベントを待ちます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-184">If no events are pending, wait for the next new event.</span></span>                                                                                                                                 |
| [**<span data-ttu-id="d2c50-185">CoreProcessEventsOption.ProcessOneIfPresent</span><span class="sxs-lookup"><span data-stu-id="d2c50-185">CoreProcessEventsOption.ProcessOneIfPresent</span></span>**](https://msdn.microsoft.com/library/windows/apps/br208217)     | <span data-ttu-id="d2c50-186">キュー内で保留中のイベントを 1 つだけディスパッチします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-186">Dispatch one event if it is pending in the queue.</span></span> <span data-ttu-id="d2c50-187">保留中のイベントがない場合は、新しいイベントの発生を待たずに直ちに制御を返します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-187">If no events are pending, don't wait for a new event to be raised but instead return immediately.</span></span>                                                                                          |
| [**<span data-ttu-id="d2c50-188">CoreProcessEventsOption.ProcessUntilQuit</span><span class="sxs-lookup"><span data-stu-id="d2c50-188">CoreProcessEventsOption.ProcessUntilQuit</span></span>**](https://msdn.microsoft.com/library/windows/apps/br208217)        | <span data-ttu-id="d2c50-189">新しいイベントを待ち、発生したイベントをすべてディスパッチします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-189">Wait for new events and dispatch all available events.</span></span> <span data-ttu-id="d2c50-190">この動作を、ウィンドウが閉じられるか、アプリが [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) インスタンスで [**Close**](https://msdn.microsoft.com/library/windows/apps/br208260) メソッドを呼び出すまで継続します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-190">Continue this behavior until the window is closed or the application calls the [**Close**](https://msdn.microsoft.com/library/windows/apps/br208260) method on the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) instance.</span></span> |
| [**<span data-ttu-id="d2c50-191">CoreProcessEventsOption.ProcessAllIfPresent</span><span class="sxs-lookup"><span data-stu-id="d2c50-191">CoreProcessEventsOption.ProcessAllIfPresent</span></span>**](https://msdn.microsoft.com/library/windows/apps/br208217)     | <span data-ttu-id="d2c50-192">現在キューに入っているすべてのイベントをディスパッチします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-192">Dispatch all currently available events in the queue.</span></span> <span data-ttu-id="d2c50-193">保留中のイベントがない場合は、直ちに制御を返します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-193">If no events are pending, return immediately.</span></span>                                                                                                                                          |

 

<span data-ttu-id="d2c50-194">DirectX を使った UWP アプリでは、[**CoreProcessEventsOption.ProcessAllIfPresent**](https://msdn.microsoft.com/library/windows/apps/br208217) オプションを使って、グラフィックスの更新を中断する可能性があるブロック動作を防ぐ必要があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-194">UWP using DirectX should use the [**CoreProcessEventsOption.ProcessAllIfPresent**](https://msdn.microsoft.com/library/windows/apps/br208217) option to prevent blocking behaviors that might interrupt graphics updates.</span></span>

## <a name="asta-considerations-for-directx-devs"></a><span data-ttu-id="d2c50-195">DirectX 開発者向けの ASTA の考慮事項</span><span class="sxs-lookup"><span data-stu-id="d2c50-195">ASTA considerations for DirectX devs</span></span>


<span data-ttu-id="d2c50-196">DirectX を使った UWP アプリの実行時の形式を定義するアプリ オブジェクトは、アプリケーション シングルスレッド アパートメント (ASTA) というスレッド モデルを使ってアプリの UI ビューをホストします。</span><span class="sxs-lookup"><span data-stu-id="d2c50-196">The app object that defines the run-time representation of yourUWP and DirectX app uses a threading model called Application Single-Threaded Apartment (ASTA) to host your app’s UI views.</span></span> <span data-ttu-id="d2c50-197">DirectX を使った UWP アプリを開発している場合、そのアプリからディスパッチするすべてのスレッドは [**Windows::System::Threading**](https://msdn.microsoft.com/library/windows/apps/br229642) API または [**CoreWindow::CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) を使う必要があるので、ASTA のプロパティについては十分に理解していると考えられます </span><span class="sxs-lookup"><span data-stu-id="d2c50-197">If you are developing a UWP and DirectX app, you're familiar with the properties of an ASTA, because any thread you dispatch from your UWP and DirectX app must use the [**Windows::System::Threading**](https://msdn.microsoft.com/library/windows/apps/br229642) APIs, or use [**CoreWindow::CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211).</span></span> <span data-ttu-id="d2c50-198">(アプリから [**CoreWindow::GetForCurrentThread**](https://msdn.microsoft.com/library/windows/apps/hh701589) を呼び出すことで ASTA の [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) オブジェクトを取得できます)。</span><span class="sxs-lookup"><span data-stu-id="d2c50-198">(You can get the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) object for the ASTA by calling [**CoreWindow::GetForCurrentThread**](https://msdn.microsoft.com/library/windows/apps/hh701589) from your app.)</span></span>

<span data-ttu-id="d2c50-199">DirectX を使った UWP アプリの開発者として、気を付ける必要のある最も重要なことは、**Platform::MTAThread** を **main()** 上で設定して、アプリ スレッドが MTA スレッドをディスパッチできるようにする必要があるということです。</span><span class="sxs-lookup"><span data-stu-id="d2c50-199">The most important thing for you to be aware of, as a developer of a UWP DirectX app, is that you must enable your app thread to dispatch MTA threads by setting **Platform::MTAThread** on **main()**.</span></span>

```cpp
[Platform::MTAThread]
int main(Platform::Array<Platform::String^>^)
{
    auto myDXAppSource = ref new MyDXAppSource(); // your view provider factory 
    CoreApplication::Run(myDXAppSource);
    return 0;
}
```

<span data-ttu-id="d2c50-200">DirectX を使った UWP アプリのアプリ オブジェクトは、アクティブ化されると、UI ビューに使われる ASTA を作成します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-200">When the app object for your UWP DirectX app activates, it creates the ASTA that will be used for the UI view.</span></span> <span data-ttu-id="d2c50-201">新しい ASTA スレッドは、ビュー プロバイダー ファクトリを呼び出して、アプリ オブジェクトのビュー プロバイダーを作成します。その結果、ビュー プロバイダー コードがこの ASTA スレッド上で実行されます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-201">The new ASTA thread calls into your view provider factory, to create the view provider for your app object, and as a result, your view provider code will run on that ASTA thread.</span></span>

<span data-ttu-id="d2c50-202">また、ASTA から分離するスレッドは MTA にある必要があります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-202">Also, any thread that you spin off from the ASTA must be in an MTA.</span></span> <span data-ttu-id="d2c50-203">分離する MTA スレッドには、引き続き再入の問題が発生して、デッドロックとなる可能性があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="d2c50-203">Be aware that any MTA threads that you spin off can still create reentrancy issues and result in a deadlock.</span></span>

<span data-ttu-id="d2c50-204">ASTA スレッドで実行するために元のコードを移植している場合、これらの考慮事項に注意してください。</span><span class="sxs-lookup"><span data-stu-id="d2c50-204">If you're porting existing code to run on the ASTA thread, keep these considerations in mind:</span></span>

-   <span data-ttu-id="d2c50-205">[**CoWaitForMultipleObjects**](https://msdn.microsoft.com/library/windows/desktop/hh404144) などの待機プリミティブは、STA 内と ASTA 内とで動作が異なります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-205">Wait primitives, such as [**CoWaitForMultipleObjects**](https://msdn.microsoft.com/library/windows/desktop/hh404144), behave differently in an ASTA than in an STA.</span></span>
-   <span data-ttu-id="d2c50-206">COM 呼び出しモーダル ループの動作は ASTA では異なります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-206">The COM call modal loop operates differently in an ASTA.</span></span> <span data-ttu-id="d2c50-207">呼び出しの進行中は、無関係な呼び出しを受け取ることができなくなります。</span><span class="sxs-lookup"><span data-stu-id="d2c50-207">You can no longer receive unrelated calls while an outgoing call is in progress.</span></span> <span data-ttu-id="d2c50-208">たとえば、次の動作は ASTA からデッドロックを引き起こします (さらに、即座にアプリがクラッシュします)。</span><span class="sxs-lookup"><span data-stu-id="d2c50-208">For example, the following behavior will create a deadlock from an ASTA (and immediately crash the app):</span></span>
    1.  <span data-ttu-id="d2c50-209">ASTA が MTA オブジェクトを呼び出し、インターフェイス ポインター P1 を渡します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-209">The ASTA calls an MTA object and passes an interface pointer P1.</span></span>
    2.  <span data-ttu-id="d2c50-210">その後で、ASTA が同じ MTA オブジェクトを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-210">Later, the ASTA calls the same MTA object.</span></span> <span data-ttu-id="d2c50-211">MTA オブジェクトは、ASTA に制御を返す前に P1 を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-211">The MTA object calls P1 before it returns to the ASTA.</span></span>
    3.  <span data-ttu-id="d2c50-212">P1 は、無関係な呼び出しがブロックされているため、ASTA に入ることができません。</span><span class="sxs-lookup"><span data-stu-id="d2c50-212">P1 cannot enter the ASTA as it's blocked making an unrelated call.</span></span> <span data-ttu-id="d2c50-213">しかし、MTA スレッドは P1 の呼び出しを試みるのでブロックされます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-213">However, the MTA thread is blocked as it tries to make the call to P1.</span></span>

    <span data-ttu-id="d2c50-214">これは次の方法で解決できます。</span><span class="sxs-lookup"><span data-stu-id="d2c50-214">You can resolve this by :</span></span>
    -   <span data-ttu-id="d2c50-215">並列パターン ライブラリ (PPLTasks.h) で定義された **async** パターンを使います。</span><span class="sxs-lookup"><span data-stu-id="d2c50-215">Using the **async** pattern defined in the Parallel Patterns Library (PPLTasks.h)</span></span>
    -   <span data-ttu-id="d2c50-216">できるだけ早くアプリの ASTA (アプリのメイン スレッド) から [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) を呼び出して、任意の呼び出しを許可します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-216">Calling [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) from your app's ASTA (the main thread of your app) as soon as possible to allow arbitrary calls.</span></span>

    <span data-ttu-id="d2c50-217">しかし、アプリの ASTA への無関係な呼び出しの即時の配信に頼ることはできません。</span><span class="sxs-lookup"><span data-stu-id="d2c50-217">That said, you cannot rely on immediate delivery of unrelated calls to your app's ASTA.</span></span> <span data-ttu-id="d2c50-218">非同期呼び出しの詳細について、「[C++ での非同期プログラミング](https://msdn.microsoft.com/library/windows/apps/mt187334)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="d2c50-218">For more info about async calls, read [Asynchronous programming in C++](https://msdn.microsoft.com/library/windows/apps/mt187334).</span></span>

<span data-ttu-id="d2c50-219">全体的に見れば、UWP アプリをデザインする場合、自分で MTA スレッドを作って管理しようとするのではなく、アプリの [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) の [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) と [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) を使ってすべての UI スレッドを処理します。</span><span class="sxs-lookup"><span data-stu-id="d2c50-219">Overall, when designing your UWP app, use the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) for your app's [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) and [**CoreDispatcher::ProcessEvents**](https://msdn.microsoft.com/library/windows/apps/br208215) to handle all UI threads rather than trying to create and manage your MTA threads yourself.</span></span> <span data-ttu-id="d2c50-220">**CoreDispatcher** で処理できない個別のスレッドが必要な場合、非同期パターンを使い、再入の問題を回避するために前のガイドに従います。</span><span class="sxs-lookup"><span data-stu-id="d2c50-220">When you need a separate thread that you cannot handle with the **CoreDispatcher**, use async patterns and follow the guidance mentioned earlier to avoid reentrancy issues.</span></span>

 

 




