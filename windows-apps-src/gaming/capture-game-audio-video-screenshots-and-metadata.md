---
author: drewbatgit
ms.assetid: ''
description: UWP アプリでゲームのオーディオ、ビデオ、メタデータを記録する方法を示します。
title: ゲームのオーディオ、ビデオ、スクリーンショット、メタデータのキャプチャ
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, ゲーム, キャプチャ, オーディオ, ビデオ, メタデータ
ms.localizationpriority: medium
ms.openlocfilehash: 6c1641cb4c50b86d7f678bf18fa85ad0215b4b15
ms.sourcegitcommit: 144f5f127fc4fbd852f2f6780ef26054192d68fc
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2018
ms.locfileid: "5969683"
---
# <a name="capture-game-audio-video-screenshots-and-metadata"></a><span data-ttu-id="530a0-104">ゲームのオーディオ、ビデオ、スクリーンショット、メタデータのキャプチャ</span><span class="sxs-lookup"><span data-stu-id="530a0-104">Capture game audio, video, screenshots, and metadata</span></span>
<span data-ttu-id="530a0-105">この記事では、ゲームのビデオ、オーディオ、スクリーン ショットをキャプチャする方法や、キャプチャおよびブロードキャストされるメディアにシステムが埋め込むメタデータを送信して、アプリや他のユーザーがゲームプレイのイベントに同期する動的なエクスペリエンスを作成できるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="530a0-105">This article describes how to capture game video, audio, and screenshots, and how to submit metadata that the system will embed in captured and broadcast media, allowing your app and others to create dynamic experiences that are synchronized to gameplay events.</span></span> 

<span data-ttu-id="530a0-106">UWP アプリでゲームプレイをキャプチャするには、2 つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-106">There are two different ways that gameplay can be captured in a UWP app.</span></span> <span data-ttu-id="530a0-107">ユーザーは、組み込みのシステム UI を使用してキャプチャを開始できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-107">The user can initiate capture using the built-in system UI.</span></span> <span data-ttu-id="530a0-108">この手法を使用してキャプチャされたメディアは、Microsoft ゲーム エコシステムに取り込まれ、XBox アプリなど、ファースト パーティのエクスペリエンスを通して表示、共有されます。アプリやユーザーが、直接使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="530a0-108">Media that is captured using this technique is ingested into the Microsoft gaming ecosystem, can be viewed and shared through first-party experiences such as the XBox app, and is not directly availble to your app or to users.</span></span> <span data-ttu-id="530a0-109">この記事の最初のセクションでは、システムに実装されたアプリのキャプチャを有効または無効にする方法と、アプリのキャプチャが開始または停止されたときに通知を受信する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="530a0-109">The first sections of this article will show you how to enable and disable system-implemented app capture and how to receive notifications when app capture starts or stops.</span></span>

<span data-ttu-id="530a0-110">メディアをキャプチャするもう 1 つの方法は、**[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** 名前空間の API を使用する方法です。</span><span class="sxs-lookup"><span data-stu-id="530a0-110">The other way to capture media is to use the APIs of the **[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** namespace.</span></span> <span data-ttu-id="530a0-111">デバイスでキャプチャが有効になっている場合、アプリはゲームプレイのキャプチャを開始し、しばらく時間が経過した後、キャプチャを停止できます。その時点で、メディアはファイルに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="530a0-111">If capturing is enabled on the device, your app can start capturing gameplay and then, after some time has passed, you can stop the capture, at which point the media is written to a file.</span></span> <span data-ttu-id="530a0-112">ユーザーが履歴のキャプチャを有効にしている場合、過去の開始時刻と記録の継続時間を指定することによって、既に発生したゲームプレイも記録できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-112">If the user has enabled historical capture, then you can also record gameplay that has already occured by specifying a start time in the past and a duration to record.</span></span> <span data-ttu-id="530a0-113">これらのいずれの手法でも、アプリでアクセスできるビデオ ファイルが生成されます。また、ファイルを保存するために選択した場所によっては、ユーザーがアクセスできるビデオ ファイルが生成されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-113">Both of these techniques produce an video file that can be accessed by your app, and depending on where you choose to save the files, by the user.</span></span> <span data-ttu-id="530a0-114">この記事の中ほどのセクションでは、これらのシナリオを実装する手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="530a0-114">The middle sections of this article walk you through the implemenation of these scenarios.</span></span>

<span data-ttu-id="530a0-115">**[Windows.Media.Capture](https://docs.microsoft.com/uwp/api/windows.media.capture)** 名前空間は、キャプチャまたはブロードキャストされるゲームプレイを説明するメタデータを作成するための API を提供します。</span><span class="sxs-lookup"><span data-stu-id="530a0-115">The **[Windows.Media.Capture](https://docs.microsoft.com/uwp/api/windows.media.capture)** namespace provides APIs for creating metadata that describes the gameplay being captured or broadcast.</span></span> <span data-ttu-id="530a0-116">これには、テキストや数値を、各データ項目を識別するテキスト ラベルと共に含めることができます。</span><span class="sxs-lookup"><span data-stu-id="530a0-116">This can include text or numeric values, with a text label identifying each data item.</span></span> <span data-ttu-id="530a0-117">メタデータは、1 つの時点で発生する "イベント" (ユーザーがレーシング ゲームでコースを走り終えたときなど) を表すことができます。また、一定期間保持される "状態" (ユーザーがプレイしている現在のゲーム マップなど) を表すこともできます。</span><span class="sxs-lookup"><span data-stu-id="530a0-117">Metadata can represent an "event" which occurs at a single moment, such as when the user finishes a lap in a racing game, or it can represent a "state" that persists over a span of time, such as the current game map the user is playing in.</span></span> <span data-ttu-id="530a0-118">メタデータは、システムによってアプリ用に割り当てられて管理されるキャッシュに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="530a0-118">The metadata is written to a cache that is allocated and managed for your app by the system.</span></span> <span data-ttu-id="530a0-119">メタデータは、組み込みのシステム キャプチャとカスタム アプリによるキャプチャのいずれの手法でも、ブロードキャスト ストリームやキャプチャしたビデオ ファイルに埋め込まれます。</span><span class="sxs-lookup"><span data-stu-id="530a0-119">The metadata is embedded into broadcast streams and captured video files, including both the built-in system capture or custom app capture techniques.</span></span> <span data-ttu-id="530a0-120">この記事の最後のセクションでは、ゲームプレイのメタデータを書き込む方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="530a0-120">The final sections of this article show you how to write gameplay metadata.</span></span>

> [!NOTE] 
> <span data-ttu-id="530a0-121">ゲームプレイのメタデータは、潜在的に、ネットワーク上でユーザーの制御の範囲外で共有できるメディア ファイルに埋め込まれる可能性があるため、個人を特定できる情報やその他の潜在的な機密データをメタデータに含めないでください。</span><span class="sxs-lookup"><span data-stu-id="530a0-121">Because the gameplay metadata can be embedded in media files that can potentially be shared over the network, out of the user's control, you should not include personally identifiable information or other potentially sensitive data in the metadata.</span></span>


## <a name="enable-and-disable-system-app-capture"></a><span data-ttu-id="530a0-122">システムによるアプリのキャプチャを有効または無効にする</span><span class="sxs-lookup"><span data-stu-id="530a0-122">Enable and disable system app capture</span></span>
<span data-ttu-id="530a0-123">システムによるアプリのキャプチャは、ユーザーによって、組み込みのシステム UI を使用して開始されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-123">System app capture is initiated by the user with the built-in system UI.</span></span> <span data-ttu-id="530a0-124">ファイルは、Windows ゲーム エコシステムによって取り込まれ、アプリやユーザーが使用することはできません。ただし、Xbox アプリなどのファースト パーティ エクスペリエンスによる場合は例外です。</span><span class="sxs-lookup"><span data-stu-id="530a0-124">The files are ingested by the Windows gaming ecosystem and is not available to your app or the user, except for through first party experiences like the XBox app.</span></span> <span data-ttu-id="530a0-125">アプリでは、システムによって開始されるアプリのキャプチャを無効または有効にすることができ、ユーザーが特定のコンテンツやゲームプレイをキャプチャできないように設定できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-125">Your app can disable and enable system-initiated app capture, allowing you to prevent the user from capturing certain content or gameplay.</span></span> 

<span data-ttu-id="530a0-126">システムによるアプリのキャプチャを有効または無効にするには、静的メソッド **[AppCapture.SetAllowedAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.setallowedasync)** を呼び出して、キャプチャを無効にする場合は **false** を、キャプチャを有効にする場合は **true** を渡すだけです。</span><span class="sxs-lookup"><span data-stu-id="530a0-126">To enable or disable system app capture, simply call the static method **[AppCapture.SetAllowedAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.setallowedasync)** and passing **false** to disable capture or **true** to enable capture.</span></span>

[!code-cpp[SetAppCaptureAllowed](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetSetAppCaptureAllowed)]


## <a name="receive-notifications-when-system-app-capture-starts-and-stops"></a><span data-ttu-id="530a0-127">システムによるアプリのキャプチャが開始および停止したときに通知を受信する</span><span class="sxs-lookup"><span data-stu-id="530a0-127">Receive notifications when system app capture starts and stops</span></span>
<span data-ttu-id="530a0-128">システムによるアプリのキャプチャが開始または終了されたときに通知を受信するには、最初に、ファクトリ メソッド **[GetForCurrentView](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.GetForCurrentView)** を呼び出すことによって、**[AppCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture)** クラスのインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="530a0-128">To receive a notification when system app capture begins or ends, first get an instance of the **[AppCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture)** class by calling the factory method **[GetForCurrentView](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.GetForCurrentView)**.</span></span> <span data-ttu-id="530a0-129">次に、**[CapturingChanged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.CapturingChanged)** イベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="530a0-129">Next, register a handler for the **[CapturingChanged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.CapturingChanged)** event.</span></span>

[!code-cpp[RegisterCapturingChanged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRegisterCapturingChanged)]

<span data-ttu-id="530a0-130">**CapturingChanged** イベントのハンドラーで、**[IsCapturingAudio](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingAudio)** プロパティと **[IsCapturingVideo](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingVideo)** プロパティを調べて、それぞれオーディオまたはビデオがキャプチャされているかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-130">In the handler for the **CapturingChanged** event, you can check the **[IsCapturingAudio](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingAudio)** and the **[IsCapturingVideo](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapture.IsCapturingVideo)** properties to determine if audio or video are being captured respectively.</span></span> <span data-ttu-id="530a0-131">現在のキャプチャの状態を示すために、アプリの UI を更新することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-131">You may want to update your app's UI to indicate the current capturing status.</span></span>

[!code-cpp[OnCapturingChanged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetOnCapturingChanged)]

## <a name="add-the-windows-desktop-extensions-for-the-uwp-to-your-app"></a><span data-ttu-id="530a0-132">UWP 用の Windows デスクトップ拡張機能をアプリに追加する</span><span class="sxs-lookup"><span data-stu-id="530a0-132">Add the Windows Desktop Extensions for the UWP to your app</span></span>
<span data-ttu-id="530a0-133">アプリから直接、オーディオとビデオを記録するための API やスクリーンショットをキャプチャするための API は、**[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** 名前空間にあり、ユニバーサル API コントラクトには含まれていません。</span><span class="sxs-lookup"><span data-stu-id="530a0-133">The APIs for recording audio and video and for capturing screenshots directly from your app, found in the **[Windows.Media.AppRecording](https://docs.microsoft.com/uwp/api/windows.media.apprecording)** namespace, are not included in the Universal API contract.</span></span> <span data-ttu-id="530a0-134">この API にアクセスするには、次の手順に従って、UWP 用の Windows デスクトップ拡張機能への参照をアプリに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-134">To access the APIs, you must add a reference to the Windows Desktop Extensions for the UWP to your app with the following steps.</span></span>

1. <span data-ttu-id="530a0-135">Visual Studio の**ソリューション エクスプローラー**で、UWP プロジェクトを展開し、**[参照]** を右クリックして、**[参照の追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="530a0-135">In Visual Studio, in **Solution Explorer**, expand your UWP project and right-click **References** and then select **Add Reference...**.</span></span> 
2. <span data-ttu-id="530a0-136">**[ユニバーサル Windows]** ノードを展開し、**[拡張機能]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="530a0-136">Expand the **Universal Windows** node and select **Extensions**.</span></span>
3. <span data-ttu-id="530a0-137">拡張機能の一覧で、プロジェクトのターゲット ビルドに一致する **[Windows Desktop Extensions for the UWP]** エントリの横にあるチェック ボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="530a0-137">In the list of extensions check the checkbox next to the **Windows Desktop Extensions for the UWP** entry that matches the target build for your project.</span></span> <span data-ttu-id="530a0-138">アプリのブロードキャスト機能を使用するには、バージョンが 1709 以上である必要があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-138">For the app broadcast features, the version must be 1709 or greater.</span></span>
4. <span data-ttu-id="530a0-139">**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="530a0-139">Click **OK**.</span></span>

## <a name="get-an-instance-of-apprecordingmanager"></a><span data-ttu-id="530a0-140">AppRecordingManager のインスタンスを取得する</span><span class="sxs-lookup"><span data-stu-id="530a0-140">Get an instance of AppRecordingManager</span></span>
<span data-ttu-id="530a0-141">**[AppRecordingManager](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager)** クラスは、アプリの記録を管理するために使用する中心的な API です。</span><span class="sxs-lookup"><span data-stu-id="530a0-141">The **[AppRecordingManager](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager)** class is the central API you will use to manage app recording.</span></span> <span data-ttu-id="530a0-142">ファクトリ メソッド **[GetDefault](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetDefault)** を呼び出すことによって、このクラスのインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="530a0-142">Get an instance of this class by calling the factory method **[GetDefault](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetDefault)**.</span></span> <span data-ttu-id="530a0-143">**Windows.Media.AppRecording**名前空間の API のいずれかを使用する前に、現在のデバイスでこれらが存在することを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-143">Before using any of the APIs in the **Windows.Media.AppRecording** namespace, you should check for their presence on the current device.</span></span> <span data-ttu-id="530a0-144">この API は、Windows 10 バージョン 1709 より前のバージョンの OS を実行しているデバイスでは利用できません。</span><span class="sxs-lookup"><span data-stu-id="530a0-144">The APIs are not available on devices running an OS version earlier than Windows 10, version 1709.</span></span> <span data-ttu-id="530a0-145">特定の OS バージョンを確認するのではなく、**[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)** メソッドで、*Windows.Media.AppBroadcasting.AppRecordingContract* バージョン 1.0 を照会します。</span><span class="sxs-lookup"><span data-stu-id="530a0-145">Rather than check for a specific OS version, use the **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)** method to query for the *Windows.Media.AppBroadcasting.AppRecordingContract* version 1.0.</span></span> <span data-ttu-id="530a0-146">このコントラクトが存在する場合は、デバイスで記録 API を利用できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-146">If this contract is present, then the recording APIs are available on the device.</span></span> <span data-ttu-id="530a0-147">この記事のコード例では、API を 1 回確認し、それ以降の操作の前に、**AppRecordingManager** が null であるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="530a0-147">The example code in this article checks for the APIs once and then checks if the **AppRecordingManager** is null before subsequent operations.</span></span>

[!code-cpp[GetAppRecordingManager](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetGetAppRecordingManager)]

## <a name="determine-if-your-app-can-currently-record"></a><span data-ttu-id="530a0-148">アプリが現在記録できるかどうかを確認する</span><span class="sxs-lookup"><span data-stu-id="530a0-148">Determine if your app can currently record</span></span>
<span data-ttu-id="530a0-149">現在、アプリでオーディオやビデオをキャプチャできない場合は、いくつかの原因があります。たとえば、現在のデバイスが記録のハードウェア要件を満たしていない場合や、別のアプリが現在ブロードキャストしている場合です。</span><span class="sxs-lookup"><span data-stu-id="530a0-149">There are several reasons that your app may not currently be able to capture audio or video, including if the current device doesn't meet the hardware requirements for recording or if another app is currently broadcasting.</span></span> <span data-ttu-id="530a0-150">記録を開始する前に、アプリが現在記録できるかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-150">Before initiating a recording, you can check to see if your app is currently able to record.</span></span> <span data-ttu-id="530a0-151">**AppRecordingManager** オブジェクトの **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** メソッドを呼び出して、返された **[AppRecordingStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus)** オブジェクトの **[CanRecord](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecord)** プロパティを確認します。</span><span class="sxs-lookup"><span data-stu-id="530a0-151">Call the **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** method of the **AppRecordingManager** object and then check the **[CanRecord](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecord)** property of the returned **[AppRecordingStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus)** object.</span></span> <span data-ttu-id="530a0-152">**CanRecord** が **false** を返し、アプリが現在記録できないことを意味している場合、**[Details](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.Details)** プロパティを確認して、理由を特定できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-152">If **CanRecord** returns **false**, meaning that your app can't currenty record, you can check the **[Details](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.Details)** property to determine the reason.</span></span> <span data-ttu-id="530a0-153">理由に応じて、ユーザーに対してステータスを表示したり、アプリの記録を有効にするための手順を示したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="530a0-153">Depending on the reason, you may want to display the status to the user or show instructions for enabling app recording.</span></span>



[!code-cpp[CanRecord](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCanRecord)]

## <a name="manually-start-and-stop-recording-your-app-to-a-file"></a><span data-ttu-id="530a0-154">ファイルへのアプリの記録を手動で開始および停止する</span><span class="sxs-lookup"><span data-stu-id="530a0-154">Manually start and stop recording your app to a file</span></span>

<span data-ttu-id="530a0-155">アプリが記録できることを確認した後、**AppRecordingManager** オブジェクトの **[StartRecordingToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.startrecordingtofileasync)** メソッドを呼び出すことによって、新しい記録を開始することができます。</span><span class="sxs-lookup"><span data-stu-id="530a0-155">After verifying that your app is able to record, you can start a new recording by calling the **[StartRecordingToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.startrecordingtofileasync)** method of the **AppRecordingManager** object.</span></span>

<span data-ttu-id="530a0-156">次の例で、最初の **then** ブロックは、非同期タスクが失敗したときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-156">In the following example, the first **then** block executes when the asynchronous task fails.</span></span> <span data-ttu-id="530a0-157">2 番目の **then** ブロックは、タスクの結果へのアクセスを試行します。結果が null の場合、タスクは完了しています。</span><span class="sxs-lookup"><span data-stu-id="530a0-157">The second **then** block attempts to access the result of the task and, if the result is null, then the task has completed.</span></span> <span data-ttu-id="530a0-158">いずれの場合も、次に示す **OnRecordingComplete** ヘルパー メソッドが呼び出されて、結果が処理されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-158">In both cases, the **OnRecordingComplete** helper method, shown below, is called to handle the result.</span></span> 

[!code-cpp[StartRecordToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetStartRecordToFile)]

<span data-ttu-id="530a0-159">記録操作が完了したら、返された **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)** オブジェクトの **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** プロパティを確認して、記録操作が成功したかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="530a0-159">When the recording operation completes, check the **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** property of the returned **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)** object to determine if the record operation was successful.</span></span> <span data-ttu-id="530a0-160">成功している場合、**[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** プロパティを確認して、記憶域上の理由から、システムがキャプチャされたファイルを強制的に切り詰めたかどうかを判断できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-160">If so, you can check the **[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** property to determine if, for storage reasons, the system was forced to truncate the captured file.</span></span> <span data-ttu-id="530a0-161">**[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** プロパティを確認して、記録されたファイルの実際の継続時間を検出できます。ファイルが切り詰められている場合、実際の継続時間は記録操作の継続時間よりも短い場合があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-161">You can check the **[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** property to discover the actual duration of the recorded file which, if the file is truncated, may be shorter than the duration of the recording operation.</span></span>

[!code-cpp[OnRecordingComplete](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetOnRecordingComplete)]

<span data-ttu-id="530a0-162">次の例では、前の例で示した記録操作を開始および停止するためのいくつかの基本的なコードを示します。</span><span class="sxs-lookup"><span data-stu-id="530a0-162">The following examples show some basic code for starting and stopping the recording operation shown in the previous example.</span></span>

[!code-cpp[CallStartRecordToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCallStartRecordToFile)]

[!code-cpp[FinishRecordToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetFinishRecordToFile)]

## <a name="record-a-historical-time-span-to-a-file"></a><span data-ttu-id="530a0-163">履歴の期間をファイルに記録する</span><span class="sxs-lookup"><span data-stu-id="530a0-163">Record a historical time span to a file</span></span>
<span data-ttu-id="530a0-164">ユーザーが、システムの設定でアプリの履歴の記録を有効にしている場合、既に経過したゲームプレイの期間を記録できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-164">If the user has enabled historical recording for your app in the system settings, you can record a time span of gameplay that has previously transpired.</span></span> <span data-ttu-id="530a0-165">この記事の前の例では、アプリが現在ゲームプレイを記録できることを確認する方法を示しました。</span><span class="sxs-lookup"><span data-stu-id="530a0-165">A previous example in this article showed how to confirm that your app can currently record gameplay.</span></span> <span data-ttu-id="530a0-166">履歴のキャプチャが有効になっているかどうかを判断するには、追加の確認を行います。</span><span class="sxs-lookup"><span data-stu-id="530a0-166">There is an additional check to determine if historical capture is enabled.</span></span> <span data-ttu-id="530a0-167">もう一度 **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** を呼び出して、返された **AppRecordingStatus** オブジェクトの **[CanRecordTimeSpan](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecordTimeSpan)** プロパティを確認します。</span><span class="sxs-lookup"><span data-stu-id="530a0-167">Once again, call **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.GetStatus)** and check the **[CanRecordTimeSpan](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.CanRecordTimeSpan)** property of the returned **AppRecordingStatus** object.</span></span> <span data-ttu-id="530a0-168">この例では、**AppRecordingStatus** の **[HistoricalBufferDuration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.HistoricalBufferDuration)** プロパティも返されます。このプロパティは、記録操作の有効な開始時刻を確認するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-168">This example also returns the **[HistoricalBufferDuration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingstatus.HistoricalBufferDuration)** property of the **AppRecordingStatus** which will be used to determine a valid start time for the recording operation.</span></span>

[!code-cpp[CanRecordTimeSpan](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCanRecordTimeSpan)]

<span data-ttu-id="530a0-169">履歴の期間をキャプチャするには、記録の開始時刻と継続時間を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-169">To capture a historical timespan, you must specify a start time for the recording and a duration.</span></span> <span data-ttu-id="530a0-170">開始時刻は、**[DateTime](https://docs.microsoft.com/uwp/api/windows.foundation.datetime)** 構造体として提供されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-170">The start time is provided as a **[DateTime](https://docs.microsoft.com/uwp/api/windows.foundation.datetime)** struct.</span></span> <span data-ttu-id="530a0-171">開始時刻は、記録バッファーの長さの範囲内で、現在の時刻よりも前の時刻である必要があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-171">The start time must be a time before the current time, within the length of the historical recording buffer.</span></span> <span data-ttu-id="530a0-172">この例では、バッファーの長さは、前のコード例に示されている、履歴の記録が有効になっているかどうかの確認の一環として取得されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-172">For this example, the buffer length is retrieved as part of the check to see if historical recording is enabled, which is shown in the previous code example.</span></span> <span data-ttu-id="530a0-173">履歴の記録の継続時間は、**[TimeSpan](https://docs.microsoft.com/uwp/api/windows.foundation.timespan)** 構造体として提供されます。これも、履歴のバッファーの継続時間以下である必要があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-173">The duration of the historical recording is provided as  **[TimeSpan](https://docs.microsoft.com/uwp/api/windows.foundation.timespan)** struct, which should also be equal to or smaller than the duration of the historical buffer.</span></span> <span data-ttu-id="530a0-174">目的の開始時刻と継続時間を確認したら、**[RecordTimeSpanToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.recordtimespantofileasync)** を呼び出して、記録操作を開始します。</span><span class="sxs-lookup"><span data-stu-id="530a0-174">Once you have determined your desired start time and duration, call **[RecordTimeSpanToFileAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.recordtimespantofileasync)** to start the recording operation.</span></span>

<span data-ttu-id="530a0-175">手動で記録を開始および停止する場合と同様に、履歴の記録が完了したときに、返された **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)** オブジェクトの **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** プロパティを確認して、記録操作が成功したかどうかを判断できます。また、**[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** プロパティと **[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** プロパティを確認して、記録されたファイルの実際の継続時間を検出できます。ファイルが切り詰められている場合、実際の継続時間は要求された継続時間よりも短い場合があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-175">Like recording with manual start and stop, when a historical recording completes, you can check the **[Succeeded](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Succeeded)** property of the returned **[AppRecordingResult](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult)** object to determine if the record operation was successful, and you can check the **[IsFileTruncated](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.IsFileTruncated)** and **[Duration](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingresult.Duration)** property to discover the actual duration of the recorded file which, if the file is truncated, may be shorter than the duration of the requested time window.</span></span>

[!code-cpp[RecordTimeSpanToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRecordTimeSpanToFile)]

<span data-ttu-id="530a0-176">次の例では、前の例で示した履歴の記録操作を開始するためのいくつかの基本的なコードを示します。</span><span class="sxs-lookup"><span data-stu-id="530a0-176">The following example shows some basic code for initiating the historical record operation shown in the previous example.</span></span>

[!code-cpp[CallRecordTimeSpanToFile](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCallRecordTimeSpanToFile)]

## <a name="save-screenshot-images-to-files"></a><span data-ttu-id="530a0-177">スクリーンショットの画像をファイルに保存する</span><span class="sxs-lookup"><span data-stu-id="530a0-177">Save screenshot images to files</span></span>
<span data-ttu-id="530a0-178">アプリでスクリーンショットのキャプチャを開始できます。アプリのウィンドウの現在の内容を、1 つの画像ファイルに保存することも、異なる画像エンコードで複数の画像ファイルに保存することもできます。</span><span class="sxs-lookup"><span data-stu-id="530a0-178">Your app can initiate a screenshot capture that will save the current contents of the app's window to one image file or to multiple image files with different image encodings.</span></span> <span data-ttu-id="530a0-179">使用する画像エンコードを指定するには、それぞれが画像の種類を表す文字列の一覧を作成します。</span><span class="sxs-lookup"><span data-stu-id="530a0-179">To specify the image encodings you would like to use, create a list of strings where each represents an image type.</span></span> <span data-ttu-id="530a0-180">**[ImageEncodingSubtypes](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingsubtypes)** のプロパティは、サポートされている画像の種類ごとに、適切な文字列 (**MediaEncodingSubtypes.Png**、**MediaEncodingSubtypes.JpegXr** など) を提供します。</span><span class="sxs-lookup"><span data-stu-id="530a0-180">The properties of the **[ImageEncodingSubtypes](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingsubtypes)** provide the correct string for each supported image type, such as **MediaEncodingSubtypes.Png** or **MediaEncodingSubtypes.JpegXr**.</span></span>

<span data-ttu-id="530a0-181">画面キャプチャを開始するには、**AppRecordingManager** オブジェクトの **[SaveScreenshotToFilesAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.savescreenshottofilesasync)** メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="530a0-181">Initiate screen capture by calling the **[SaveScreenshotToFilesAsync](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingmanager.savescreenshottofilesasync)** method of the **AppRecordingManager** object.</span></span> <span data-ttu-id="530a0-182">このメソッドの最初のパラメーターは、画像ファイルの保存場所を示す **StorageFolder** です。</span><span class="sxs-lookup"><span data-stu-id="530a0-182">The first parameter to this method is a **StorageFolder** where the image files will be saved.</span></span> <span data-ttu-id="530a0-183">2 番目のパラメーターは、システムが、保存される各画像の種類の拡張子 (".png" など) を追加する、ファイル名のプレフィックスです。</span><span class="sxs-lookup"><span data-stu-id="530a0-183">The second parameter is a filename prefix to which the system will append the extension for each image type saved, such as ".png".</span></span>

<span data-ttu-id="530a0-184">**SaveScreenshotToFilesAsync** の 3 番目のパラメーターは、キャプチャされる現在のウィンドウが HDR コンテンツを表示している場合に、システムが適切な色空間変換を実行できるようにするために必要です。</span><span class="sxs-lookup"><span data-stu-id="530a0-184">The third parameter to **SaveScreenshotToFilesAsync** is necessary for the system to be able to do the proper colorspace conversion if the current window to be captured is displaying HDR content.</span></span> <span data-ttu-id="530a0-185">HDR コンテンツが存在する場合は、このパラメーターを **AppRecordingSaveScreenshotOption.HdrContentVisible** に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-185">If HDR content is present, this parameter should be set to **AppRecordingSaveScreenshotOption.HdrContentVisible**.</span></span> <span data-ttu-id="530a0-186">それ以外の場合は、**AppRecordingSaveScreenshotOption.None** を使用します。</span><span class="sxs-lookup"><span data-stu-id="530a0-186">Otherwise, use **AppRecordingSaveScreenshotOption.None**.</span></span> <span data-ttu-id="530a0-187">このメソッドの最後のパラメーターは、画面をキャプチャするか画像形式の一覧です。</span><span class="sxs-lookup"><span data-stu-id="530a0-187">The final parameter to the method is the list of image formats to which the screen should be captured.</span></span>

<span data-ttu-id="530a0-188">**SaveScreenshotToFilesAsync** の非同期呼び出しが完了すると、**[AppRecordingSavedScreenshotInfo](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingsavedscreenshotinfo)** オブジェクトが返されます。このオブジェクトは、**StorageFile** と、保存された各画像の種類を示す **MediaEncodingSubtypes** 値を提供します。</span><span class="sxs-lookup"><span data-stu-id="530a0-188">When the asynchronous call to **SaveScreenshotToFilesAsync** completes, it returns a **[AppRecordingSavedScreenshotInfo](https://docs.microsoft.com/uwp/api/windows.media.apprecording.apprecordingsavedscreenshotinfo)** object that provides the **StorageFile** and associated **MediaEncodingSubtypes** value indicating the image type for each saved image.</span></span>

[!code-cpp[SaveScreenShotToFiles](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetSaveScreenShotToFiles)]

<span data-ttu-id="530a0-189">次の例では、前の例で示したスクリーンショットの操作を開始するためのいくつかの基本的なコードを示します。</span><span class="sxs-lookup"><span data-stu-id="530a0-189">The following example shows some basic code for initiating the screenshot operation shown in the previous example.</span></span>

[!code-cpp[CallSaveScreenShotToFiles](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCallSaveScreenShotToFiles)]

## <a name="add-game-metadata-for-system-and-app-initiated-capture"></a><span data-ttu-id="530a0-190">システムやアプリによるキャプチャのゲーム メタデータを追加する</span><span class="sxs-lookup"><span data-stu-id="530a0-190">Add game metadata for system and app-initiated capture</span></span>
<span data-ttu-id="530a0-191">この記事の以下のセクションでは、キャプチャまたはブロードキャストされるゲームプレイの MP4 ストリームにシステムが埋め込むメタデータを提供する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="530a0-191">The following sections of this article describe how to provide metadata that the system will embed into the MP4 stream of captured or broadcast gameplay.</span></span> <span data-ttu-id="530a0-192">メタデータは、組み込みのシステム UI を使用してキャプチャされたメディアや、**AppRecordingManager** を使用してアプリでキャプチャされたメディアに埋め込むことができます。</span><span class="sxs-lookup"><span data-stu-id="530a0-192">Metadata can be embedded in media that is captured using the built-in system UI and media that is captured by the app with **AppRecordingManager**.</span></span> <span data-ttu-id="530a0-193">このメタデータを、メディアの再生中にアプリや他のアプリで抽出して、キャプチャまたはブロードキャストされたゲームプレイと同期する、コンテキストに対応したエクスペリエンスを提供することができます。</span><span class="sxs-lookup"><span data-stu-id="530a0-193">This metadata can be extracted by your app and other apps during media playback in order to provide contextually-aware experiences that are synchronized with the captured or broadcast gameplay.</span></span>

### <a name="get-an-instance-of-appcapturemetadatawriter"></a><span data-ttu-id="530a0-194">AppCaptureMetadataWriter のインスタンスを取得する</span><span class="sxs-lookup"><span data-stu-id="530a0-194">Get an instance of AppCaptureMetadataWriter</span></span>
<span data-ttu-id="530a0-195">アプリのキャプチャ メタデータを管理するためのプライマリ クラスは、**[AppCaptureMetadataWriter](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter)** です。</span><span class="sxs-lookup"><span data-stu-id="530a0-195">The primary class for managing app capture metadata is **[AppCaptureMetadataWriter](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter)**.</span></span> <span data-ttu-id="530a0-196">このクラスのインスタンスを初期化する前に、**[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)** メソッドを使用して、*Windows.Media.Capture.AppCaptureMetadataContract* バージョン 1.0 を照会し、この API が現在のデバイスで利用できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="530a0-196">Before initializing an instance of this class, use the **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation.isapicontractpresent)** method to query for the *Windows.Media.Capture.AppCaptureMetadataContract* version 1.0 to verify that the API is available on the current device.</span></span>

[!code-cpp[GetMetadataWriter](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetGetMetadataWriter)]

### <a name="write-metadata-to-the-system-cache-for-your-app"></a><span data-ttu-id="530a0-197">アプリのシステム キャッシュにメタデータを書き込む</span><span class="sxs-lookup"><span data-stu-id="530a0-197">Write metadata to the system cache for your app</span></span>
<span data-ttu-id="530a0-198">各メタデータ項目には 1 つのラベルがあり、メタデータ項目、関連するデータ値 (文字列、整数、または double 型の値)、データ項目の相対的な優先順位を示す **[AppCaptureMetadataPriority](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** 列挙の値が識別されます。</span><span class="sxs-lookup"><span data-stu-id="530a0-198">Each metadata item has a string label, identifying the metadata item, an associated data value which can be a string, an integer, or a double value, and a value from the **[AppCaptureMetadataPriority](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** enumeration indicating the relative priority of the data item.</span></span> <span data-ttu-id="530a0-199">メタデータ項目は、ある時点で発生する "イベント" またはある時間枠で値を維持する "状態" と見なすことができます。</span><span class="sxs-lookup"><span data-stu-id="530a0-199">A metadata item can either be considered an "event", which occurs at a single point in time, or a "state" which maintains a value over a time window.</span></span> <span data-ttu-id="530a0-200">メタデータは、システムによってアプリ用に割り当てられて管理されるメモリ キャッシュに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="530a0-200">Metadata is written to a memory cache that is allocated and managed for your app by the system.</span></span> <span data-ttu-id="530a0-201">システムは、メタデータのメモリ キャッシュにサイズ制限を適用し、制限に達すると、各メタデータに書き込まれている優先順位に基づいてデータを削除します。</span><span class="sxs-lookup"><span data-stu-id="530a0-201">The system enforces a size limit on the metadata memory cache and, when the limit is reached, will purge data based on the priority with which each metadata item was written.</span></span> <span data-ttu-id="530a0-202">この記事の次のセクションでは、アプリのメタデータのメモリ割り当てを管理する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="530a0-202">The next section of this article shows how to manage your app's metadata memory allocation.</span></span>

<span data-ttu-id="530a0-203">一般的なアプリでは、キャプチャ セッションの最初に特定のメタデータを書き込んで、以降のデータのコンテキストを提供することを選択できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-203">A typical app may choose to write some metadata at the beginning of the capture session to provide some context for the subsequent data.</span></span> <span data-ttu-id="530a0-204">このシナリオでは、瞬間的な "イベント" データを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="530a0-204">For this scenario it is recommended that you use instantaneous "event" data.</span></span> <span data-ttu-id="530a0-205">この例では、**[AddStringEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addstringevent)**、**[AddDoubleEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.adddoubleevent)**、および**[AddInt32Event](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addint32event)** を呼び出して、各データ型の瞬間的な値を設定します。</span><span class="sxs-lookup"><span data-stu-id="530a0-205">This example calls **[AddStringEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addstringevent)**, **[AddDoubleEvent](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.adddoubleevent)**, and **[AddInt32Event](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.addint32event)** to set instantaneous values for each data type.</span></span>

[!code-cpp[StartSession](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetStartSession)]

<span data-ttu-id="530a0-206">一定時間継続する "状態" データを使用する一般的なシナリオとして、プレイヤーが現在プレイしているゲーム マップの追跡があります。</span><span class="sxs-lookup"><span data-stu-id="530a0-206">A common scenario for using "state" data that persists over time is to track the game map that the player is currently within.</span></span> <span data-ttu-id="530a0-207">この例では、**[StartStringState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.startstringstate)** を呼び出して状態の値を設定します。</span><span class="sxs-lookup"><span data-stu-id="530a0-207">This example calls **[StartStringState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.startstringstate)** to set the state value.</span></span> 

[!code-cpp[StartMap](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetStartMap)]

<span data-ttu-id="530a0-208">特定の状態が終了したことを記録するには、**[StopState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.stopstate)** を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="530a0-208">Call **[StopState](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.stopstate)** to record that a particular state has ended.</span></span>

[!code-cpp[EndMap](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetEndMap)]

<span data-ttu-id="530a0-209">状態は、既存の状態ラベルを持つ新しい値を設定して上書きできます。</span><span class="sxs-lookup"><span data-stu-id="530a0-209">You can overwrite a state by setting a new value with an existing state label.</span></span>

[!code-cpp[LevelUp](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetLevelUp)]

<span data-ttu-id="530a0-210">**[StopAllStates](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.StopAllStates)** を呼び出すことによって、現在開いているすべての状態を終了できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-210">You can end all currently open states by calling **[StopAllStates](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.StopAllStates)**.</span></span>

[!code-cpp[RaceComplete](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRaceComplete)]

### <a name="manage-metadata-cache-storage-limit"></a><span data-ttu-id="530a0-211">メタデータ キャッシュの記憶域の制限を管理する</span><span class="sxs-lookup"><span data-stu-id="530a0-211">Manage metadata cache storage limit</span></span>
<span data-ttu-id="530a0-212">**AppCaptureMetadataWriter** を使用して書き込むメタデータは、関連付けられているメディア ストリームに書き込まれるまで、システムによってキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="530a0-212">The metadata that you write with **AppCaptureMetadataWriter** is cached by the system until it is written to the associated media stream.</span></span> <span data-ttu-id="530a0-213">システムでは、各アプリのメタデータ キャッシュのサイズ制限を定義しています。</span><span class="sxs-lookup"><span data-stu-id="530a0-213">The system defines a size limit for each app's metadata cache.</span></span> <span data-ttu-id="530a0-214">キャッシュのサイズ制限に達すると、システムはキャッシュされたメタデータの削除を開始します。</span><span class="sxs-lookup"><span data-stu-id="530a0-214">Once the cache size limit has been reached, the system will begin purging cached metadata.</span></span> <span data-ttu-id="530a0-215">システムは、**[AppCaptureMetadataPriority.Important](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** の優先順位が設定されているメタデータを削除する前に、**[AppCaptureMetadataPriority.Informational](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** の優先順位の値を指定して書き込まれたメタデータを削除します。</span><span class="sxs-lookup"><span data-stu-id="530a0-215">The system will delete metadata that was written with **[AppCaptureMetadataPriority.Informational](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** proiority value before deleting metadata with the **[AppCaptureMetadataPriority.Important](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatapriority)** priority.</span></span>

<span data-ttu-id="530a0-216">いつでも、**[RemainingStorageBytesAvailable](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.RemainingStorageBytesAvailable)** を呼び出すことによって、アプリのメタデータ キャッシュで利用可能なバイト数を確認できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-216">At any point, you can check to see the number of bytes available in your app's metadata cache by calling **[RemainingStorageBytesAvailable](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.RemainingStorageBytesAvailable)**.</span></span> <span data-ttu-id="530a0-217">独自のアプリで定義されたしきい値を設定することを選択し、その後でキャッシュに書き込むメタデータの量を減らすことを選択できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-217">You can choose to set your own app-defined threshold after which you can choose to reduce the amount of metadata that you write to the cache.</span></span> <span data-ttu-id="530a0-218">次の例は、このパターンの簡単な実装を示しています。</span><span class="sxs-lookup"><span data-stu-id="530a0-218">The following example shows a simple implementation of this pattern.</span></span>

[!code-cpp[CheckMetadataStorage](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetCheckMetadataStorage)]

[!code-cpp[ComboExecuted](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetComboExecuted)]

### <a name="receive-notifications-when-the-system-purges-metadata"></a><span data-ttu-id="530a0-219">システムがメタデータを削除するときに通知を受け取る</span><span class="sxs-lookup"><span data-stu-id="530a0-219">Receive notifications when the system purges metadata</span></span>
<span data-ttu-id="530a0-220">**[MetadataPurged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.MetadataPurged)** イベントのハンドラーを登録することで、システムがアプリのメタデータの削除を開始するときに、通知を受け取るように登録できます。</span><span class="sxs-lookup"><span data-stu-id="530a0-220">You can register to recieve a notification when the system begins purging metadata for your app by registering a handler for the **[MetadataPurged](https://docs.microsoft.com/uwp/api/windows.media.capture.appcapturemetadatawriter.MetadataPurged)** event.</span></span>

[!code-cpp[RegisterMetadataPurged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetRegisterMetadataPurged)]

<span data-ttu-id="530a0-221">**MetadataPurged** イベントのハンドラーで、優先順位の低い状態を終了してメタデータ キャッシュの空き容量を増やすことも、キャッシュに書き込むメタデータの量を削減するためにアプリで定義されたロジックを実装することも、何もせずに書き込み時の優先順位に基づいてシステムによるキャッシュの削除を継続することもできます。</span><span class="sxs-lookup"><span data-stu-id="530a0-221">In the handler for the **MetadataPurged** event, you can clear up some room in the metadata cache by ending lower-priority states, you can implement app-defined logic for reducing the amount of metadata you write to the cache, or you can do nothing and let the system continue to purge the cache based on the priority with which it was written.</span></span>

[!code-cpp[OnMetadataPurged](./code/AppRecordingExample/cpp/AppRecordingExample/App.cpp#SnippetOnMetadataPurged)]

## <a name="related-topics"></a><span data-ttu-id="530a0-222">関連トピック</span><span class="sxs-lookup"><span data-stu-id="530a0-222">Related topics</span></span>

* [<span data-ttu-id="530a0-223">ゲーム</span><span class="sxs-lookup"><span data-stu-id="530a0-223">Gaming</span></span>](index.md)
 

 




