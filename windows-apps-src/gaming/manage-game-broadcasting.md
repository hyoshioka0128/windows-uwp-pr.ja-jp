---
author: drewbatgit
ms.assetid: 
description: "UWP アプリのゲームのブロードキャストを管理する方法を示します。"
title: "ゲームのブロードキャストを管理する"
ms.author: drewbat
ms.date: 09/27/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: "Windows 10, ゲーム, ブロードキャスト"
ms.localizationpriority: medium
ms.openlocfilehash: 613dd69c00257ac5d750bc67b174d7ff010e0b59
ms.sourcegitcommit: f9a4854b6aecfda472fb3f8b4a2d3b271b327800
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
# <a name="manage-game-broadcasting"></a><span data-ttu-id="5e25a-104">ゲームのブロードキャストを管理する</span><span class="sxs-lookup"><span data-stu-id="5e25a-104">Manage game broadcasting</span></span>
<span data-ttu-id="5e25a-105">この記事では、UWP アプリのゲームのブロードキャストを管理する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-105">This article shows you how to manage game broadcasting for a UWP app.</span></span> <span data-ttu-id="5e25a-106">ユーザーは、Windows に組み込まれているシステム UI を使用してゲームのブロードキャストを開始する必要がありますが、Windows 10 バージョン 1709 以降、アプリでシステムのブロードキャスト UI を起動でき、ブロードキャストが開始および停止されたときには通知を受信できます。</span><span class="sxs-lookup"><span data-stu-id="5e25a-106">Users must initiate broadcasting by using the system UI that is built into Windows, but starting with Windows 10, version 1709, apps can launch the system broadcasting UI and can receive notifications when broadcasting starts and stops.</span></span>

## <a name="add-the-windows-desktop-extensions-for-the-uwp-to-your-app"></a><span data-ttu-id="5e25a-107">UWP 用の Windows デスクトップ拡張機能をアプリに追加する</span><span class="sxs-lookup"><span data-stu-id="5e25a-107">Add the Windows Desktop Extensions for the UWP to your app</span></span>
<span data-ttu-id="5e25a-108">アプリのブロードキャストを管理するための API は、**[Windows.Media.AppBroadcasting](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting)** 名前空間にあり、ユニバーサル API コントラクトに含まれていません。</span><span class="sxs-lookup"><span data-stu-id="5e25a-108">The APIs for managing app broadcasting, found in the **[Windows.Media.AppBroadcasting](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting)** namespace, are not included in the Universal API contract.</span></span> <span data-ttu-id="5e25a-109">この API にアクセスするには、次の手順に従って、UWP 用の Windows デスクトップ拡張機能への参照をアプリに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e25a-109">To access the APIs, you must add a reference to the Windows Desktop Extensions for the UWP to your app with the following steps.</span></span>

1. <span data-ttu-id="5e25a-110">Visual Studio の**ソリューション エクスプローラー**で、UWP プロジェクトを展開し、**[参照]** を右クリックして、**[参照の追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-110">In Visual Studio, in **Solution Explorer**, expand your UWP project and right-click **References** and then select **Add Reference...**.</span></span> 
2. <span data-ttu-id="5e25a-111">**[ユニバーサル Windows]** ノードを展開し、**[拡張機能]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-111">Expand the **Universal Windows** node and select **Extensions**.</span></span>
3. <span data-ttu-id="5e25a-112">拡張機能の一覧で、プロジェクトのターゲット ビルドに一致する **[Windows Desktop Extensions for the UWP]** エントリの横にあるチェック ボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="5e25a-112">In the list of extensions check the checkbox next to the **Windows Desktop Extensions for the UWP** entry that matches the target build for your project.</span></span> <span data-ttu-id="5e25a-113">アプリのブロードキャスト機能を使用するには、バージョンが 1709 以上である必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e25a-113">For the app broadcast features, the version must be 1709 or greater.</span></span>
4. <span data-ttu-id="5e25a-114">**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5e25a-114">Click **OK**.</span></span>

## <a name="launch-the-system-ui-to-allow-the-user-to-initiate-broadcasting"></a><span data-ttu-id="5e25a-115">システム UI を起動して、ユーザーがブロードキャストを開始できるようにします。</span><span class="sxs-lookup"><span data-stu-id="5e25a-115">Launch the system UI to allow the user to initiate broadcasting</span></span>
<span data-ttu-id="5e25a-116">現在、アプリでブロードキャストできない場合は、いくつかの原因があります。たとえば、現在のデバイスがブロードキャストのハードウェア要件を満たしていない場合や、別のアプリが現在ブロードキャストしている場合です。</span><span class="sxs-lookup"><span data-stu-id="5e25a-116">There are several reasons that your app may not currently be able to broadcast, including if the current device doesn't meet the hardware requirements for broadcasting or if another app is currently broadcasting.</span></span> <span data-ttu-id="5e25a-117">システム UI を起動する前に、アプリが現在ブロードキャストできるかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="5e25a-117">Before launching the system UI, you can check to see if your app is currently able to broadcast.</span></span> <span data-ttu-id="5e25a-118">最初に、ブロードキャスト API が現在のデバイスで利用可能かどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-118">First, check to see if the broadcast APIs are available on the current device.</span></span> <span data-ttu-id="5e25a-119">この API は、Windows 10 バージョン 1709 より前のバージョンの OS を実行しているデバイスでは利用できません。</span><span class="sxs-lookup"><span data-stu-id="5e25a-119">The APIs are not available on devices running an OS version earlier than Windows 10, version 1709.</span></span> <span data-ttu-id="5e25a-120">特定の OS バージョンを確認するのではなく、**[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation#Windows_Foundation_Metadata_ApiInformation_IsApiContractPresent_System_String_System_UInt16_System_UInt16_)** メソッドで、*Windows.Media.AppBroadcasting.AppBroadcastingContract* バージョン 1.0 を照会します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-120">Rather than check for a specific OS version, use the **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation#Windows_Foundation_Metadata_ApiInformation_IsApiContractPresent_System_String_System_UInt16_System_UInt16_)** method to query for the *Windows.Media.AppBroadcasting.AppBroadcastingContract* version 1.0.</span></span> <span data-ttu-id="5e25a-121">このコントラクトが存在する場合は、デバイスでブロードキャスト API を利用できます。</span><span class="sxs-lookup"><span data-stu-id="5e25a-121">If this contract is present, then the broadcasting APIs are available on the device.</span></span>

<span data-ttu-id="5e25a-122">次に、一度に 1 人のユーザーがサインインしている PC で、ファクトリ メソッド **[GetDefault](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_GetDefault)** を呼び出すことによって、**[AppBroadcastingUI](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui)** クラスのインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-122">Next, get an instance of the **[AppBroadcastingUI](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui)** class by calling the factory method **[GetDefault](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_GetDefault)** on PC, where there is a single user signed in at a time.</span></span> <span data-ttu-id="5e25a-123">複数のユーザーがログインできる XBox では、代わりに **[GetForUser](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_GetForUser_Windows_System_User_)** を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-123">On XBox, where multiple users can be signed in, call **[GetForUser](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_GetForUser_Windows_System_User_)** instead.</span></span> <span data-ttu-id="5e25a-124">次に、**[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_GetStatus)** を呼び出して、アプリのブロードキャストの状態を取得します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-124">Then call **[GetStatus](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_GetStatus)** to get the broadcasting status of your app.</span></span>

<span data-ttu-id="5e25a-125">**AppBroadcastingStatus** クラスの **[CanStartBroadcast](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingstatus#Windows_Media_AppBroadcasting_AppBroadcastingStatus_CanStartBroadcast)** プロパティは、アプリが現在ブロードキャストを開始できるかどうかを通知します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-125">The **[CanStartBroadcast](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingstatus#Windows_Media_AppBroadcasting_AppBroadcastingStatus_CanStartBroadcast)** property of the **AppBroadcastingStatus** class tells you whether the app can currently start broadcasting.</span></span> <span data-ttu-id="5e25a-126">開始できない場合は、**[Details](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingstatus#Windows_Media_AppBroadcasting_AppBroadcastingStatus_Details)** プロパティを調べて、ブロードキャストを利用できない理由を確認できます。</span><span class="sxs-lookup"><span data-stu-id="5e25a-126">If not, you can check the **[Details](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingstatus#Windows_Media_AppBroadcasting_AppBroadcastingStatus_Details)** property to determine the reason broadcasting is not available.</span></span> <span data-ttu-id="5e25a-127">理由に応じて、ユーザーに対してステータスを表示したり、ブロードキャストを有効にするための手順を示したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="5e25a-127">Depending on the reason, you may want to display the status to the user or show instructions for enabling broadcasting.</span></span>

[!code-cpp[CanStartBroadcast](./code/AppBroadcast/cpp/AppBroadcastExampleApp/App.cpp#SnippetCanStartBroadcast)]

<span data-ttu-id="5e25a-128">**[ShowBroadcastUI](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_ShowBroadcastUI)** を呼び出すことによって、アプリのブロードキャスト UI をシステムで表示することを要求します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-128">Request that the app broadcast UI be shown by the system by calling **[ShowBroadcastUI](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingui#Windows_Media_AppBroadcasting_AppBroadcastingUI_ShowBroadcastUI)**.</span></span>

> [!NOTE] 
> <span data-ttu-id="5e25a-129">**ShowBroadcastUI** メソッドは、システムの現在の状態に応じて、成功しない可能性がある要求を示します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-129">The **ShowBroadcastUI** method represents a request that may not succeed, depending on the current state of the system.</span></span> <span data-ttu-id="5e25a-130">アプリでは、このメソッドを呼び出した後、ブロードキャストが開始済みであることを想定しないでください。</span><span class="sxs-lookup"><span data-stu-id="5e25a-130">Your app should not assume that broadcasting has begun after calling this method.</span></span> <span data-ttu-id="5e25a-131">ブロードキャストが開始または停止するときに通知される **[IsCurrentAppBroadcastingChanged](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingmonitor#Windows_Media_AppBroadcasting_AppBroadcastingMonitor_IsCurrentAppBroadcastingChanged)** イベントを使用します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-131">Use the **[IsCurrentAppBroadcastingChanged](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingmonitor#Windows_Media_AppBroadcasting_AppBroadcastingMonitor_IsCurrentAppBroadcastingChanged)** event to be notified when broadcasting starts or stops.</span></span>

[!code-cpp[LaunchBroadcastUI](./code/AppBroadcast/cpp/AppBroadcastExampleApp/App.cpp#SnippetLaunchBroadcastUI)]

## <a name="receive-notifications-when-broadcasting-starts-and-stops"></a><span data-ttu-id="5e25a-132">ブロードキャストが開始および停止するときに通知を受信する</span><span class="sxs-lookup"><span data-stu-id="5e25a-132">Receive notifications when broadcasting starts and stops</span></span>
<span data-ttu-id="5e25a-133">ユーザーがシステム UI を使用して、**[AppBroadcastingMonitor](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingmonitor)** クラスのインスタンスを初期化し、**[IsCurrentAppBroadcastingChanged](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingmonitor#Windows_Media_AppBroadcasting_AppBroadcastingMonitor_IsCurrentAppBroadcastingChanged)** イベントのハンドラーを登録することによって、アプリのブロードキャストを開始または停止するときに通知を受信することを登録します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-133">Register to receive notifications when the user uses the system UI to start or stop broadcasting your app by initializing an instance of **[AppBroadcastingMonitor](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingmonitor)** class and registering a handler for the  **[IsCurrentAppBroadcastingChanged](https://docs.microsoft.com/uwp/api/windows.media.appbroadcasting.appbroadcastingmonitor#Windows_Media_AppBroadcasting_AppBroadcastingMonitor_IsCurrentAppBroadcastingChanged)** event.</span></span> <span data-ttu-id="5e25a-134">前のセクションで説明したように、必ずある時点で **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation#Windows_Foundation_Metadata_ApiInformation_IsApiContractPresent_System_String_System_UInt16_System_UInt16_)** を使用して、ブロードキャスト API を使用する前に、デバイスにブロードキャスト API が存在することを確認します。</span><span class="sxs-lookup"><span data-stu-id="5e25a-134">As discussed in the previous section, be sure to use the **[ApiInformation.IsApiContractPresent](https://docs.microsoft.com/uwp/api/windows.foundation.metadata.apiinformation#Windows_Foundation_Metadata_ApiInformation_IsApiContractPresent_System_String_System_UInt16_System_UInt16_)** at some point to verify that the broadcasting APIs are present on the device before attempting to use them.</span></span> 

[!code-cpp[AppBroadcastingRegisterChangedHandler](./code/AppBroadcast/cpp/AppBroadcastExampleApp/App.cpp#SnippetAppBroadcastingRegisterChangedHandler)]

<span data-ttu-id="5e25a-135">**IsCurrentAppBroadcastingChanged** イベントのハンドラーで、現在のブロードキャストの状態を反映するように、アプリの UI を更新することもできます。</span><span class="sxs-lookup"><span data-stu-id="5e25a-135">In the handler for the **IsCurrentAppBroadcastingChanged** event, you may want to update your app's UI to reflect the current broadcasting state.</span></span>

[!code-cpp[AppBroadcastingChangedHandler](./code/AppBroadcast/cpp/AppBroadcastExampleApp/App.cpp#SnippetAppBroadcastingChangedHandler)]

## <a name="related-topics"></a><span data-ttu-id="5e25a-136">関連トピック</span><span class="sxs-lookup"><span data-stu-id="5e25a-136">Related topics</span></span>

* [<span data-ttu-id="5e25a-137">ゲーム</span><span class="sxs-lookup"><span data-stu-id="5e25a-137">Gaming</span></span>](index.md)

 

 




