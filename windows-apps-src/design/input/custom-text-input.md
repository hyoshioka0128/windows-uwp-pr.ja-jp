---
author: Karl-Bridge-Microsoft
Description: The core text APIs in the Windows.UI.Text.Core namespace enable a Universal Windows Platform (UWP) app to receive text input from any text service supported on Windows devices.
title: カスタム テキスト入力の概要
ms.assetid: 58F5F7AC-6A4B-45FC-8C2A-942730FD7B74
label: Custom text input
template: detail.hbs
keywords: キーボード, テキスト, 基本的なテキスト, カスタム テキスト, テキスト サービス フレームワーク, 入力, ユーザー操作
ms.author: kbridge
ms.date: 02/08/2017
ms.topic: article
ms.localizationpriority: medium
ms.openlocfilehash: 14a2811f59b8de33db51b255aee8892abf553198
ms.sourcegitcommit: 71e8eae5c077a7740e5606298951bb78fc42b22c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/14/2018
ms.locfileid: "6669589"
---
# <a name="custom-text-input"></a><span data-ttu-id="50430-103">カスタム テキスト入力</span><span class="sxs-lookup"><span data-stu-id="50430-103">Custom text input</span></span>



<span data-ttu-id="50430-104">[**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) 名前空間の基本的なテキスト API によって、ユニバーサル Windows プラットフォーム (UWP) アプリは、Windows デバイスでサポートされている任意のテキスト サービスからテキスト入力を受け取ることができます。</span><span class="sxs-lookup"><span data-stu-id="50430-104">The core text APIs in the [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) namespace enable a Universal Windows Platform (UWP) app to receive text input from any text service supported on Windows devices.</span></span> <span data-ttu-id="50430-105">この API は、アプリがテキスト サービスの詳細を認識している必要がないという点で、[テキスト サービス フレームワーク](https://msdn.microsoft.com/library/windows/desktop/ms629032) API に似ています。</span><span class="sxs-lookup"><span data-stu-id="50430-105">The APIs are similar to the [Text Services Framework](https://msdn.microsoft.com/library/windows/desktop/ms629032) APIs in that the app is not required to have detailed knowledge of the text services.</span></span> <span data-ttu-id="50430-106">これにより、アプリは、キーボード、音声、ペンなどのすべての種類の入力から、テキストを任意の言語で受け取ることができます。</span><span class="sxs-lookup"><span data-stu-id="50430-106">This enables the app to receive text in any language and from any input type, like keyboard, speech, or pen.</span></span>

> <span data-ttu-id="50430-107">**重要な API**: [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238)、[**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158)</span><span class="sxs-lookup"><span data-stu-id="50430-107">**Important APIs**: [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238), [**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158)</span></span>

## <a name="why-use-core-text-apis"></a><span data-ttu-id="50430-108">基本的なテキスト API を使う理由</span><span class="sxs-lookup"><span data-stu-id="50430-108">Why use core text APIs?</span></span>


<span data-ttu-id="50430-109">多くのアプリでは、テキストの入力や編集には XAML や HTML のテキスト ボックス コントロールで十分です。</span><span class="sxs-lookup"><span data-stu-id="50430-109">For many apps, the XAML or HTML text box controls are sufficient for text input and editing.</span></span> <span data-ttu-id="50430-110">ただし、ワード プロセッシング アプリなど、アプリでテキストの複雑なシナリオを処理する場合は、柔軟なカスタム テキスト編集コントロールが必要になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="50430-110">However, if your app handles complex text scenarios, like a word processing app, you might need the flexibility of a custom text edit control.</span></span> <span data-ttu-id="50430-111">[**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) キーボード API を使ってテキスト編集コントロールを作成できますが、これらは、東アジアの言語をサポートするために必要なコンポジション ベースのテキスト入力を受け取る方法を提供しません。</span><span class="sxs-lookup"><span data-stu-id="50430-111">You could use the [**CoreWindow**](https://msdn.microsoft.com/library/windows/apps/br208225) keyboard APIs to create your text edit control, but these don't provide a way to receive composition-based text input, which is required to support East Asian languages.</span></span>

<span data-ttu-id="50430-112">カスタム テキスト編集コントロールを作成する必要がある場合は、代わりに [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) API を使います。</span><span class="sxs-lookup"><span data-stu-id="50430-112">Instead, use the [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) APIs when you need to create a custom text edit control.</span></span> <span data-ttu-id="50430-113">これらの API は、任意の言語でのテキスト入力の処理において高い柔軟性を実現するように設計されており、アプリに最適なテキスト エクスペリエンスを提供できます。</span><span class="sxs-lookup"><span data-stu-id="50430-113">These APIs are designed to give you a lot of flexibility in processing text input, in any language, and let you provide the text experience best suited to your app.</span></span> <span data-ttu-id="50430-114">基本的なテキスト API に組み込まれているテキスト入力および編集コントロールは、Windows デバイスでの既存のすべてのテキスト入力方式からテキスト入力を受け取ることができます。これには、[テキスト サービス フレームワーク](https://msdn.microsoft.com/library/windows/desktop/ms629032) ベースの入力方式エディター (IME) や PC での手書き入力、モバイル デバイスでの WordFlow キーボード (自動修正、予測入力、ディクテーションを提供する) が含まれます。</span><span class="sxs-lookup"><span data-stu-id="50430-114">Text input and edit controls built with the core text APIs can receive text input from all existing text input methods on Windows devices, from [Text Services Framework](https://msdn.microsoft.com/library/windows/desktop/ms629032) based Input Method Editors (IMEs) and handwriting on PCs to the WordFlow keyboard (which provides auto-correction, prediction, and dictation) on mobile devices.</span></span>

## <a name="architecture"></a><span data-ttu-id="50430-115">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="50430-115">Architecture</span></span>


<span data-ttu-id="50430-116">テキスト入力システムの単純な例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="50430-116">The following is a simple representation of the text input system.</span></span>

-   <span data-ttu-id="50430-117">"アプリケーション" は、基本的なテキスト API を使って構築されたカスタム編集コントロールをホストする UWP アプリを表します。</span><span class="sxs-lookup"><span data-stu-id="50430-117">"Application" represents a UWP app hosting a custom edit control built using the core text APIs.</span></span>
-   <span data-ttu-id="50430-118">[**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) API は、Windows 経由でのテキスト サービスとの通信を容易にします。</span><span class="sxs-lookup"><span data-stu-id="50430-118">The [**Windows.UI.Text.Core**](https://msdn.microsoft.com/library/windows/apps/dn958238) APIs facilitate the communication with text services through Windows.</span></span> <span data-ttu-id="50430-119">テキスト編集コントロールとテキスト サービス間の通信は、主に [**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158) オブジェクトによって処理されます。このオブジェクトが通信を容易にするメソッドとイベントを提供します。</span><span class="sxs-lookup"><span data-stu-id="50430-119">Communication between the text edit control and the text services is handled primarily through a [**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158) object that provides the methods and events to facilitate the communication.</span></span>

![基本的なテキストのアーキテクチャ図](images/coretext/architecture.png)

## <a name="text-ranges-and-selection"></a><span data-ttu-id="50430-121">テキスト範囲と選択範囲</span><span class="sxs-lookup"><span data-stu-id="50430-121">Text ranges and selection</span></span>


<span data-ttu-id="50430-122">編集コントロールはテキスト入力用の領域を提供し、ユーザーはこの領域の任意の場所でテキストを編集できることを期待しています。</span><span class="sxs-lookup"><span data-stu-id="50430-122">Edit controls provide space for text entry and users expect to edit text anywhere in this space.</span></span> <span data-ttu-id="50430-123">ここでは、基本的なテキスト API で使用されるテキスト配置システムについて説明します。また、範囲と選択範囲がこのシステムでどのように表現されるかについても説明します。</span><span class="sxs-lookup"><span data-stu-id="50430-123">Here, we explain the text positioning system used by the core text APIs and how ranges and selections are represented in this system.</span></span>

### <a name="application-caret-position"></a><span data-ttu-id="50430-124">アプリケーションのカーソル位置</span><span class="sxs-lookup"><span data-stu-id="50430-124">Application caret position</span></span>

<span data-ttu-id="50430-125">基本的なテキスト API で使用されるテキスト範囲は、カーソル位置の観点で表されます。</span><span class="sxs-lookup"><span data-stu-id="50430-125">Text ranges used with the core text APIs are expressed in terms of caret positions.</span></span> <span data-ttu-id="50430-126">"アプリケーション カーソル位置 (ACP)" は、次に示すように、カーソルの直前にあるテキスト ストリームの先頭からの文字数を示す 0 から始まる数値です。</span><span class="sxs-lookup"><span data-stu-id="50430-126">An "Application Caret Position (ACP)" is a zero-based number that indicates the count of characters from the start of the text stream immediately before the caret, as shown here.</span></span>

![テキスト ストリームの例の図](images/coretext/stream-1.png)
### <a name="text-ranges-and-selection"></a><span data-ttu-id="50430-128">テキスト範囲と選択範囲</span><span class="sxs-lookup"><span data-stu-id="50430-128">Text ranges and selection</span></span>

<span data-ttu-id="50430-129">テキスト範囲と選択範囲は、次の 2 つのフィールドが含まれる [**CoreTextRange**](https://msdn.microsoft.com/library/windows/apps/dn958201) 構造体で表されます。</span><span class="sxs-lookup"><span data-stu-id="50430-129">Text ranges and selections are represented by the [**CoreTextRange**](https://msdn.microsoft.com/library/windows/apps/dn958201) structure which contains two fields:</span></span>

| <span data-ttu-id="50430-130">フィールド</span><span class="sxs-lookup"><span data-stu-id="50430-130">Field</span></span>                  | <span data-ttu-id="50430-131">データ型</span><span class="sxs-lookup"><span data-stu-id="50430-131">Data type</span></span>                                                                 | <span data-ttu-id="50430-132">説明</span><span class="sxs-lookup"><span data-stu-id="50430-132">Description</span></span>                                                                      |
|------------------------|---------------------------------------------------------------------------|----------------------------------------------------------------------------------|
| **<span data-ttu-id="50430-133">StartCaretPosition</span><span class="sxs-lookup"><span data-stu-id="50430-133">StartCaretPosition</span></span>** | <span data-ttu-id="50430-134">**Number** \[JavaScript\]</span><span class="sxs-lookup"><span data-stu-id="50430-134">**Number** \[JavaScript\]</span></span> | <span data-ttu-id="50430-135">**System.Int32** \[.NET\]</span><span class="sxs-lookup"><span data-stu-id="50430-135">**System.Int32** \[.NET\]</span></span> | <span data-ttu-id="50430-136">**int32** \[C++\]</span><span class="sxs-lookup"><span data-stu-id="50430-136">**int32** \[C++\]</span></span> | <span data-ttu-id="50430-137">範囲の開始位置は、最初の文字の直前の ACP です。</span><span class="sxs-lookup"><span data-stu-id="50430-137">The start position of a range is the ACP immediately before the first character.</span></span> |
| **<span data-ttu-id="50430-138">EndCaretPosition</span><span class="sxs-lookup"><span data-stu-id="50430-138">EndCaretPosition</span></span>**   | <span data-ttu-id="50430-139">**Number** \[JavaScript\]</span><span class="sxs-lookup"><span data-stu-id="50430-139">**Number** \[JavaScript\]</span></span> | <span data-ttu-id="50430-140">**System.Int32** \[.NET\]</span><span class="sxs-lookup"><span data-stu-id="50430-140">**System.Int32** \[.NET\]</span></span> | <span data-ttu-id="50430-141">**int32** \[C++\]</span><span class="sxs-lookup"><span data-stu-id="50430-141">**int32** \[C++\]</span></span> | <span data-ttu-id="50430-142">範囲の終了位置は、最後の文字の直後の ACP です。</span><span class="sxs-lookup"><span data-stu-id="50430-142">The end position of a range is the ACP immediately after the last character.</span></span>     |

 

<span data-ttu-id="50430-143">たとえば、前に示したテキスト範囲で、範囲 \[0, 5\] は "Hello" という単語を指します。</span><span class="sxs-lookup"><span data-stu-id="50430-143">For example, in the text range shown previously, the range \[0, 5\] specifies the word "Hello".</span></span> <span data-ttu-id="50430-144">**StartCaretPosition** は、常に **EndCaretPosition** 以下である必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-144">**StartCaretPosition** must always be less than or equal to the **EndCaretPosition**.</span></span> <span data-ttu-id="50430-145">範囲 \[5, 0\] は無効です。</span><span class="sxs-lookup"><span data-stu-id="50430-145">The range \[5, 0\] is invalid.</span></span>

### <a name="insertion-point"></a><span data-ttu-id="50430-146">挿入ポイント</span><span class="sxs-lookup"><span data-stu-id="50430-146">Insertion point</span></span>

<span data-ttu-id="50430-147">現在のカーソル位置は挿入ポイントとも呼ばれ、**StartCaretPosition** を **EndCaretPosition** と等しくなるように設定することによって表されます。</span><span class="sxs-lookup"><span data-stu-id="50430-147">The current caret position, frequently referred to as the insertion point, is represented by setting the **StartCaretPosition** to be equal to the **EndCaretPosition**.</span></span>

### <a name="noncontiguous-selection"></a><span data-ttu-id="50430-148">連続しない選択範囲</span><span class="sxs-lookup"><span data-stu-id="50430-148">Noncontiguous selection</span></span>

<span data-ttu-id="50430-149">一部の編集コントロールでは、連続しない選択範囲がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="50430-149">Some edit controls support noncontiguous selections.</span></span> <span data-ttu-id="50430-150">たとえば、Microsoft Office アプリでは任意の複数の選択範囲がサポートされ、多くのソース コード エディターでは列の選択がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="50430-150">For example, Microsoft Office apps support multiple arbitrary selections, and many source code editors support column selection.</span></span> <span data-ttu-id="50430-151">ただし、基本的なテキスト API では連続しない選択範囲はサポートされません。</span><span class="sxs-lookup"><span data-stu-id="50430-151">However, the core text APIs do not support noncontiguous selections.</span></span> <span data-ttu-id="50430-152">編集コントロールは、1 つ連続した選択範囲のみをレポートする必要があります。これは通常、連続しない選択範囲のアクティブな下位範囲です。</span><span class="sxs-lookup"><span data-stu-id="50430-152">Edit controls must report only a single contiguous selection, most often the active sub-range of the noncontiguous selections.</span></span>

<span data-ttu-id="50430-153">たとえば、次のようなテキスト ストリームがあるとします。</span><span class="sxs-lookup"><span data-stu-id="50430-153">For example, consider this text stream:</span></span>

![<span data-ttu-id="50430-154">テキスト ストリームの例の図](images/coretext/stream-2.png) \[0, 1\] と \[6, 11\] の 2 つの選択範囲があります。</span><span class="sxs-lookup"><span data-stu-id="50430-154">example text stream diagram](images/coretext/stream-2.png) There are two selections: \[0, 1\] and \[6, 11\].</span></span> <span data-ttu-id="50430-155">編集コントロールは、\[0, 1\] と \[6, 11\] のいずれか一方のみをレポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-155">The edit control must report only one of them; either \[0, 1\] or \[6, 11\].</span></span>

## <a name="working-with-text"></a><span data-ttu-id="50430-156">テキストの操作</span><span class="sxs-lookup"><span data-stu-id="50430-156">Working with text</span></span>


<span data-ttu-id="50430-157">[**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158) クラスの [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) イベント、[**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) イベント、[**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) メソッドによって、Windows と編集コントロールとの間でのテキスト フローを実現できます。</span><span class="sxs-lookup"><span data-stu-id="50430-157">The [**CoreTextEditContext**](https://msdn.microsoft.com/library/windows/apps/dn958158) class enables text flow between Windows and edit controls through the [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event, the [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event, and the [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) method.</span></span>

<span data-ttu-id="50430-158">編集コントロールは、ユーザーがキーボード、音声、IME などのテキスト入力方式を操作したときに生成される [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) イベントによってテキストを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="50430-158">Your edit control receives text through [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) events that are generated when users interact with text input methods like keyboards, speech, or IMEs.</span></span>

<span data-ttu-id="50430-159">テキストをコントロールに貼り付けるなどの方法で、編集コントロールでテキストを変更する場合、[**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) を呼び出して Windows に通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-159">When you change text in your edit control, for example, by pasting text into the control, you need to notify Windows by calling [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172).</span></span>

<span data-ttu-id="50430-160">テキスト サービスが新しいテキストを必要とする場合、[**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="50430-160">If the text service requires the new text, then a [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event is raised.</span></span> <span data-ttu-id="50430-161">**TextRequested** イベント ハンドラーで、新しいテキストを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-161">You must provide the new text in the **TextRequested** event handler.</span></span>

### <a name="accepting-text-updates"></a><span data-ttu-id="50430-162">テキストの更新の受け付け</span><span class="sxs-lookup"><span data-stu-id="50430-162">Accepting text updates</span></span>

<span data-ttu-id="50430-163">編集コントロールでは、通常、テキストの更新要求を受け付ける必要があります。これらは、ユーザーが入力するテキストを表しているためです。</span><span class="sxs-lookup"><span data-stu-id="50430-163">Your edit control should typically accept text update requests because they represent the text the user wants to enter.</span></span> <span data-ttu-id="50430-164">[**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) イベント ハンドラーでは、編集コントロールの次の操作が想定されています。</span><span class="sxs-lookup"><span data-stu-id="50430-164">In the [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event handler, these actions are expected of your edit control:</span></span>

1.  <span data-ttu-id="50430-165">[**CoreTextTextUpdatingEventArgs.Text**](https://msdn.microsoft.com/library/windows/apps/dn958236) で指定されたテキストを、[**CoreTextTextUpdatingEventArgs.Range**](https://msdn.microsoft.com/library/windows/apps/dn958234) で指定された位置に挿入します。</span><span class="sxs-lookup"><span data-stu-id="50430-165">Insert the text specified in [**CoreTextTextUpdatingEventArgs.Text**](https://msdn.microsoft.com/library/windows/apps/dn958236) in the position specified in [**CoreTextTextUpdatingEventArgs.Range**](https://msdn.microsoft.com/library/windows/apps/dn958234).</span></span>
2.  <span data-ttu-id="50430-166">[**CoreTextTextUpdatingEventArgs.NewSelection**](https://msdn.microsoft.com/library/windows/apps/dn958233) で指定された位置に選択範囲を配置します。</span><span class="sxs-lookup"><span data-stu-id="50430-166">Place selection at the position specified in [**CoreTextTextUpdatingEventArgs.NewSelection**](https://msdn.microsoft.com/library/windows/apps/dn958233).</span></span>
3.  <span data-ttu-id="50430-167">[**CoreTextTextUpdatingEventArgs.Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) を [**CoreTextTextUpdatingResult.Succeeded**](https://msdn.microsoft.com/library/windows/apps/dn958237) に設定することによって、更新が成功したことをシステムに通知します。</span><span class="sxs-lookup"><span data-stu-id="50430-167">Notify the system that the update succeeded by setting [**CoreTextTextUpdatingEventArgs.Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to [**CoreTextTextUpdatingResult.Succeeded**](https://msdn.microsoft.com/library/windows/apps/dn958237).</span></span>

<span data-ttu-id="50430-168">たとえば、これは、ユーザーが "d" を入力する前の編集コントロールの状態です。</span><span class="sxs-lookup"><span data-stu-id="50430-168">For example, this is the state of an edit control before the user types "d".</span></span> <span data-ttu-id="50430-169">挿入ポイントは \[10, 10\] にあります。</span><span class="sxs-lookup"><span data-stu-id="50430-169">The insertion point is at \[10, 10\].</span></span>

![<span data-ttu-id="50430-170">テキスト ストリームの例の図](images/coretext/stream-3.png) ユーザーが "d" を入力すると、次の [**CoreTextTextUpdatingEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn958229) データを使って、[**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="50430-170">example text stream diagram](images/coretext/stream-3.png) When the user types "d", a [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event is raised with the following [**CoreTextTextUpdatingEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn958229) data:</span></span>

-   <span data-ttu-id="50430-171">[**Range**](https://msdn.microsoft.com/library/windows/apps/dn958234) = \[10, 10\]</span><span class="sxs-lookup"><span data-stu-id="50430-171">[**Range**](https://msdn.microsoft.com/library/windows/apps/dn958234) = \[10, 10\]</span></span>
-   <span data-ttu-id="50430-172">[**Text**](https://msdn.microsoft.com/library/windows/apps/dn958236) = "d"</span><span class="sxs-lookup"><span data-stu-id="50430-172">[**Text**](https://msdn.microsoft.com/library/windows/apps/dn958236) = "d"</span></span>
-   <span data-ttu-id="50430-173">[**NewSelection**](https://msdn.microsoft.com/library/windows/apps/dn958233) = \[11, 11\]</span><span class="sxs-lookup"><span data-stu-id="50430-173">[**NewSelection**](https://msdn.microsoft.com/library/windows/apps/dn958233) = \[11, 11\]</span></span>

<span data-ttu-id="50430-174">編集コントロールで、指定された変更を適用し、[**Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) を **Succeeded** に設定します。</span><span class="sxs-lookup"><span data-stu-id="50430-174">In your edit control, apply the specified changes and set [**Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to **Succeeded**.</span></span> <span data-ttu-id="50430-175">変更が適用された後のコントロールの状態は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="50430-175">Here's the state of the control after the changes are applied.</span></span>

![テキスト ストリームの例の図](images/coretext/stream-4.png)
### <a name="rejecting-text-updates"></a><span data-ttu-id="50430-177">テキストの更新の拒否</span><span class="sxs-lookup"><span data-stu-id="50430-177">Rejecting text updates</span></span>

<span data-ttu-id="50430-178">要求された範囲が編集コントロールの変更してはいけない領域にある場合、テキストの更新を適用できないことがあります。</span><span class="sxs-lookup"><span data-stu-id="50430-178">Sometimes, you cannot apply text updates because the requested range is in an area of the edit control that should not be changed.</span></span> <span data-ttu-id="50430-179">この場合、変更を適用しないでください。</span><span class="sxs-lookup"><span data-stu-id="50430-179">In this case, you should not apply any changes.</span></span> <span data-ttu-id="50430-180">代わりに、[**CoreTextTextUpdatingEventArgs.Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) を [**CoreTextTextUpdatingResult.Failed**](https://msdn.microsoft.com/library/windows/apps/dn958237) に設定することによって、更新が失敗したことをシステムに通知します。</span><span class="sxs-lookup"><span data-stu-id="50430-180">Instead, notify the system that the update failed by setting [**CoreTextTextUpdatingEventArgs.Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to [**CoreTextTextUpdatingResult.Failed**](https://msdn.microsoft.com/library/windows/apps/dn958237).</span></span>

<span data-ttu-id="50430-181">たとえば、電子メール アドレスのみを受け付ける編集コントロールがあるとします。</span><span class="sxs-lookup"><span data-stu-id="50430-181">For example, consider an edit control that accepts only an e-mail address.</span></span> <span data-ttu-id="50430-182">電子メール アドレスにスペースを含めることはできないため、スペースは拒否する必要があります。そのため、Space キーについて [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) イベントが発生した場合は、編集コントロールで単に [**Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) を **Failed** に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-182">Spaces should be rejected because e-mail addresses cannot contain spaces, so when [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) events are raised for the space key, you should simply set [**Result**](https://msdn.microsoft.com/library/windows/apps/dn958235) to **Failed** in your edit control.</span></span>

### <a name="notifying-text-changes"></a><span data-ttu-id="50430-183">テキストの変更の通知</span><span class="sxs-lookup"><span data-stu-id="50430-183">Notifying text changes</span></span>

<span data-ttu-id="50430-184">テキストの貼り付けや自動修正などが行われた場合に、編集コントロールのテキストが変更されることがあります。</span><span class="sxs-lookup"><span data-stu-id="50430-184">Sometimes, your edit control makes changes to text such as when text is pasted or auto-corrected.</span></span> <span data-ttu-id="50430-185">このような場合、[**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) を呼び出すことによって、これらの変更をテキスト サービスに通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-185">In these cases, you must notify the text services of these changes by calling the [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) method.</span></span>

<span data-ttu-id="50430-186">たとえば、これは、ユーザーが "World" を貼り付ける前の編集コントロールの状態です。</span><span class="sxs-lookup"><span data-stu-id="50430-186">For example, this is the state of an edit control before the user pastes "World".</span></span> <span data-ttu-id="50430-187">挿入ポイントは \[6, 6\] にあります。</span><span class="sxs-lookup"><span data-stu-id="50430-187">The insertion point is at \[6, 6\].</span></span>

![<span data-ttu-id="50430-188">テキスト ストリームの例の図](images/coretext/stream-5.png) ユーザーが貼り付け操作を実行すると、編集コントロールのテキストは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="50430-188">example text stream diagram](images/coretext/stream-5.png) The user performs the paste action and the edit control ends up with the following text:</span></span>

![<span data-ttu-id="50430-189">テキスト ストリームの例の図](images/coretext/stream-4.png) この場合、次の引数を使って、[**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-189">example text stream diagram](images/coretext/stream-4.png) When this happens, you should call [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) with these arguments:</span></span>

-   <span data-ttu-id="50430-190">*modifiedRange* = \[6, 6\]</span><span class="sxs-lookup"><span data-stu-id="50430-190">*modifiedRange* = \[6, 6\]</span></span>
-   <span data-ttu-id="50430-191">*newLength* = 5</span><span class="sxs-lookup"><span data-stu-id="50430-191">*newLength* = 5</span></span>
-   <span data-ttu-id="50430-192">*newSelection* = \[11, 11\]</span><span class="sxs-lookup"><span data-stu-id="50430-192">*newSelection* = \[11, 11\]</span></span>

<span data-ttu-id="50430-193">1 つまたは複数の [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) イベントが発生し、これを処理することによって、テキスト サービスが操作しているテキストを更新します。</span><span class="sxs-lookup"><span data-stu-id="50430-193">One or more [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) events will follow, which you handle to update the text that the text services are working with.</span></span>

### <a name="overriding-text-updates"></a><span data-ttu-id="50430-194">テキストの更新の上書き</span><span class="sxs-lookup"><span data-stu-id="50430-194">Overriding text updates</span></span>

<span data-ttu-id="50430-195">編集コントロールで、自動修正機能を提供するために、テキストの更新を上書きすることが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="50430-195">In your edit control, you might want to override a text update to provide auto-correction features.</span></span>

<span data-ttu-id="50430-196">たとえば、短縮形を正式なつづりにする修正機能を提供する編集コントロールがあるとします。</span><span class="sxs-lookup"><span data-stu-id="50430-196">For example, consider an edit control that provides a correction feature that formalizes contractions.</span></span> <span data-ttu-id="50430-197">ユーザーが Space キーを押して修正機能をトリガーする前の編集コントロールの状態は、次のようになっています。</span><span class="sxs-lookup"><span data-stu-id="50430-197">This is the state of the edit control before the user types the space key to trigger the correction.</span></span> <span data-ttu-id="50430-198">挿入ポイントは \[3, 3\] にあります。</span><span class="sxs-lookup"><span data-stu-id="50430-198">The insertion point is at \[3, 3\].</span></span>

![<span data-ttu-id="50430-199">テキスト ストリームの例の図](images/coretext/stream-6.png) ユーザーが Space キーを押すと、対応する [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="50430-199">example text stream diagram](images/coretext/stream-6.png) The user presses the space key and a corresponding [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event is raised.</span></span> <span data-ttu-id="50430-200">編集コントロールは、テキストの更新を受け付けます。</span><span class="sxs-lookup"><span data-stu-id="50430-200">The edit control accepts the text update.</span></span> <span data-ttu-id="50430-201">修正が完了する直前の編集コントロールの状態は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="50430-201">This is the state of the edit control for a brief moment before the correction is completed.</span></span> <span data-ttu-id="50430-202">挿入ポイントは \[4, 4\] にあります。</span><span class="sxs-lookup"><span data-stu-id="50430-202">The insertion point is at \[4, 4\].</span></span>

![<span data-ttu-id="50430-203">テキスト ストリームの例の図](images/coretext/stream-7.png) [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) イベント ハンドラーの外部で、編集コントロールは次の修正を実行します。</span><span class="sxs-lookup"><span data-stu-id="50430-203">example text stream diagram](images/coretext/stream-7.png) Outside of the [**TextUpdating**](https://msdn.microsoft.com/library/windows/apps/dn958176) event handler, the edit control makes the following correction.</span></span> <span data-ttu-id="50430-204">修正が完了した後の編集コントロールの状態は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="50430-204">This is the state of the edit control after the correction is complete.</span></span> <span data-ttu-id="50430-205">挿入ポイントは \[5, 5\] にあります。</span><span class="sxs-lookup"><span data-stu-id="50430-205">The insertion point is at \[5, 5\].</span></span>

![<span data-ttu-id="50430-206">テキスト ストリームの例の図](images/coretext/stream-8.png) この場合、次の引数を使って、[**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-206">example text stream diagram](images/coretext/stream-8.png) When this happens, you should call [**NotifyTextChanged**](https://msdn.microsoft.com/library/windows/apps/dn958172) with these arguments:</span></span>

-   <span data-ttu-id="50430-207">*modifiedRange* = \[1, 2\]</span><span class="sxs-lookup"><span data-stu-id="50430-207">*modifiedRange* = \[1, 2\]</span></span>
-   <span data-ttu-id="50430-208">*newLength* = 2</span><span class="sxs-lookup"><span data-stu-id="50430-208">*newLength* = 2</span></span>
-   <span data-ttu-id="50430-209">*newSelection* = \[5, 5\]</span><span class="sxs-lookup"><span data-stu-id="50430-209">*newSelection* = \[5, 5\]</span></span>

<span data-ttu-id="50430-210">1 つまたは複数の [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) イベントが発生し、これを処理することによって、テキスト サービスが操作しているテキストを更新します。</span><span class="sxs-lookup"><span data-stu-id="50430-210">One or more [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) events will follow, which you handle to update the text that the text services are working with.</span></span>

### <a name="providing-requested-text"></a><span data-ttu-id="50430-211">要求されたテキストの提供</span><span class="sxs-lookup"><span data-stu-id="50430-211">Providing requested text</span></span>

<span data-ttu-id="50430-212">テキスト サービスでは、自動修正や予測入力などの機能を提供する場合、正しいテキストがあることが重要です。特に、ドキュメントの読み込みなどから編集コントロールに既に存在しているテキストや、前のセクションで説明したように編集コントロールによって挿入されたテキストについて重要です。</span><span class="sxs-lookup"><span data-stu-id="50430-212">It's important for text services to have the correct text to provide features like auto-correction or prediction, especially for text that already existed in the edit control, from loading a document, for example, or text that is inserted by the edit control as explained in previous sections.</span></span> <span data-ttu-id="50430-213">そのため、[**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) イベントが発生するたびに、現在編集コントロール内にあり、指定された範囲のテキストを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="50430-213">Therefore, whenever a [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event is raised, you must provide the text currently in your edit control for the specified range.</span></span>

<span data-ttu-id="50430-214">[**CoreTextTextRequest**](https://msdn.microsoft.com/library/windows/apps/dn958221) 内の [**Range**](https://msdn.microsoft.com/library/windows/apps/dn958227) が、編集コントロールでそのまま格納できない範囲を指定する場合があります。</span><span class="sxs-lookup"><span data-stu-id="50430-214">There will be times the [**Range**](https://msdn.microsoft.com/library/windows/apps/dn958227) in [**CoreTextTextRequest**](https://msdn.microsoft.com/library/windows/apps/dn958221) specifies a range that your edit control cannot accommodate as-is.</span></span> <span data-ttu-id="50430-215">たとえば、[**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) イベントの発生時に **Range** が編集コントロールのサイズよりも大きい場合や、**Range** の最後が範囲外である場合です。</span><span class="sxs-lookup"><span data-stu-id="50430-215">For example, the **Range** is larger than the size of the edit control at the time of the [**TextRequested**](https://msdn.microsoft.com/library/windows/apps/dn958175) event, or the end of the **Range** is out of bounds.</span></span> <span data-ttu-id="50430-216">このような場合は、何か適切な範囲を返す必要があります。通常、これは要求された範囲のサブセットです。</span><span class="sxs-lookup"><span data-stu-id="50430-216">In these cases, you should return whatever range makes sense, which is typically a subset of the requested range.</span></span>

## <a name="related-articles"></a><span data-ttu-id="50430-217">関連記事</span><span class="sxs-lookup"><span data-stu-id="50430-217">Related articles</span></span>

**<span data-ttu-id="50430-218">サンプル</span><span class="sxs-lookup"><span data-stu-id="50430-218">Samples</span></span>**
* <span data-ttu-id="50430-219">[カスタム編集コントロールのサンプル](https://go.microsoft.com/fwlink/?linkid=831024)
**サンプルのアーカイブ**</span><span class="sxs-lookup"><span data-stu-id="50430-219">[Custom Edit Control sample](https://go.microsoft.com/fwlink/?linkid=831024) 
**Archive samples**</span></span>
* [<span data-ttu-id="50430-220">XAML テキスト編集のサンプルに関するページ</span><span class="sxs-lookup"><span data-stu-id="50430-220">XAML text editing sample</span></span>](http://go.microsoft.com/fwlink/p/?LinkID=251417)


