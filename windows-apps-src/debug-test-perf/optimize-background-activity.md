---
ms.assetid: 24351dad-2ee3-462a-ae78-2752bb3374c2
title: バックグラウンド アクティビティの最適化
description: システムと連携して、バッテリー効率の高い方法でバックグラウンド タスクを使用する UWP アプリを作成します。
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 71a56bc23b4b727d5be2ed35fb77afae03f0689c
ms.sourcegitcommit: a3dc929858415b933943bba5aa7487ffa721899f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/07/2018
ms.locfileid: "8794893"
---
# <a name="optimize-background-activity"></a><span data-ttu-id="568d7-104">バックグラウンド アクティビティの最適化</span><span class="sxs-lookup"><span data-stu-id="568d7-104">Optimize background activity</span></span>

<span data-ttu-id="568d7-105">ユニバーサル Windows アプリは、すべてのデバイス ファミリで一貫して動作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="568d7-105">Universal Windows apps should perform consistently well across all device families.</span></span> <span data-ttu-id="568d7-106">バッテリー駆動デバイスにおいて、消費電力は、アプリの全体的なユーザー エクスペリエンスを左右する重要な要因です。</span><span class="sxs-lookup"><span data-stu-id="568d7-106">On battery-powered devices, power consumption is a critical factor in the user's overall experience with your app.</span></span> <span data-ttu-id="568d7-107">バッテリー残量が 1 日中持続する終日バッテリー駆動はすべてのユーザーにとって望ましい機能ですが、それにはデバイスにインストールされているすべてのソフトウェアが効率的に動作する必要があるため、その点を考慮した開発が求められます。</span><span class="sxs-lookup"><span data-stu-id="568d7-107">All-day battery life is a desirable feature to every user, but it requires efficiency from all of the software installed on the device, including your own.</span></span> 

<span data-ttu-id="568d7-108">バックグラウンド タスクの動作は、ほとんどの場合、アプリの合計電力コストを決定する最も重要な要因です。</span><span class="sxs-lookup"><span data-stu-id="568d7-108">Background task behavior is arguably the most important factor in the total energy cost of an app.</span></span> <span data-ttu-id="568d7-109">バックグラウンド タスクとは、アプリを開かずにシステムに登録されるあらゆるプログラムの動作を指します。</span><span class="sxs-lookup"><span data-stu-id="568d7-109">A background task is any program activity that has been registered with the system to run without the app being open.</span></span> <span data-ttu-id="568d7-110">詳しくは、「[アウトプロセス バックグラウンド タスクの作成と登録](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)」をご覧ください</span><span class="sxs-lookup"><span data-stu-id="568d7-110">See [Create and register an out-of-process background task](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task) for more information.</span></span>

## <a name="background-activity-permissions"></a><span data-ttu-id="568d7-111">バックグラウンド アクティビティのアクセス許可</span><span class="sxs-lookup"><span data-stu-id="568d7-111">Background activity permissions</span></span>

<span data-ttu-id="568d7-112">Windows 10 Version 1607 以降を実行するデスクトップ デバイスやモバイル デバイスでは、ユーザーは設定アプリの [バッテリー] セクションにある [アプリによるバッテリーの使用] をクリックして使用率を確認できます。</span><span class="sxs-lookup"><span data-stu-id="568d7-112">On desktop and mobile devices running Windows 10, version 1607 or later, users can view their "Battery usage by app" in the Battery section of the Settings app.</span></span> <span data-ttu-id="568d7-113">ここでは、アプリの一覧と各アプリが消費したバッテリー残量の割合 (最後の充電時以降に使用された全バッテリー残量に対する) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="568d7-113">Here they will see a list of apps and the percentage of battery life that each app has consumed (out of the amount of battery life that has been used since the last charge).</span></span> <span data-ttu-id="568d7-114">この一覧の UWP アプリについては、ユーザーはアプリを選択して、バックグラウンド アクティビティに関連するコントロールを開くことができます。</span><span class="sxs-lookup"><span data-stu-id="568d7-114">For UWP apps on this list, users can select the app to open up controls related to background activity.</span></span>

![アプリによるバッテリーの使用](images/battery-usage-by-app.png)

### <a name="background-permissions-on-mobile"></a><span data-ttu-id="568d7-116">モバイルでのバックグラウンドのアクセス許可</span><span class="sxs-lookup"><span data-stu-id="568d7-116">Background permissions on mobile</span></span>

<span data-ttu-id="568d7-117">モバイル デバイスでは、ユーザーに対して、そのアプリのバックグラウンド タスクのアクセス許可の設定を指定するラジオ ボタンの一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="568d7-117">On mobile devices, users will see a list of radio buttons that specify the background task permission setting for that app.</span></span> <span data-ttu-id="568d7-118">バックグラウンド アクティビティは、[常に許可]、[バックグラウンドで許可しない]、[Windows で管理] のいずれかに設定できます。[Windows で管理] の場合、アプリのバックグラウンド アクティビティは、さまざまな要因に応じて、システムによって規制されます。</span><span class="sxs-lookup"><span data-stu-id="568d7-118">Background activity can be set to "Always allowed," "Never allowed," or "Managed by Windows," which means the app's background activity is regulated by the system according to a number of factors.</span></span> 

![バックグラウンド タスクのアクセス許可のラジオ ボタン](images/background-task-permissions.png)

### <a name="background-permissions-on-desktop"></a><span data-ttu-id="568d7-120">デスクトップでのバックグラウンドのアクセス許可</span><span class="sxs-lookup"><span data-stu-id="568d7-120">Background permissions on desktop</span></span>

<span data-ttu-id="568d7-121">デスクトップ デバイスでは、[Windows で管理] の設定はトグル スイッチとして表示され、既定では**オン**に設定されています。</span><span class="sxs-lookup"><span data-stu-id="568d7-121">On desktop devices, the "Managed by Windows" setting is presented as a toggle switch, set to **On** by default.</span></span> <span data-ttu-id="568d7-122">ユーザーが**オフ**に切り替えた場合、バックグラウンド アクティビティのアクセス許可を手動で定義できるチェック ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="568d7-122">If the user switches  to **Off**, they are presented with a checkbox with which they can manually define the background activity permissions.</span></span> <span data-ttu-id="568d7-123">チェック ボックスをオンにした場合、アプリでバックグラウンド タスクの実行が常に許可されます。</span><span class="sxs-lookup"><span data-stu-id="568d7-123">When the box is checked, the app will be allowed to run background tasks at all times.</span></span> <span data-ttu-id="568d7-124">チェック ボックスがオフにした場合、バックグラウンド アクティビティは無効になります。</span><span class="sxs-lookup"><span data-stu-id="568d7-124">When the box is unchecked, the background activity will be disabled.</span></span>

![バックグラウンド タスクのアクセス許可がオン](images/background-task-permissions-on.png)

![バックグラウンド タスクのアクセス許可がオフ](images/background-task-permissions-off.png)

<span data-ttu-id="568d7-127">アプリでは、[**BackgroundExecutionManager.RequestAccessAsync()**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.backgroundexecutionmanager.requestaccessasync.aspx) メソッドの呼び出しによって返される [**BackgroundAccessStatus**](https://docs.microsoft.com/en-us/uwp/api/windows.applicationmodel.background.backgroundaccessstatus) 列挙値で、現在のバックグラウンド アクティビティのアクセス許可の設定を確認できます。</span><span class="sxs-lookup"><span data-stu-id="568d7-127">In your app, you can use the [**BackgroundAccessStatus**](https://docs.microsoft.com/en-us/uwp/api/windows.applicationmodel.background.backgroundaccessstatus) enum value returned by a call to the [**BackgroundExecutionManager.RequestAccessAsync()**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.backgroundexecutionmanager.requestaccessasync.aspx) method to determine its current background activity permission setting.</span></span>

<span data-ttu-id="568d7-128">しかし、アプリに信頼できるアクティビティ管理が実装されていない場合、ユーザーはそのアプリに対するバックグラウンドのアクセス許可を一切拒否する可能性があります。このことは、開発者とユーザーの双方にとって望ましいことではありません。</span><span class="sxs-lookup"><span data-stu-id="568d7-128">All this is to say that if your app doesn't implement responsible background activity management, the user may deny background permissions to your app altogether, which is not desirable for either party.</span></span> <span data-ttu-id="568d7-129">アプリをバックグラウンドで実行するためのアクセス許可が拒否されているときに、ユーザーの操作を完了するためにバックグラウンド アクティビティが必要である場合は、ユーザーに通知し、設定アプリに誘導することができます。</span><span class="sxs-lookup"><span data-stu-id="568d7-129">If your app has been denied permission to run in the background but requires background activity to complete an action for the user, you can notify the user and point them to the Settings app.</span></span> <span data-ttu-id="568d7-130">これを行うには、[設定アプリを起動](https://docs.microsoft.com/en-us/windows/uwp/launch-resume/launch-settings-app)して、[バックグラウンド アプリ] ページや [バッテリ使用量の詳細] ページに移動します。</span><span class="sxs-lookup"><span data-stu-id="568d7-130">This can be accomplished by [Launching the Settings App](https://docs.microsoft.com/en-us/windows/uwp/launch-resume/launch-settings-app) to the Background Apps or Battery Usage Details page.</span></span>

## <a name="work-with-the-battery-saver-feature"></a><span data-ttu-id="568d7-131">バッテリー節約機能の使用</span><span class="sxs-lookup"><span data-stu-id="568d7-131">Work with the Battery Saver feature</span></span>
<span data-ttu-id="568d7-132">バッテリー節約機能は、ユーザーが設定で構成できるシステム レベルの機能です。</span><span class="sxs-lookup"><span data-stu-id="568d7-132">Battery Saver is a system-level feature that users can configure in Settings.</span></span> <span data-ttu-id="568d7-133">バッテリー レベルがユーザーによって定義されたしきい値を下回った場合、*[常に許可] に設定されたアプリを除いて*、すべてのアプリのバックグラウンド アクティビティが中断されます。</span><span class="sxs-lookup"><span data-stu-id="568d7-133">It cuts off all background activity of all apps when the battery level drops below a user-defined threshold, *except* for the background activity of apps that have been set to "Always allowed."</span></span>

<span data-ttu-id="568d7-134">アプリ内からバッテリー節約機能モードの状態を確認するには、[**PowerManager.EnergySaverStatus**](https://docs.microsoft.com/en-us/uwp/api/windows.system.power.energysaverstatus) プロパティを参照します。</span><span class="sxs-lookup"><span data-stu-id="568d7-134">Check the status of Battery Saver mode from within your app by referencing the [**PowerManager.EnergySaverStatus**](https://docs.microsoft.com/en-us/uwp/api/windows.system.power.energysaverstatus) property.</span></span> <span data-ttu-id="568d7-135">これは列挙値で、**EnergySaverStatus.Disabled**、**EnergySaverStatus.Off**、**EnergySaverStatus.On** のいずれかです。</span><span class="sxs-lookup"><span data-stu-id="568d7-135">It is an enum value: either **EnergySaverStatus.Disabled**, **EnergySaverStatus.Off** or **EnergySaverStatus.On**.</span></span> <span data-ttu-id="568d7-136">アプリがバックグラウンド アクティビティを必要とし、[常に許可] に設定されていない場合、特定の指定されたバックグラウンド タスクは、バッテリー節約機能がオフになるまで実行されないことをユーザーに通知することにより、**EnergySaverStatus.On** を処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="568d7-136">If your app requires background activity and is not set to "Always allowed" then it should handle **EnergySaverStatus.On** by notifying the user that the given background task(s) will not run until Battery Saver is off.</span></span> <span data-ttu-id="568d7-137">バックグラウンド アクティビティの管理は、バッテリー節約機能の主要目的ですが、バッテリー節約機能をオンにした場合、アプリはさらに電力を節約するための追加の調整を実行できます。</span><span class="sxs-lookup"><span data-stu-id="568d7-137">While background activity management is the primary purpose of the Battery Saver feature, your app can make additional adjustments to further conserve energy when Battery Saver is on.</span></span>  <span data-ttu-id="568d7-138">バッテリー節約機能がオンの場合、アプリは、アニメーションの使用を減らし、位置のポーリングを停止できるほか、同期やバックアップを遅らせることができます。</span><span class="sxs-lookup"><span data-stu-id="568d7-138">In the case where Battery Saver is on, your app could reduce its use of animations, stop location polling, or delay syncs and backups.</span></span> 

## <a name="further-optimize-background-tasks"></a><span data-ttu-id="568d7-139">バックグラウンド タスクのさらなる最適化</span><span class="sxs-lookup"><span data-stu-id="568d7-139">Further optimize background tasks</span></span>
<span data-ttu-id="568d7-140">バックグラウンド タスクを登録する場合に、さらにバッテリー効率を高めるためのその他の手順を次に示します。</span><span class="sxs-lookup"><span data-stu-id="568d7-140">The following are additional steps you can take when registering your background tasks to make them more battery-aware.</span></span>

### <a name="use-a-maintenance-trigger"></a><span data-ttu-id="568d7-141">メンテナンス トリガーの使用</span><span class="sxs-lookup"><span data-stu-id="568d7-141">Use a maintenance trigger</span></span> 
<span data-ttu-id="568d7-142">[**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.maintenancetrigger.aspx) オブジェクトを [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.systemtrigger.aspx) オブジェクトの代わりに使用すると、バックグラウンド タスクを開始するタイミングを判断できます。</span><span class="sxs-lookup"><span data-stu-id="568d7-142">A [**MaintenanceTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.maintenancetrigger.aspx) object can be used instead of a [**SystemTrigger**](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.background.systemtrigger.aspx) object to determine when a background task starts.</span></span> <span data-ttu-id="568d7-143">メンテナンス トリガーを使用するタスクは、デバイスが AC 電源に接続され、長時間実行できる場合のみ実行されます。</span><span class="sxs-lookup"><span data-stu-id="568d7-143">Tasks that use maintenance triggers will only run when the device is connected to AC power, and they are allowed to run for longer.</span></span> <span data-ttu-id="568d7-144">使い方については、「[メンテナンス トリガーの使用](https://msdn.microsoft.com/windows/uwp/launch-resume/use-a-maintenance-trigger)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="568d7-144">See [Use a maintenance trigger](https://msdn.microsoft.com/windows/uwp/launch-resume/use-a-maintenance-trigger) for instructions.</span></span>

### <a name="use-the-backgroundworkcostnothigh-system-condition-type"></a><span data-ttu-id="568d7-145">**BackgroundWorkCostNotHigh** システム条件型の使用</span><span class="sxs-lookup"><span data-stu-id="568d7-145">Use the **BackgroundWorkCostNotHigh** system condition type</span></span>
<span data-ttu-id="568d7-146">これにより、システム条件が満たされている場合のみバックグラウンド タスクが実行されます (詳しくは、「[バック グラウンド タスクを実行するための条件の設定](https://msdn.microsoft.com/windows/uwp/launch-resume/set-conditions-for-running-a-background-task)」をご覧ください)。</span><span class="sxs-lookup"><span data-stu-id="568d7-146">System conditions must be met in order for background tasks to run (see [Set conditions for running a background task](https://msdn.microsoft.com/windows/uwp/launch-resume/set-conditions-for-running-a-background-task) for more).</span></span> <span data-ttu-id="568d7-147">バック グラウンド作業のコストとは、バックグラウンド タスクの実行が消費電力にもたらす*相対的な*影響を示す尺度です。</span><span class="sxs-lookup"><span data-stu-id="568d7-147">The background work cost is a measurement that denotes the *relative* energy impact of running the background task.</span></span> <span data-ttu-id="568d7-148">デバイスが AC 電源に接続されているときに実行されるタスクは、**low**(低。バッテリーへの影響がわずかまたはなし) としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="568d7-148">A task running when the device is plugged into AC power would be marked as **low** (little/no impact on battery).</span></span> <span data-ttu-id="568d7-149">バッテリー電源で稼働していて、画面がオフのときに実行されるタスクは、**high** (高) としてマークされます。そのような場合には、デバイス上でほとんどプログラム アクティビティが行われていないため、バックグラウンド タスクの相対的コストが大きくなります。</span><span class="sxs-lookup"><span data-stu-id="568d7-149">A task running when the device is on battery power with the screen off is marked as **high** because there is presumably little program activity running on the device at the time, so the background task would have a greater relative cost.</span></span> <span data-ttu-id="568d7-150">バッテリー電源で稼働していて、画面が*オン*のときに実行されるタスクは、**medium** (中) としてマークされます。そのような場合には、おそらく何らかのプログラム アクティビティが既に実行されていて、バックグラウンド タスクはそのエネルギー コストを少し追加する程度であるためです。</span><span class="sxs-lookup"><span data-stu-id="568d7-150">A task running when the device is on battery power with the screen *on* is marked as **medium**, because there is presumably already some program activity running, and the background task would add a bit more to the energy cost.</span></span> <span data-ttu-id="568d7-151">**BackgroundWorkCostNotHigh** システム条件は、画面がオンになるか、デバイスが AC 電源に接続されるまで、単純にタスクの実行を遅らせます。</span><span class="sxs-lookup"><span data-stu-id="568d7-151">The **BackgroundWorkCostNotHigh** system condition simply delays your task's ability to run until either the screen is on or the device is connected to AC power.</span></span>

## <a name="test-battery-efficiency"></a><span data-ttu-id="568d7-152">バッテリー効率のテスト</span><span class="sxs-lookup"><span data-stu-id="568d7-152">Test battery efficiency</span></span>

<span data-ttu-id="568d7-153">必ず大きな消費電力のシナリオを使って、実際のデバイス上でアプリをテストしてください。</span><span class="sxs-lookup"><span data-stu-id="568d7-153">Be sure to test your app on real devices for any high-power-consumption scenarios.</span></span> <span data-ttu-id="568d7-154">多様なサービス上で、バッテリー節約機能のオンとオフを切り替え、さまざまなネットワーク強度の環境でアプリをテストすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="568d7-154">It's a good idea to test your app on many different devices, with Battery Saver on and off, and in environments of varying network strength.</span></span>

## <a name="related-topics"></a><span data-ttu-id="568d7-155">関連トピック</span><span class="sxs-lookup"><span data-stu-id="568d7-155">Related topics</span></span>

* [<span data-ttu-id="568d7-156">アウトプロセス バックグラウンド タスクの作成と登録</span><span class="sxs-lookup"><span data-stu-id="568d7-156">Create and register an out-of-process background task</span></span>](https://msdn.microsoft.com/windows/uwp/launch-resume/create-and-register-a-background-task)  
* [<span data-ttu-id="568d7-157">パフォーマンスの計画</span><span class="sxs-lookup"><span data-stu-id="568d7-157">Planning for performance</span></span>](https://msdn.microsoft.com/windows/uwp/debug-test-perf/planning-and-measuring-performance)  

