---
author: jwmsft
ms.assetid: 9899F6A0-7EDD-4988-A76E-79D7C0C58126
title: ユニバーサル Windows プラットフォーム コンポーネントと相互運用性の最適化
description: 相互運用性のパフォーマンス上の問題を回避しながら、ネイティブ型とマネージ型の間で UWP コンポーネントと相互運用機能を使うユニバーサル Windows プラットフォーム (UWP) アプリを作成します。
ms.author: jimwalk
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 726dc4aaa34b9b68aa198e236abcef57b78b21f4
ms.sourcegitcommit: 3257416aebb5a7b1515e107866806f8bd57845a8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/17/2018
ms.locfileid: "7161205"
---
# <a name="uwp-components-and-optimizing-interop"></a><span data-ttu-id="53b5c-104">UWPコンポーネントと相互運用性の最適化</span><span class="sxs-lookup"><span data-stu-id="53b5c-104">UWP Components and optimizing interop</span></span>


<span data-ttu-id="53b5c-105">相互運用性のパフォーマンス上の問題を回避しながら、ネイティブ型とマネージ型の間で UWP コンポーネントと相互運用機能を使うユニバーサル Windows プラットフォーム (UWP) アプリを作成します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-105">Create Universal Windows Platform (UWP) apps that use UWP Components and interop between native and managed types while avoiding interop performance issues.</span></span>

## <a name="best-practices-for-interoperability-with-uwp-components"></a><span data-ttu-id="53b5c-106">UWP コンポーネントとの相互運用性のベスト プラクティス (UWP)</span><span class="sxs-lookup"><span data-stu-id="53b5c-106">Best practices for interoperability with UWP Components</span></span>

<span data-ttu-id="53b5c-107">UWP コンポーネントを使うとアプリのパフォーマンスに大きな影響を与える場合があるので、注意してください。</span><span class="sxs-lookup"><span data-stu-id="53b5c-107">If you are not careful, using UWP Components can have a large impact on your app performance.</span></span> <span data-ttu-id="53b5c-108">このセクションでは、UWP コンポーネントを使用するアプリで高パフォーマンスを実現する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-108">This section discusses how to get good performance when your app uses UWP Components.</span></span>

### <a name="introduction"></a><span data-ttu-id="53b5c-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="53b5c-109">Introduction</span></span>

<span data-ttu-id="53b5c-110">相互運用性はアプリのパフォーマンスに大きな影響を与えますが、その存在を意識せずに利用していることも多いでしょう。</span><span class="sxs-lookup"><span data-stu-id="53b5c-110">Interoperability can have a big impact on performance and you might be using it without even realizing that you are.</span></span> <span data-ttu-id="53b5c-111">UWP は、開発者に代わって多数の相互運用性を処理し、生産性の向上と、他の言語で記述されたコードの再利用を実現します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-111">The UWP handles a lot of the interoperability for you so that you can be more productive and reuse code that was written in other languages.</span></span> <span data-ttu-id="53b5c-112">UWP の機能を活用することをお勧めしますが、一方でそれがパフォーマンスに与える影響を認識しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-112">We encourage you to take advantage of what the UWP does for you, but be aware that it can impact performance.</span></span> <span data-ttu-id="53b5c-113">このセクションでは、相互運用性がアプリのパフォーマンスに与える影響を軽減するためにできることについて説明します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-113">This section discusses things you can do to lessen the impact that interoperability has on your app's performance.</span></span>

<span data-ttu-id="53b5c-114">UWP には、UWP アプリの作成に使用できるすべての言語からアクセスできる型ライブラリが用意されています。</span><span class="sxs-lookup"><span data-stu-id="53b5c-114">The UWP has a library of types that are accessible from any language that can write a UWP app.</span></span> <span data-ttu-id="53b5c-115">C# または Microsoft Visual Basic で、UWP の型を .NET オブジェクトと同様に使用することができます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-115">You use the UWP types in C# or Microsoft Visual Basic the same way you use .NET objects.</span></span> <span data-ttu-id="53b5c-116">UWP コンポーネントにアクセスするために、プラットフォーム呼び出しメソッドを呼び出す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="53b5c-116">You don't need to make platform invoke method calls to access the UWP components.</span></span> <span data-ttu-id="53b5c-117">これによってアプリの作成作業が大幅に簡素化されますが、そのために相互運用性の利用が想像以上に発生していることを認識することが重要です。</span><span class="sxs-lookup"><span data-stu-id="53b5c-117">This makes writing your apps much less complex, but it is important to realize that there might be more interoperability occurring than you expect.</span></span> <span data-ttu-id="53b5c-118">UWP コンポーネントが C# または Visual Basic 以外の言語で記述されている場合、コンポーネントを使うためには相互運用性の境界を越えることが必要になります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-118">If a UWP component is written in a language other than C# or Visual Basic, you cross interoperability boundaries when you use that component.</span></span> <span data-ttu-id="53b5c-119">相互運用性の境界を越えると、アプリのパフォーマンスに影響する場合があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-119">Crossing interoperability boundaries can impact the performance of an app.</span></span>

<span data-ttu-id="53b5c-120">UWP アプリを C# または Visual Basic で開発する際、最もよく使用される API は、UWP API と UWP アプリ用 .NET API の 2 つです。</span><span class="sxs-lookup"><span data-stu-id="53b5c-120">When you develop a UWP app in C# or Visual Basic, the two most common set of APIs that you use are the UWP APIs and the .NET APIs for UWP apps.</span></span> <span data-ttu-id="53b5c-121">一般に、UWP で定義される型は "Windows." で始まる名前空間にあります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-121">In general, types that are defined in the UWP are in namespaces that begin with "Windows."</span></span> <span data-ttu-id="53b5c-122">また、.NET 型は "System." で始まる名前空間にあります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-122">and .NET types are in namespaces that begin with "System."</span></span> <span data-ttu-id="53b5c-123">ただし、例外もあります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-123">There are exceptions, though.</span></span> <span data-ttu-id="53b5c-124">UWP アプリ用 .NET に含まれる型は、使う際に相互運用性を必要としません。</span><span class="sxs-lookup"><span data-stu-id="53b5c-124">The types in .NET for UWP apps do not require interoperability when they are used.</span></span> <span data-ttu-id="53b5c-125">UWP を使っている領域のパフォーマンスが低い場合は、代わりに UWP アプリ用 .NET を使うことで良好なパフォーマンスを得られることがあります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-125">If you find that you have bad performance in an area that uses UWP, you might be able to use .NET for UWP apps instead to get better performance.</span></span>

<span data-ttu-id="53b5c-126">**注:** これらを c# または Visual Basic から使うには、相互運用性の境界を越えるために、windows 10 に同梱されている UWP コンポーネントの大部分は C++ で実装されています。</span><span class="sxs-lookup"><span data-stu-id="53b5c-126">**Note** Most of the UWP components that ship with Windows10 are implemented in C++ so you cross interoperability boundaries when you use them from C# or Visual Basic.</span></span> <span data-ttu-id="53b5c-127">通常の場合と同様に、アプリのパフォーマンスに UWP コンポーネントが影響を与えているかどうかを調査した後で、コードの変更に注力してください。</span><span class="sxs-lookup"><span data-stu-id="53b5c-127">As always, make sure to measure your app to see if using UWP components affects your app's performance before you invest in making changes to your code.</span></span>

<span data-ttu-id="53b5c-128">このトピックでは、"UWP コンポーネント" とは、C# または Visual Basic 以外の言語で記述されたコンポーネントを指すものとします。</span><span class="sxs-lookup"><span data-stu-id="53b5c-128">In this topic, when we say "UWP components", we mean components that are written in a language other than C# or Visual Basic.</span></span>

 

<span data-ttu-id="53b5c-129">UWP コンポーネントのプロパティにアクセスする、またはメソッドを呼び出す場合は、常に相互運用性のコストが発生します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-129">Each time you access a property or call a method on a UWP component, an interoperability cost is incurred.</span></span> <span data-ttu-id="53b5c-130">実際、UWP コンポーネントの作成は .NET オブジェクトの作成よりも高コストになります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-130">In fact, creating a UWP component is more costly than creating a .NET object.</span></span> <span data-ttu-id="53b5c-131">その理由は、UWP では、アプリの言語からコンポーネントの言語に移行するためのコードを実行する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="53b5c-131">The reasons for this are that the UWP must execute code that transitions from your app's language to the component's language.</span></span> <span data-ttu-id="53b5c-132">またコンポーネントにデータを渡す場合も、マネージ型とアンマネージ型の間でデータの変換が必要です。</span><span class="sxs-lookup"><span data-stu-id="53b5c-132">Also, if you pass data to the component, the data must be converted between managed and unmanaged types.</span></span>

### <a name="using-uwp-components-efficiently"></a><span data-ttu-id="53b5c-133">UWP コンポーネントを効率的に使う</span><span class="sxs-lookup"><span data-stu-id="53b5c-133">Using UWP Components efficiently</span></span>

<span data-ttu-id="53b5c-134">パフォーマンスを高める必要がある場合は、現在のコードにおける UWP コンポーネントの使用効率を可能な限り高めることができます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-134">If you find that you need to get better performance, you can ensure that your code uses UWP components as efficiently as possible.</span></span> <span data-ttu-id="53b5c-135">このセクションでは、UWP コンポーネントを使用する際のパフォーマンス向上のヒントをいくつか説明します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-135">This section discusses some tips for improving performance when you use UWP components.</span></span>

<span data-ttu-id="53b5c-136">短時間で大量の呼び出しが行われることで、パフォーマンスに対する影響が顕著に表れます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-136">It takes a significant number of calls in a short period of time for the performance impact to be noticeable.</span></span> <span data-ttu-id="53b5c-137">ビジネス ロジックおよびその他のマネージ コードからの UWP コンポーネントへの呼び出しをカプセル化している適切に設計されたアプリでは、相互運用性の大きなコストが発生することはありません。</span><span class="sxs-lookup"><span data-stu-id="53b5c-137">A well-designed application that encapsulates calls to UWP components from business logic and other managed code should not incur huge interoperability costs.</span></span> <span data-ttu-id="53b5c-138">UWP コンポーネントを使うことでアプリのパフォーマンスに影響が発生していることがテストによってわかった場合、このセクションのヒントを活用してパフォーマンスを向上してください。</span><span class="sxs-lookup"><span data-stu-id="53b5c-138">But if your tests indicate that using UWP components is affecting your app's performance, the tips discussed in this section help you improve performance.</span></span>

### <a name="consider-using-net-for-uwp-apps"></a><span data-ttu-id="53b5c-139">UWP アプリ用 .NET の使用を検討する</span><span class="sxs-lookup"><span data-stu-id="53b5c-139">Consider using .NET for UWP apps</span></span>

<span data-ttu-id="53b5c-140">あるタスクを、UWP または UWP アプリ用 .NET のどちらを使っても達成できる場合があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-140">There are certain cases where you can accomplish a task by using either UWP or .NET for UWP apps.</span></span> <span data-ttu-id="53b5c-141">こうした場合、.NET の型と UWP の型を組み合わせず、</span><span class="sxs-lookup"><span data-stu-id="53b5c-141">It is a good idea to try to not mix .NET types and UWP types.</span></span> <span data-ttu-id="53b5c-142">どちらか一方に揃えることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="53b5c-142">Try to stay in one or the other.</span></span> <span data-ttu-id="53b5c-143">たとえば、xml のストリームを解析するには、[**Windows.Data.Xml.Dom.XmlDocument**](https://msdn.microsoft.com/library/windows/apps/BR206173) 型 (UWP の型) または [**System.Xml.XmlReader**](https://msdn.microsoft.com/library/windows/apps/xaml/system.xml.xmlreader.aspx) 型 (.NET の型) のどちらも使えます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-143">For example, you can parse a stream of xml by using either the [**Windows.Data.Xml.Dom.XmlDocument**](https://msdn.microsoft.com/library/windows/apps/BR206173) type (a UWP type) or the [**System.Xml.XmlReader**](https://msdn.microsoft.com/library/windows/apps/xaml/system.xml.xmlreader.aspx) type (a .NET type).</span></span> <span data-ttu-id="53b5c-144">同じテクノロジの API をストリームとして使いましょう。</span><span class="sxs-lookup"><span data-stu-id="53b5c-144">Use the API that is from the same technology as the stream.</span></span> <span data-ttu-id="53b5c-145">たとえば、[**MemoryStream**](https://msdn.microsoft.com/library/windows/apps/xaml/system.io.memorystream.aspx) から xml を読み取る場合は両方が同じ .NET の型になるので、**System.Xml.XmlReader** 型を使います。</span><span class="sxs-lookup"><span data-stu-id="53b5c-145">For example, if you read xml from a [**MemoryStream**](https://msdn.microsoft.com/library/windows/apps/xaml/system.io.memorystream.aspx), use the **System.Xml.XmlReader** type, because both types are .NET types.</span></span> <span data-ttu-id="53b5c-146">ファイルから読み取る場合は、**Windows.Data.Xml.Dom.XmlDocument** 型を使います。これはファイル API と **XmlDocument** が UWP コンポーネントであるためです。</span><span class="sxs-lookup"><span data-stu-id="53b5c-146">If you read from a file, use the **Windows.Data.Xml.Dom.XmlDocument** type because the file APIs and **XmlDocument** are UWP components.</span></span>

### <a name="copy-window-runtime-objects-to-net-types"></a><span data-ttu-id="53b5c-147">Windows ランタイム オブジェクトを .NET 型にコピーする</span><span class="sxs-lookup"><span data-stu-id="53b5c-147">Copy Window Runtime objects to .NET types</span></span>

<span data-ttu-id="53b5c-148">UWP コンポーネントが UWP オブジェクトを返す場合、返されるオブジェクトを .NET オブジェクトにコピーすると便利な場合があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-148">When a UWP component returns a UWP object, it might be beneficial to copy the returned object into a .NET object.</span></span> <span data-ttu-id="53b5c-149">これが特に重要になる 2 つの場面は、コレクションとストリームを使うときです。</span><span class="sxs-lookup"><span data-stu-id="53b5c-149">Two places where this is especially important is when you're working with collections and streams.</span></span>

<span data-ttu-id="53b5c-150">コレクションを返す UWP API を呼び出して、その後そのコレクションを保存し何度もアクセスする場合、このコレクションを .NET コレクションにコピーし、それ以降は .NET バージョンを使うと便利です。</span><span class="sxs-lookup"><span data-stu-id="53b5c-150">If you call a UWP API that returns a collection and then you save and access that collection many times, it might be beneficial to copy the collection into a .NET collection and use the .NET version from then on.</span></span>

### <a name="cache-the-results-of-calls-to-uwp-components-for-later-use"></a><span data-ttu-id="53b5c-151">UWP コンポーネントへの呼び出しの結果を後のためにキャッシュする</span><span class="sxs-lookup"><span data-stu-id="53b5c-151">Cache the results of calls to UWP components for later use</span></span>

<span data-ttu-id="53b5c-152">UWP の型に繰り返しアクセスする代わりに、値をローカル変数に保存することでパフォーマンスを向上できる場合があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-152">You might be able to get better performance by saving values into local variables instead of accessing a UWP type multiple times.</span></span> <span data-ttu-id="53b5c-153">ループ内で値を使用する場合、この方法は特に有効です。</span><span class="sxs-lookup"><span data-stu-id="53b5c-153">This can be especially beneficial if you use a value inside of a loop.</span></span> <span data-ttu-id="53b5c-154">ローカル変数を使うことでアプリのパフォーマンスが向上できるかどうか、アプリを調べてください。</span><span class="sxs-lookup"><span data-stu-id="53b5c-154">Measure your app to see if using local variables improves your app's performance.</span></span> <span data-ttu-id="53b5c-155">キャッシュされた値を使用することでアプリが高速化されるのは、相互運用性に費やされる時間が短縮されるためです。</span><span class="sxs-lookup"><span data-stu-id="53b5c-155">Using cached values can increase your app's speed because it will spend less time on interoperability.</span></span>

### <a name="combine-calls-to-uwp-components"></a><span data-ttu-id="53b5c-156">UWP コンポーネントへの呼び出しを結合する</span><span class="sxs-lookup"><span data-stu-id="53b5c-156">Combine calls to UWP components</span></span>

<span data-ttu-id="53b5c-157">UWP オブジェクトの呼び出しは必要最小限にしてタスクを実行するようにしましょう。</span><span class="sxs-lookup"><span data-stu-id="53b5c-157">Try to complete tasks with the fewest number of calls to UWP objects as possible.</span></span> <span data-ttu-id="53b5c-158">たとえば、通常、ストリームのデータは少量を複数同時に読み取るよりも一度に大量に読み取ることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="53b5c-158">For example, it is usually better to read a large amount of data from a stream than to read small amounts at a time.</span></span>

<span data-ttu-id="53b5c-159">処理量が少なく呼び出し数が多くなる API の代わりに、処理をできる限り少ない呼び出しにバンドルする API を使います。</span><span class="sxs-lookup"><span data-stu-id="53b5c-159">Use APIs that bundle work in as few calls as possible instead of APIs that do less work and require more calls.</span></span> <span data-ttu-id="53b5c-160">たとえば、既定のコンストラクターを呼び出してプロパティを 1 つずつ割り当てるのではなく、複数のコンストラクターを呼び出すオブジェクトを作成して複数のプロパティを初期化することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="53b5c-160">For example, prefer to create an object by calling constructors that initialize multiple properties instead of calling the default constructor and assigning properties one at a time.</span></span>

### <a name="building-a-uwp-components"></a><span data-ttu-id="53b5c-161">UWP コンポーネントを構築する</span><span class="sxs-lookup"><span data-stu-id="53b5c-161">Building a UWP components</span></span>

<span data-ttu-id="53b5c-162">C++ または JavaScript で記述されたアプリで使用できる UWP コンポーネントを作成する場合、高いパフォーマンスを実現できるようにコンポーネントを設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-162">If you write a UWP Component that can be used by apps written in C++ or JavaScript, make sure that your component is designed for good performance.</span></span> <span data-ttu-id="53b5c-163">高パフォーマンスなアプリを実現するためのすべての推奨事項は、高パフォーマンスなコンポーネントを実現する際にも当てはまります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-163">All the suggestions for getting good performance in apps apply to getting good performance in components.</span></span> <span data-ttu-id="53b5c-164">コンポーネントを測定してトラフィックが大きいパターンを持つ API を特定し、それらの領域については、少ない呼び出しでユーザーが作業を実行できるようにする API を提供することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="53b5c-164">Measure your component to find out which APIs have high traffic patterns and for those areas, consider providing APIs that enable your users to do work with few calls.</span></span>

## <a name="keep-your-app-fast-when-you-use-interop-in-managed-code"></a><span data-ttu-id="53b5c-165">マネージ コードで相互運用性を使うときのアプリの速さの維持</span><span class="sxs-lookup"><span data-stu-id="53b5c-165">Keep your app fast when you use interop in managed code</span></span>

<span data-ttu-id="53b5c-166">UWP では、ネイティブ コードとマネージ コードの間で簡単に相互運用性を利用できますが、注意しないとパフォーマンスが低下する場合があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-166">The UWP makes it easy to interoperate between native and managed code, but if you're not careful it can incur performance costs.</span></span> <span data-ttu-id="53b5c-167">ここでは、マネージ UWP アプリで相互運用機能を使う場合に高いパフォーマンスを実現する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-167">Here we show you how to get good performance when you use interop in your managed UWP apps.</span></span>

<span data-ttu-id="53b5c-168">UWP では、各言語に UWP API のプロジェクションが用意されているため、開発者は XAML と任意の言語でアプリを記述できます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-168">The UWP allows developers to write apps using XAML with their language of choice thanks to the projections of the UWP APIs available in each language.</span></span> <span data-ttu-id="53b5c-169">アプリを C# または Visual Basic で記述する場合は、この便利さの一方で、相互運用性のコストが高くなります。これは、UWP API は通常ネイティブ コードで実装され、C# または Visual Basic から UWP を呼び出すときには、マネージドからネイティブ スタック フレームへの CLR の移行と、ネイティブ コードでアクセスできる表現への関数パラメーターのマーシャリングが必要になるためです。</span><span class="sxs-lookup"><span data-stu-id="53b5c-169">When writing an app in C# or Visual Basic, this convenience comes at an interop cost because the UWP APIs are usually implemented in native code, and any UWP invocation from C# or Visual Basic requires that the CLR transition from a managed to a native stack frame and marshal function parameters to representations accessible by native code.</span></span> <span data-ttu-id="53b5c-170">このオーバーヘッドは、ほとんどのアプリでは無視できます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-170">This overhead is negligible for most apps.</span></span> <span data-ttu-id="53b5c-171">ただし、アプリの重要なパスで UWP API の呼び出しを多数 (数十万回～数百万回) 実行する場合は、このコストが無視できなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-171">But when you make many calls (hundreds of thousands, to millions) to UWP APIs in the critical path of an app, this cost can become noticeable.</span></span> <span data-ttu-id="53b5c-172">一般に、言語間の移行に費やされる時間は、コードの他の部分の実行に対して小さくする必要があります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-172">In general you want to ensure that the time spent in transition between languages is small relative to the execution of the rest of your code.</span></span> <span data-ttu-id="53b5c-173">この概念を示したのが次の図です。</span><span class="sxs-lookup"><span data-stu-id="53b5c-173">This is illustrated by the following diagram.</span></span>

![相互運用に伴う移行がプログラムの実行時間を圧迫することは避けます。](images/interop-transitions.png)

<span data-ttu-id="53b5c-175">「[**Windows アプリ用 .NET**](https://msdn.microsoft.com/library/windows/apps/xaml/br230232.aspx)」に一覧の型では、C# または Visual Basic から使ったときにこの相互運用性コストの問題は発生しません。</span><span class="sxs-lookup"><span data-stu-id="53b5c-175">The types listed at [**.NET for Windows apps**](https://msdn.microsoft.com/library/windows/apps/xaml/br230232.aspx) don't incur this interop cost when used from C# or Visual Basic.</span></span> <span data-ttu-id="53b5c-176">一般に、"Windows." で始まる名前空間の型は </span><span class="sxs-lookup"><span data-stu-id="53b5c-176">As a rule of thumb, you can assume that types in namespaces which begin with “Windows.”</span></span> <span data-ttu-id="53b5c-177">UWP に属し、"System." で始まる名前空間の型は </span><span class="sxs-lookup"><span data-stu-id="53b5c-177">are part of the UWP, and types in namespaces which begin with “System.”</span></span> <span data-ttu-id="53b5c-178">.NET 型に属します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-178">are .NET types.</span></span> <span data-ttu-id="53b5c-179">UWP の型に対する単純な操作 (メモリの割り当て、プロパティへのアクセスなど) でも、相互運用性のコストが発生する点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="53b5c-179">Keep in mind that even simple usage of UWP types such as allocation or property access incurs an interop cost.</span></span>

<span data-ttu-id="53b5c-180">相互運用性のコストを最適化するためには、アプリの実行時間の大部分が相互運用に費やされているかどうかの評価と判断が必要です。</span><span class="sxs-lookup"><span data-stu-id="53b5c-180">You should measure your app and determine if interop is taking up a large portion of your apps execution time before optimizing your interop costs.</span></span> <span data-ttu-id="53b5c-181">Visual Studio でアプリのパフォーマンスを分析する際は、**[関数]** ビューを使い、UWP のメソッド呼び出しに費やされている包括時間を調べることで、相互運用性コストの上限を簡単に把握できます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-181">When analyzing your app’s performance with Visual Studio, you can easily get an upper bound on your interop costs by using the **Functions** view and looking at inclusive time spent in methods which call into the UWP.</span></span>

<span data-ttu-id="53b5c-182">相互運用性のオーバーヘッドによってアプリが低速になる場合は、実行頻度の高いコード パスでの UWP API の呼び出しを減らすことで、パフォーマンスを向上できます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-182">If your app is slow because of interop overhead, you can improve its performance by reducing calls to UWP APIs on hot code paths.</span></span> <span data-ttu-id="53b5c-183">たとえば、[**UIElements**](https://msdn.microsoft.com/library/windows/apps/BR208911) の位置とサイズを継続的に照会することで大量の物理的計算を実行しているゲーム エンジンは、**UIElements** から必要な情報をローカル変数に格納し、それらのキャッシュされた値に対して計算を行い、計算実行後に最終結果を **UIElements** にもう一度割り当てることによって、多くの時間を節約できます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-183">For example, a game engine that is doing tons of physics calculations by constantly querying the position and dimensions of [**UIElements**](https://msdn.microsoft.com/library/windows/apps/BR208911) can save a lot of time by storing the necessary info from **UIElements** to local variables, doing calculations on these cached values, and assigning the end result back to the **UIElements** after the calculations are done.</span></span> <span data-ttu-id="53b5c-184">別の例として、C# または Visual Basic のコードから頻繁にアクセスされるコレクションがある場合は、[**System.Collections**](https://msdn.microsoft.com/library/windows/apps/BR206657) 名前空間からのコレクションではなく、[**Windows.Foundation.Collections**](https://msdn.microsoft.com/library/windows/apps/xaml/system.collections.aspx) 名前空間からのコレクションを使ったほうが、より効率的です。</span><span class="sxs-lookup"><span data-stu-id="53b5c-184">Another example: if a collection is heavily accessed by C# or Visual Basic code, then it is more efficient to use a collection from the [**System.Collections**](https://msdn.microsoft.com/library/windows/apps/xaml/system.collections.aspx) namespace, rather than a collection from the [**Windows.Foundation.Collections**](https://msdn.microsoft.com/library/windows/apps/BR206657) namespace.</span></span> <span data-ttu-id="53b5c-185">UWP コンポーネントの呼び出しを結合することも検討に値します。これは、たとえば、[**Windows.Storage.BulkAccess**](https://msdn.microsoft.com/library/windows/apps/BR207676) API で実現できます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-185">You may also consider combining calls to UWP components; one example where this is possible is by using the [**Windows.Storage.BulkAccess**](https://msdn.microsoft.com/library/windows/apps/BR207676) APIs.</span></span>

### <a name="building-a-uwp-component"></a><span data-ttu-id="53b5c-186">UWP コンポーネントを構築する</span><span class="sxs-lookup"><span data-stu-id="53b5c-186">Building a UWP component</span></span>

<span data-ttu-id="53b5c-187">C++ または JavaScript で記述されたアプリに使う UWP コンポーネントを作成する場合は、高パフォーマンスを実現できるようにコンポーネントを設計します。</span><span class="sxs-lookup"><span data-stu-id="53b5c-187">If you write a UWP component for use in apps written in C++ or JavaScript, make sure that your component is designed for good performance.</span></span> <span data-ttu-id="53b5c-188">コンポーネントの API サーフェスによって、相互運用性の境界が決まるだけでなく、このトピックで取り上げた事柄をコンポーネントのユーザーがどの程度考慮しなければならないかも変わってきます。</span><span class="sxs-lookup"><span data-stu-id="53b5c-188">Your API surface defines your interop boundary and defines the degree to which your users will have to think about the guidance in this topic.</span></span> <span data-ttu-id="53b5c-189">コンポーネントを第三者に配布する場合は、この点が特に重要となります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-189">If you are distributing your components to other parties then this becomes especially important.</span></span>

<span data-ttu-id="53b5c-190">高パフォーマンスなアプリを実現するためのすべての推奨事項は、高パフォーマンスなコンポーネントを実現する際にも当てはまります。</span><span class="sxs-lookup"><span data-stu-id="53b5c-190">All of the suggestions for getting good performance in apps apply to getting good performance in components.</span></span> <span data-ttu-id="53b5c-191">コンポーネントを測定してトラフィックが大きいパターンを持つ API を特定し、それらの領域については、少ない呼び出しでユーザーが作業を実行できるようにする API を提供することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="53b5c-191">Measure your component to find out which APIs have high traffic patterns, and for those areas, consider providing APIs that enable your users to do work with few calls.</span></span> <span data-ttu-id="53b5c-192">UWP は、それを利用するアプリが相互運用性の境界を何度も行き来しなくても済むように、その設計には膨大な労力が費やされています。</span><span class="sxs-lookup"><span data-stu-id="53b5c-192">Significant effort was put into designing the UWP to allow apps to use it without requiring frequent crossing of the interop boundary.</span></span>

 

