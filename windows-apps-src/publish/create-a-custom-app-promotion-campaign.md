---
author: JnHs
description: Windows アプリ内で実行されるアプリの広告キャンペーンの作成に加えて、他のチャネルを使ってアプリを宣伝することができます。
title: カスタム アプリ プロモーション キャンペーンの作成
ms.assetid: 7C9BF73E-B811-4FC7-B1DD-4A0C2E17E95D
ms.author: wdg-dev-content
ms.date: 09/27/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10、UWP、カスタム、アプリ、プロモーション、キャンペーン
ms.localizationpriority: medium
ms.openlocfilehash: 13ee8d7482a2ce0716d4e133af329cd0ea42c184
ms.sourcegitcommit: 232543fba1fb30bb1489b053310ed6bd4b8f15d5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/25/2018
ms.locfileid: "4173951"
---
# <a name="create-a-custom-app-promotion-campaign"></a><span data-ttu-id="508e1-104">カスタム アプリ プロモーション キャンペーンの作成</span><span class="sxs-lookup"><span data-stu-id="508e1-104">Create a custom app promotion campaign</span></span>

<span data-ttu-id="508e1-105">Windows アプリ内で実行される[アプリの広告キャンペーン](create-an-ad-campaign-for-your-app.md)の作成に加えて、他のチャネルを使ってアプリを宣伝することもできます。</span><span class="sxs-lookup"><span data-stu-id="508e1-105">In addition to creating an [ad campaign for your app](create-an-ad-campaign-for-your-app.md) that will run in Windows apps, you can also promote your app using other channels.</span></span> <span data-ttu-id="508e1-106">たとえば、サード パーティのアプリ マーケティング プロバイダーを使ってアプリを宣伝したり、ソーシャル メディア サイトにアプリのリンクを投稿したりできます。</span><span class="sxs-lookup"><span data-stu-id="508e1-106">For example, you can promote your app using a third-party app marketing provider, or you might post links to your app on social media sites.</span></span> <span data-ttu-id="508e1-107">これらの活動は*カスタム キャンペーン*と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="508e1-107">These activities are called *custom campaigns*.</span></span>

<span data-ttu-id="508e1-108">アプリのカスタム キャンペーンを実行する場合、カスタム キャンペーンごとに異なる*キャンペーン ID* を含んだ異なる URL を作成することによって、各キャンペーンの相対的な成果を追跡できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-108">If you run custom campaigns for your app, you can track the relative performance of each campaign by creating a different URL for each custom campaign, where each URL contains a different *campaign ID*.</span></span> <span data-ttu-id="508e1-109">Windows 10 を実行しているユーザーがキャンペーン ID を含む URL をクリックすると、対応するカスタム キャンペーンに関連付けられて、そのデータが提供されます。</span><span class="sxs-lookup"><span data-stu-id="508e1-109">When a customer running Windows 10 clicks a URL that contains a campaign ID, Microsoft associates the click with the corresponding custom campaign and makes this data available to you.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="508e1-110">このデータは、Windows 10 ユーザーについてのみ追跡されます。</span><span class="sxs-lookup"><span data-stu-id="508e1-110">This data is only tracked for customers on Windows 10.</span></span> <span data-ttu-id="508e1-111">他のオペレーティング システムを使用しているユーザーも、アプリの内容へのリンクをたどることはできますが、それらのユーザーの活動に関するデータは含まれません。</span><span class="sxs-lookup"><span data-stu-id="508e1-111">Customers using other operating systems can still follow the link to your app's listing, but data about those customers' activities will not be included.</span></span>

<span data-ttu-id="508e1-112">カスタム キャンペーンに関連付けられる 2 種類の主要なデータがあります。アプリの Store 登録情報の*ページ ビュー*と*コンバージョン*です。</span><span class="sxs-lookup"><span data-stu-id="508e1-112">There are two main types of data associated with custom campaigns: *page views* for your app's Store listing, and *conversions*.</span></span> <span data-ttu-id="508e1-113">コンバージョンとは、カスタム キャンペーン ID を含む URL からアプリのストア登録情報ページを閲覧したユーザーが、結果としてアプリを取得することです。</span><span class="sxs-lookup"><span data-stu-id="508e1-113">A conversion is an app acquisition that results from a customer viewing your app's Store listing page from a URL that includes a custom campaign ID.</span></span> <span data-ttu-id="508e1-114">コンバージョンについて詳しくは、このトピックの「[アプリの取得がコンバージョンとして認められるしくみについて](#understanding-how-acquisitions-qualify-as-conversions)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="508e1-114">For more details about conversions, see [Understanding how app acquisitions qualify as conversions](#understanding-how-acquisitions-qualify-as-conversions) in this topic.</span></span>

<span data-ttu-id="508e1-115">次の方法でアプリのカスタム キャンペーンのパフォーマンス データが得られます。</span><span class="sxs-lookup"><span data-stu-id="508e1-115">You can retrieve custom campaign performance data for your app in the following ways:</span></span>

* <span data-ttu-id="508e1-116">アプリやアドオンのページ ビューとコンバージョンに関するデータは、デベロッパー センター ダッシュボードの [[取得] レポート](acquisitions-report.md)で、**[キャンペーン ID ごとのアプリ ページ ビューとコンバージョン]** グラフと **[キャンペーンのコンバージョン合計]** グラフから確認できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-116">You can view data about page views and conversions for your app or add-on from the **App page views and conversions by campaign ID** and **Total campaign conversions** charts in the [Acquisitions report](acquisitions-report.md) in the Dev Center dashboard.</span></span>
* <span data-ttu-id="508e1-117">アプリがユニバーサル Windows プラットフォーム (UWP) アプリの場合は、Windows SDK の API を使って、コンバージョンの基となるカスタム キャンペーン ID をプログラムによって取得できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-117">If your app is a Universal Windows Platform (UWP) app, you can use APIs in the Windows SDK to programmatically retrieve the custom campaign ID that resulted in a conversion.</span></span>

## <a name="example-custom-campaign-scenario"></a><span data-ttu-id="508e1-118">カスタム キャンペーンのシナリオの例</span><span class="sxs-lookup"><span data-stu-id="508e1-118">Example custom campaign scenario</span></span>

<span data-ttu-id="508e1-119">新しいゲームの作成を終えたゲーム開発者がおり、このゲームをこの開発者の以前のゲームのプレーヤーに宣伝したいと考えているとします。</span><span class="sxs-lookup"><span data-stu-id="508e1-119">Consider a game developer who has finished building a new game and would like to promote it to players of her existing games.</span></span> <span data-ttu-id="508e1-120">開発者は、自分の Facebook のページで新しいゲームのリリースに関するお知らせを投稿し、その中にこのゲームの Store 登録情報へのリンクを含めます。</span><span class="sxs-lookup"><span data-stu-id="508e1-120">She posts the announcement of the new game release on her Facebook page, including a link to the game's Store listing.</span></span> <span data-ttu-id="508e1-121">また、Twitter でも多くのプレーヤーがこの開発者をフォローしているため、このゲームの Store 登録情報へのリンクを含むお知らせをツイートします。</span><span class="sxs-lookup"><span data-stu-id="508e1-121">Many of her players also follow her on Twitter, so she also tweets an announcement with the link to the game's Store listing.</span></span>

<span data-ttu-id="508e1-122">これらの各プロモーション チャネルの成果を追跡するためには、このゲームの Store 登録情報への URL を 2 種類作成します。</span><span class="sxs-lookup"><span data-stu-id="508e1-122">To track the success of each of these promotion channels, the developer creates two variants of the URL to the game's Store listing:</span></span>

* <span data-ttu-id="508e1-123">Facebook のページに投稿する URL には、カスタム キャンペーン ID を含めます。</span><span class="sxs-lookup"><span data-stu-id="508e1-123">The URL she will post to her Facebook page includes the custom campaign ID</span></span> `my-facebook-campaign`

* <span data-ttu-id="508e1-124">Twitter に投稿する URL には、カスタム キャンペーン ID を含めます。</span><span class="sxs-lookup"><span data-stu-id="508e1-124">The URL she will post to Twitter includes the custom campaign ID</span></span> `my-twitter-campaign`

<span data-ttu-id="508e1-125">Facebook や Twitter のフォロワーがその URL をクリックすると、それが記録されて対応するカスタム キャンペーンに関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="508e1-125">As her Facebook and Twitter followers click the URLs, Microsoft tracks each click and associates it with the corresponding custom campaign.</span></span> <span data-ttu-id="508e1-126">以降、ゲームおよびアドオンの購入に関して要件を満たすものは、カスタム キャンペーンと関連付けられてコンバージョンとして報告されます。</span><span class="sxs-lookup"><span data-stu-id="508e1-126">Subsequent qualifying acquisitions of the game and any add-on purchases are associated with the custom campaign and reported as conversions.</span></span>

<span id="conversions" />

## <a name="understanding-how-acquisitions-qualify-as-conversions"></a><span data-ttu-id="508e1-127">取得がコンバージョンとして認められるしくみについて</span><span class="sxs-lookup"><span data-stu-id="508e1-127">Understanding how acquisitions qualify as conversions</span></span>

<span data-ttu-id="508e1-128">カスタム キャンペーンの*コンバージョン*とは、カスタム キャンペーンによって宣伝された URL をクリックしたユーザーが、結果としてアプリを取得することです。</span><span class="sxs-lookup"><span data-stu-id="508e1-128">A custom campaign *conversion* is an acquisition that results from a customer clicking a URL that is promoted via a custom campaign.</span></span> <span data-ttu-id="508e1-129">デベロッパー センター ダッシュボードの [[取得] レポート](acquisitions-report.md)の **[キャンペーン ID ごとのアプリ ページ ビューとコンバージョン]** グラフと **[キャンペーンのコンバージョン合計]** グラフでコンバージョンであると認められるシナリオと、[プログラムによってキャンペーン ID を取得](#programmatically)した場合にコンバージョンであると認められるシナリオは異なります。</span><span class="sxs-lookup"><span data-stu-id="508e1-129">There are different scenarios for qualifying as a conversion for the **App page views and conversions by campaign ID** and **Total campaign conversions** charts in the [Acquisitions report](acquisitions-report.md) in the Dev Center dashboard and for qualifying as a conversion for [programmatically retrieving the campaign ID](#programmatically).</span></span>

### <a name="qualifying-conversions-in-the-dashboard-report"></a><span data-ttu-id="508e1-130">ダッシュボード レポートでコンバージョンと認められる条件</span><span class="sxs-lookup"><span data-stu-id="508e1-130">Qualifying conversions in the dashboard report</span></span>

<span data-ttu-id="508e1-131">[[取得] レポート](acquisitions-report.md)の **[キャンペーン ID ごとのアプリ ページ ビューとコンバージョン]** グラフと **[キャンペーンのコンバージョン合計]** グラフで、コンバージョンとして認められるシナリオは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="508e1-131">The following scenarios qualify as a conversion for the **App page views and conversions by campaign ID** and **Total campaign conversions** charts in the [Acquisitions report](acquisitions-report.md):</span></span>

* <span data-ttu-id="508e1-132">ユーザー (*認識されている Microsoft アカウントを使っているかどうかにかかわらない*) が、カスタム キャンペーン ID が含まれているアプリの URL をクリックし、アプリのストア登録情報のページにリダイレクトされ、</span><span class="sxs-lookup"><span data-stu-id="508e1-132">A customer *with or without a recognized Microsoft account* clicks an app URL that contains a custom campaign ID and is redirected to the Store listing for the app.</span></span> <span data-ttu-id="508e1-133">その後、同じユーザーが、カスタム キャンペーン ID が含まれている Microsoft Store の URL を最初にクリックしてから 24 時間以内にアプリを取得している。</span><span class="sxs-lookup"><span data-stu-id="508e1-133">Then, that same customer acquires the app within 24 hours after they first clicked the Microsoft Store URL with the custom campaign ID.</span></span>

* <span data-ttu-id="508e1-134">カスタム キャンペーン ID が含まれている Windows ストアの URL をクリックしたのとは別のデバイスでアプリを取得した場合には、URL をクリックしたときと同じ Microsoft アカウントを使ってユーザーがサインインしている場合に限り、コンバージョンとしてカウントされる。</span><span class="sxs-lookup"><span data-stu-id="508e1-134">If the customer acquires the app on a different device than the one on which they clicked the URL with the custom campaign ID, the conversion will only be counted if the customer is signed in with the same Microsoft account as when they clicked the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="508e1-135">カスタム キャンペーンのコンバージョンとしてカウントされるアプリの取得については、アプリ内で購入されたアドオンも、同じカスタム キャンペーンのコンバージョンとしてカウントされます。</span><span class="sxs-lookup"><span data-stu-id="508e1-135">For app acquisitions that are counted as conversions for a custom campaign, any add-on purchases in that app are also counted as conversions for the same custom campaign.</span></span>

### <a name="qualifying-conversions-when-programmatically-retrieving-the-campaign-id"></a><span data-ttu-id="508e1-136">プログラムによってキャンペーン ID を取得する場合にコンバージョンと認められる条件</span><span class="sxs-lookup"><span data-stu-id="508e1-136">Qualifying conversions when programmatically retrieving the campaign ID</span></span>

<span data-ttu-id="508e1-137">アプリに関連付けられているキャンペーン ID をプログラムによって取得するときに、コンバージョンであると認められるには、次の条件を満たす必要があります。</span><span class="sxs-lookup"><span data-stu-id="508e1-137">To qualify as a conversion when programmatically retrieving the campaign ID associated with the app, the following conditions must be met:</span></span>

* <span data-ttu-id="508e1-138">**Windows 10 バージョン 1607 以降**を実行しているデバイスの場合: ユーザー (認識されている Microsoft アカウントを使ってサインインしているかどうかにかかわらない) が、カスタム キャンペーン ID が含まれている URL をクリックし、アプリのストア登録情報ページにリダイレクトされ、</span><span class="sxs-lookup"><span data-stu-id="508e1-138">On a device running **Windows 10, version 1607, or later**: A customer (whether signed in to a recognized Microsoft account or not) clicks a URL that contains a custom campaign ID and is redirected to the Store listing page for the app.</span></span> <span data-ttu-id="508e1-139">URL をクリックした結果としてストア登録情報を閲覧している最中にアプリを取得している。</span><span class="sxs-lookup"><span data-stu-id="508e1-139">The customer acquires the app while viewing the Store listing as a result of clicking the URL.</span></span>

* <span data-ttu-id="508e1-140">**Windows 10 バージョン 1511 以前**を実行しているデバイスの場合: ユーザー (認識されている Microsoft アカウントを使ってサインインしている) が、カスタム キャンペーン ID が含まれている URL をクリックし、アプリのストア登録情報ページにリダイレクトされ、</span><span class="sxs-lookup"><span data-stu-id="508e1-140">On a device running **Windows 10, version 1511, or earlier**: A customer (who must be signed in with a recognized Microsoft account) clicks a URL that contains a custom campaign ID and is redirected to the Store listing page for the app.</span></span> <span data-ttu-id="508e1-141">URL をクリックした結果としてストア登録情報を閲覧している最中にアプリを取得している。</span><span class="sxs-lookup"><span data-stu-id="508e1-141">The customer acquires the app while viewing the Store listing as a result of clicking the URL.</span></span> <span data-ttu-id="508e1-142">Windows 10 のこれらのバージョンでは、キャンペーン ID をプログラムによって取得するときに、アプリの取得がコンバージョンであると認められるには、認識されている Microsoft アカウントを使ってユーザーがサインインしている必要があります。</span><span class="sxs-lookup"><span data-stu-id="508e1-142">On these versions of Windows 10, the user must be signed in with a recognized Microsoft account in order for the acquisition to qualify as a conversion when programmatically retrieving the campaign ID.</span></span>

> [!NOTE]
> <span data-ttu-id="508e1-143">ユーザーがストア登録情報ページから離れても、(同じデバイスを使うか、別のデバイスの場合は同じ Microsoft アカウントでサインインした状態で) 24 時間以内にページに再びアクセスし、アプリを取得した場合、これは [[取得] レポート](acquisitions-report.md)の **[キャンペーン ID ごとのアプリ ページ ビューとコンバージョン]** グラフと **[キャンペーンのコンバージョン合計]** グラフでコンバージョンとして**認められます**。</span><span class="sxs-lookup"><span data-stu-id="508e1-143">If the customer leaves the Store listing page, but returns to the page with 24 hours (either on the same device, or on a different device when signed in with the same a Microsoft account) and acquires the app, this **will** qualify as a conversion in the **App page views and conversions by campaign ID** and **Total campaign conversions** charts in the [Acquisitions report](acquisitions-report.md).</span></span> <span data-ttu-id="508e1-144">ただし、プログラムによってキャンペーン ID を取得した場合にはコンバージョンとして**認められません**。</span><span class="sxs-lookup"><span data-stu-id="508e1-144">However, this **will not** qualify as a conversion if you programmatically retrieve the campaign ID.</span></span>

## <a name="embed-a-custom-campaign-id-to-your-apps-microsoft-store-page-url"></a><span data-ttu-id="508e1-145">アプリの Microsoft Store のページの URL にカスタム キャンペーン ID を埋め込む</span><span class="sxs-lookup"><span data-stu-id="508e1-145">Embed a custom campaign ID to your app's Microsoft Store page URL</span></span>

<span data-ttu-id="508e1-146">カスタム キャンペーン ID が含まれているアプリの Microsoft Store のページの URL を作成するには、次の手順を実施します。</span><span class="sxs-lookup"><span data-stu-id="508e1-146">To create a Microsoft Store page URL for your app with a custom campaign ID:</span></span>

1.  <span data-ttu-id="508e1-147">カスタム キャンペーン用の ID 文字列を作成します。</span><span class="sxs-lookup"><span data-stu-id="508e1-147">Create an ID string for your custom campaign.</span></span> <span data-ttu-id="508e1-148">この文字列は最大 100 文字にできますが、簡単に識別できる短いキャンペーン ID を定義することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="508e1-148">This string can contain up to 100 characters, although we recommend that you define short campaign IDs that are easily identifiable.</span></span>

   > [!NOTE]
   > <span data-ttu-id="508e1-149">キャンペーン ID 文字列は、他の開発者がその開発者のアプリの [[取得] レポート](acquisitions-report.md)を閲覧するときに、表示される場合があります。</span><span class="sxs-lookup"><span data-stu-id="508e1-149">The campaign ID string may be visible to other developers when they view the [Acquisitions report](acquisitions-report.md) for their apps.</span></span> <span data-ttu-id="508e1-150">これは、ユーザーがカスタム キャンペーン ID をクリックしてストアに入り、同じセッション中に別の開発者のアプリを購入した場合、つまり、そのコンバージョンにそのカスタム キャンペーン ID が寄与した場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="508e1-150">This can occur when a customer clicks your custom campaign ID to enter the Store and purchases another developer’s app within the same session, thus attributing that conversion to your campaign ID.</span></span> <span data-ttu-id="508e1-151">その開発者には、最初にこのキャンペーン ID をクリックした結果として発生したその開発者のアプリのコンバージョン数とキャンペーン ID の名前が表示されますが、このキャンペーン ID をクリックしてキャンペーン ID の所有者 (またはその他の開発者) のアプリを購入したユーザー数についてのデータは表示されません。</span><span class="sxs-lookup"><span data-stu-id="508e1-151">That developer will see how many conversions of their own app resulted from an initial click on your campaign ID, including the name of the campaign ID, but they will not see any data about how many users purchased your own apps (or apps from any other developers) after clicking your campaign ID.</span></span>

2.  <span data-ttu-id="508e1-152">HTML またはプロトコル形式でアプリの Store 登録情報のリンクを取得します。</span><span class="sxs-lookup"><span data-stu-id="508e1-152">Get the link for your app's Store listing in HTML or protocol format.</span></span>

    * <span data-ttu-id="508e1-153">どのオペレーティング システムであっても、ユーザーがブラウザーからアプリの Web ベースのストア登録情報に移動できるようにするには、HTML URL を使います。</span><span class="sxs-lookup"><span data-stu-id="508e1-153">Use the HTML URL if you want customers to navigate to your app's web-based Store listing in a browser on any operating system.</span></span> <span data-ttu-id="508e1-154">Windows デバイスでは、ストア アプリも起動して、アプリの登録情報を表示します。</span><span class="sxs-lookup"><span data-stu-id="508e1-154">On Windows devices, the Store app will also launch and display your app's listing.</span></span> <span data-ttu-id="508e1-155">この URL の形式は **`https://www.microsoft.com/store/apps/*your app ID*`** です。</span><span class="sxs-lookup"><span data-stu-id="508e1-155">This URL has the format **`https://www.microsoft.com/store/apps/*your app ID*`**.</span></span> <span data-ttu-id="508e1-156">たとえば、Skype 用の HTML URL は `https://www.microsoft.com/store/apps/9wzdncrfj364` になります。</span><span class="sxs-lookup"><span data-stu-id="508e1-156">For example, the HTML URL for Skype is `https://www.microsoft.com/store/apps/9wzdncrfj364`.</span></span> <span data-ttu-id="508e1-157">この URL は、[[アプリ ID]](view-app-identity-details.md#link-to-your-apps-listing) ページで確認できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-157">You can find this URL on your [App identity](view-app-identity-details.md#link-to-your-apps-listing) page.</span></span>

    * <span data-ttu-id="508e1-158">UWP アプリがインストールされたデバイスやコンピューター上で実行されている他の Windows アプリ内でアプリを宣伝するか、ユーザーが Microsoft Store をサポートするデバイスを使用していることが確かな場合は、プロトコル形式を使います。</span><span class="sxs-lookup"><span data-stu-id="508e1-158">Use the protocol format if you are promoting your app from within other Windows apps that are running on a device or computer with the UWP app installed, or when you know that your customers are on a device which supports the Microsoft Store.</span></span> <span data-ttu-id="508e1-159">このリンクは、ブラウザーを開かずに直接アプリのストア登録情報に移動します。</span><span class="sxs-lookup"><span data-stu-id="508e1-159">This link will go directly to your app's Store listing without opening a browser.</span></span> <span data-ttu-id="508e1-160">この URL の形式は **`ms-windows-store://pdp/?PRODUCTID=*your app id*`** です。</span><span class="sxs-lookup"><span data-stu-id="508e1-160">This URL has the format **`ms-windows-store://pdp/?PRODUCTID=*your app id*`**.</span></span> <span data-ttu-id="508e1-161">たとえば、Skype 用のプロトコル URL は `ms-windows-store://pdp/?PRODUCTID=9wzdncrfj364` になります。</span><span class="sxs-lookup"><span data-stu-id="508e1-161">For example, the protocol URL for Skype is `ms-windows-store://pdp/?PRODUCTID=9wzdncrfj364`.</span></span>

3.  <span data-ttu-id="508e1-162">アプリの URL の末尾に次の文字列を追加します。</span><span class="sxs-lookup"><span data-stu-id="508e1-162">Append the following string to the end of the URL for your app:</span></span>

    * <span data-ttu-id="508e1-163">HTML 形式の URL の場合は **?cid=`?cid=*my custom campaign ID*`** を追加します。</span><span class="sxs-lookup"><span data-stu-id="508e1-163">For an HTML format URL, append **`?cid=*my custom campaign ID*`**.</span></span> <span data-ttu-id="508e1-164">たとえば、Skype でキャンペーン ID の値が **custom\_campaign** であるキャンペーンを紹介する場合、このキャンペーン ID を含む新しい URL は `https://www.microsoft.com/store/apps/skype/9wzdncrfj364?cid=custom\_campaign` になります。</span><span class="sxs-lookup"><span data-stu-id="508e1-164">For example, if Skype introduces a campaign ID with the value **custom\_campaign**, the new URL including the campaign ID would be: `https://www.microsoft.com/store/apps/skype/9wzdncrfj364?cid=custom\_campaign`.</span></span>

    * <span data-ttu-id="508e1-165">プロトコル形式の URL の場合は **`&cid=*my custom campaign ID*`** を追加します。</span><span class="sxs-lookup"><span data-stu-id="508e1-165">For a protocol format URL, append **`&cid=*my custom campaign ID*`**.</span></span> <span data-ttu-id="508e1-166">たとえば、Skype でキャンペーン ID の値が **custom\_campaign** であるキャンペーンを紹介する場合、このキャンペーン ID を含む新しいプロトコル URL は `ms-windows-store://pdp/?PRODUCTID=9wzdncrfj364&cid=custom\_campaign` になります。</span><span class="sxs-lookup"><span data-stu-id="508e1-166">For example, if Skype introduces a campaign ID with the value **custom\_campaign**, the new protocol URL including the campaign ID would be: `ms-windows-store://pdp/?PRODUCTID=9wzdncrfj364&cid=custom\_campaign`.</span></span>

<span id="programmatically" />

## <a name="programmatically-retrieve-the-custom-campaign-id-for-an-app"></a><span data-ttu-id="508e1-167">アプリのカスタム キャンペーン ID をプログラムで取得する</span><span class="sxs-lookup"><span data-stu-id="508e1-167">Programmatically retrieve the custom campaign ID for an app</span></span>

<span data-ttu-id="508e1-168">アプリが UWP アプリの場合、アプリの取得に関連付けられているカスタム キャンペーン ID を、Windows SDK の API を使ってプログラムで取得できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-168">If your app is a UWP app, you can programmatically retrieve the custom campaign ID associated with an app's acquisition by using APIs in the Windows SDK.</span></span> <span data-ttu-id="508e1-169">これらの API によって、多くの分析シナリオや収益化シナリオが可能になります。</span><span class="sxs-lookup"><span data-stu-id="508e1-169">These APIs make many analytics and monetization scenarios possible.</span></span> <span data-ttu-id="508e1-170">たとえば、現在のユーザーが Facebook のキャンペーンによってアプリを見つけた後でアプリを取得したかどうかがわかるので、それに合わせてアプリのエクスペリエンスをカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="508e1-170">For example, you can find out if the current user acquired your app after discovering it through your Facebook campaign, and then customize the app experience accordingly.</span></span> <span data-ttu-id="508e1-171">また、サード パーティのアプリ マーケティング プロバイダーを使っている場合は、プロバイダーにデータを送ることができます。</span><span class="sxs-lookup"><span data-stu-id="508e1-171">Alternatively, if you are using a third-party app marketing provider, you can send data back to the provider.</span></span>

<span data-ttu-id="508e1-172">これらの API は、ユーザーがキャンペーン ID が埋め込まれた URL をクリックし、アプリの Microsoft Store のページを閲覧し、Store 登録情報ページから離れることなくアプリを取得する場合にのみキャンペーン ID 文字列を返します。</span><span class="sxs-lookup"><span data-stu-id="508e1-172">These APIs will return a campaign ID string only if the customer clicked your URL with the embedded campaign ID, viewed the Microsoft Store page for your app, and then acquires your app without leaving the Store listing page.</span></span> <span data-ttu-id="508e1-173">ユーザーがこのページから離れ、後で戻ってアプリを取得する場合、これらの API では[コンバージョン](#conversions)として認められません。</span><span class="sxs-lookup"><span data-stu-id="508e1-173">If the user leaves the page and then later returns and acquires the app, this will not [qualify as a conversion](#conversions) when using these APIs.</span></span>

<span data-ttu-id="508e1-174">アプリが対象とする Windows 10 のバージョンに応じて、異なる API が用意されています。</span><span class="sxs-lookup"><span data-stu-id="508e1-174">There are different APIs for you to use depending on the version of Windows 10 that your app targets:</span></span>

* <span data-ttu-id="508e1-175">Windows 10 バージョン 1607 以降: **Windows.Services.Store** 名前空間の [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) クラスを使います。</span><span class="sxs-lookup"><span data-stu-id="508e1-175">Windows 10, version 1607, or later: Use the [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) class in the **Windows.Services.Store** namespace.</span></span> <span data-ttu-id="508e1-176">この API を使用するときは、認識されている Microsoft アカウントを使ってユーザーがサインインしているかどうかに関係なく、[条件を満たしている取得](#conversions)についてカスタム キャンペーン ID を取得できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-176">When using this API, you can retrieve custom campaign IDs for any [qualified acquisitions](#conversions), whether or not the user is signed in with a recognized Microsoft account.</span></span>

* <span data-ttu-id="508e1-177">Windows 10 バージョン 1511 以前の場合: **Windows.ApplicationModel.Store**名前空間の [**CurrentApp**](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp) クラスを使います。</span><span class="sxs-lookup"><span data-stu-id="508e1-177">Windows 10, version 1511, or earlier: Use the [**CurrentApp**](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp) class in the **Windows.ApplicationModel.Store** namespace.</span></span> <span data-ttu-id="508e1-178">この API を使用するときは、認識されている Microsoft アカウントを使ってユーザーがサインインしている場合にのみ、[条件を満たしている取得](#conversions)についてカスタム キャンペーン ID を取得できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-178">When using this API, you can only retrieve custom campaign IDs for [qualified acquisitions](#conversions) where the user is signed in with a recognized Microsoft account.</span></span>

> [!NOTE]
> <span data-ttu-id="508e1-179">**Windows.ApplicationModel.Store** 名前空間は、すべてのバージョンの Windows 10 で利用できますが、アプリが Windows 10 バージョン 1607 以降をターゲットにしている場合は、**Windows.Services.Store** 名前空間の API を使うことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="508e1-179">Although the **Windows.ApplicationModel.Store** namespace is available in all versions of Windows 10, we recommend that you use the APIs in the **Windows.Services.Store** namespace if your app targets Windows 10, version 1607, or later.</span></span> <span data-ttu-id="508e1-180">これらの名前空間の違いについて詳しくは、「[アプリ内購入と試用版](../monetize/in-app-purchases-and-trials.md#choose-namespace)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="508e1-180">For more information about the differences between these namespaces, see [In-app purchases and trials](../monetize/in-app-purchases-and-trials.md#choose-namespace).</span></span> <span data-ttu-id="508e1-181">次のコード例は、同じプロジェクトで両方の API を使用するコードを構築する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="508e1-181">The following code example shows how to structure your code to use both APIs in the same project.</span></span>

### <a name="code-example"></a><span data-ttu-id="508e1-182">コードの例</span><span class="sxs-lookup"><span data-stu-id="508e1-182">Code example</span></span>

<span data-ttu-id="508e1-183">次のコード例は、カスタム キャンペーン ID を取得する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="508e1-183">The following code example shows how to retrieve the custom campaign ID.</span></span> <span data-ttu-id="508e1-184">この例では、[バージョン アダプティブ コード](../debug-test-perf/version-adaptive-code.md)を使用することによって、**Windows.Services.Store** 名前空間と **Windows.ApplicationModel.Store** 名前空間の両方の API のセットを使用しています。</span><span class="sxs-lookup"><span data-stu-id="508e1-184">This example uses both sets of APIs in the **Windows.Services.Store** and **Windows.ApplicationModel.Store** namespaces by using [version adaptive code](../debug-test-perf/version-adaptive-code.md).</span></span> <span data-ttu-id="508e1-185">この手順に従うことで、Windows 10 のすべてのバージョンでコードを実行できます。</span><span class="sxs-lookup"><span data-stu-id="508e1-185">By following this process, your code can run on any version of Windows 10.</span></span> <span data-ttu-id="508e1-186">このコードを使用するには、プロジェクトのターゲット OS のバージョンが、**Windows 10 Anniversary Edition (10.0、ビルド 14394)** 以降である必要があります。ただし、最小 OS バージョンは以前のバージョンにすることができます。</span><span class="sxs-lookup"><span data-stu-id="508e1-186">To use this code, the target OS version of your project must be **Windows 10 Anniversary Edition (10.0; Build 14394)** or later, although the minimum OS version can be an earlier version.</span></span>

``` csharp
// This example assumes the code file has using statements for
// System.Linq, System.Threading.Tasks, Windows.Data.Json,
// and Windows.Services.Store.
public async Task<string> GetCampaignId()
{
    // Use APIs in the Windows.Services.Store namespace if they are available
    // (the app is running on a device with Windows 10, version 1607, or later).
    if (Windows.Foundation.Metadata.ApiInformation.IsTypePresent(
         "Windows.Services.Store.StoreContext"))
    {
        StoreContext context = StoreContext.GetDefault();

        // Try to get the campaign ID for users with a recognized Microsoft account.
        StoreProductResult result = await context.GetStoreProductForCurrentAppAsync();
        if (result.Product != null)
        {
            StoreSku sku = result.Product.Skus.FirstOrDefault(s => s.IsInUserCollection);

            if (sku != null)
            {
                return sku.CollectionData.CampaignId;
            }
        }

        // Try to get the campaign ID from the license data for users without a
        // recognized Microsoft account.
        StoreAppLicense license = await context.GetAppLicenseAsync();
        JsonObject json = JsonObject.Parse(license.ExtendedJsonData);
        if (json.ContainsKey("customPolicyField1"))
        {
            return json["customPolicyField1"].GetString();
        }

        // No campaign ID was found.
        return String.Empty;
    }
    // Fall back to using APIs in the Windows.ApplicationModel.Store namespace instead
    // (the app is running on a device with Windows 10, version 1577, or earlier).
    else
    {
#if DEBUG
        return await Windows.ApplicationModel.Store.CurrentAppSimulator.GetAppPurchaseCampaignIdAsync();
#else
        return await Windows.ApplicationModel.Store.CurrentApp.GetAppPurchaseCampaignIdAsync() ;
#endif
    }
}
```

<span data-ttu-id="508e1-187">このコードは、次の処理を実行します。</span><span class="sxs-lookup"><span data-stu-id="508e1-187">This code does the following:</span></span>

1. <span data-ttu-id="508e1-188">まず、現在のデバイスで **Windows.Services.Store** 名前空間の [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) クラスが利用可能かどうか (つまり、デバイスで Windows 10 バージョン1607 以降が実行されているかどうか) を確認します。</span><span class="sxs-lookup"><span data-stu-id="508e1-188">First, it checks to see if the [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) class in the **Windows.Services.Store** namespace is available on the current device (this means the device is running Windows 10, version 1607, or later).</span></span> <span data-ttu-id="508e1-189">利用可能な場合、コードはこのクラスを使って処理を進めます。</span><span class="sxs-lookup"><span data-stu-id="508e1-189">If so, the code proceeds to use this class.</span></span>

2. <span data-ttu-id="508e1-190">次に、現在のユーザーが正式な Microsoft アカウントを持っている場合は、カスタム キャンペーン ID の取得を試行します。</span><span class="sxs-lookup"><span data-stu-id="508e1-190">Next, it attempts to get the custom campaign ID for the case where the current user has a recognized Microsoft account.</span></span> <span data-ttu-id="508e1-191">これを行うために、コードは、現在のアプリの SKU を表す [**StoreSku**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreSku) オブジェクトを取得した後、[**CampaignId**](https://docs.microsoft.com/uwp/api/windows.services.store.storecollectiondata.CampaignId) プロパティにアクセスしてキャンペーン ID (利用可能な場合) を取得します。</span><span class="sxs-lookup"><span data-stu-id="508e1-191">To do this, the code gets a [**StoreSku**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreSku) object that represents the current app SKU, and then it accesses the [**CampaignId**](https://docs.microsoft.com/uwp/api/windows.services.store.storecollectiondata.CampaignId) property to retrieve the campaign ID, if one is available.</span></span>
3. <span data-ttu-id="508e1-192">次に、コードは、現在のユーザーが正式な Microsoft アカウントを持っていない場合のキャンペーン ID の取得を試行します。</span><span class="sxs-lookup"><span data-stu-id="508e1-192">The code then attempts to retrieve the campaign ID for the case where the current user does not have a recognized Microsoft account.</span></span> <span data-ttu-id="508e1-193">この場合、キャンペーン ID はアプリのライセンスに埋め込まれています。</span><span class="sxs-lookup"><span data-stu-id="508e1-193">In this case, the campaign ID is embedded in the app license.</span></span> <span data-ttu-id="508e1-194">コードは、[**GetAppLicenseAsync**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.GetAppLicenseAsync) メソッドを使用してライセンスを取得した後、ライセンスの JSON コンテンツを解析して *customPolicyField1* というキーの値を取得します。</span><span class="sxs-lookup"><span data-stu-id="508e1-194">The code retrieves the license by using the [**GetAppLicenseAsync**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext.GetAppLicenseAsync) method and then parses the JSON contents of the license for the value of a key named *customPolicyField1*.</span></span> <span data-ttu-id="508e1-195">この値にキャンペーン ID が含まれています。</span><span class="sxs-lookup"><span data-stu-id="508e1-195">This value contains the campaign ID.</span></span>

4. <span data-ttu-id="508e1-196">**Windows.Services.Store** 名前空間の [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) クラスが利用できない場合、コードは、**Windows.ApplicationModel.Store** 名前空間 (この名前空間は、バージョン 1511 以前を含め、Windows 10 のすべてのバージョンで利用できます) の [**GetAppPurchaseCampaignIdAsync**](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp#Windows_ApplicationModel_Store_CurrentApp_GetAppPurchaseCampaignIdAsync) メソッドを使用する方法にフォールバックして、カスタム キャンペーン ID を取得します。</span><span class="sxs-lookup"><span data-stu-id="508e1-196">If the [**StoreContext**](https://docs.microsoft.com/uwp/api/windows.services.store.storecontext) class in the **Windows.Services.Store** namespace is not available, the code then falls back to using the [**GetAppPurchaseCampaignIdAsync**](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.Store.CurrentApp#Windows_ApplicationModel_Store_CurrentApp_GetAppPurchaseCampaignIdAsync) method in the **Windows.ApplicationModel.Store** namespace to retrieve the custom campaign ID (this namespace is available in all versions of Windows 10, including version 1511 and earlier).</span></span> <span data-ttu-id="508e1-197">このメソッドを使用するときは、ユーザーが正式な Microsoft アカウントを持っている場合にのみ、[条件を満たしている取得](#conversions)についてカスタム キャンペーン ID を取得できることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="508e1-197">Note that when using this method, you can only retrieve custom campaign IDs for [qualified acquisitions](#conversions) where the user has a recognized Microsoft account.</span></span>

### <a name="specify-the-campaign-id-in-the-proxy-file-for-the-windowsapplicationmodelstore-namespace"></a><span data-ttu-id="508e1-198">プロキシ ファイルで Windows.ApplicationModel.Store 名前空間のキャンペーン ID を指定します。</span><span class="sxs-lookup"><span data-stu-id="508e1-198">Specify the campaign ID in the proxy file for the Windows.ApplicationModel.Store namespace</span></span>

<span data-ttu-id="508e1-199">**Windows.ApplicationModel.Store** 名前空間には [**CurrentAppSimulator**](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentappsimulator) が含まれています。これは、ストアにアプリを提出する前に、ストアの操作をシミュレートしてコードをテストするための特別なクラスです。</span><span class="sxs-lookup"><span data-stu-id="508e1-199">The **Windows.ApplicationModel.Store** namespace includes [**CurrentAppSimulator**](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentappsimulator), a special class that simulates Store operations for testing your code before you submit your app to the Store.</span></span> <span data-ttu-id="508e1-200">このクラスは、[Windows.StoreProxy.xml ファイルという名前のローカル ファイル](../monetize/in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#using-the-windowsstoreproxyxml-file-with-currentappsimulator)からデータを取得します。</span><span class="sxs-lookup"><span data-stu-id="508e1-200">This class retrieves data from [a local file named Windows.StoreProxy.xml file](../monetize/in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#using-the-windowsstoreproxyxml-file-with-currentappsimulator).</span></span> <span data-ttu-id="508e1-201">前のコード例は、プロジェクトのデバッグおよび非デバッグ コードに **CurrentApp** と **CurrentAppSimulator** の両方を含める方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="508e1-201">The previous code example shows how to include use both **CurrentApp** and **CurrentAppSimulator** in debug and non-debug code in your project.</span></span> <span data-ttu-id="508e1-202">デバッグ環境でこのコードをテストするには、次の例のように、開発用コンピューターの WindowsStoreProxy.xml ファイルに **AppPurchaseCampaignId** 要素を追加します。</span><span class="sxs-lookup"><span data-stu-id="508e1-202">To test this code in a debug environment, add an **AppPurchaseCampaignId** element to the WindowsStoreProxy.xml file on your development computer, as shown in the following example.</span></span> <span data-ttu-id="508e1-203">アプリを実行すると、[**GetAppPurchaseCampaignIdAsync**](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentappsimulator.GetAppPurchaseCampaignIdAsync) メソッドは常にこの値を返します。</span><span class="sxs-lookup"><span data-stu-id="508e1-203">When you run the app, the [**GetAppPurchaseCampaignIdAsync**](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentappsimulator.GetAppPurchaseCampaignIdAsync) method will always return this value.</span></span>

``` xml
<CurrentApp>
    ...
    <AppPurchaseCampaignId>your custom campaign ID</AppPurchaseCampaignId>
</CurrentApp>
```

<span data-ttu-id="508e1-204">**Windows.Services.Store** 名前空間には、テスト中にライセンス情報をシミュレートするために使用できるクラスが用意されていません。</span><span class="sxs-lookup"><span data-stu-id="508e1-204">The **Windows.Services.Store** namespace does not provide a class that you can use to simulate license info during testing.</span></span> <span data-ttu-id="508e1-205">代わりに、アプリをストアに公開し、そのアプリを開発用デバイスにダウンロードして、そのライセンスをテストに使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="508e1-205">Instead, you must publish an app to the Store and download that app to your development device to use its license for testing.</span></span> <span data-ttu-id="508e1-206">詳しくは、「[アプリ内購入と試用版](../monetize/in-app-purchases-and-trials.md#testing)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="508e1-206">For more information, see [In-app purchases and trials](../monetize/in-app-purchases-and-trials.md#testing).</span></span>

## <a name="test-your-custom-campaign"></a><span data-ttu-id="508e1-207">カスタム キャンペーンをテストする</span><span class="sxs-lookup"><span data-stu-id="508e1-207">Test your custom campaign</span></span>

<span data-ttu-id="508e1-208">カスタム キャンペーンの URL を宣伝する前に、次の手順でカスタム キャンペーンをテストすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="508e1-208">Before you promote a custom campaign URL, we recommend that you test your custom campaign by doing the following:</span></span>

1.  <span data-ttu-id="508e1-209">テストに使用するデバイスで Microsoft アカウントにサインインします。</span><span class="sxs-lookup"><span data-stu-id="508e1-209">Sign in to a Microsoft account on the device you are using for testing.</span></span>

2.  <span data-ttu-id="508e1-210">カスタム キャンペーンの URL をクリックします。</span><span class="sxs-lookup"><span data-stu-id="508e1-210">Click your custom campaign URL.</span></span> <span data-ttu-id="508e1-211">アプリのページに移動することを確認し、UWP アプリまたはブラウザーのページを閉じます。</span><span class="sxs-lookup"><span data-stu-id="508e1-211">Make sure you are taken to your app page, and then close the UWP app or the browser page.</span></span>

3.  <span data-ttu-id="508e1-212">さらに URL を数回クリックします。アプリのページに移動した後は、毎回 UWP アプリまたはブラウザーのページを閉じます。</span><span class="sxs-lookup"><span data-stu-id="508e1-212">Click the URL several more times, closing the UWP app or the browser page after each visit to your app's page.</span></span> <span data-ttu-id="508e1-213">アプリのページに移動した**いずれかのとき**に、アプリを取得してコンバージョンを生成します。</span><span class="sxs-lookup"><span data-stu-id="508e1-213">During **one** of the visits to your app's page, acquire your app to generate a conversion.</span></span> <span data-ttu-id="508e1-214">URL をクリックした合計回数を覚えておきます。</span><span class="sxs-lookup"><span data-stu-id="508e1-214">Count the total number of times you clicked the URL.</span></span>

4. <span data-ttu-id="508e1-215">デベロッパー センター ダッシュボードの [[取得] レポート](acquisitions-report.md)の **[キャンペーン ID ごとのアプリ ページ ビューとコンバージョン]** グラフと **[キャンペーンのコンバージョン合計]** グラフで、予想されるページ ビュー数とコンバージョン数が示されるかどうかを確認します。また、アプリのコードをテストして、上記の API を使ってキャンペーン ID が正しく取得されるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="508e1-215">Confirm whether the expected page views and conversions appear in the **App page views and conversions by campaign ID** and **Total campaign conversions** charts in the [Acquisitions report](acquisitions-report.md) in the Dev Center dashboard., and test your app's code to confirm whether it can successfully retrieve the campaign ID using the APIs described above.</span></span>
