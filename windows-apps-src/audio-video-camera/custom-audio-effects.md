---
author: drewbatgit
Description: This article describes how to create a Windows Runtime component that implements the IBasicAudioEffect interface to allow you to create custom effects for audio streams.
title: カスタムのオーディオ特殊効果
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.assetid: 360faf3f-7e73-4db4-8324-3391f801d827
ms.localizationpriority: medium
ms.openlocfilehash: a9c62dac489be07a08acc4ad17ecb79bcc54f57a
ms.sourcegitcommit: 71e8eae5c077a7740e5606298951bb78fc42b22c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/13/2018
ms.locfileid: "6660622"
---
# <a name="custom-audio-effects"></a><span data-ttu-id="82321-103">カスタムのオーディオ特殊効果</span><span class="sxs-lookup"><span data-stu-id="82321-103">Custom audio effects</span></span>

<span data-ttu-id="82321-104">この記事では、オーディオ ストリームのカスタム効果を作成するための [**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) インターフェイスを実装する Windows ランタイム コンポーネントを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="82321-104">This article describes how to create a Windows Runtime component that implements the [**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) interface to create custom effects for audio streams.</span></span> <span data-ttu-id="82321-105">カスタム効果は、デバイスのカメラへのアクセスを提供する [MediaCapture](https://msdn.microsoft.com/library/windows/apps/br241124)、メディア クリップから複雑なコンポジションを作成するための [**MediaComposition**](https://msdn.microsoft.com/library/windows/apps/dn652646)、さまざまなオーディオ入力、出力、サブミックス ノードのグラフをすばやくアセンブルできる [**AudioGraph**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioGraph) など、さまざまな Windows ランタイム API で使用できます。</span><span class="sxs-lookup"><span data-stu-id="82321-105">Custom effects can be used with several different Windows Runtime APIs including [MediaCapture](https://msdn.microsoft.com/library/windows/apps/br241124), which provides access to a device's camera, [**MediaComposition**](https://msdn.microsoft.com/library/windows/apps/dn652646), which allows you to create complex compositions out of media clips, and [**AudioGraph**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioGraph) which allows you to quickly assemble a graph of various audio input, output, and submix nodes.</span></span>

## <a name="add-a-custom-effect-to-your-app"></a><span data-ttu-id="82321-106">アプリへのカスタム効果の追加</span><span class="sxs-lookup"><span data-stu-id="82321-106">Add a custom effect to your app</span></span>


<span data-ttu-id="82321-107">カスタムのオーディオ効果は、[**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) インターフェイスを実装するクラスで定義します。</span><span class="sxs-lookup"><span data-stu-id="82321-107">A custom audio effect is defined in a class that implements the [**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) interface.</span></span> <span data-ttu-id="82321-108">このクラスは、アプリのプロジェクトに直接含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="82321-108">This class can't be included directly in your app's project.</span></span> <span data-ttu-id="82321-109">代わりに、Windows ランタイム コンポーネントを使ってオーディオ特殊効果のクラスをホストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-109">Instead, you must use a Windows Runtime component to host your audio effect class.</span></span>

**<span data-ttu-id="82321-110">オーディオ特殊効果用の Windows ランタイム コンポーネントの追加</span><span class="sxs-lookup"><span data-stu-id="82321-110">Add a Windows Runtime component for your audio effect</span></span>**

1.  <span data-ttu-id="82321-111">Microsoft Visual Studio で、ソリューションを開き、**[ファイル]** メニューから **[追加]、[新しいプロジェクト]** の順にクリックします。</span><span class="sxs-lookup"><span data-stu-id="82321-111">In Microsoft Visual Studio, with your solution open, go to the **File** menu and select **Add-&gt;New Project**.</span></span>
2.  <span data-ttu-id="82321-112">プロジェクトの種類として **[Windows ランタイム コンポーネント (ユニバーサル Windows)]** を選びます。</span><span class="sxs-lookup"><span data-stu-id="82321-112">Select the **Windows Runtime Component (Universal Windows)** project type.</span></span>
3.  <span data-ttu-id="82321-113">この例では、プロジェクトに *AudioEffectComponent* という名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="82321-113">For this example, name the project *AudioEffectComponent*.</span></span> <span data-ttu-id="82321-114">この名前は後でコードで参照されます。</span><span class="sxs-lookup"><span data-stu-id="82321-114">This name will be referenced in code later.</span></span>
4.  <span data-ttu-id="82321-115">**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82321-115">Click **OK**.</span></span>
5.  <span data-ttu-id="82321-116">プロジェクト テンプレートに基づいて、Class1.cs という名前のクラスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="82321-116">The project template creates a class called Class1.cs.</span></span> <span data-ttu-id="82321-117">**ソリューション エクスプローラー**で、Class1.cs のアイコンを右クリックし、**[名前の変更]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82321-117">In **Solution Explorer**, right-click the icon for Class1.cs and select **Rename**.</span></span>
6.  <span data-ttu-id="82321-118">ファイル名を *ExampleAudioEffect.cs* に変更します。</span><span class="sxs-lookup"><span data-stu-id="82321-118">Rename the file to *ExampleAudioEffect.cs*.</span></span> <span data-ttu-id="82321-119">すべての参照を新しい名前に更新するかどうかを確認するメッセージが表示されたら、</span><span class="sxs-lookup"><span data-stu-id="82321-119">Visual Studio will show a prompt asking if you want to update all references to the new name.</span></span> <span data-ttu-id="82321-120">**[はい]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82321-120">Click **Yes**.</span></span>
7.  <span data-ttu-id="82321-121">**ExampleAudioEffect.cs** を開き、クラス定義を更新して [**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) インターフェイスを実装します。</span><span class="sxs-lookup"><span data-stu-id="82321-121">Open **ExampleAudioEffect.cs** and update the class definition to implement the [**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) interface.</span></span>


[!code-cs[ImplementIBasicAudioEffect](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetImplementIBasicAudioEffect)]

<span data-ttu-id="82321-122">この記事の例で使うすべての型にアクセスできるように、効果のクラス ファイルに次の名前空間を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-122">You need to include the following namespaces in your effect class file in order to access all of the types used in the examples in this article.</span></span>

[!code-cs[EffectUsing](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetEffectUsing)]

## <a name="implement-the-ibasicaudioeffect-interface"></a><span data-ttu-id="82321-123">IBasicAudioEffect インターフェイスを実装する</span><span class="sxs-lookup"><span data-stu-id="82321-123">Implement the IBasicAudioEffect interface</span></span>

<span data-ttu-id="82321-124">オーディオ特殊効果では、[**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) インターフェイスのすべてのメソッドとプロパティを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-124">Your audio effect must implement all of the methods and properties of the [**IBasicAudioEffect**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect) interface.</span></span> <span data-ttu-id="82321-125">このセクションでは、基本的なエコー効果を作成する、このインターフェイスの簡単な実装について説明します。</span><span class="sxs-lookup"><span data-stu-id="82321-125">This section walks you through a simple implementation of this interface to create a basic echo effect.</span></span>

### <a name="supportedencodingproperties-property"></a><span data-ttu-id="82321-126">SupportedEncodingProperties プロパティ</span><span class="sxs-lookup"><span data-stu-id="82321-126">SupportedEncodingProperties property</span></span>

<span data-ttu-id="82321-127">[**SupportedEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect.SupportedEncodingProperties) プロパティは、効果でサポートされるエンコード プロパティを確認するためにシステムでチェックされます。</span><span class="sxs-lookup"><span data-stu-id="82321-127">The system checks the [**SupportedEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect.SupportedEncodingProperties) property to determine which encoding properties are supported by your effect.</span></span> <span data-ttu-id="82321-128">効果で指定したプロパティを使ってオーディオをエンコードできない場合、[**Close**](https://msdn.microsoft.com/library/windows/apps/dn764782) が呼び出され、効果がオーディオ パイプラインから削除されます。</span><span class="sxs-lookup"><span data-stu-id="82321-128">Note that if the consumer of your effect can't encode audio using the properties you specify, the system will call [**Close**](https://msdn.microsoft.com/library/windows/apps/dn764782) on your effect and will remove your effect from the audio pipeline.</span></span> <span data-ttu-id="82321-129">この例では、[**AudioEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.AudioEncodingProperties) オブジェクトが作成され、44.1 kHz と 48 kHz、32 ビットの浮動小数点、モノラル エンコードをサポートする、返された一覧に追加されます。</span><span class="sxs-lookup"><span data-stu-id="82321-129">In this example,  [**AudioEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.AudioEncodingProperties) objects are created and added to the returned list to support 44.1 kHz and 48 kHz, 32-bit float, mono encoding.</span></span>

[!code-cs[SupportedEncodingProperties](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetSupportedEncodingProperties)]

### <a name="setencodingproperties-method"></a><span data-ttu-id="82321-130">SetEncodingProperties メソッド</span><span class="sxs-lookup"><span data-stu-id="82321-130">SetEncodingProperties method</span></span>

<span data-ttu-id="82321-131">[**SetEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/dn919884) は、効果の対象となるオーディオ ストリームのエンコード プロパティを示すために呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="82321-131">The system calls [**SetEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/dn919884) on your effect to let you know the encoding properties for the audio stream upon which the effect is operating.</span></span> <span data-ttu-id="82321-132">エコー効果を実装するため、この例では 1 秒間のオーディオ データを格納するバッファーを使用します。</span><span class="sxs-lookup"><span data-stu-id="82321-132">In order to implement an echo effect, this example uses a buffer to store one second of audio data.</span></span> <span data-ttu-id="82321-133">このメソッドは、オーディオをエンコードするサンプル レートに基づいて、バッファーのサイズを 1 秒間のオーディオのサンプル数に初期化する機会を提供します。</span><span class="sxs-lookup"><span data-stu-id="82321-133">This method provides the opportunity to initialize the size of the buffer to the number of samples in one second of audio, based on the sample rate in which the audio is encoded.</span></span> <span data-ttu-id="82321-134">遅延効果では、遅延バッファー内の現在位置を追跡する整数カウンターも使います。</span><span class="sxs-lookup"><span data-stu-id="82321-134">The delay effect also uses an integer counter to keep track of the current position in the delay buffer.</span></span> <span data-ttu-id="82321-135">オーディオ パイプラインに効果が追加されるたびに **SetEncodingProperties** 効果が呼び出されるため、これは値を 0 に初期化する良い機会です。</span><span class="sxs-lookup"><span data-stu-id="82321-135">Since **SetEncodingProperties** is called whenever the effect is added to the audio pipeline, this is a good time to initialize that value to 0.</span></span> <span data-ttu-id="82321-136">このメソッドに渡された **AudioEncodingProperties** オブジェクトをキャプチャして、効果の他の場所で使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="82321-136">You may also want to capture the **AudioEncodingProperties** object passed into this method to use elsewhere in your effect.</span></span>

[!code-cs[DeclareEchoBuffer](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetDeclareEchoBuffer)]
[!code-cs[SetEncodingProperties](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetSetEncodingProperties)]


### <a name="setproperties-method"></a><span data-ttu-id="82321-137">SetProperties メソッド</span><span class="sxs-lookup"><span data-stu-id="82321-137">SetProperties method</span></span>

<span data-ttu-id="82321-138">[**SetProperties**](https://msdn.microsoft.com/library/windows/apps/br240986) メソッドは、呼び出し元のアプリで効果のパラメーターを調整するために使われます。</span><span class="sxs-lookup"><span data-stu-id="82321-138">The [**SetProperties**](https://msdn.microsoft.com/library/windows/apps/br240986) method allows the app that is using your effect to adjust effect parameters.</span></span> <span data-ttu-id="82321-139">プロパティは、プロパティ名と値の [**IPropertySet**](https://msdn.microsoft.com/library/windows/apps/br226054) マップとして渡されます。</span><span class="sxs-lookup"><span data-stu-id="82321-139">Properties are passed as an [**IPropertySet**](https://msdn.microsoft.com/library/windows/apps/br226054) map of property names and values.</span></span>

[!code-cs[SetProperties](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetSetProperties)]

<span data-ttu-id="82321-140">このシンプルな例では、現在のオーディオ サンプルを、**Mix** プロパティの値に従って、遅延バッファーからの値とミキシングします。</span><span class="sxs-lookup"><span data-stu-id="82321-140">This simple example will mix the current audio sample with a value from the delay buffer according the value of the **Mix** property.</span></span> <span data-ttu-id="82321-141">プロパティを宣言し、呼び出し元アプリで設定された値を TryGetValue で取得しています。</span><span class="sxs-lookup"><span data-stu-id="82321-141">A property is declared and TryGetValue is used to get the value set by the calling app.</span></span> <span data-ttu-id="82321-142">値が設定されていない場合は、既定値の .5 が使われます。</span><span class="sxs-lookup"><span data-stu-id="82321-142">If no value was set, a default value of .5 is used.</span></span> <span data-ttu-id="82321-143">このプロパティは読み取り専用であることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82321-143">Note that this property is read-only.</span></span> <span data-ttu-id="82321-144">プロパティの値は **SetProperties** を使って設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-144">The property value must be set using **SetProperties**.</span></span>

[!code-cs[MixProperty](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetMixProperty)]

### <a name="processframe-method"></a><span data-ttu-id="82321-145">ProcessFrame メソッド</span><span class="sxs-lookup"><span data-stu-id="82321-145">ProcessFrame method</span></span>

<span data-ttu-id="82321-146">[**ProcessFrame**](https://msdn.microsoft.com/library/windows/apps/dn764784) メソッドは、効果によって、ストリームのオーディオ データを変更するためのメソッドです。</span><span class="sxs-lookup"><span data-stu-id="82321-146">The [**ProcessFrame**](https://msdn.microsoft.com/library/windows/apps/dn764784) method is where your effect modifies the audio data of the stream.</span></span> <span data-ttu-id="82321-147">このメソッドはフレームごとに 1 回呼び出され、[**ProcessAudioFrameContext**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext) オブジェクトが渡されます。</span><span class="sxs-lookup"><span data-stu-id="82321-147">The method is called once per frame and is passed a [**ProcessAudioFrameContext**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext) object.</span></span> <span data-ttu-id="82321-148">このオブジェクトには、処理対象の着信フレームを格納する入力 [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.AudioFrame) オブジェクトと、オーディオ パイプラインの残りの部分に渡すオーディオ データを書き込む出力 **AudioFrame** オブジェクトが含まれています。</span><span class="sxs-lookup"><span data-stu-id="82321-148">This object contains an input [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.AudioFrame) object that contains the incoming frame to be processed and an output **AudioFrame** object to which you write audio data that will be passed on to rest of the audio pipeline.</span></span> <span data-ttu-id="82321-149">オーディオ フレームは、オーディオ データの短いスライスを表す、オーディオ サンプル バッファーです。</span><span class="sxs-lookup"><span data-stu-id="82321-149">An audio frame is a buffer of audio samples representing a short slice of audio data.</span></span>

<span data-ttu-id="82321-150">**AudioFrame** のデータ バッファーにアクセスするには COM 相互運用機能が必要であるため、効果のクラス ファイルに **System.Runtime.InteropServices** 名前空間を含め、効果の名前空間内に次のコードを追加して、オーディオ バッファーにアクセスするためのインターフェイスをインポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-150">Accessing the data buffer of a **AudioFrame** requires COM interop, so you should include the **System.Runtime.InteropServices** namespace in your effect class file and then add the following code inside the namespace for your effect to import the interface for accessing the audio buffer.</span></span>

[!code-cs[ComImport](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetComImport)]

> [!NOTE]
> <span data-ttu-id="82321-151">この手法では管理対象外のネイティブの画像バッファーにアクセスするため、アンセーフ コードを許可するようにプロジェクトを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-151">Because this technique accesses a native, unmanaged image buffer, you will need to configure your project to allow unsafe code.</span></span>
> 1.  <span data-ttu-id="82321-152">ソリューション エクスプローラーで、AudioEffectComponent プロジェクトを右クリックし、**[プロパティ]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="82321-152">In Solution Explorer, right-click the AudioEffectComponent project and select **Properties**.</span></span>
> 2.  <span data-ttu-id="82321-153">**[ビルド]** タブを選択します。</span><span class="sxs-lookup"><span data-stu-id="82321-153">Select the **Build** tab.</span></span>
> 3.  <span data-ttu-id="82321-154">**[アンセーフ コードの許可]** チェック ボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="82321-154">Select the **Allow unsafe code** check box.</span></span>

 

<span data-ttu-id="82321-155">これで、**ProcessFrame** メソッドの実装を効果に追加できます。</span><span class="sxs-lookup"><span data-stu-id="82321-155">Now you can add the **ProcessFrame** method implementation to your effect.</span></span> <span data-ttu-id="82321-156">最初に、入力と出力の両方のオーディオ フレームから [**AudioBuffer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.AudioBuffer) オブジェクトを取得します。</span><span class="sxs-lookup"><span data-stu-id="82321-156">First, this method obtains a [**AudioBuffer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.AudioBuffer) object from both the input and output audio frames.</span></span> <span data-ttu-id="82321-157">出力フレームが書き込み用で、入力フレームが読み取り用です。</span><span class="sxs-lookup"><span data-stu-id="82321-157">Note that the output frame is opened for writing and the input for reading.</span></span> <span data-ttu-id="82321-158">次に、[**CreateReference**](https://msdn.microsoft.com/library/windows/apps/dn949046) を呼び出して、各バッファーの [**IMemoryBufferReference**](https://msdn.microsoft.com/library/windows/apps/dn921671) を取得します。</span><span class="sxs-lookup"><span data-stu-id="82321-158">Next, an [**IMemoryBufferReference**](https://msdn.microsoft.com/library/windows/apps/dn921671) is obtained for each buffer by calling [**CreateReference**](https://msdn.microsoft.com/library/windows/apps/dn949046).</span></span> <span data-ttu-id="82321-159">その後、実際のデータ バッファーを取得するために、先ほど定義した COM 相互運用機能のインターフェイス (**IMemoryByteAccess**) として **IMemoryBufferReference** オブジェクトをキャストし、**GetBuffer** を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="82321-159">Then, the actual data buffer is obtained by casting the **IMemoryBufferReference** objects as the COM interop interface defined above, **IMemoryByteAccess**, and then calling **GetBuffer**.</span></span>

<span data-ttu-id="82321-160">これで、データ バッファーが取得され、入力バッファーからの読み取りと出力バッファーへの書き込みが可能になります。</span><span class="sxs-lookup"><span data-stu-id="82321-160">Now that the data buffers have been obtained, you can read from the input buffer and write to the output buffer.</span></span> <span data-ttu-id="82321-161">入力バッファーの各サンプルで値が取得され、1 - **Mix**が乗算されて、効果のドライ信号値が設定されます。</span><span class="sxs-lookup"><span data-stu-id="82321-161">For each sample in the inputbuffer, the value is obtained and multiplied by 1 - **Mix** to set the dry signal value of the effect.</span></span> <span data-ttu-id="82321-162">次にエコー バッファー内の現在の位置からサンプルが取得され、**Mix** が乗算されて、効果のウェット値が設定されます。</span><span class="sxs-lookup"><span data-stu-id="82321-162">Next, a sample is retrieved from the current position in the echo buffer and multiplied by **Mix** to set the wet value of the effect.</span></span> <span data-ttu-id="82321-163">出力サンプルはドライとウェット値の合計に設定されます。</span><span class="sxs-lookup"><span data-stu-id="82321-163">The output sample is set to the sum of the dry and wet values.</span></span> <span data-ttu-id="82321-164">最後に、各入力サンプルがエコー バッファーに格納され、現在のサンプルのインデックスがインクリメントされます。</span><span class="sxs-lookup"><span data-stu-id="82321-164">Finally, each input sample is stored in the echo buffer and the current sample index is incremented.</span></span>

[!code-cs[ProcessFrame](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetProcessFrame)]



### <a name="close-method"></a><span data-ttu-id="82321-165">Close メソッド</span><span class="sxs-lookup"><span data-stu-id="82321-165">Close method</span></span>

<span data-ttu-id="82321-166">[**Close**](https://msdn.microsoft.com/library/windows/apps/dn764782) [**Close**](https://msdn.microsoft.com/library/windows/apps/dn764782) メソッドは、クラスで効果をシャットダウンする必要があるときに呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="82321-166">The system will call the [**Close**](https://msdn.microsoft.com/library/windows/apps/dn764782) [**Close**](https://msdn.microsoft.com/library/windows/apps/dn764782) method on your class when the effect should shut down.</span></span> <span data-ttu-id="82321-167">このメソッドを使って、作成したすべてのリソースを破棄する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-167">You should use this method to dispose of any resources you have created.</span></span> <span data-ttu-id="82321-168">このメソッドの [**MediaEffectClosedReason**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.MediaEffectClosedReason) 引数により、効果が正常に終了されたかどうかがわかります。エラーが発生したり、必要なエンコード形式が効果でサポートされていないと、この引数で通知されます。</span><span class="sxs-lookup"><span data-stu-id="82321-168">The argument to the method is a [**MediaEffectClosedReason**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.MediaEffectClosedReason) that lets you know whether the effect was closed normally, if an error occurred, or if the effect does not support the required encoding format.</span></span>

[!code-cs[Close](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetClose)]

### <a name="discardqueuedframes-method"></a><span data-ttu-id="82321-169">DiscardQueuedFrames メソッド</span><span class="sxs-lookup"><span data-stu-id="82321-169">DiscardQueuedFrames method</span></span>

<span data-ttu-id="82321-170">[**DiscardQueuedFrames**](https://msdn.microsoft.com/library/windows/apps/dn764790) メソッドは、効果をリセットする必要があるときに呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="82321-170">The [**DiscardQueuedFrames**](https://msdn.microsoft.com/library/windows/apps/dn764790) method is called when your effect should reset.</span></span> <span data-ttu-id="82321-171">典型的なシナリオとしては、現在のフレームの処理で使うために前に処理したフレームを保存している場合などが挙げられます。</span><span class="sxs-lookup"><span data-stu-id="82321-171">A typical scenario for this is if your effect stores previously processed frames to use in processing the current frame.</span></span> <span data-ttu-id="82321-172">このメソッドが呼び出されたときは、保存した一連のフレームを破棄する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-172">When this method is called, you should dispose of the set of previous frames you saved.</span></span> <span data-ttu-id="82321-173">このメソッドでは、蓄積されたオーディオ フレームだけでなく、前のフレームに関連するすべての状態をリセットできます。</span><span class="sxs-lookup"><span data-stu-id="82321-173">This method can be used to reset any state related to previous frames, not only accumulated audio frames.</span></span>

[!code-cs[DiscardQueuedFrames](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetDiscardQueuedFrames)]

### <a name="timeindependent-property"></a><span data-ttu-id="82321-174">TimeIndependent プロパティ</span><span class="sxs-lookup"><span data-stu-id="82321-174">TimeIndependent property</span></span>

<span data-ttu-id="82321-175">TimeIndependent [**TimeIndependent**](https://msdn.microsoft.com/library/windows/apps/dn764803) プロパティは、効果のタイミングを合わせる必要がないかどうかを示します。</span><span class="sxs-lookup"><span data-stu-id="82321-175">The TimeIndependent [**TimeIndependent**](https://msdn.microsoft.com/library/windows/apps/dn764803) property lets the system know if your effect does not require uniform timing.</span></span> <span data-ttu-id="82321-176">true に設定すると、効果のパフォーマンスを高めるために最適化を使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="82321-176">When set to true, the system can use optimizations that enhance effect performance.</span></span>

[!code-cs[TimeIndependent](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetTimeIndependent)]

### <a name="useinputframeforoutput-property"></a><span data-ttu-id="82321-177">UseInputFrameForOutput プロパティ</span><span class="sxs-lookup"><span data-stu-id="82321-177">UseInputFrameForOutput property</span></span>

<span data-ttu-id="82321-178">効果がその出力を [**ProcessFrame**](https://msdn.microsoft.com/library/windows/apps/dn764784) に渡される [**ProcessAudioFrameContext**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext) の [**OutputFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext.OutputFrame) ではなく、[**InputFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext.InputFrame) のオーディオ バッファーに書き込む場合には、[**UseInputFrameForOutput**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect.UseInputFrameForOutput) プロパティを **true** に設定します。</span><span class="sxs-lookup"><span data-stu-id="82321-178">Set the [**UseInputFrameForOutput**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.IBasicAudioEffect.UseInputFrameForOutput) property to **true** to tell the system that your effect will write its output to the audio buffer of the  [**InputFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext.InputFrame) of the [**ProcessAudioFrameContext**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext) passed into [**ProcessFrame**](https://msdn.microsoft.com/library/windows/apps/dn764784) instead of writing to the [**OutputFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.ProcessAudioFrameContext.OutputFrame).</span></span> 

[!code-cs[UseInputFrameForOutput](./code/AudioGraph/AudioEffectComponent/ExampleAudioEffect.cs#SnippetUseInputFrameForOutput)]


## <a name="adding-your-custom-effect-to-your-app"></a><span data-ttu-id="82321-179">アプリへのカスタム効果の追加</span><span class="sxs-lookup"><span data-stu-id="82321-179">Adding your custom effect to your app</span></span>


<span data-ttu-id="82321-180">アプリからオーディオ特殊効果を使うには、効果のプロジェクトへの参照をアプリに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82321-180">To use your audio effect from your app, you must add a reference to the effect project to your app.</span></span>

1.  <span data-ttu-id="82321-181">ソリューション エクスプローラーで、アプリのプロジェクトの下にある **[参照設定]** を右クリックし、**[参照の追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="82321-181">In Solution Explorer, under your app project, right-click **References** and select **Add reference**.</span></span>
2.  <span data-ttu-id="82321-182">**[プロジェクト]** タブを展開し、**[ソリューション]** を選択して、効果のプロジェクトの名前に対応するチェック ボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="82321-182">Expand the **Projects** tab, select **Solution**, and then select the check box for your effect project name.</span></span> <span data-ttu-id="82321-183">この例では、*AudioEffectComponent* という名前です。</span><span class="sxs-lookup"><span data-stu-id="82321-183">For this example, the name is *AudioEffectComponent*.</span></span>
3.  <span data-ttu-id="82321-184">[**OK**] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82321-184">Click **OK**</span></span>

<span data-ttu-id="82321-185">オーディオ効果クラスが別の名前空間で宣言されている場合は、その名前空間をコード ファイルに含めるようにします。</span><span class="sxs-lookup"><span data-stu-id="82321-185">If your audio effect class is declared is a different namespace, be sure to include that namespace in your code file.</span></span>

[!code-cs[UsingAudioEffectComponent](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetUsingAudioEffectComponent)]

### <a name="add-your-custom-effect-to-an-audiograph-node"></a><span data-ttu-id="82321-186">AudioGraph ノードにカスタム効果を追加する</span><span class="sxs-lookup"><span data-stu-id="82321-186">Add your custom effect to an AudioGraph node</span></span>
<span data-ttu-id="82321-187">オーディオ グラフの使用に関する概要については、「[オーディオ グラフ](audio-graphs.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="82321-187">For general information about using audio graphs, see [Audio garphs](audio-graphs.md).</span></span> <span data-ttu-id="82321-188">次のコード スニペットは、この記事で説明したエコー効果をオーディオ グラフ ノードに追加する例を示しています。</span><span class="sxs-lookup"><span data-stu-id="82321-188">The following code snippet shows you how to add the example echoe effect shown in this article to an audio graph node.</span></span> <span data-ttu-id="82321-189">まず、[**PropertySet**](https://msdn.microsoft.com/library/windows/apps/Windows.Foundation.Collections.PropertySet) が作成され、効果によって定義された **Mix** プロパティの値が設定されます。</span><span class="sxs-lookup"><span data-stu-id="82321-189">First, a [**PropertySet**](https://msdn.microsoft.com/library/windows/apps/Windows.Foundation.Collections.PropertySet) is created and a value for the **Mix** property, defined by the effect, is set.</span></span> <span data-ttu-id="82321-190">次に、[**AudioEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.AudioEffectDefinition) コンストラクターが呼び出され、カスタム効果の種類とプロパティ セットの完全なクラス名が渡されます。</span><span class="sxs-lookup"><span data-stu-id="82321-190">Next, the [**AudioEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Effects.AudioEffectDefinition) constructor is called, passing in the full class name of the custom effect type and the property set.</span></span> <span data-ttu-id="82321-191">最後に、既存の [**FileInputNode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.CreateAudioFileInputNodeResult.FileInputNode) の [**EffectDefinitions**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioFileInputNode.EffectDefinitions)プロパティに効果の定義が追加され、カスタム効果によるオーディオの処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="82321-191">Finally, the effect definition is added to the [**EffectDefinitions**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioFileInputNode.EffectDefinitions) property of an existing [**FileInputNode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.CreateAudioFileInputNodeResult.FileInputNode), causing the audio emitted to be processed by the custom effect.</span></span> 

[!code-cs[AddCustomEffect](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetAddCustomEffect)]

<span data-ttu-id="82321-192">カスタム効果がノードに追加された後では、[**DisableEffectsByDefinition**](https://msdn.microsoft.com/library/windows/apps/dn958480) を呼び出して、**AudioEffectDefinition** オブジェクトを渡すことにより無効化することができます。</span><span class="sxs-lookup"><span data-stu-id="82321-192">After it has been added to a node, the custom effect can be disabled by calling [**DisableEffectsByDefinition**](https://msdn.microsoft.com/library/windows/apps/dn958480) and passing in the **AudioEffectDefinition** object.</span></span> <span data-ttu-id="82321-193">アプリでのオーディオ グラフの使用について詳しくは、「[AudioGraph](audio-graphs.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="82321-193">For more information about using audio graphs in your app, see [AudioGraph](audio-graphs.md).</span></span>

### <a name="add-your-custom-effect-to-a-clip-in-a-mediacomposition"></a><span data-ttu-id="82321-194">MediaComposition のクリップへのカスタム効果の追加</span><span class="sxs-lookup"><span data-stu-id="82321-194">Add your custom effect to a clip in a MediaComposition</span></span>

<span data-ttu-id="82321-195">次のコード スニペットは、カスタムのオーディオ効果をメディア コンポジションのビデオクリップとバック グラウンド オーディオ トラックに追加する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="82321-195">The following code snippet demonstrates adding the custom audio effect to a video clip and a background audio track in a media composition.</span></span> <span data-ttu-id="82321-196">ビデオ クリップからメディア コンポジションを作成してバックグラウンド オーディオ トラックを追加する一般的なガイダンスについては、「[メディア コンポジションと編集](media-compositions-and-editing.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="82321-196">For general guidance for creating media compositions from video clips and adding background audio tracks, see [Media compositions and editing](media-compositions-and-editing.md).</span></span>

[!code-cs[AddCustomAudioEffect](./code/MediaEditing/cs/MainPage.xaml.cs#SnippetAddCustomAudioEffect)]



## <a name="related-topics"></a><span data-ttu-id="82321-197">関連トピック</span><span class="sxs-lookup"><span data-stu-id="82321-197">Related topics</span></span>
* [<span data-ttu-id="82321-198">シンプルなカメラ プレビューへのアクセス</span><span class="sxs-lookup"><span data-stu-id="82321-198">Simple camera preview access</span></span>](simple-camera-preview-access.md)
* [<span data-ttu-id="82321-199">メディアのコンポジションと編集</span><span class="sxs-lookup"><span data-stu-id="82321-199">Media compositions and editing</span></span>](media-compositions-and-editing.md)
* [<span data-ttu-id="82321-200">Win2D ドキュメント</span><span class="sxs-lookup"><span data-stu-id="82321-200">Win2D documentation</span></span>](http://go.microsoft.com/fwlink/p/?LinkId=519078)
* [<span data-ttu-id="82321-201">メディア再生</span><span class="sxs-lookup"><span data-stu-id="82321-201">Media playback</span></span>](media-playback.md)

 



