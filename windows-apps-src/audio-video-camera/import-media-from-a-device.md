---
author: drewbatgit
ms.assetid: dd2a1e01-c284-4d62-963e-f59f58dca61a
description: この記事では、利用可能なメディア ソースの検索、写真やサイドカー ファイルなどのファイルのインポート、ソース デバイスからインポートしたファイルの削除など、デバイスからメディアをインポートする方法について説明します。
title: メディアのインポート
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 36f8956e2ca167d98bb8e6ecf35ce3d131d7b032
ms.sourcegitcommit: 144f5f127fc4fbd852f2f6780ef26054192d68fc
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2018
ms.locfileid: "5978433"
---
# <a name="import-media-from-a-device"></a><span data-ttu-id="06f48-104">デバイスからのメディアのインポート</span><span class="sxs-lookup"><span data-stu-id="06f48-104">Import media from a device</span></span>

<span data-ttu-id="06f48-105">この記事では、利用可能なメディア ソースの検索、ビデオ、写真、サイドカー ファイルなどのファイルのインポート、ソース デバイスからインポートしたファイルの削除など、デバイスからメディアをインポートする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="06f48-105">This article describes how to import media from a device, including searching for available media sources, importing files such as videos, photos, and sidecar files, and deleting the imported files from the source device.</span></span>

> [!NOTE] 
> <span data-ttu-id="06f48-106">この記事のコードは、[**MediaImport UWP アプリ サンプル**](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/MediaImport)を基にしています。</span><span class="sxs-lookup"><span data-stu-id="06f48-106">The code in this article was adapted from the [**MediaImport UWP app sample**](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/MediaImport) .</span></span> <span data-ttu-id="06f48-107">このサンプルを[**ユニバーサル Windows アプリ サンプル Git リポジトリ**](https://github.com/Microsoft/Windows-universal-samples)から複製またはダウンロードすると、コンテキスト内のコードを確認できます。独自のアプリの出発点として使うこともできます。</span><span class="sxs-lookup"><span data-stu-id="06f48-107">You can clone or download this sample from the [**Universal Windows app samples Git repo**](https://github.com/Microsoft/Windows-universal-samples) to see the code in context or to use it as a starting point for your own app.</span></span>

## <a name="create-a-simple-media-import-ui"></a><span data-ttu-id="06f48-108">シンプルなメディア インポート UI の作成</span><span class="sxs-lookup"><span data-stu-id="06f48-108">Create a simple media import UI</span></span>
<span data-ttu-id="06f48-109">この記事の例では、メディア インポートのコア シナリオを実現する最小限の UI を使用します。</span><span class="sxs-lookup"><span data-stu-id="06f48-109">The example in this article uses a minimal UI to enable the core media import scenarios.</span></span> <span data-ttu-id="06f48-110">メディア インポート アプリ用のより強力な UI を作成する方法については、[**MediaImport サンプル**](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/MediaImport)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="06f48-110">To see how to create a more robust UI for a media import app, see the [**MediaImport sample**](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/MediaImport).</span></span> <span data-ttu-id="06f48-111">次の XAML では、次のコントロールを持つスタック パネルを作成します。</span><span class="sxs-lookup"><span data-stu-id="06f48-111">The following XAML creates a stack panel with the following controls:</span></span>
* <span data-ttu-id="06f48-112">メディアをインポートできるソースの検索を開始するための [**Button**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Button)。</span><span class="sxs-lookup"><span data-stu-id="06f48-112">A [**Button**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Button) to initiate searching for sources from which media can be imported.</span></span>
* <span data-ttu-id="06f48-113">見つかったメディア インポート ソースを一覧にして選択するための [**ComboBox**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ComboBox)。</span><span class="sxs-lookup"><span data-stu-id="06f48-113">A [**ComboBox**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ComboBox) to list and select from the media import sources that are found.</span></span>
* <span data-ttu-id="06f48-114">選択したインポート ソースのメディア項目を表示して選択するための [**ListView**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ListView) コントロール。</span><span class="sxs-lookup"><span data-stu-id="06f48-114">A [**ListView**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ListView) control to display and select from the media items from the selected import source.</span></span>
* <span data-ttu-id="06f48-115">選択したソースからメディア項目のインポートを開始するための **Button**。</span><span class="sxs-lookup"><span data-stu-id="06f48-115">A **Button** to initiate importing media items from the selected source.</span></span>
* <span data-ttu-id="06f48-116">選択したソースからインポートされた項目の削除を開始するための **Button**。</span><span class="sxs-lookup"><span data-stu-id="06f48-116">A **Button** to initiate deleting the items that have been imported from the selected source.</span></span>
* <span data-ttu-id="06f48-117">非同期メディア インポート操作を取り消すための **Button**。</span><span class="sxs-lookup"><span data-stu-id="06f48-117">A **Button** to cancel an asynchronous media import operation.</span></span>

[!code-xml[ImportXAML](./code/PhotoImport_Win10/cs/MainPage.xaml#SnippetImportXAML)]

## <a name="set-up-your-code-behind-file"></a><span data-ttu-id="06f48-118">分離コード ファイルの設定</span><span class="sxs-lookup"><span data-stu-id="06f48-118">Set up your code-behind file</span></span>
<span data-ttu-id="06f48-119">*using* ディレクティブを追加して、既定のプロジェクト テンプレートにまだ含まれていない、この例で使用する名前空間を含めます。</span><span class="sxs-lookup"><span data-stu-id="06f48-119">Add *using* directives to include the namespaces used by this example that are not already included in the default project template.</span></span>

[!code-cs[Using](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetUsing)]

## <a name="set-up-task-cancellation-for-media-import-operations"></a><span data-ttu-id="06f48-120">メディア インポート操作のタスク取り消しの設定</span><span class="sxs-lookup"><span data-stu-id="06f48-120">Set up task cancellation for media import operations</span></span>

<span data-ttu-id="06f48-121">メディア インポート操作には長い時間がかかる場合があるため、操作は [**IAsyncOperationWithProgress**](https://msdn.microsoft.com/library/windows/apps/br206594.aspx) を使用して非同期で実行します。</span><span class="sxs-lookup"><span data-stu-id="06f48-121">Because media import operations can take a long time, they are performed asynchronously using [**IAsyncOperationWithProgress**](https://msdn.microsoft.com/library/windows/apps/br206594.aspx).</span></span> <span data-ttu-id="06f48-122">ユーザーがキャンセル ボタンをクリックした場合に、実行中の操作の取り消しに使用する、[**CancellationTokenSource**](https://msdn.microsoft.com/library/system.threading.cancellationtokensource) 型のクラス メンバー変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="06f48-122">Declare a class member variable of type [**CancellationTokenSource**](https://msdn.microsoft.com/library/system.threading.cancellationtokensource) that will be used to cancel an in-progress operation if the user clicks the cancel button.</span></span>

[!code-cs[DeclareCts](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetDeclareCts)]

<span data-ttu-id="06f48-123">キャンセル ボタンのハンドラーの実装</span><span class="sxs-lookup"><span data-stu-id="06f48-123">Implement a handler for the cancel button.</span></span> <span data-ttu-id="06f48-124">この記事の後で示す例では、**CancellationTokenSource** を操作が始まったときに初期化して、操作が完了したときに null に設定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-124">The examples shown later in this article will initialize the **CancellationTokenSource** when an operation begins and set it to null when the operation completes.</span></span> <span data-ttu-id="06f48-125">このキャンセル ボタン ハンドラーでは、トークンが null かどうかを確認し、null でない場合は [**Cancel**](https://msdn.microsoft.com/library/dd321955) を呼び出して操作を取り消します。</span><span class="sxs-lookup"><span data-stu-id="06f48-125">In the cancel button handler, check to see if the token is null, and if not, call [**Cancel**](https://msdn.microsoft.com/library/dd321955) to cancel the operation.</span></span>

[!code-cs[OnCancel](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetOnCancel)]

## <a name="data-binding-helper-classes"></a><span data-ttu-id="06f48-126">データ バインディング ヘルパー クラス</span><span class="sxs-lookup"><span data-stu-id="06f48-126">Data binding helper classes</span></span>

<span data-ttu-id="06f48-127">一般的なメディア インポート シナリオでは、インポートできるメディア項目の一覧をユーザーに提示します。選択するメディア ファイルの数は非常に多い可能性があり、通常、各メディア項目のサムネイルを表示します。</span><span class="sxs-lookup"><span data-stu-id="06f48-127">In a typical media import scenario you show the user a list of available media items to import, there can be a large number of media files to choose from and, typically, you want to show a thumbnail for each media item.</span></span> <span data-ttu-id="06f48-128">このため、この例では 3 つのヘルパー クラスを使用して、ユーザーが一覧をスクロールしていくと ListView コントロールにエントリが段階的に読み込まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="06f48-128">For this reason, this example uses three helper classes to incrementally load entries into the ListView control as the user scrolls down through the list.</span></span>

* <span data-ttu-id="06f48-129">**IncrementalLoadingBase** クラス - [**IList**](https://msdn.microsoft.com/library/system.collections.ilist)、[**ISupportIncrementalLoading**](https://msdn.microsoft.com/library/windows/apps/windows.ui.xaml.data.isupportincrementalloading)、および [**INotifyCollectionChanged**](https://msdn.microsoft.com/library/windows/apps/system.collections.specialized.inotifycollectionchanged(v=vs.105).aspx) を実装し、段階的な読み込みの基本動作を提供します。</span><span class="sxs-lookup"><span data-stu-id="06f48-129">**IncrementalLoadingBase** class - Implements the [**IList**](https://msdn.microsoft.com/library/system.collections.ilist), [**ISupportIncrementalLoading**](https://msdn.microsoft.com/library/windows/apps/windows.ui.xaml.data.isupportincrementalloading), and [**INotifyCollectionChanged**](https://msdn.microsoft.com/library/windows/apps/system.collections.specialized.inotifycollectionchanged(v=vs.105).aspx) to provide the base incremental loading behavior.</span></span>
* <span data-ttu-id="06f48-130">**GeneratorIncrementalLoadingClass** クラス - 段階的な読み込みの基底クラスの実装を提供します。</span><span class="sxs-lookup"><span data-stu-id="06f48-130">**GeneratorIncrementalLoadingClass** class - Provides an implementation of the incremental loading base class.</span></span>
* <span data-ttu-id="06f48-131">**ImportableItemWrapper** クラス - [**PhotoImportItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItem) クラスのシン ラッパーで、インポートされる各項目のサムネイル イメージに対するバインディング可能な [**BitmapImage**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.BitmapImage) プロパティを追加します。</span><span class="sxs-lookup"><span data-stu-id="06f48-131">**ImportableItemWrapper** class - A thin wrapper around the [**PhotoImportItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItem) class to add a bindable [**BitmapImage**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.BitmapImage) property for the thumbnail image for each imported item.</span></span>

<span data-ttu-id="06f48-132">これらのクラスは [**MediaImport サンプル**](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/MediaImport)に用意されており、変更なしでプロジェクトに追加できます。</span><span class="sxs-lookup"><span data-stu-id="06f48-132">These classes are provided in the [**MediaImport sample**](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/MediaImport) and can be added to your project without modifications.</span></span> <span data-ttu-id="06f48-133">ヘルパー クラスをプロジェクトに追加したら、後でこの例で使用する**GeneratorIncrementalLoadingClass** 型のクラス メンバー変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="06f48-133">After adding the helper classes to your project, declare a class member variable of type **GeneratorIncrementalLoadingClass** that will be used later in this example.</span></span>

[!code-cs[GeneratorIncrementalLoadingClass](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetGeneratorIncrementalLoadingClass)]


## <a name="find-available-sources-from-which-media-can-be-imported"></a><span data-ttu-id="06f48-134">メディアをインポートできる利用可能なソースを見つける</span><span class="sxs-lookup"><span data-stu-id="06f48-134">Find available sources from which media can be imported</span></span>

<span data-ttu-id="06f48-135">ソース検索ボタンのクリック ハンドラーで、静的メソッド [**PhotoImportManager.FindAllSourcesAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportManager.FindAllSourcesAsync) を呼び出し、メディアをインポート可能なデバイスのシステム検索を開始します。</span><span class="sxs-lookup"><span data-stu-id="06f48-135">In the click handler for the find sources button, call the static method [**PhotoImportManager.FindAllSourcesAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportManager.FindAllSourcesAsync) to start the system searching for devices from which media can be imported.</span></span> <span data-ttu-id="06f48-136">操作の完了を待機した後、返される一覧内の各 [**PhotoImportSource**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSource) オブジェクトをループ処理し、エントリを **ComboBox** に追加します。ソース オブジェクト自体に **Tag** プロパティを設定して、ユーザーが選択するときに簡単にソース オブジェクトを取得できるようにします。</span><span class="sxs-lookup"><span data-stu-id="06f48-136">After awaiting the completion of the operation, loop through each [**PhotoImportSource**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSource) object in the returned list and add an entry to the **ComboBox**, setting the **Tag** property to the source object itself so it can be easily retrieved when the user makes a selection.</span></span>

[!code-cs[FindSourcesClick](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetFindSourcesClick)]

<span data-ttu-id="06f48-137">ユーザーが選択したインポート ソースを格納するクラス メンバー変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="06f48-137">Declare a class member variable to store the user's selected import source.</span></span>

[!code-cs[DeclareImportSource](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetDeclareImportSource)]

<span data-ttu-id="06f48-138">インポート ソース **ComboBox** の [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Primitives.Selector.SelectionChanged) ハンドラーで、クラス メンバー変数を選択したソースに設定します。その後、この記事の広範で示す **FindItems** ヘルパー メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="06f48-138">In the [**SelectionChanged**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Primitives.Selector.SelectionChanged) handler for the import source **ComboBox**, set the class member variable to the selected source and then call the **FindItems** helper method which will be shown later in this article.</span></span> 

[!code-cs[SourcesSelectionChanged](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetSourcesSelectionChanged)]

## <a name="find-items-to-import"></a><span data-ttu-id="06f48-139">インポートする項目を見つける</span><span class="sxs-lookup"><span data-stu-id="06f48-139">Find items to import</span></span>

<span data-ttu-id="06f48-140">この後の手順で使用する [**PhotoImportSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSession) 型および [**PhotoImportFindItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult) 型のクラス メンバー 変数を追加します。</span><span class="sxs-lookup"><span data-stu-id="06f48-140">Add class member variables of type [**PhotoImportSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSession) and [**PhotoImportFindItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult) which will be used in the following steps.</span></span>

[!code-cs[DeclareImport](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetDeclareImport)]

<span data-ttu-id="06f48-141">**FindItems** メソッドで、C**CancellationTokenSource** 変数を初期化して、必要に応じて検索操作の取り消しに使用できるようにします。</span><span class="sxs-lookup"><span data-stu-id="06f48-141">In the **FindItems** method, initialize the **CancellationTokenSource** variable so it can be used to cancel the find operation if necessary.</span></span> <span data-ttu-id="06f48-142">**try** ブロック内で、ユーザーが選択した [**PhotoImportSource**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSource) オブジェクトで [**CreateImportSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSource.CreateImportSession) を呼び出して、新しいインポート セッションを作成します。</span><span class="sxs-lookup"><span data-stu-id="06f48-142">Within a **try** block, create a new import session by calling [**CreateImportSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSource.CreateImportSession) on the [**PhotoImportSource**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportSource) object selected by the user.</span></span> <span data-ttu-id="06f48-143">検索操作の進行状況を表示するためのコールバックを提供するために、新しい [**Progress**](https://msdn.microsoft.com/library/hh193692.aspx) オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="06f48-143">Create a new [**Progress**](https://msdn.microsoft.com/library/hh193692.aspx) object to provide a callback to display the progress of the find operation.</span></span> <span data-ttu-id="06f48-144">次に、**[FindItemsAsync](https://docs.microsoft.com/uwp/api/windows.media.import.photoimportsession.finditemsasync)** を呼び出して、検索操作を開始します。</span><span class="sxs-lookup"><span data-stu-id="06f48-144">Next, call **[FindItemsAsync](https://docs.microsoft.com/uwp/api/windows.media.import.photoimportsession.finditemsasync)** to start the find operation.</span></span> <span data-ttu-id="06f48-145">[**PhotoImportContentTypeFilter**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportContentTypeFilter) の値を提供して、写真、ビデオ、またはその両方を返す必要があるかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-145">Provide a [**PhotoImportContentTypeFilter**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportContentTypeFilter) value to specify whether photos, videos, or both should be returned.</span></span> <span data-ttu-id="06f48-146">[**PhotoImportItemSelectionMode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItemSelectionMode) の値を提供して、[**IsSelected**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItem.IsSelected) プロパティが true に設定されているときに、すべてのメディア項目を返すのか、メディア項目を何も返さないのか、新しいメディア項目のみを返すのかを指定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-146">Provide a [**PhotoImportItemSelectionMode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItemSelectionMode) value to specify whether all, none, or only the new media items are returned with their [**IsSelected**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItem.IsSelected) property set to true.</span></span> <span data-ttu-id="06f48-147">このプロパティは、ListBox 項目テンプレートの、各メディア項目のチェック ボックスにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="06f48-147">This property is bound to a checkbox for each media item in our ListBox item template.</span></span>

<span data-ttu-id="06f48-148">**FindItemsAsync** は [**IAsyncOperationWithProgress**](https://msdn.microsoft.com/library/windows/apps/br206594.aspx) を返します。</span><span class="sxs-lookup"><span data-stu-id="06f48-148">**FindItemsAsync** returns an [**IAsyncOperationWithProgress**](https://msdn.microsoft.com/library/windows/apps/br206594.aspx).</span></span> <span data-ttu-id="06f48-149">拡張メソッド [**AsTask**](https://msdn.microsoft.com/library/hh779750.aspx) は、待機可能で、キャンセル トークンを使用して取り消し可能であり、提供された **Progress** オブジェクトを使用して進行状況を報告するタスクの作成に使用されます。</span><span class="sxs-lookup"><span data-stu-id="06f48-149">The extension method [**AsTask**](https://msdn.microsoft.com/library/hh779750.aspx) is used to create a task that can be awaited, can be cancelled with the cancellation token, and that reports progress using the supplied **Progress** object.</span></span>

<span data-ttu-id="06f48-150">次に、データ バインディング ヘルパー クラス **GeneratorIncrementalLoadingClass** が初期化されます。</span><span class="sxs-lookup"><span data-stu-id="06f48-150">Next the data binding helper class, **GeneratorIncrementalLoadingClass** is initialized.</span></span> <span data-ttu-id="06f48-151">**FindItemsAsync** は、待機から返されると、[**PhotoImportFindItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult) オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="06f48-151">**FindItemsAsync**, when it returns from being awaited, returns a [**PhotoImportFindItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult) object.</span></span> <span data-ttu-id="06f48-152">このオブジェクトには、操作の成功、見つかったさまざまな種類のメディア項目の数など、検索操作の状態情報が含まれます。</span><span class="sxs-lookup"><span data-stu-id="06f48-152">This object contains status information about the find operation, including the success of the operation and the count of different types of media items that were found.</span></span> <span data-ttu-id="06f48-153">[**FoundItems**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.FoundItems) プロパティには、見つかったメディア項目を表す [**PhotoImportItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItem) オブジェクトの一覧が含まれます。</span><span class="sxs-lookup"><span data-stu-id="06f48-153">The [**FoundItems**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.FoundItems) property contains a list of [**PhotoImportItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportItem) objects representing the found media items.</span></span> <span data-ttu-id="06f48-154">**GeneratorIncrementalLoadingClass** コンストラクターは、段階的に読み込まれる項目の合計数と、必要に応じて読み込まれる新規項目を生成する関数を引数として受け取ります。</span><span class="sxs-lookup"><span data-stu-id="06f48-154">The **GeneratorIncrementalLoadingClass** constructor takes as arguments the total count of items that will be loaded incrementally, and a function that generates new items to be loaded as needed.</span></span> <span data-ttu-id="06f48-155">この場合、指定されたラムダ式によって、**ImportableItemWrapper** の新しいインスタンスが作成されます。これは、**PhotoImportItem** をラップして各項目のサムネイルを含めます。</span><span class="sxs-lookup"><span data-stu-id="06f48-155">In this case, the provided lambda expression creates a new instance of the **ImportableItemWrapper** which wraps **PhotoImportItem** and includes a thumbnail for each item.</span></span> <span data-ttu-id="06f48-156">段階的読み込みクラスが初期化されたら、それを UI に含まれる **ListView** コントロールの [**ItemsSource**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ItemsControl.ItemsSource) プロパティに設定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-156">Once the incremental loading class has been initialized, set it to the [**ItemsSource**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ItemsControl.ItemsSource) property of the **ListView** control in the UI.</span></span> <span data-ttu-id="06f48-157">これで、見つかったメディア項目が段階的に読み込まれ、一覧に表示されます。</span><span class="sxs-lookup"><span data-stu-id="06f48-157">Now, the found media items will be loaded incrementally and displayed in the list.</span></span>

<span data-ttu-id="06f48-158">次に、検索操作の状態情報が出力されます。</span><span class="sxs-lookup"><span data-stu-id="06f48-158">Next, the status information of the find operation are output.</span></span> <span data-ttu-id="06f48-159">一般的なアプリでは、この情報が UI でユーザーに表示されます。しかし、この例では、単純に情報をデバッグ コンソールに出力します。</span><span class="sxs-lookup"><span data-stu-id="06f48-159">A typical app will display this information to the user in the UI, but this example simply outputs the information to the debug console.</span></span> <span data-ttu-id="06f48-160">最後に、操作が完了したのでキャンセル トークンを null に設定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-160">Finally, set the cancellation token to null because the operation is complete.</span></span>

[!code-cs[FindItems](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetFindItems)]

## <a name="import-media-items"></a><span data-ttu-id="06f48-161">メディア項目のインポート</span><span class="sxs-lookup"><span data-stu-id="06f48-161">Import media items</span></span>

<span data-ttu-id="06f48-162">インポート操作を実装する前に、インポート操作の結果を格納する [**PhotoImportImportItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult) オブジェクトを宣言します。</span><span class="sxs-lookup"><span data-stu-id="06f48-162">Before implementing the import operation, declare a [**PhotoImportImportItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult) object to store the results of the import operation.</span></span> <span data-ttu-id="06f48-163">これは後で、ソースから正常にインポートされたメディア項目を削除するために使用します。</span><span class="sxs-lookup"><span data-stu-id="06f48-163">This will be used later to delete media items that were successfully imported from the source.</span></span>

[!code-cs[DeclareImportResult](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetDeclareImportResult)]

<span data-ttu-id="06f48-164">メディアのインポート操作を開始する前に、**CancellationTokenSource** 変数を初期化し、[**ProgressBar**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ProgressBar) コントロールの値を 0 に設定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-164">Before starting the media import operation initialize the **CancellationTokenSource** variable and by setting the value of the [**ProgressBar**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.ProgressBar) control to 0.</span></span>

<span data-ttu-id="06f48-165">**ListView** コントロールで選択されている項目がない場合、インポートするものはありません。</span><span class="sxs-lookup"><span data-stu-id="06f48-165">If there are no selected items in the **ListView** control, then there is nothing to import.</span></span> <span data-ttu-id="06f48-166">それ以外の場合は、進行状況バー コントロールを更新する進行状況コールバックを提供するために、[**Progress**](https://msdn.microsoft.com/library/hh193692.aspx) オブジェクトを初期化します。</span><span class="sxs-lookup"><span data-stu-id="06f48-166">Otherwise, initialize a [**Progress**](https://msdn.microsoft.com/library/hh193692.aspx) object to provide a progress callback which updates the value of the progress bar control.</span></span> <span data-ttu-id="06f48-167">検索操作によって返される [**PhotoImportFindItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult) の [**ItemImported**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ItemImported) イベント用のハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="06f48-167">Register a handler for the [**ItemImported**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ItemImported) event of the [**PhotoImportFindItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult) returned by the find operation.</span></span> <span data-ttu-id="06f48-168">このイベントは、この例の場合、項目がインポートされ、インポートされた各ファイルの名前がデバッグ コンソールに出力されるときに発生します。</span><span class="sxs-lookup"><span data-stu-id="06f48-168">This event will be raised whenever an item is imported and, in this example, outputs the name of each imported file to the debug console.</span></span>

<span data-ttu-id="06f48-169">[**ImportItemsAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ImportItemsAsync) を呼び出して、インポート操作を開始します。</span><span class="sxs-lookup"><span data-stu-id="06f48-169">Call [**ImportItemsAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ImportItemsAsync) to begin the import operation.</span></span> <span data-ttu-id="06f48-170">検索操作と同様に、[**AsTask**](https://msdn.microsoft.com/library/hh779750.aspx) 拡張メソッドは、返された操作を、待機可能で、進行状況を報告し、取り消し可能なタスクに変換するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="06f48-170">Just as with the find operation, the [**AsTask**](https://msdn.microsoft.com/library/hh779750.aspx) extension method is used to convert the returned operation to a task that can be awaited, reports progress, and can be cancelled.</span></span>

<span data-ttu-id="06f48-171">インポート操作が完了したら、[**ImportItemsAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ImportItemsAsync) によって返される [**PhotoImportImportItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult) オブジェクトから操作の状態を取得できます。</span><span class="sxs-lookup"><span data-stu-id="06f48-171">After the import operation is complete, the operation status can be obtained from the [**PhotoImportImportItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult) object returned by [**ImportItemsAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ImportItemsAsync).</span></span> <span data-ttu-id="06f48-172">この例では、状態情報をデバッグ コンソールに出力して、最後にキャンセル トークンを null に設定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-172">This example outputs the status information to the debug console and then finallly, sets the cancellation token to null.</span></span>

[!code-cs[ImportClick](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetImportClick)]

## <a name="delete-imported-items"></a><span data-ttu-id="06f48-173">インポートされた項目の削除</span><span class="sxs-lookup"><span data-stu-id="06f48-173">Delete imported items</span></span>
<span data-ttu-id="06f48-174">ソースから正常にインポートされた項目をインポート元から削除するには、まず、削除操作を取り消せるようにキャンセル トークンを初期化して、進行状況バーの値を 0 に設定します。</span><span class="sxs-lookup"><span data-stu-id="06f48-174">To delete the successfully imported items from the source from which they were imported, first initialize the cancellation token so that the delete operation can be cancelled and set the progress bar value to 0.</span></span> <span data-ttu-id="06f48-175">[**ImportItemsAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ImportItemsAsync) から返される [**PhotoImportImportItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult) が null でないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="06f48-175">Make sure that the [**PhotoImportImportItemsResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult) returned from [**ImportItemsAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportFindItemsResult.ImportItemsAsync) is not null.</span></span> <span data-ttu-id="06f48-176">そうでない場合は、削除操作の進行状況コールバックを提供するために、[**Progress**](https://msdn.microsoft.com/library/hh193692.aspx) オブジェクトをもう一度作成します。</span><span class="sxs-lookup"><span data-stu-id="06f48-176">If not, once again create a [**Progress**](https://msdn.microsoft.com/library/hh193692.aspx) object to provide a progress callback for the delete operation.</span></span> <span data-ttu-id="06f48-177">[**DeleteImportedItemsFromSourceAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult.DeleteImportedItemsFromSourceAsync) を呼び出して、インポートされた項目の削除を開始します。</span><span class="sxs-lookup"><span data-stu-id="06f48-177">Call [**DeleteImportedItemsFromSourceAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportImportItemsResult.DeleteImportedItemsFromSourceAsync) to start deleting the imported items.</span></span> <span data-ttu-id="06f48-178">**AsTask** を使用して、進行状況の報告機能と取り消し機能を持った待機可能なタスクに結果を変換します。</span><span class="sxs-lookup"><span data-stu-id="06f48-178">Us **AsTask** to convert the result to an awaitable task with progress and cancellation capabilities.</span></span> <span data-ttu-id="06f48-179">待機後、返された [**PhotoImportDeleteImportedItemsFromSourceResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportDeleteImportedItemsFromSourceResult) オブジェクトを使用して、削除操作に関する状態情報を取得および表示できます。</span><span class="sxs-lookup"><span data-stu-id="06f48-179">After awaiting, the returned [**PhotoImportDeleteImportedItemsFromSourceResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Import.PhotoImportDeleteImportedItemsFromSourceResult) object can be used to get and display status information about the delete operation.</span></span>

[!code-cs[DeleteClick](./code/PhotoImport_Win10/cs/MainPage.xaml.cs#SnippetDeleteClick)]








 


