---
ms.assetid: 3FD2AA71-EF67-47B2-9332-3FFA5D3703EA
description: この記事では、BitmapDecoder と BitmapEncoder を使って画像ファイルを読み込んだり保存したりする方法のほか、SoftwareBitmap オブジェクトを使ってビットマップ画像を表現する方法について説明します。
title: ビットマップ画像の作成、編集、保存
ms.date: 03/22/2018
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: 7c61a35f0ad35cf85afcba564eb676aa171b0243
ms.sourcegitcommit: ac7f3422f8d83618f9b6b5615a37f8e5c115b3c4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2019
ms.locfileid: "66360843"
---
# <a name="create-edit-and-save-bitmap-images"></a><span data-ttu-id="164b9-104">ビットマップ画像の作成、編集、保存</span><span class="sxs-lookup"><span data-stu-id="164b9-104">Create, edit, and save bitmap images</span></span>



<span data-ttu-id="164b9-105">この記事では、[**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder) と [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder) を使って画像ファイルを読み込んだり保存したりする方法のほか、[**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) オブジェクトを使ってビットマップ画像を表現する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="164b9-105">This article explains how to load and save image files using [**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder) and [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder) and how to use the [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) object to represent bitmap images.</span></span>

<span data-ttu-id="164b9-106">**SoftwareBitmap** クラスは、さまざまなソースから作成できる多用途の API です。画像ファイルや [**WriteableBitmap**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Media.Imaging.WriteableBitmap) オブジェクト、Direct3D サーフェスから作成できるほか、コードから作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="164b9-106">The **SoftwareBitmap** class is a versatile API that can be created from multiple sources including image files, [**WriteableBitmap**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Media.Imaging.WriteableBitmap) objects, Direct3D surfaces, and code.</span></span> <span data-ttu-id="164b9-107">**SoftwareBitmap** を使うと、異なるピクセル形式間やアルファ モード間の変換、ピクセル データへの低レベル アクセスを簡単に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="164b9-107">**SoftwareBitmap** allows you to easily convert between different pixel formats and alpha modes, and allows low-level access to pixel data.</span></span> <span data-ttu-id="164b9-108">Windows のさまざまな機能のインターフェイスとしても、**SoftwareBitmap** は広く使われています。その例を以下に挙げます。</span><span class="sxs-lookup"><span data-stu-id="164b9-108">Also, **SoftwareBitmap** is a common interface used by multiple features of Windows, including:</span></span>

-   <span data-ttu-id="164b9-109">[**CapturedFrame** ](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.CapturedFrame)としてカメラによってキャプチャされたフレームを取得することができます、 **SoftwareBitmap**します。</span><span class="sxs-lookup"><span data-stu-id="164b9-109">[**CapturedFrame**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.CapturedFrame) allows you to get frames captured by the camera as a **SoftwareBitmap**.</span></span>

-   <span data-ttu-id="164b9-110">[**VideoFrame** ](https://docs.microsoft.com/uwp/api/Windows.Media.VideoFrame)を取得することができます、 **SoftwareBitmap**の表現、 **VideoFrame**します。</span><span class="sxs-lookup"><span data-stu-id="164b9-110">[**VideoFrame**](https://docs.microsoft.com/uwp/api/Windows.Media.VideoFrame) allows you to get a **SoftwareBitmap** representation of a **VideoFrame**.</span></span>

-   <span data-ttu-id="164b9-111">[**FaceDetector** ](https://docs.microsoft.com/uwp/api/Windows.Media.FaceAnalysis.FaceDetector)で顔を検出することができます、 **SoftwareBitmap**します。</span><span class="sxs-lookup"><span data-stu-id="164b9-111">[**FaceDetector**](https://docs.microsoft.com/uwp/api/Windows.Media.FaceAnalysis.FaceDetector) allows you to detect faces in a **SoftwareBitmap**.</span></span>

<span data-ttu-id="164b9-112">この記事のサンプル コードには、以下の名前空間の API が使われています。</span><span class="sxs-lookup"><span data-stu-id="164b9-112">The sample code in this article uses APIs from the following namespaces.</span></span>

[!code-cs[Namespaces](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetNamespaces)]

## <a name="create-a-softwarebitmap-from-an-image-file-with-bitmapdecoder"></a><span data-ttu-id="164b9-113">BitmapDecoder で画像ファイルから SoftwareBitmap を作成する</span><span class="sxs-lookup"><span data-stu-id="164b9-113">Create a SoftwareBitmap from an image file with BitmapDecoder</span></span>

<span data-ttu-id="164b9-114">[  **SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) をファイルから作成するには、画像データを含んだ [**StorageFile**](https://docs.microsoft.com/uwp/api/Windows.Storage.StorageFile) のインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-114">To create a [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) from a file, get an instance of [**StorageFile**](https://docs.microsoft.com/uwp/api/Windows.Storage.StorageFile) containing the image data.</span></span> <span data-ttu-id="164b9-115">この例では、[**FileOpenPicker**](https://docs.microsoft.com/uwp/api/Windows.Storage.Pickers.FileOpenPicker) を使って、画像ファイルをユーザーが選択できるようにしています。</span><span class="sxs-lookup"><span data-stu-id="164b9-115">This example uses a [**FileOpenPicker**](https://docs.microsoft.com/uwp/api/Windows.Storage.Pickers.FileOpenPicker) to allow the user to select an image file.</span></span>

[!code-cs[PickInputFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetPickInputFile)]

<span data-ttu-id="164b9-116">**StorageFile** オブジェクトの [**OpenAsync**](https://docs.microsoft.com/uwp/api/windows.storage.istoragefile.openasync) メソッドを呼び出して、画像データを含んだランダム アクセス ストリームを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-116">Call the [**OpenAsync**](https://docs.microsoft.com/uwp/api/windows.storage.istoragefile.openasync) method of the **StorageFile** object to get a random access stream containing the image data.</span></span> <span data-ttu-id="164b9-117">静的メソッド [**BitmapDecoder.CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapdecoder.createasync) を呼び出して、指定したストリームの [**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder) クラスのインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-117">Call the static method [**BitmapDecoder.CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapdecoder.createasync) to get an instance of the [**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder) class for the specified stream.</span></span> <span data-ttu-id="164b9-118">[  **GetSoftwareBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapdecoder.getsoftwarebitmapasync) を呼び出して、画像が格納されている [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) オブジェクトを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-118">Call [**GetSoftwareBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapdecoder.getsoftwarebitmapasync) to get a [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) object containing the image.</span></span>

[!code-cs[CreateSoftwareBitmapFromFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateSoftwareBitmapFromFile)]

## <a name="save-a-softwarebitmap-to-a-file-with-bitmapencoder"></a><span data-ttu-id="164b9-119">BitmapEncoder で SoftwareBitmap をファイルに保存する</span><span class="sxs-lookup"><span data-stu-id="164b9-119">Save a SoftwareBitmap to a file with BitmapEncoder</span></span>

<span data-ttu-id="164b9-120">**SoftwareBitmap** をファイルに保存するには、画像の保存先となる **StorageFile** のインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-120">To save a **SoftwareBitmap** to a file, get an instance of **StorageFile** to which the image will be saved.</span></span> <span data-ttu-id="164b9-121">この例では、[**FileSavePicker**](https://docs.microsoft.com/uwp/api/Windows.Storage.Pickers.FileSavePicker) を使って、ユーザーが出力ファイルを選択できるピッカーを表示しています。</span><span class="sxs-lookup"><span data-stu-id="164b9-121">This example uses a [**FileSavePicker**](https://docs.microsoft.com/uwp/api/Windows.Storage.Pickers.FileSavePicker) to allow the user to select an output file.</span></span>

[!code-cs[PickOutputFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetPickOutputFile)]

<span data-ttu-id="164b9-122">**StorageFile** オブジェクトの [**OpenAsync**](https://docs.microsoft.com/uwp/api/windows.storage.istoragefile.openasync) メソッドを呼び出して、画像の書き込み先となるランダム アクセス ストリームを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-122">Call the [**OpenAsync**](https://docs.microsoft.com/uwp/api/windows.storage.istoragefile.openasync) method of the **StorageFile** object to get a random access stream to which the image will be written.</span></span> <span data-ttu-id="164b9-123">静的メソッド [**BitmapEncoder.CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createasync) を呼び出して、指定したストリームの [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder) クラスのインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-123">Call the static method [**BitmapEncoder.CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createasync) to get an instance of the [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder) class for the specified stream.</span></span> <span data-ttu-id="164b9-124">**CreateAsync** の第 1 パラメーターは、画像のエンコードに使うコーデックの GUID です。</span><span class="sxs-lookup"><span data-stu-id="164b9-124">The first parameter to **CreateAsync** is a GUID representing the codec that should be used to encode the image.</span></span> <span data-ttu-id="164b9-125">エンコーダーがサポートしている各コーデックについて、この ID を保持するプロパティが、**BitmapEncoder** クラスによって公開されています ([**JpegEncoderId**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.jpegencoderid) など)。</span><span class="sxs-lookup"><span data-stu-id="164b9-125">**BitmapEncoder** class exposes a property containing the ID for each codec supported by the encoder, such as [**JpegEncoderId**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.jpegencoderid).</span></span>

<span data-ttu-id="164b9-126">エンコードの対象となる画像は、[**SetSoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.setsoftwarebitmap) メソッドを使って設定します。</span><span class="sxs-lookup"><span data-stu-id="164b9-126">Use the [**SetSoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.setsoftwarebitmap) method to set the image that will be encoded.</span></span> <span data-ttu-id="164b9-127">[  **BitmapTransform**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapTransform) プロパティの値を設定することで、画像のエンコード中に基本的な変換を適用することができます。</span><span class="sxs-lookup"><span data-stu-id="164b9-127">You can set values of the [**BitmapTransform**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapTransform) property to apply basic transforms to the image while it is being encoded.</span></span> <span data-ttu-id="164b9-128">エンコーダーで縮小表示が生成されるかどうかは、[**IsThumbnailGenerated**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.isthumbnailgenerated) プロパティによって決まります。</span><span class="sxs-lookup"><span data-stu-id="164b9-128">The [**IsThumbnailGenerated**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.isthumbnailgenerated) property determines whether a thumbnail is generated by the encoder.</span></span> <span data-ttu-id="164b9-129">ファイル形式によっては縮小表示がサポートされない場合があるので注意してください。この機能を使う場合、縮小表示がサポートされない場合にスローされるエラー (サポート外操作エラー) をキャッチする必要があります。</span><span class="sxs-lookup"><span data-stu-id="164b9-129">Note that not all file formats support thumbnails, so if you use this feature, you should catch the unsupported operation error that will be thrown if thumbnails are not supported.</span></span>

<span data-ttu-id="164b9-130">[  **FlushAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.flushasync) を呼び出すと、指定されたファイルへの画像データの書き込みをエンコーダーが開始します。</span><span class="sxs-lookup"><span data-stu-id="164b9-130">Call [**FlushAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.flushasync) to cause the encoder to write the image data to the specified file.</span></span>

[!code-cs[SaveSoftwareBitmapToFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetSaveSoftwareBitmapToFile)]

<span data-ttu-id="164b9-131">その他のエンコード オプションは、**BitmapEncoder** を作成するときに、新しい [**BitmapPropertySet**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapPropertySet) オブジェクトを作成し、そこにエンコーダーの設定を表す [**BitmapTypedValue**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapTypedValue) オブジェクトを渡すことによって指定できます。</span><span class="sxs-lookup"><span data-stu-id="164b9-131">You can specify additional encoding options when you create the **BitmapEncoder** by creating a new [**BitmapPropertySet**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapPropertySet) object and populating it with one or more [**BitmapTypedValue**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapTypedValue) objects representing the encoder settings.</span></span> <span data-ttu-id="164b9-132">サポートされているエンコーダー オプションの一覧については、「[BitmapEncoder オプション リファレンス](bitmapencoder-options-reference.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="164b9-132">For a list of supported encoder options, see [BitmapEncoder options reference](bitmapencoder-options-reference.md).</span></span>

[!code-cs[UseEncodingOptions](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetUseEncodingOptions)]

## <a name="use-softwarebitmap-with-a-xaml-image-control"></a><span data-ttu-id="164b9-133">SoftwareBitmap と XAML Image コントロールを使う</span><span class="sxs-lookup"><span data-stu-id="164b9-133">Use SoftwareBitmap with a XAML Image control</span></span>

<span data-ttu-id="164b9-134">[  **Image**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.Image) コントロールを使って XAML ページ内に画像を表示するには、まず XAML ページで **Image** コントロールを定義します。</span><span class="sxs-lookup"><span data-stu-id="164b9-134">To display an image within a XAML page using the [**Image**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.Image) control, first define an **Image** control in your XAML page.</span></span>

[!code-xml[ImageControl](./code/ImagingWin10/cs/MainPage.xaml#SnippetImageControl)]

<span data-ttu-id="164b9-135">現時点では、**Image** コントロールは、BGRA8 エンコードを使用し、プリマルチプライ処理済みまたはアルファ チャネルなしの画像のみをサポートします。</span><span class="sxs-lookup"><span data-stu-id="164b9-135">Currently, the **Image** control only supports images that use BGRA8 encoding and pre-multiplied or no alpha channel.</span></span> <span data-ttu-id="164b9-136">画像を表示する前に、画像の形式が正しいことをテストしてください。形式が不適切な場合は、**SoftwareBitmap** の [**Convert**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.windows) メソッドを使用して、サポートされる形式に画像を変換してください。</span><span class="sxs-lookup"><span data-stu-id="164b9-136">Before attempting to display an image, test to make sure it has the correct format, and if not, use the **SoftwareBitmap** static [**Convert**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.windows) method to convert the image to the supported format.</span></span>

<span data-ttu-id="164b9-137">新しい [**SoftwareBitmapSource**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource) オブジェクトを作ります。</span><span class="sxs-lookup"><span data-stu-id="164b9-137">Create a new [**SoftwareBitmapSource**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource) object.</span></span> <span data-ttu-id="164b9-138">[  **SetBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource.setbitmapasync) を呼び出し、**SoftwareBitmap** で渡して、ソース オブジェクトの内容を設定します。</span><span class="sxs-lookup"><span data-stu-id="164b9-138">Set the contents of the source object by calling [**SetBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource.setbitmapasync), passing in a **SoftwareBitmap**.</span></span> <span data-ttu-id="164b9-139">その新しく作成した **SoftwareBitmapSource** を、**Image** コントロールの [**Source**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.image.source) プロパティに設定します。</span><span class="sxs-lookup"><span data-stu-id="164b9-139">Then you can set the [**Source**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.image.source) property of the **Image** control to the newly created **SoftwareBitmapSource**.</span></span>

[!code-cs[SoftwareBitmapToWriteableBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetSoftwareBitmapToWriteableBitmap)]

<span data-ttu-id="164b9-140">**SoftwareBitmapSource** を [**ImageBrush**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Media.ImageBrush) の [**ImageSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imagebrush.imagesource) として使用して **SoftwareBitmap** を設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="164b9-140">You can also use **SoftwareBitmapSource** to set a **SoftwareBitmap** as the [**ImageSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imagebrush.imagesource) for an [**ImageBrush**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Media.ImageBrush).</span></span>

## <a name="create-a-softwarebitmap-from-a-writeablebitmap"></a><span data-ttu-id="164b9-141">WriteableBitmap から SoftwareBitmap を作成する</span><span class="sxs-lookup"><span data-stu-id="164b9-141">Create a SoftwareBitmap from a WriteableBitmap</span></span>

<span data-ttu-id="164b9-142">[  **SoftwareBitmap.CreateCopyFromBuffer**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.createcopyfrombuffer) を呼び出して、**WriteableBitmap** の **PixelBuffer** プロパティを指定することで、既存の **WriteableBitmap** から **SoftwareBitmap** を作成し、ピクセル データを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="164b9-142">You can create a **SoftwareBitmap** from an existing **WriteableBitmap** by calling [**SoftwareBitmap.CreateCopyFromBuffer**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.createcopyfrombuffer) and supplying the **PixelBuffer** property of the **WriteableBitmap** to set the pixel data.</span></span> <span data-ttu-id="164b9-143">新しく作成する **WriteableBitmap** のピクセル形式は第 2 引数で指定できます。</span><span class="sxs-lookup"><span data-stu-id="164b9-143">The second argument allows you to request a pixel format for the newly created **WriteableBitmap**.</span></span> <span data-ttu-id="164b9-144">新しい画像のサイズは、**WriteableBitmap** の [**PixelWidth**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.bitmapsource.pixelwidth) プロパティと [**PixelHeight**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.bitmapsource.pixelheight) プロパティを使って指定してください。</span><span class="sxs-lookup"><span data-stu-id="164b9-144">You can use the [**PixelWidth**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.bitmapsource.pixelwidth) and [**PixelHeight**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.bitmapsource.pixelheight) properties of the **WriteableBitmap** to specify the dimensions of the new image.</span></span>

[!code-cs[WriteableBitmapToSoftwareBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetWriteableBitmapToSoftwareBitmap)]

## <a name="create-or-edit-a-softwarebitmap-programmatically"></a><span data-ttu-id="164b9-145">SoftwareBitmap をプログラムから作成または編集する</span><span class="sxs-lookup"><span data-stu-id="164b9-145">Create or edit a SoftwareBitmap programmatically</span></span>

<span data-ttu-id="164b9-146">ここまでは、画像ファイルを使った方法を紹介してきました。</span><span class="sxs-lookup"><span data-stu-id="164b9-146">So far this topic has addressed working with image files.</span></span> <span data-ttu-id="164b9-147">新しい **SoftwareBitmap** をプログラム コードから作成し、同じ手法を用いて **SoftwareBitmap** のピクセル データにアクセスし、変更を加えることもできます。</span><span class="sxs-lookup"><span data-stu-id="164b9-147">You can also create a new **SoftwareBitmap** programatically in code and use the same technique to access and modify the **SoftwareBitmap**'s pixel data.</span></span>

<span data-ttu-id="164b9-148">**SoftwareBitmap** では、ピクセル データを含んだ RAW バッファーが、COM 相互運用機能を使って公開されます。</span><span class="sxs-lookup"><span data-stu-id="164b9-148">**SoftwareBitmap** uses COM interop to expose the raw buffer containing the pixel data.</span></span>

<span data-ttu-id="164b9-149">COM 相互運用機能を使うには、**System.Runtime.InteropServices** 名前空間の参照をプロジェクトに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="164b9-149">To use COM interop, you must include a reference to the **System.Runtime.InteropServices** namespace in your project.</span></span>

[!code-cs[InteropNamespace](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetInteropNamespace)]

<span data-ttu-id="164b9-150">COM インターフェイス [**IMemoryBufferByteAccess**](https://docs.microsoft.com/previous-versions//mt297505(v=vs.85)) を初期化するには、対象の名前空間に以下のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="164b9-150">Initialize the [**IMemoryBufferByteAccess**](https://docs.microsoft.com/previous-versions//mt297505(v=vs.85)) COM interface by adding the following code within your namespace.</span></span>

[!code-cs[COMImport](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCOMImport)]

<span data-ttu-id="164b9-151">必要なピクセル形式とサイズを指定して新しい **SoftwareBitmap** を作成します。</span><span class="sxs-lookup"><span data-stu-id="164b9-151">Create a new **SoftwareBitmap** with pixel format and size you want.</span></span> <span data-ttu-id="164b9-152">既にある **SoftwareBitmap** のピクセル データを編集する必要がある場合は、その SoftwareBitmap を使ってもかまいません。</span><span class="sxs-lookup"><span data-stu-id="164b9-152">Or, use an existing **SoftwareBitmap** for which you want to edit the pixel data.</span></span> <span data-ttu-id="164b9-153">[  **SoftwareBitmap.LockBuffer**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.lockbuffer) を呼び出して、ピクセル データ バッファーを表す [**BitmapBuffer**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapBuffer) クラスのインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-153">Call [**SoftwareBitmap.LockBuffer**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.lockbuffer) to obtain an instance of the [**BitmapBuffer**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapBuffer) class representing the pixel data buffer.</span></span> <span data-ttu-id="164b9-154">**BitmapBuffer** を COM インターフェイス **IMemoryBufferByteAccess** にキャストしたうえで [**IMemoryBufferByteAccess.GetBuffer**](https://docs.microsoft.com/windows/desktop/WinRT/imemorybufferbyteaccess-getbuffer) を呼び出し、バイト配列にデータを設定します。</span><span class="sxs-lookup"><span data-stu-id="164b9-154">Cast the **BitmapBuffer** to the **IMemoryBufferByteAccess** COM interface and then call [**IMemoryBufferByteAccess.GetBuffer**](https://docs.microsoft.com/windows/desktop/WinRT/imemorybufferbyteaccess-getbuffer) to populate a byte array with data.</span></span> <span data-ttu-id="164b9-155">ピクセルごとにバッファーのオフセットを計算しやすいよう、[**BitmapBuffer.GetPlaneDescription**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapbuffer.getplanedescription) メソッドを使って [**BitmapPlaneDescription**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapPlaneDescription) オブジェクトを取得します。</span><span class="sxs-lookup"><span data-stu-id="164b9-155">Use the [**BitmapBuffer.GetPlaneDescription**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapbuffer.getplanedescription) method to get a [**BitmapPlaneDescription**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapPlaneDescription) object that will help you calculate the offset into the buffer for each pixel.</span></span>

[!code-cs[CreateNewSoftwareBitmap](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateNewSoftwareBitmap)]

<span data-ttu-id="164b9-156">このメソッドは、Windows ランタイム型よりも低いレベルの RAW バッファーにアクセスするため、**unsafe** キーワードを使って宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="164b9-156">Because this method accesses the raw buffer underlying the Windows Runtime types, it must be declared using the **unsafe** keyword.</span></span> <span data-ttu-id="164b9-157">また、Microsoft Visual Studio でアンセーフ コードのコンパイルを許可するようにプロジェクトを構成する必要があります。プロジェクトの **[プロパティ]** ページを開き、 **[ビルド]** プロパティ ページをクリックして、 **[アンセーフ コードの許可]** チェック ボックスをオンにしてください。</span><span class="sxs-lookup"><span data-stu-id="164b9-157">You must also configure your project in Microsoft Visual Studio to allow the compilation of unsafe code by opening the project's **Properties** page, clicking the **Build** property page, and selecting the **Allow Unsafe Code** checkbox.</span></span>

## <a name="create-a-softwarebitmap-from-a-direct3d-surface"></a><span data-ttu-id="164b9-158">Direct3D サーフェスから SoftwareBitmap を作成する</span><span class="sxs-lookup"><span data-stu-id="164b9-158">Create a SoftwareBitmap from a Direct3D surface</span></span>

<span data-ttu-id="164b9-159">Direct3D サーフェスから **SoftwareBitmap** オブジェクトを作成するには、プロジェクトで [**Windows.Graphics.DirectX.Direct3D11**](https://docs.microsoft.com/uwp/api/Windows.Graphics.DirectX.Direct3D11) 名前空間を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="164b9-159">To create a **SoftwareBitmap** object from a Direct3D surface, you must include the [**Windows.Graphics.DirectX.Direct3D11**](https://docs.microsoft.com/uwp/api/Windows.Graphics.DirectX.Direct3D11) namespace in your project.</span></span>

[!code-cs[Direct3DNamespace](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetDirect3DNamespace)]

<span data-ttu-id="164b9-160">サーフェスから新しい **SoftwareBitmap** を作成するには、[**CreateCopyFromSurfaceAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.createcopyfromsurfaceasync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="164b9-160">Call [**CreateCopyFromSurfaceAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.createcopyfromsurfaceasync) to create a new **SoftwareBitmap** from the surface.</span></span> <span data-ttu-id="164b9-161">この名前を見るとわかるように、新しい **SoftwareBitmap** には、画像データのコピーが別に存在します。</span><span class="sxs-lookup"><span data-stu-id="164b9-161">As the name indicates, the new **SoftwareBitmap** has a separate copy of the image data.</span></span> <span data-ttu-id="164b9-162">**SoftwareBitmap** に変更を加えても、Direct3D サーフェスには一切影響しません。</span><span class="sxs-lookup"><span data-stu-id="164b9-162">Modifications to the **SoftwareBitmap** will not have any effect on the Direct3D surface.</span></span>

[!code-cs[CreateSoftwareBitmapFromSurface](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetCreateSoftwareBitmapFromSurface)]

## <a name="convert-a-softwarebitmap-to-a-different-pixel-format"></a><span data-ttu-id="164b9-163">SoftwareBitmap を異なるピクセル形式に変換する</span><span class="sxs-lookup"><span data-stu-id="164b9-163">Convert a SoftwareBitmap to a different pixel format</span></span>

<span data-ttu-id="164b9-164">**SoftwareBitmap** クラスの静的メソッド [**Convert**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.windows) を使うと、既にある **SoftwareBitmap** から、指定したピクセル形式とアルファ モードを使った新しい **SoftwareBitmap** を簡単に作成することができます。</span><span class="sxs-lookup"><span data-stu-id="164b9-164">The **SoftwareBitmap** class provides the static method, [**Convert**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.windows), that allows you to easily create a new **SoftwareBitmap** that uses the pixel format and alpha mode you specify from an existing **SoftwareBitmap**.</span></span> <span data-ttu-id="164b9-165">新しく作成されたビットマップには、画像データのコピーが別に存在します。</span><span class="sxs-lookup"><span data-stu-id="164b9-165">Note that the newly created bitmap has a separate copy of the image data.</span></span> <span data-ttu-id="164b9-166">新しいビットマップに変更を加えても、元のビットマップには一切影響しません。</span><span class="sxs-lookup"><span data-stu-id="164b9-166">Modifications to the new bitmap will not affect the source bitmap.</span></span>

[!code-cs[Convert](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetConvert)]

## <a name="transcode-an-image-file"></a><span data-ttu-id="164b9-167">画像ファイルのトランスコード</span><span class="sxs-lookup"><span data-stu-id="164b9-167">Transcode an image file</span></span>

<span data-ttu-id="164b9-168">画像ファイルを [**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder) から [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder) に直接トランスコードすることができます。</span><span class="sxs-lookup"><span data-stu-id="164b9-168">You can transcode an image file directly from a [**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder) to a [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder).</span></span> <span data-ttu-id="164b9-169">トランスコードの対象となるファイルから [**IRandomAccessStream**](https://docs.microsoft.com/uwp/api/Windows.Storage.Streams.IRandomAccessStream) を作成します。</span><span class="sxs-lookup"><span data-stu-id="164b9-169">Create a [**IRandomAccessStream**](https://docs.microsoft.com/uwp/api/Windows.Storage.Streams.IRandomAccessStream) from the file to be transcoded.</span></span> <span data-ttu-id="164b9-170">入力ストリームから新しい **BitmapDecoder** を作成します。</span><span class="sxs-lookup"><span data-stu-id="164b9-170">Create a new **BitmapDecoder** from the input stream.</span></span> <span data-ttu-id="164b9-171">エンコーダーの書き込み先となる新しい [**InMemoryRandomAccessStream**](https://docs.microsoft.com/uwp/api/Windows.Storage.Streams.InMemoryRandomAccessStream) を作成し、[**BitmapEncoder.CreateForTranscodingAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createfortranscodingasync) を呼び出します。このとき、引数にインメモリ ストリームとデコーダー オブジェクトを渡します。</span><span class="sxs-lookup"><span data-stu-id="164b9-171">Create a new [**InMemoryRandomAccessStream**](https://docs.microsoft.com/uwp/api/Windows.Storage.Streams.InMemoryRandomAccessStream) for the encoder to write to and call [**BitmapEncoder.CreateForTranscodingAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createfortranscodingasync), passing in the in-memory stream and the decoder object.</span></span> <span data-ttu-id="164b9-172">トランスコードではエンコード オプションはサポートされません。オプションを指定する場合は、代わりに [**CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createasync) を使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="164b9-172">Encode options are not supported when transcoding; instead you should use [**CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createasync).</span></span> <span data-ttu-id="164b9-173">入力画像ファイルのプロパティのうち、エンコーダーに対して明示的に指定しなかったプロパティはすべて、元のまま出力ファイルに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="164b9-173">Any properties in the input image file that you do not specifically set on the encoder, will be written to the output file unchanged.</span></span> <span data-ttu-id="164b9-174">[  **FlushAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.flushasync) を呼び出すと、インメモリ ストリームへのエンコードをエンコーダーが開始します。</span><span class="sxs-lookup"><span data-stu-id="164b9-174">Call [**FlushAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.flushasync) to cause the encoder to encode to the in-memory stream.</span></span> <span data-ttu-id="164b9-175">最後に、ファイル ストリームとインメモリ ストリームを先頭までシークし、[**CopyAsync**](https://docs.microsoft.com/uwp/api/windows.storage.streams.randomaccessstream.copyasync) を呼び出してインメモリ ストリームをファイル ストリームに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="164b9-175">Finally, seek the file stream and the in-memory stream to the beginning and call [**CopyAsync**](https://docs.microsoft.com/uwp/api/windows.storage.streams.randomaccessstream.copyasync) to write the in-memory stream out to the file stream.</span></span>

[!code-cs[TranscodeImageFile](./code/ImagingWin10/cs/MainPage.xaml.cs#SnippetTranscodeImageFile)]

## <a name="related-topics"></a><span data-ttu-id="164b9-176">関連トピック</span><span class="sxs-lookup"><span data-stu-id="164b9-176">Related topics</span></span>

* [<span data-ttu-id="164b9-177">BitmapEncoder オプションのリファレンス</span><span class="sxs-lookup"><span data-stu-id="164b9-177">BitmapEncoder options reference</span></span>](bitmapencoder-options-reference.md)
* [<span data-ttu-id="164b9-178">イメージのメタデータ</span><span class="sxs-lookup"><span data-stu-id="164b9-178">Image Metadata</span></span>](image-metadata.md)
 

 




