---
ms.assetid: E0189423-1DF3-4052-AB2E-846EA18254C4
description: このトピックでは、カメラのプレビューおよび録画中のビデオ ストリームに効果を適用する方法と、ビデオ手ブレ補正効果を使用する方法について説明します。
title: ビデオ キャプチャの効果
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: ea79794f18da01438392bb0bc37b127668a53538
ms.sourcegitcommit: ac7f3422f8d83618f9b6b5615a37f8e5c115b3c4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2019
ms.locfileid: "66361766"
---
# <a name="effects-for-video-capture"></a><span data-ttu-id="a1f7f-104">ビデオ キャプチャの効果</span><span class="sxs-lookup"><span data-stu-id="a1f7f-104">Effects for video capture</span></span>


<span data-ttu-id="a1f7f-105">このトピックでは、カメラのプレビューおよび録画中のビデオ ストリームに効果を適用する方法と、ビデオ手ブレ補正効果を使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-105">This topic shows you how to apply effects to the camera preview and recording video streams and shows you how to use the video stabilization effect.</span></span>

> [!NOTE] 
> <span data-ttu-id="a1f7f-106">この記事の内容は、写真やビデオの基本的なキャプチャ機能を実装するための手順を紹介した「[MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ](basic-photo-video-and-audio-capture-with-MediaCapture.md)」で取り上げた概念やコードに基づいています。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-106">This article builds on concepts and code discussed in [Basic photo, video, and audio capture with MediaCapture](basic-photo-video-and-audio-capture-with-MediaCapture.md), which describes the steps for implementing basic photo and video capture.</span></span> <span data-ttu-id="a1f7f-107">そちらの記事で基本的なメディア キャプチャのパターンを把握してから、高度なキャプチャ シナリオに進むことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-107">We recommend that you familiarize yourself with the basic media capture pattern in that article before moving on to more advanced capture scenarios.</span></span> <span data-ttu-id="a1f7f-108">この記事で紹介しているコードは、MediaCapture のインスタンスが既に作成され、適切に初期化されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-108">The code in this article assumes that your app already has an instance of MediaCapture that has been properly initialized.</span></span>

## <a name="adding-and-removing-effects-from-the-camera-video-stream"></a><span data-ttu-id="a1f7f-109">カメラのビデオ ストリームに対する効果の追加と削除</span><span class="sxs-lookup"><span data-stu-id="a1f7f-109">Adding and removing effects from the camera video stream</span></span>
<span data-ttu-id="a1f7f-110">デバイスのカメラからビデオをプレビューまたはキャプチャするには、「[MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ](basic-photo-video-and-audio-capture-with-MediaCapture.md)」で説明されているように、[**MediaCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.MediaCapture) オブジェクトを使用します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-110">To capture or preview video from the device's camera, you use the [**MediaCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.MediaCapture) object as described in [Basic photo, video, and audio capture with MediaCapture](basic-photo-video-and-audio-capture-with-MediaCapture.md).</span></span> <span data-ttu-id="a1f7f-111">**MediaCapture** オブジェクトを初期化した後、プレビュー ストリームやキャプチャ ストリームに 1 つまたは複数のビデオ効果を追加できます。そのためには、[**AddVideoEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.addvideoeffectasync) を呼び出して、追加する効果を表す [**IVideoEffectDefinition**](https://docs.microsoft.com/uwp/api/Windows.Media.Effects.IVideoEffectDefinition) オブジェクトと、カメラのプレビュー ストリームとレコード ストリームのどちらに効果を追加するかを示す [**MediaStreamType**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.MediaStreamType) 列挙のメンバーを渡します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-111">After you have initialized the **MediaCapture** object, you can add one or more video effects to the preview or capture stream by calling [**AddVideoEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.addvideoeffectasync), passing in an [**IVideoEffectDefinition**](https://docs.microsoft.com/uwp/api/Windows.Media.Effects.IVideoEffectDefinition) object representing the effect to be added, and a member of the [**MediaStreamType**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.MediaStreamType) enumeration indicating whether the effect should be added to the camera's preview stream or the record stream.</span></span>

> [!NOTE]
> <span data-ttu-id="a1f7f-112">一部のデバイスでは、プレビュー ストリームとキャプチャ ストリームが同じである場合があります。これは、**AddVideoEffectAsync** を呼び出すときに **MediaStreamType.VideoPreview** または **MediaStreamType.VideoRecord** を指定すると、プレビュー ストリームとレコード ストリームの両方に効果が適用されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-112">On some devices, the preview stream and the capture stream are the same, which means that if you specify **MediaStreamType.VideoPreview** or **MediaStreamType.VideoRecord** when you call **AddVideoEffectAsync**, the effect will be applied to both preview and record streams.</span></span> <span data-ttu-id="a1f7f-113">現在のデバイスでプレビュー ストリームとレコード ストリームが同じであるかどうかを確認するには、**MediaCapture** オブジェクトの [**MediaCaptureSettings**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.mediacapturesettings) の [**VideoDeviceCharacteristic**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapturesettings.videodevicecharacteristic) プロパティを調べます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-113">You can determine whether the preview and record streams are the same on the current device by checking the [**VideoDeviceCharacteristic**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapturesettings.videodevicecharacteristic) property of the [**MediaCaptureSettings**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.mediacapturesettings) for the **MediaCapture** object.</span></span> <span data-ttu-id="a1f7f-114">このプロパティの値が **VideoDeviceCharacteristic.AllStreamsIdentical** または **VideoDeviceCharacteristic.PreviewRecordStreamsIdentical** である場合、ストリームは同じであり、一方に対して適用したすべての効果はもう一方にも影響します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-114">If the value of this property is **VideoDeviceCharacteristic.AllStreamsIdentical** or **VideoDeviceCharacteristic.PreviewRecordStreamsIdentical**, then the streams are the same and any effect you apply to one will affect the other.</span></span>

<span data-ttu-id="a1f7f-115">次の例では、カメラのプレビュー ストリームとレコード ストリームの両方に効果を追加します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-115">The following example adds an effect to both the camera preview and record streams.</span></span> <span data-ttu-id="a1f7f-116">この例では、レコード ストリームとプレビュー ストリームが同じかどうかを確認する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-116">This example illustrates checking to see if the record and preview streams are the same.</span></span>

[!code-cs[BasicAddEffect](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetBasicAddEffect)]

<span data-ttu-id="a1f7f-117">**AddVideoEffectAsync** は、追加されたビデオ効果を表す [**IMediaExtension**](https://docs.microsoft.com/uwp/api/Windows.Media.IMediaExtension) を実装するオブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-117">Note that **AddVideoEffectAsync** returns an object that implements [**IMediaExtension**](https://docs.microsoft.com/uwp/api/Windows.Media.IMediaExtension) that represents the added video effect.</span></span> <span data-ttu-id="a1f7f-118">一部の効果では、[**PropertySet**](https://docs.microsoft.com/uwp/api/Windows.Foundation.Collections.PropertySet) を [**SetProperties**](https://docs.microsoft.com/uwp/api/windows.media.imediaextension.setproperties) メソッドに渡すことによって、効果の設定を変更できます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-118">Some effects allow you to change the effect settings by passing a [**PropertySet**](https://docs.microsoft.com/uwp/api/Windows.Foundation.Collections.PropertySet) into the [**SetProperties**](https://docs.microsoft.com/uwp/api/windows.media.imediaextension.setproperties) method.</span></span>

<span data-ttu-id="a1f7f-119">Windows 10 バージョン 1607 では、**AddVideoEffectAsync** によって返されるオブジェクトを [**RemoveEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.removeeffectasync) に渡すことによって、ビデオ パイプラインから効果を削除することもできます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-119">Starting with Windows 10, version 1607, you can also use the object returned by **AddVideoEffectAsync** to remove the effect from the video pipeline by passing it into [**RemoveEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.removeeffectasync).</span></span> <span data-ttu-id="a1f7f-120">**RemoveEffectAsync** は、効果オブジェクトのパラメーターがプレビュー ストリームとレコード ストリームのどちらに追加されたかを自動的に特定するため、呼び出しの際にストリームの種類を指定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-120">**RemoveEffectAsync** automatically determines whether the effect object parameter was added to the preview or record stream, so you don't need to specify the stream type when making the call.</span></span>

[!code-cs[RemoveOneEffect](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetRemoveOneEffect)]

<span data-ttu-id="a1f7f-121">また、[**ClearEffectsAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.cleareffectsasync) を呼び出し、すべての効果を削除するストリームを指定して、プレビュー ストリームやキャプチャ ストリームからすべての効果を削除することもできます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-121">You can also remove all effects from the preview or capture stream by calling [**ClearEffectsAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.cleareffectsasync) and specifying the stream for which all effects should be removed.</span></span>

[!code-cs[ClearAllEffects](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetClearAllEffects)]

## <a name="video-stabilization-effect"></a><span data-ttu-id="a1f7f-122">ビデオ手ブレ補正効果</span><span class="sxs-lookup"><span data-stu-id="a1f7f-122">Video stabilization effect</span></span>

<span data-ttu-id="a1f7f-123">ビデオ手ブレ補正効果は、キャプチャ デバイスを手で支えることによって生じる動きを極力目立たなくするために、ビデオ ストリームのフレームを操作します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-123">The video stabilization effect manipulates the frames of a video stream to minimize shaking caused by holding the capture device in your hand.</span></span> <span data-ttu-id="a1f7f-124">この手法を適用するとピクセルが上下左右に移動されますが、ビデオ フレームのすぐ外側に何があるのかは、手ブレ補正効果のロジックにはわからないため、手ブレ補正後は元のビデオがわずかにトリミングされた状態となります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-124">Because this technique causes the pixels to be shifted right, left, up, and down, and because the effect can't know what the content just outside the video frame is, the stabilized video is cropped slightly from the original video.</span></span> <span data-ttu-id="a1f7f-125">ここで紹介しているユーティリティ関数を使いビデオ エンコードの設定を調整することで、手ブレ補正効果によるトリミングをベストな状態に制御することができます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-125">A utility function is provided to allow you to adjust your video encoding settings to optimally manage the cropping performed by the effect.</span></span>

<span data-ttu-id="a1f7f-126">デバイス側でサポートされていれば、Optical Image Stabilization (OIS) がキャプチャ デバイスを機械的に操作することでビデオのブレが抑えられるため、ビデオ フレームの端をトリミングする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-126">On devices that support it, Optical Image Stabilization (OIS) stabilizes video by mechanically manipulating the capture device and, therefore, does not need to crop the edges of the video frames.</span></span> <span data-ttu-id="a1f7f-127">詳しくは、「[ビデオ キャプチャのためのキャプチャ デバイス コントロール](capture-device-controls-for-video-capture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-127">For more information, see [Capture device controls for video capture](capture-device-controls-for-video-capture.md).</span></span>

### <a name="set-up-your-app-to-use-video-stabilization"></a><span data-ttu-id="a1f7f-128">ビデオの手ブレ補正を行うようにアプリを設定する</span><span class="sxs-lookup"><span data-stu-id="a1f7f-128">Set up your app to use video stabilization</span></span>

<span data-ttu-id="a1f7f-129">ビデオ手ブレ補正効果を使うためには、基本的なメディア キャプチャに必要な名前空間に加え、次の名前空間が必要となります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-129">In addition to the namespaces required for basic media capture, using the video stabilization effect requires the following namespace.</span></span>

[!code-cs[VideoStabilizationEffectUsing](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetVideoStabilizationEffectUsing)]

<span data-ttu-id="a1f7f-130">[  **VideoStabilizationEffect**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffect) オブジェクトを格納するためのメンバー変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-130">Declare a member variable to store the [**VideoStabilizationEffect**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffect) object.</span></span> <span data-ttu-id="a1f7f-131">効果の実装の一部として、キャプチャしたビデオをエンコードするために使うエンコードのプロパティを変更します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-131">As part of the effect implementation, you will modify the encoding properties that you use to encode the captured video.</span></span> <span data-ttu-id="a1f7f-132">後で効果が無効にされたときに入出力のエンコード プロパティを復元できるよう、初期状態のバックアップ コピーを格納するための 2 つの変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-132">Declare two variables to store a backup copy of the initial input and output encoding properties so that you can restore them later when the effect is disabled.</span></span> <span data-ttu-id="a1f7f-133">最後に、[**MediaEncodingProfile**](https://docs.microsoft.com/uwp/api/Windows.Media.MediaProperties.MediaEncodingProfile) 型のメンバー変数を宣言します。メンバー変数として宣言しているのは、コードのいたるところからこのオブジェクトにアクセスすることになるためです。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-133">Finally, declare a member variable of type [**MediaEncodingProfile**](https://docs.microsoft.com/uwp/api/Windows.Media.MediaProperties.MediaEncodingProfile) because this object will be accessed from multiple locations within your code.</span></span>

[!code-cs[DeclareVideoStabilizationEffect](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetDeclareVideoStabilizationEffect)]

<span data-ttu-id="a1f7f-134">このシナリオでは、後からアクセスできるようメディア エンコード プロファイル オブジェクトをメンバー変数に代入する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-134">For this scenario, you should assign the media encoding profile object to a member variable so that you can access it later.</span></span>

[!code-cs[EncodingProfileMember](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetEncodingProfileMember)]

### <a name="initialize-the-video-stabilization-effect"></a><span data-ttu-id="a1f7f-135">ビデオ手ブレ補正効果を初期化する</span><span class="sxs-lookup"><span data-stu-id="a1f7f-135">Initialize the video stabilization effect</span></span>

<span data-ttu-id="a1f7f-136">**MediaCapture** オブジェクトの初期化後、[**VideoStabilizationEffectDefinition**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffectDefinition) オブジェクトの新しいインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-136">After your **MediaCapture** object has been initialized, create a new instance of the [**VideoStabilizationEffectDefinition**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffectDefinition) object.</span></span> <span data-ttu-id="a1f7f-137">効果をビデオ パイプラインに追加し、[**VideoStabilizationEffect**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffect) クラスのインスタンスを取得するには、[**MediaCapture.AddVideoEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.addvideoeffectasync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-137">Call [**MediaCapture.AddVideoEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.addvideoeffectasync) to add the effect to the video pipeline and retrieve an instance of the [**VideoStabilizationEffect**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffect) class.</span></span> <span data-ttu-id="a1f7f-138">[  **MediaStreamType.VideoRecord**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.MediaStreamType) を指定すると、ビデオ レコード ストリームに効果を適用する、という意味になります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-138">Specify [**MediaStreamType.VideoRecord**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.MediaStreamType) to indicate that the effect should be applied to the video record stream.</span></span>

<span data-ttu-id="a1f7f-139">[  **EnabledChanged**](https://docs.microsoft.com/uwp/api/windows.media.core.videostabilizationeffect.enabledchanged) イベントのハンドラーを登録し、ヘルパー メソッド **SetUpVideoStabilizationRecommendationAsync** を呼び出します。詳細については後で説明します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-139">Register an event handler for the [**EnabledChanged**](https://docs.microsoft.com/uwp/api/windows.media.core.videostabilizationeffect.enabledchanged) event and call the helper method **SetUpVideoStabilizationRecommendationAsync**, both of which are discussed later in this article.</span></span> <span data-ttu-id="a1f7f-140">最後に、[**Enabled**](https://docs.microsoft.com/uwp/api/windows.media.core.videostabilizationeffect.enabled) プロパティを true に設定して効果を有効にします。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-140">Finally, set the [**Enabled**](https://docs.microsoft.com/uwp/api/windows.media.core.videostabilizationeffect.enabled) property of the effect to true to enable the effect.</span></span>

[!code-cs[CreateVideoStabilizationEffect](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetCreateVideoStabilizationEffect)]

### <a name="use-recommended-encoding-properties"></a><span data-ttu-id="a1f7f-141">推奨エンコード プロパティを使う</span><span class="sxs-lookup"><span data-stu-id="a1f7f-141">Use recommended encoding properties</span></span>

<span data-ttu-id="a1f7f-142">先ほども触れましたが、ビデオ手ブレ補正効果に使われている手法では必然的に、補正後、わずかですが元のビデオがトリミングされます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-142">As discussed earlier in this article, the technique that the video stabilization effect uses necessarily causes the stabilized video to be cropped slightly from the source video.</span></span> <span data-ttu-id="a1f7f-143">これは手ブレ補正効果の制限です。ビデオ エンコード プロパティを調整して、できるだけ適切に対処するために、以下のヘルパー関数をコードの中で定義してください。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-143">Define the following helper function in your code in order to adjust the video encoding properties to optimally handle this limitation of the effect.</span></span> <span data-ttu-id="a1f7f-144">このステップはビデオ手ブレ補正効果を使ううえで必須ではありませんが、これを省略した場合、最終的に得られるビデオが若干アップスケーリングされるために、ビジュアルの再現性がわずかに低下します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-144">This step is not required in order to use the video stabilization effect, but if you don't perform this step, the resulting video will be upscaled slightly and therefore have slightly lower visual fidelity.</span></span>

<span data-ttu-id="a1f7f-145">VideoStabilizationEffect のインスタンスの [**GetRecommendedStreamConfiguration**](https://docs.microsoft.com/uwp/api/windows.media.core.videostabilizationeffect.getrecommendedstreamconfiguration) を呼び出します。このメソッドは、ビデオ補正効果に対して現在の入力ストリームのエンコード プロパティを伝える [**VideoDeviceController**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.VideoDeviceController) オブジェクトと、現在の出力エンコード プロパティを伝える **MediaEncodingProfile** とを引数として受け取ります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-145">Call [**GetRecommendedStreamConfiguration**](https://docs.microsoft.com/uwp/api/windows.media.core.videostabilizationeffect.getrecommendedstreamconfiguration) on your video stabilization effect instance, passing in the [**VideoDeviceController**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.VideoDeviceController) object, which informs the effect about your current input stream encoding properties, and your **MediaEncodingProfile** which lets the effect know your current output encoding properties.</span></span> <span data-ttu-id="a1f7f-146">このメソッドの戻り値である [**VideoStreamConfiguration**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.VideoStreamConfiguration) オブジェクトには、入力ストリームと出力ストリームの最新の推奨エンコード プロパティが格納されます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-146">This method returns a [**VideoStreamConfiguration**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.VideoStreamConfiguration) object containing new recommended input and output stream encoding properties.</span></span>

<span data-ttu-id="a1f7f-147">効果のトリミング適用後に失われる解像度を最小限にするために、入力の推奨エンコード プロパティは、デバイスによってサポートされる範囲で、指定した初期設定よりも解像度が高くなります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-147">The recommended input encoding properties are, if it is supported by the device, a higher resolution that the initial settings you provided so that there is minimal loss in resolution after the effect's cropping is applied.</span></span>

<span data-ttu-id="a1f7f-148">新しいエンコード プロパティを設定するには、[**VideoDeviceController.SetMediaStreamPropertiesAsync**](https://docs.microsoft.com/uwp/api/windows.media.devices.videodevicecontroller.setmediastreampropertiesasync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-148">Call [**VideoDeviceController.SetMediaStreamPropertiesAsync**](https://docs.microsoft.com/uwp/api/windows.media.devices.videodevicecontroller.setmediastreampropertiesasync) to set the new encoding properties.</span></span> <span data-ttu-id="a1f7f-149">効果を無効にしたときに設定を元に戻すことができるよう、新しいプロパティを設定する前にメンバー変数を使って初期エンコード プロパティを保存します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-149">Before setting the new properties, use the member variable to store the initial encoding properties so that you can change the settings back when you disable the effect.</span></span>

<span data-ttu-id="a1f7f-150">ビデオ手ブレ補正効果で出力ビデオをトリミングする必要がある場合、出力の推奨エンコード プロパティは、トリミングされたビデオのサイズになります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-150">If the video stabilization effect must crop the output video, the recommended output encoding properties will be the size of the cropped video.</span></span> <span data-ttu-id="a1f7f-151">つまり出力の解像度は、トリミングされたビデオのサイズと一致します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-151">This means that the output resolution will match the cropped video size.</span></span> <span data-ttu-id="a1f7f-152">推奨される出力プロパティを使わなかった場合、最初の出力サイズに合わせてビデオがアップスケーリングされるため、ビジュアルの再現性が低下します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-152">If you do not use the recommended output properties, the video will be scaled up to match the initial output size, which will result in a loss of visual fidelity.</span></span>

<span data-ttu-id="a1f7f-153">**MediaEncodingProfile** オブジェクトの [**Video**](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile.video) プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-153">Set the [**Video**](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile.video) property of the **MediaEncodingProfile** object.</span></span> <span data-ttu-id="a1f7f-154">効果を無効にしたときに設定を元に戻すことができるよう、新しいプロパティを設定する前にメンバー変数を使って初期エンコード プロパティを保存します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-154">Before setting the new properties, use the member variable to store the initial encoding properties so that you can change the settings back when you disable the effect.</span></span>

[!code-cs[SetUpVideoStabilizationRecommendationAsync](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetSetUpVideoStabilizationRecommendationAsync)]

### <a name="handle-the-video-stabilization-effect-being-disabled"></a><span data-ttu-id="a1f7f-155">ビデオ手ブレ補正効果の無効化イベントを処理する</span><span class="sxs-lookup"><span data-stu-id="a1f7f-155">Handle the video stabilization effect being disabled</span></span>

<span data-ttu-id="a1f7f-156">ピクセル スループットが高すぎて効果の処理が追い付かない場合や、効果の実行に時間がかかっていることをシステムが検出した場合、ビデオ手ブレ補正効果がシステムによって自動的に無効化されます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-156">The system may automatically disable the video stabilization effect if the pixel throughput is too high for the effect to handle or if it detects that the effect is running slowly.</span></span> <span data-ttu-id="a1f7f-157">このように状態が変化した場合、EnabledChanged イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-157">If this occurs, the EnabledChanged event is raised.</span></span> <span data-ttu-id="a1f7f-158">最新の効果の状態 (有効または無効) は、*sender* パラメーターに格納された **VideoStabilizationEffect** のインスタンスによって知ることができます。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-158">The **VideoStabilizationEffect** instance in the *sender* parameter indicates the new state of the effect, enabled or disabled.</span></span> <span data-ttu-id="a1f7f-159">[  **VideoStabilizationEffectEnabledChangedEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffectEnabledChangedEventArgs) に格納される [**VideoStabilizationEffectEnabledChangedReason**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffectEnabledChangedReason) の値は、効果が有効または無効にされた理由を示しています。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-159">The [**VideoStabilizationEffectEnabledChangedEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffectEnabledChangedEventArgs) has a [**VideoStabilizationEffectEnabledChangedReason**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.VideoStabilizationEffectEnabledChangedReason) value indicating why the effect was enabled or disabled.</span></span> <span data-ttu-id="a1f7f-160">このイベントは、プログラムから効果を有効または無効にした場合にも発生します。この場合の理由は **Programmatic** になります。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-160">Note that this event is also raised if you programmatically enable or disable the effect, in which case the reason will be **Programmatic**.</span></span>

<span data-ttu-id="a1f7f-161">通常、このイベントを使ってアプリの UI を調整し、ビデオ手ブレ補正の現在の状態を示します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-161">Typically, you would use this event to adjust your app's UI to indicate the current status of video stabilization.</span></span>

[!code-cs[VideoStabilizationEnabledChanged](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetVideoStabilizationEnabledChanged)]

### <a name="clean-up-the-video-stabilization-effect"></a><span data-ttu-id="a1f7f-162">ビデオ手ブレ補正効果をクリーンアップする</span><span class="sxs-lookup"><span data-stu-id="a1f7f-162">Clean up the video stabilization effect</span></span>

<span data-ttu-id="a1f7f-163">ビデオ手ブレ補正効果をクリーンアップするには、[**RemoveEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.removeeffectasync) を呼び出してビデオ パイプラインから効果を削除します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-163">To clean up the video stabilization effect, call [**RemoveEffectAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.removeeffectasync) to remove the effect from the video pipeline.</span></span> <span data-ttu-id="a1f7f-164">初期エンコード プロパティを格納しているメンバー変数が null 以外であれば、それらの変数を使ってエンコード プロパティを復元します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-164">If the member variables containing the initial encoding properties are not null, use them to restore the encoding properties.</span></span> <span data-ttu-id="a1f7f-165">最後に、**EnabledChanged** イベント ハンドラーを削除し、効果を null に設定します。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-165">Finally, remove the **EnabledChanged** event handler and set the effect to null.</span></span>

[!code-cs[CleanUpVisualStabilizationEffect](./code/SimpleCameraPreview_Win10/cs/MainPage.Effects.xaml.cs#SnippetCleanUpVisualStabilizationEffect)]

## <a name="related-topics"></a><span data-ttu-id="a1f7f-166">関連トピック</span><span class="sxs-lookup"><span data-stu-id="a1f7f-166">Related topics</span></span>

* [<span data-ttu-id="a1f7f-167">カメラ</span><span class="sxs-lookup"><span data-stu-id="a1f7f-167">Camera</span></span>](camera.md)
* [<span data-ttu-id="a1f7f-168">MediaCapture で基本的な写真、ビデオ、およびオーディオのキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="a1f7f-168">Basic photo, video, and audio capture with MediaCapture</span></span>](basic-photo-video-and-audio-capture-with-MediaCapture.md)
 

 




