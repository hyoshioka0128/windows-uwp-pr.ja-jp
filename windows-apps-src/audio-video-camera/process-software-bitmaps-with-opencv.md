---
ms.assetid: ''
description: この記事では、Open Source Computer Vision Library (OpenCV) で、SoftwareBitmap クラスを使用する方法について説明します。
title: OpenCV でのビットマップの処理
ms.date: 03/19/2018
ms.topic: article
keywords: Windows 10, UWP, OpenCV, SoftwareBitmap
ms.localizationpriority: medium
ms.openlocfilehash: 45f76744070a7557939d1d7f2307113852737072
ms.sourcegitcommit: c01c29cd97f1cbf050950526e18e15823b6a12a0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2018
ms.locfileid: "8686616"
---
# <a name="process-bitmaps-with-opencv"></a><span data-ttu-id="fa842-104">OpenCV でのビットマップの処理</span><span class="sxs-lookup"><span data-stu-id="fa842-104">Process bitmaps with OpenCV</span></span>

<span data-ttu-id="fa842-105">この記事では、さまざまな種類の UWP API で使用されている **[SoftwareBitmap](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap)** クラスを、さまざまな画像処理アルゴリズムを提供するオープン ソースの、ネイティブ コード ライブラリである Open Source Computer Vision Library (OpenCV) で使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="fa842-105">This article explains how to use the **[SoftwareBitmap](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap)** class, which is used by many different UWP APIs to represent images, with the Open Source Computer Vision Library (OpenCV), an open source, native code library that provides a wide variety of image processing algorithms.</span></span> 

<span data-ttu-id="fa842-106">この記事の例は、C# を使用して作成されるアプリを含め、UWP アプリから使用できるネイティブ コードの Windows ランタイム コンポーネントを作成するチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="fa842-106">The examples in this article walk you through creating a native code Windows Runtime Component that can be used from a UWP app, including apps that are created using C#.</span></span> <span data-ttu-id="fa842-107">このヘルパー コンポーネントは、OpenCV の blur 画像処理関数を使用する 1 つのメソッド **Blur** を公開します。</span><span class="sxs-lookup"><span data-stu-id="fa842-107">This helper component will expose a single method, **Blur**, which will use OpenCV's blur image processing function.</span></span> <span data-ttu-id="fa842-108">このコンポーネントは、OpenCV ライブラリから直接使用できる、基になる画像データ バッファーへのポインターを取得するプライベート メソッドを実装します。これにより、ヘルパー コンポーネントを拡張して他の OpenCV 処理機能を実装することが容易になります。</span><span class="sxs-lookup"><span data-stu-id="fa842-108">The component implements private methods that get a pointer to the underlying image data buffer which can be used directly by the OpenCV library, making it simple to extend the helper component to implement other OpenCV processing features.</span></span> 

* <span data-ttu-id="fa842-109">**SoftwareBitmap** の使用方法の概要については、「[ビットマップ画像の作成、編集、保存](imaging.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="fa842-109">For an introduction to using **SoftwareBitmap**, see [Create, edit, and save bitmap images](imaging.md).</span></span> 
* <span data-ttu-id="fa842-110">OpenCV ライブラリーを使用する方法については、[http://opencv.org](http://opencv.org) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="fa842-110">To learn how to use the OpenCV library, go to [http://opencv.org](http://opencv.org).</span></span>
* <span data-ttu-id="fa842-111">この記事で説明する OpenCV ヘルパー コンポーネントを **[MediaFrameReader](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader)** と共に使用して、カメラからのフレームのリアルタイムの画像処理を実現する方法については、「[OpenCV と MediaFrameReader の使用](use-opencv-with-mediaframereader.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="fa842-111">To see how to use the OpenCV helper component shown in this article with **[MediaFrameReader](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader)** to implement real-time image processing of frames from a camera, see [Use OpenCV with MediaFrameReader](use-opencv-with-mediaframereader.md).</span></span>
* <span data-ttu-id="fa842-112">複数の効果を実装する完全なコード例については、Windows ユニバーサル サンプル GitHub リポジトリにある[カメラ フレームと OpenCV のサンプル](https://go.microsoft.com/fwlink/?linkid=854003)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="fa842-112">For a complete code example that implements some different effects, see the [Camera Frames + OpenCV Sample](https://go.microsoft.com/fwlink/?linkid=854003) in the Windows Universal Samples GitHub repo.</span></span>

> [!NOTE] 
> <span data-ttu-id="fa842-113">この記事で解説する OpenCVHelper コンポーネントで使用されている手法では、処理される画像データが GPU メモリではなく CPU メモリに格納されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa842-113">The technique used by the OpenCVHelper component, described in detail in this article, requires that the image data to be processed resides in CPU memory, not GPU memory.</span></span> <span data-ttu-id="fa842-114">したがって、画像のメモリ位置を要求できる API (**[MediaCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture)** クラスなど) では、CPU メモリを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa842-114">So, for APIs that allow you to request the memory location of images, such as the **[MediaCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture)** class, you should specify CPU memory.</span></span>

## <a name="create-a-helper-windows-runtime-component-for-opencv-interop"></a><span data-ttu-id="fa842-115">OpenCV 相互運用のためのヘルパー Windows ランタイム コンポーネントを作成する</span><span class="sxs-lookup"><span data-stu-id="fa842-115">Create a helper Windows Runtime Component for OpenCV interop</span></span>

### <a name="1-add-a-new-native-code-windows-runtime-component-project-to-your-solution"></a><span data-ttu-id="fa842-116">1. ソリューションに新しいネイティブ コードの Windows ランタイム コンポーネント プロジェクトを追加する</span><span class="sxs-lookup"><span data-stu-id="fa842-116">1. Add a new native code Windows Runtime Component project to your solution</span></span>

1. <span data-ttu-id="fa842-117">ソリューション エクスプローラーで、ソリューションを右クリックして **[追加]、[新しいプロジェクト]** の順に選択し、新しいプロジェクトを Visual Studio のソリューションに追加します。</span><span class="sxs-lookup"><span data-stu-id="fa842-117">Add a new project to your solution in Visual Studio by right-clicking your solution in Solution Explorer and selecting **Add->New Project**.</span></span> 
2. <span data-ttu-id="fa842-118">**[Visual C++]** カテゴリで、**[Windows ランタイム コンポーネント (ユニバーサル Windows)]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="fa842-118">Under the **Visual C++** category, select **Windows Runtime Component (Universal Windows)**.</span></span> <span data-ttu-id="fa842-119">この例では、「OpenCVBridge」というプロジェクト名を入力し、**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa842-119">For this example, name the project "OpenCVBridge" and click **OK**.</span></span> 
3. <span data-ttu-id="fa842-120">**[新しい Windows ユニバーサル プロジェクト]** ダイアログ ボックスで、アプリのターゲットと最小 OS バージョンを選択して **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa842-120">In the **New Windows Universal Project** dialog, select the target and minimum OS version for your app and click **OK**.</span></span>
4. <span data-ttu-id="fa842-121">ソリューション エクスプローラーで自動生成された Class1.cpp ファイルを右クリックして **[削除]** を選択し、確認のダイアログ ボックスが表示されたら **[削除]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="fa842-121">Right-click the autogerenated file Class1.cpp in Solution Explorer and select **Remove**, when the confirmation dialog pops up, choose **Delete**.</span></span> <span data-ttu-id="fa842-122">次に Class1.h ヘッダー ファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="fa842-122">Then delete the Class1.h header file.</span></span>
5. <span data-ttu-id="fa842-123">OpenCVBridge プロジェクト アイコンを右クリックし、**[追加]、[クラス]** の順に選択します。**[クラスの追加]** ダイアログ ボックスで、**[クラス名]** フィールドに「OpenCVHelper」と入力し、**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa842-123">Right-click the OpenCVBridge project icon and select **Add->Class...**. In the **Add Class** dialog, input "OpenCVHelper" in the **Class Name** field and then click **OK**.</span></span> <span data-ttu-id="fa842-124">コードは、後の手順で作成されるクラス ファイルに追加されます。</span><span class="sxs-lookup"><span data-stu-id="fa842-124">Code will be added to the created class files in a later step.</span></span>

### <a name="2-add-the-opencv-nuget-packages-to-your-component-project"></a><span data-ttu-id="fa842-125">2. OpenCV NuGet パッケージをコンポーネント プロジェクトに追加する</span><span class="sxs-lookup"><span data-stu-id="fa842-125">2. Add the OpenCV NuGet packages to your component project</span></span>

1. <span data-ttu-id="fa842-126">ソリューション エクスプローラーで、OpenCVBridge プロジェクト アイコンを右クリックし、**[NuGet パッケージの管理]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa842-126">Right-click the OpenCVBridge project icon in Solution Explorer and select **Manage NuGet Packages...**</span></span>
2. <span data-ttu-id="fa842-127">[NuGet パッケージ マネージャー] ダイアログが開いたら、**[参照]** タブを選択し、検索ボックスに「OpenCV.Win」と入力します。</span><span class="sxs-lookup"><span data-stu-id="fa842-127">When the NuGet Package Manager dialog opens, select the **Browse** tab and type "OpenCV.Win" in the search box.</span></span>
3. <span data-ttu-id="fa842-128">[OpenCV.Win.Core] を選択し、**[インストール]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa842-128">Select "OpenCV.Win.Core" and click **Install**.</span></span> <span data-ttu-id="fa842-129">**[プレビュー]** ダイアログ ボックスで、**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa842-129">In the **Preview** dialog, click **OK**.</span></span>
4. <span data-ttu-id="fa842-130">同じ手順で "OpenCV.Win.ImgProc" パッケージをインストールします。</span><span class="sxs-lookup"><span data-stu-id="fa842-130">Use the same procedure to install the "OpenCV.Win.ImgProc" package.</span></span>

> [!NOTE]
> <span data-ttu-id="fa842-131">OpenCV.Win.Core と OpenCV.Win.ImgProc は定期的に更新されていませんが、このページの説明に従って OpenCVHelper を作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="fa842-131">OpenCV.Win.Core and OpenCV.Win.ImgProc are not regularly updated, but are still recommended for creating an OpenCVHelper as described on this page.</span></span>

### <a name="3-implement-the-opencvhelper-class"></a><span data-ttu-id="fa842-132">3. OpenCVHelper クラスを実装する</span><span class="sxs-lookup"><span data-stu-id="fa842-132">3. Implement the OpenCVHelper class</span></span>

<span data-ttu-id="fa842-133">OpenCVHelper.h ヘッダー ファイルに以下のコードを貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="fa842-133">Paste the following code into the OpenCVHelper.h header file.</span></span> <span data-ttu-id="fa842-134">このコードには、インストールした *Core* パッケージと *ImgProc* パッケージの OpenCV ヘッダー ファイルが含まれており、以下の手順で示される 3 つのメソッドを宣言しています。</span><span class="sxs-lookup"><span data-stu-id="fa842-134">This code includes OpenCV header files for the *Core* and *ImgProc* packages we installed and declares three methods that will be shown in the following steps.</span></span>

[!code-cpp[OpenCVHelperHeader](./code/ImagingWin10/cs/OpenCVBridge/OpenCVHelper.h#SnippetOpenCVHelperHeader)]

<span data-ttu-id="fa842-135">OpenCVHelper.cpp ファイルの既存の内容を削除し、次の include ディレクティブを追加します。</span><span class="sxs-lookup"><span data-stu-id="fa842-135">Delete the existing contents of the OpenCVHelper.cpp file and then add the following include directives.</span></span> 

[!code-cpp[OpenCVHelperInclude](./code/ImagingWin10/cs/OpenCVBridge/OpenCVHelper.cpp#SnippetOpenCVHelperInclude)]

<span data-ttu-id="fa842-136">include ディレクティブの後に、以下の **using** ディレクティブを追加します。</span><span class="sxs-lookup"><span data-stu-id="fa842-136">After the include directives, add the following **using** directives.</span></span> 

[!code-cpp[OpenCVHelperUsing](./code/ImagingWin10/cs/OpenCVBridge/OpenCVHelper.cpp#SnippetOpenCVHelperUsing)]

<span data-ttu-id="fa842-137">次に、**GetPointerToPixelData** メソッドを OpenCVHelper.cpp に追加します。</span><span class="sxs-lookup"><span data-stu-id="fa842-137">Next, add the method **GetPointerToPixelData** to OpenCVHelper.cpp.</span></span> <span data-ttu-id="fa842-138">このメソッドは、**[SoftwareBitmap](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap)** を受け取り、一連の変換を経て、ピクセル データの COM インターフェイス表現を取得します。これにより、基になるデータ バッファーへのポインターを **char** 配列として取得できます。</span><span class="sxs-lookup"><span data-stu-id="fa842-138">This method takes a **[SoftwareBitmap](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap)** and, through a series of conversions, gets a COM interface representation of the pixel data through which we can get a pointer to the underlying data buffer as a **char** array.</span></span> 

<span data-ttu-id="fa842-139">最初に、ピクセル データを格納する **[BitmapBuffer](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapbuffer)** が、**[LockBuffer](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.lockbuffer)** を呼び出すことによって取得されます。LockBuffer は読み取り/書き込みバッファーを要求し、OpenCV ライブラリはそのピクセル データを変更できるようにします。</span><span class="sxs-lookup"><span data-stu-id="fa842-139">First a **[BitmapBuffer](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapbuffer)** containing the pixel data is obtained by calling **[LockBuffer](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.lockbuffer)**, requesting a read/write buffer so that the OpenCV library can modify that pixel data.</span></span>  <span data-ttu-id="fa842-140">**[CreateReference](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapbuffer.CreateReference)** が呼び出され、**[IMemoryBufferReference](https://docs.microsoft.com/uwp/api/windows.foundation.imemorybufferreference)** オブジェクトが取得されます。</span><span class="sxs-lookup"><span data-stu-id="fa842-140">**[CreateReference](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapbuffer.CreateReference)** is called to get an **[IMemoryBufferReference](https://docs.microsoft.com/uwp/api/windows.foundation.imemorybufferreference)** object.</span></span> <span data-ttu-id="fa842-141">次に、**IMemoryBufferByteAccess** インターフェイスが、すべての Windows ランタイム クラスの基本インターフェイスである **IInspectable** としてキャストされ、**[QueryInterface](https://msdn.microsoft.com/library/windows/desktop/ms682521(v=vs.85).aspx)** が呼び出されて **[IMemoryBufferByteAccess](https://msdn.microsoft.com/library/mt297505(v=vs.85).aspx)** COM インターフェイスが取得されます。これにより、ピクセル データ バッファーを **char** 配列として取得できます。</span><span class="sxs-lookup"><span data-stu-id="fa842-141">Next, the **IMemoryBufferByteAccess** interface is cast as an **IInspectable**, the base interface of all Windows Runtime classes, and **[QueryInterface](https://msdn.microsoft.com/library/windows/desktop/ms682521(v=vs.85).aspx)** is called to get an **[IMemoryBufferByteAccess](https://msdn.microsoft.com/library/mt297505(v=vs.85).aspx)** COM interface that will allow us to obtain the pixel data buffer as a **char** array.</span></span> <span data-ttu-id="fa842-142">最後に、**[IMemoryBufferByteAccess::GetBuffer](https://msdn.microsoft.com/library/mt297506(v=vs.85).aspx)** を呼び出して **char** 配列を設定します。</span><span class="sxs-lookup"><span data-stu-id="fa842-142">Finally, populate the **char** array by calling **[IMemoryBufferByteAccess::GetBuffer](https://msdn.microsoft.com/library/mt297506(v=vs.85).aspx)**.</span></span> <span data-ttu-id="fa842-143">このメソッドの変換手順のいずれかが失敗した場合、メソッドは **false** を返し、処理が続行できないことを示します。</span><span class="sxs-lookup"><span data-stu-id="fa842-143">If any of the conversion steps in this method fail, the method returns **false**, indicating that further processing can't continue.</span></span>

[!code-cpp[OpenCVHelperGetPointerToPixelData](./code/ImagingWin10/cs/OpenCVBridge/OpenCVHelper.cpp#SnippetOpenCVHelperGetPointerToPixelData)]

<span data-ttu-id="fa842-144">次に、以下に示すように **TryConvert** メソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="fa842-144">Next, add the method **TryConvert** method shown below.</span></span> <span data-ttu-id="fa842-145">このメソッドは、**SoftwareBitmap** を受け取り、**Mat** オブジェクトへの変換を試行します。このオブジェクトは、OpenCV が画像データ バッファーを表すために使用するマトリックス オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="fa842-145">This method takes a **SoftwareBitmap** and attempts to convert it to a **Mat** object, which is the matrix object OpenCV uses to represent image data buffers.</span></span> <span data-ttu-id="fa842-146">このメソッドは、上で定義した **GetPointerToPixelData** メソッドを呼び出して、ピクセル データ バッファーの **char** 配列表現を取得します。</span><span class="sxs-lookup"><span data-stu-id="fa842-146">This method calls the **GetPointerToPixelData** method defined above to get a **char** array representation of the pixel data buffer.</span></span> <span data-ttu-id="fa842-147">これが成功した場合、**Mat** クラスのコンストラクターが呼び出され、ソース **SoftwareBitmap** オブジェクトから取得されたピクセルの幅と高さが渡されます。</span><span class="sxs-lookup"><span data-stu-id="fa842-147">If this succeeds, the constructor for the **Mat** class is called, passing in the pixel width and height obtained from the source **SoftwareBitmap** object.</span></span> 

> [!NOTE] 
> <span data-ttu-id="fa842-148">この例では、作成された **Mat** オブジェクトのピクセル形式として CV_8UC4 定数を指定します。</span><span class="sxs-lookup"><span data-stu-id="fa842-148">This example specifies the CV_8UC4 constant as the pixel format for the created **Mat** object.</span></span> <span data-ttu-id="fa842-149">つまり、このメソッドに渡される **SoftwareBitmap** の **[BitmapPixelFormat](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.BitmapPixelFormat)** プロパティの値は、プリマルチプライ済みアルファを含む **[BGRA8](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapPixelFormat)** (この例で使用する CV_8UC4 と同等) である必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa842-149">This means that the **SoftwareBitmap** passed into this method must have a **[BitmapPixelFormat](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.BitmapPixelFormat)** property value of  **[BGRA8](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapPixelFormat)** with premultiplied alpha, the equivalent of CV_8UC4, to work with this example.</span></span>

<span data-ttu-id="fa842-150">作成された **Mat** オブジェクトのシャロー コピーがこのメソッドによって返されるため、それ以降の処理は、バッファーのコピーではなく、**SoftwareBitmap** によって参照される同じデータのピクセル データ バッファーで実行されます。</span><span class="sxs-lookup"><span data-stu-id="fa842-150">A shallow copy of the created **Mat** object is returned from the method so that further processing operates on the same data pixel data buffer referenced by the **SoftwareBitmap** and not a copy of this buffer.</span></span>

[!code-cpp[OpenCVHelperTryConvert](./code/ImagingWin10/cs/OpenCVBridge/OpenCVHelper.cpp#SnippetOpenCVHelperTryConvert)]

<span data-ttu-id="fa842-151">最後に、この例のヘルパー クラス メソッドは、1 つの画像処理メソッド **Blur** を実装します。これは、上で定義した **TryConvert** メソッドを使用して、ぼかし操作のソース ビットマップとターゲット ビットマップを表す **Mat** オブジェクトを取得し、OpenCV ImgProc ライブラリの **blur** メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="fa842-151">Finally, this example helper class implements a single image processing method, **Blur**, which simply uses the **TryConvert** method defined above to retrieve a **Mat** object representing the source bitmap and the target bitmap for the blur operation, and then calls the **blur** method from the OpenCV ImgProc library.</span></span> <span data-ttu-id="fa842-152">**blur** のその他のパラメーターで、X および Y 方向のぼかし効果のサイズを指定します。</span><span class="sxs-lookup"><span data-stu-id="fa842-152">The other parameter to **blur** specifies the size of the blur effect in the X and Y directions.</span></span>

[!code-cpp[OpenCVHelperBlur](./code/ImagingWin10/cs/OpenCVBridge/OpenCVHelper.cpp#SnippetOpenCVHelperBlur)]


## <a name="a-simple-softwarebitmap-opencv-example-using-the-helper-component"></a><span data-ttu-id="fa842-153">ヘルパー コンポーネントを使用するシンプルな SoftwareBitmap OpenCV の例</span><span class="sxs-lookup"><span data-stu-id="fa842-153">A simple SoftwareBitmap OpenCV example using the helper component</span></span>
<span data-ttu-id="fa842-154">OpenCVBridge コンポーネントが作成されたので、OpenCV の **blur** メソッドを使用して **SoftwareBitmap** を変更するシンプルな C# アプリを作成できます。</span><span class="sxs-lookup"><span data-stu-id="fa842-154">Now that the OpenCVBridge component has been created, we can create a simple C# app that uses the OpenCV **blur** method to modify a **SoftwareBitmap**.</span></span> <span data-ttu-id="fa842-155">UWP アプリから Windows ランタイム コンポーネントにアクセスするには、最初にコンポーネントへの参照を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa842-155">To access the Windows Runtime Component from your UWP app, you must first add a reference to the component.</span></span> <span data-ttu-id="fa842-156">ソリューション エクスプローラーで、UWP アプリ プロジェクトの下にある **[参照設定] **ノードを右クリックし、**[参照の追加]** を選択します。[参照マネージャー] ダイアログ ボックスで、**[プロジェクト]、[ソリューション]** の順に選択します。</span><span class="sxs-lookup"><span data-stu-id="fa842-156">In Solution Explorer, right-click the **References** node under your UWP app project and select **Add reference...**. In the Reference Manager dialog, select **Projects->Solution**.</span></span> <span data-ttu-id="fa842-157">OpenCVBridge プロジェクトの横のボックスをオンにし、**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa842-157">Check the box next to the OpenCVBridge project and the click **OK**.</span></span>

<span data-ttu-id="fa842-158">次のコード例では、ユーザーは画像ファイルを選択し、**[BitmapDecoder](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder)** を使用して画像の  **SoftwareBitmap** 表現を作成できます。</span><span class="sxs-lookup"><span data-stu-id="fa842-158">The example code below allows the user to select an image file and then uses **[BitmapDecoder](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder)** to create a **SoftwareBitmap** representation of the image.</span></span> <span data-ttu-id="fa842-159">**SoftwareBitmap** の操作について詳しくは、「[ビットマップ画像の作成、編集、保存](https://docs.microsoft.com/windows/uwp/audio-video-camera/imaging)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="fa842-159">For more information on working with **SoftwareBitmap**, see [Create, edit, and save bitmap images](https://docs.microsoft.com/windows/uwp/audio-video-camera/imaging).</span></span>

<span data-ttu-id="fa842-160">この記事で既に説明したように、**OpenCVHelper** クラスでは、提供されるすべての **SoftwareBitmap** 画像がプリマルチプライ済みアルファ付き BGRA8 ピクセル形式でエンコードされている必要があります。そのため、画像がこの形式ではない場合、このコード例では **[Convert](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.BitmapAlphaMode)** を呼び出して画像を予期された形式に変換します。</span><span class="sxs-lookup"><span data-stu-id="fa842-160">As discussed previously in this article, the **OpenCVHelper** class requires that all provided **SoftwareBitmap** images be encoded using the BGRA8 pixel format with premultiplied alpha values, so if the image is not already in this format, the example code calls **[Convert](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap.BitmapAlphaMode)** to convert the image into the expected format.</span></span>

<span data-ttu-id="fa842-161">次に、ぼかし操作のターゲットとして使用される **SoftwareBitmap** が作成されます。</span><span class="sxs-lookup"><span data-stu-id="fa842-161">Next, a **SoftwareBitmap** is created to be used as the target of the blur operation.</span></span> <span data-ttu-id="fa842-162">一致する形式のビットマップを作成するために、入力画像のプロパティがコンストラクターの引数として使用されます。</span><span class="sxs-lookup"><span data-stu-id="fa842-162">The input image properties are used as arguments to the constructor to create a bitmap with matching format.</span></span>

<span data-ttu-id="fa842-163">**OpenCVHelper** の新しいインスタンスが作成されると、**Blur** メソッドが呼び出され、ソースとターゲットのビットマップが渡されます。</span><span class="sxs-lookup"><span data-stu-id="fa842-163">A new instance of **OpenCVHelper** is created, and the **Blur** method is called, passing in the source and target bitmaps.</span></span> <span data-ttu-id="fa842-164">最後に、**SoftwareBitmapSource** が作成され、出力画像を XAML **Image** コントロールに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="fa842-164">Finally, a **SoftwareBitmapSource** is created to assign the output image to a XAML **Image** control.</span></span>


[!code-cs[OpenCVBlur](./code/ImagingWin10/cs/MainPage.OpenCV.xaml.cs#SnippetOpenCVBlur)]

## <a name="related-topics"></a><span data-ttu-id="fa842-165">関連トピック</span><span class="sxs-lookup"><span data-stu-id="fa842-165">Related topics</span></span>

* [<span data-ttu-id="fa842-166">BitmapEncoder オプション リファレンス</span><span class="sxs-lookup"><span data-stu-id="fa842-166">BitmapEncoder options reference</span></span>](bitmapencoder-options-reference.md)
* [<span data-ttu-id="fa842-167">画像のメタデータ</span><span class="sxs-lookup"><span data-stu-id="fa842-167">Image Metadata</span></span>](image-metadata.md)
 

 




