---
ms.assetid: C5623861-6280-4352-8F22-80EB009D662C
description: この記事では、ローカル ファイルやリモート ファイルなど、さまざまなソースのメディアを参照および再生するための一般的な方法を提供し、基になるメディア形式に関係なく、メディア データにアクセスするための一般的なモデルを公開する MediaSource の使い方について説明します。
title: メディア項目、プレイリスト、トラック
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: 472e163344c8cc2fdea3dd639383bb1dac84a2f4
ms.sourcegitcommit: ac7f3422f8d83618f9b6b5615a37f8e5c115b3c4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2019
ms.locfileid: "66361586"
---
# <a name="media-items-playlists-and-tracks"></a><span data-ttu-id="7dd52-104">メディア項目、プレイリスト、トラック</span><span class="sxs-lookup"><span data-stu-id="7dd52-104">Media items, playlists, and tracks</span></span>


 <span data-ttu-id="7dd52-105">この記事では、ローカル ファイルやリモート ファイルなど、さまざまなソースのメディアを参照および再生するための一般的な方法を提供し、基になるメディア形式に関係なく、メディア データにアクセスするための一般的なモデルを公開する [**MediaSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaSource) クラスの使い方について説明します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-105">This article shows you how to use the [**MediaSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaSource) class, which provides a common way to reference and play back media from different sources such as local or remote files and exposes a common model for accessing media data, regardless of the underlying media format.</span></span> <span data-ttu-id="7dd52-106">[  **MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem) クラスは、メディア項目に含まれている複数のオーディオ、ビデオ、メタデータ トラックを管理および選択できるようにして、**MediaSource** の機能を拡張します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-106">The [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem) class extends the functionality of **MediaSource**, allowing you to manage and select from multiple audio, video, and metadata tracks contained in a media item.</span></span> <span data-ttu-id="7dd52-107">[**MediaPlaybackList** ](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList)再生項目 1 つまたは複数のメディアからの再生リストを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-107">[**MediaPlaybackList**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList) allows you to create playback lists from one or more media playback items.</span></span>


## <a name="create-and-play-a-mediasource"></a><span data-ttu-id="7dd52-108">MediaSource を作成および再生する</span><span class="sxs-lookup"><span data-stu-id="7dd52-108">Create and play a MediaSource</span></span>

<span data-ttu-id="7dd52-109">クラスによって公開されているファクトリ メソッドのいずれかを呼び出すことによって、**MediaSource** の新しいインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-109">Create a new instance of **MediaSource** by calling one of the factory methods exposed by the class:</span></span>

-   [<span data-ttu-id="7dd52-110">**CreateFromAdaptiveMediaSource**</span><span class="sxs-lookup"><span data-stu-id="7dd52-110">**CreateFromAdaptiveMediaSource**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromadaptivemediasource)
-   [<span data-ttu-id="7dd52-111">**CreateFromIMediaSource**</span><span class="sxs-lookup"><span data-stu-id="7dd52-111">**CreateFromIMediaSource**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromimediasource)
-   [<span data-ttu-id="7dd52-112">**CreateFromMediaStreamSource**</span><span class="sxs-lookup"><span data-stu-id="7dd52-112">**CreateFromMediaStreamSource**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfrommediastreamsource)
-   [<span data-ttu-id="7dd52-113">**CreateFromMseStreamSource**</span><span class="sxs-lookup"><span data-stu-id="7dd52-113">**CreateFromMseStreamSource**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfrommsestreamsource)
-   [<span data-ttu-id="7dd52-114">**CreateFromStorageFile**</span><span class="sxs-lookup"><span data-stu-id="7dd52-114">**CreateFromStorageFile**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromstoragefile)
-   [<span data-ttu-id="7dd52-115">**CreateFromStream**</span><span class="sxs-lookup"><span data-stu-id="7dd52-115">**CreateFromStream**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromstream)
-   [<span data-ttu-id="7dd52-116">**CreateFromStreamReference**</span><span class="sxs-lookup"><span data-stu-id="7dd52-116">**CreateFromStreamReference**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromstreamreference)
-   [<span data-ttu-id="7dd52-117">**CreateFromUri**</span><span class="sxs-lookup"><span data-stu-id="7dd52-117">**CreateFromUri**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromuri)
-   [<span data-ttu-id="7dd52-118">**CreateFromDownloadOperation**</span><span class="sxs-lookup"><span data-stu-id="7dd52-118">**CreateFromDownloadOperation**</span></span>](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromdownloadoperation)

<span data-ttu-id="7dd52-119">作成した **MediaSource** は、[**Source**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer.source) プロパティを設定すると、[**MediaPlayer**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlayer) を使用して再生できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-119">After creating a **MediaSource** you can play it with a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlayer) by setting the [**Source**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer.source) property.</span></span> <span data-ttu-id="7dd52-120">Windows 10 バージョン 1607 以降では、XAML ページでメディア プレイヤー コンテンツをレンダリングするには、[**SetMediaPlayer**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement.setmediaplayer) を呼び出して **MediaPlayer** を [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.MediaPlayerElement) に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-120">Starting with Windows 10, version 1607, you can assign a **MediaPlayer** to a [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.MediaPlayerElement) by calling [**SetMediaPlayer**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement.setmediaplayer) in order to render the media player content in a XAML page.</span></span> <span data-ttu-id="7dd52-121">これは、**MediaElement** を使用するよりもお勧めの方法です。</span><span class="sxs-lookup"><span data-stu-id="7dd52-121">This is the preferred method over using **MediaElement**.</span></span> <span data-ttu-id="7dd52-122">**MediaPlayer** の使い方について詳しくは、「[**MediaPlayer を使ったオーディオとビデオの再生**](play-audio-and-video-with-mediaplayer.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="7dd52-122">For more information on using **MediaPlayer**, see [**Play audio and video with MediaPlayer**](play-audio-and-video-with-mediaplayer.md).</span></span>

<span data-ttu-id="7dd52-123">次の例では、**MediaSource** を使って **MediaPlayer** でユーザーが選択したメディア ファイルを再生する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-123">The following example shows how to play back a user-selected media file in a **MediaPlayer** using **MediaSource**.</span></span>

<span data-ttu-id="7dd52-124">このシナリオを実現するには、[**Windows.Media.Core**](https://docs.microsoft.com/uwp/api/Windows.Media.Core) および [**Windows.Media.Playback**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback) 名前空間を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-124">You will need to include the [**Windows.Media.Core**](https://docs.microsoft.com/uwp/api/Windows.Media.Core) and [**Windows.Media.Playback**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback) namespaces in order to complete this scenario.</span></span>

[!code-cs[Using](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetUsing)]

<span data-ttu-id="7dd52-125">**MediaSource** 型の変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-125">Declare a variable of type **MediaSource**.</span></span> <span data-ttu-id="7dd52-126">この記事の例では、複数の場所からアクセスできるように、メディア ソースはクラス メンバーとして宣言されています。</span><span class="sxs-lookup"><span data-stu-id="7dd52-126">For the examples in this article, the media source is declared as a class member so that it can be accessed from multiple locations.</span></span>

[!code-cs[DeclareMediaSource](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetDeclareMediaSource)]

<span data-ttu-id="7dd52-127">**MediaPlayer** オブジェクトを格納するための変数を宣言します。XAML でメディア コンテンツをレンダリングする場合は、**MediaPlayerElement** コントロールをページに追加します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-127">Declare a variable to store the **MediaPlayer** object and, if you want to render the media content in XAML, add a **MediaPlayerElement** control to your page.</span></span>

[!code-cs[DeclareMediaPlayer](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetDeclareMediaPlayer)]

[!code-xml[MediaPlayerElement](./code/MediaSource_RS1/cs/MainPage.xaml#SnippetMediaPlayerElement)]

<span data-ttu-id="7dd52-128">ユーザーが再生するメディア ファイルを選択できるようにするには、[**FileOpenPicker**](https://docs.microsoft.com/uwp/api/Windows.Storage.Pickers.FileOpenPicker) を使います。</span><span class="sxs-lookup"><span data-stu-id="7dd52-128">To allow the user to pick a media file to play, use a [**FileOpenPicker**](https://docs.microsoft.com/uwp/api/Windows.Storage.Pickers.FileOpenPicker).</span></span> <span data-ttu-id="7dd52-129">ピッカーの [**PickSingleFileAsync**](https://docs.microsoft.com/uwp/api/windows.storage.pickers.fileopenpicker.picksinglefileasync) メソッドから返された [**StorageFile**](https://docs.microsoft.com/uwp/api/Windows.Storage.StorageFile) オブジェクトを使って、[**MediaSource.CreateFromStorageFile**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromstoragefile) を呼び出すことにより、新しい MediaObject を初期化します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-129">With the [**StorageFile**](https://docs.microsoft.com/uwp/api/Windows.Storage.StorageFile) object returned from the picker's [**PickSingleFileAsync**](https://docs.microsoft.com/uwp/api/windows.storage.pickers.fileopenpicker.picksinglefileasync) method, initialize a new MediaObject by calling [**MediaSource.CreateFromStorageFile**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromstoragefile).</span></span> <span data-ttu-id="7dd52-130">最後に、[**SetPlaybackSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaelement.setplaybacksource) メソッドを呼び出すことによって、メディア ソースを、**MediaElement** の再生ソースとして設定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-130">Finally, set the media source as the playback source for the **MediaElement** by calling the [**SetPlaybackSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaelement.setplaybacksource) method.</span></span>

[!code-cs[PlayMediaSource](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetPlayMediaSource)]

<span data-ttu-id="7dd52-131">既定では、メディア ソースが設定されても **MediaPlayer** では自動的に再生が開始されません。</span><span class="sxs-lookup"><span data-stu-id="7dd52-131">By default, the **MediaPlayer** does not begin playing automatically when the media source is set.</span></span> <span data-ttu-id="7dd52-132">[  **Play**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer.play) を呼び出すことにより手動で再生を開始できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-132">You can manually begin playback by calling [**Play**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer.play).</span></span>

[!code-cs[Play](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetPlay)]

<span data-ttu-id="7dd52-133">**MediaPlayer** の [**AutoPlay**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer.autoplay) プロパティを true に設定して、メディア ソースが設定されたらすぐに再生を開始するようにプレイヤーに指示することもできます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-133">You can also set the [**AutoPlay**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer.autoplay) property of the **MediaPlayer** to true to tell the player to begin playing as soon as the media source is set.</span></span>

[!code-cs[AutoPlay](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetAutoPlay)]

### <a name="create-a-mediasource-from-a-downloadoperation"></a><span data-ttu-id="7dd52-134">DownloadOperation から MediaSource を作成する</span><span class="sxs-lookup"><span data-stu-id="7dd52-134">Create a MediaSource from a DownloadOperation</span></span>
<span data-ttu-id="7dd52-135">Windows、バージョン 1803 以降では、**DownloadOperation** から **MediaSource**オブジェクトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-135">Starting with Windows, version 1803, you can create a **MediaSource** object from a **DownloadOperation**.</span></span>

[!code-cs[CreateMediaSourceFromDownload](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetCreateMediaSourceFromDownload)]

<span data-ttu-id="7dd52-136">ダウンロードを開始したり、その **IsRandomAccessRequired** プロパティを true に設定したりしなくても、ダウンロードから **MediaSource** を作成できますが、**MediaSource** を **MediaPlayer** や **MediaPlayerElement** にアタッチするには、その前にこれら両方の操作を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-136">Note that while you can create a **MediaSource** from a download without starting it or setting its **IsRandomAccessRequired** property to true, you must do both of these things before attempting to attach the **MediaSource** to a **MediaPlayer** or **MediaPlayerElement** for playback.</span></span>

[!code-cs[StartDownload](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetStartDownload)]


## <a name="handle-multiple-audio-video-and-metadata-tracks-with-mediaplaybackitem"></a><span data-ttu-id="7dd52-137">MediaPlaybackItem を使って複数のオーディオ、ビデオ、メタデータ トラックを処理する</span><span class="sxs-lookup"><span data-stu-id="7dd52-137">Handle multiple audio, video, and metadata tracks with MediaPlaybackItem</span></span>

<span data-ttu-id="7dd52-138">[  **MediaSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaSource) を使った再生では、さまざまな種類のソースからメディアを再生するための共通の方法が提供されるため便利ですが、**MediaSource** から [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem) を作成することにより、さらに高度な動作を実現できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-138">Using a [**MediaSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaSource) for playback is convenient because it provides a common way to playback media from different kinds of sources, but more advanced behavior can be accessed by creating a [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem) from the **MediaSource**.</span></span> <span data-ttu-id="7dd52-139">これには、メディアの項目の複数のオーディオ、ビデオ、データのトラックにアクセスして管理する機能が含まれます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-139">This includes the ability to access and manage multiple audio, video, and data tracks for a media item.</span></span>

<span data-ttu-id="7dd52-140">**MediaPlaybackItem** を格納するための変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-140">Declare a variable to store your **MediaPlaybackItem**.</span></span>

[!code-cs[DeclareMediaPlaybackItem](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetDeclareMediaPlaybackItem)]

<span data-ttu-id="7dd52-141">コンストラクターを呼び出して、初期化された **MediaSource** オブジェクトを渡すことによって、**MediaPlaybackItem** を作成します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-141">Create a **MediaPlaybackItem** by calling the constructor and passing in an initialized **MediaSource** object.</span></span>

<span data-ttu-id="7dd52-142">アプリがメディア再生項目で複数のオーディオ、ビデオ、データのトラックをサポートしている場合は、[**AudioTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotrackschanged)、[**VideoTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotrackschanged)、または [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.timedmetadatatrackschanged) イベントのイベント ハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-142">If your app supports multiple audio, video, or data tracks in a media playback item, register event handlers for the [**AudioTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotrackschanged), [**VideoTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotrackschanged), or [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.timedmetadatatrackschanged) events.</span></span>

<span data-ttu-id="7dd52-143">最後に、**MediaElement** または **MediaPlayer** の再生ソースを **MediaPlaybackItem** に設定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-143">Finally, set the playback source of the **MediaElement** or **MediaPlayer** to your **MediaPlaybackItem**.</span></span>

[!code-cs[PlayMediaPlaybackItem](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetPlayMediaPlaybackItem)]

> [!NOTE] 
> <span data-ttu-id="7dd52-144">**MediaSource** は、単一の **MediaPlaybackItem** にのみ関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-144">A **MediaSource** can only be associated with a single **MediaPlaybackItem**.</span></span> <span data-ttu-id="7dd52-145">ソースから **MediaPlaybackItem** を作成した後、同じソースから別の再生項目を作成しようとすると、エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-145">After creating a **MediaPlaybackItem** from a source, attempting to create another playback item from the same source will result in an error.</span></span> <span data-ttu-id="7dd52-146">また、メディア ソースから **MediaPlaybackItem** を作成した後、**MediaSource** オブジェクトを **MediaPlayer** のソースとして直接設定することはできません。この場合は、代わりに **MediaPlaybackItem** を使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-146">Also, after creating a **MediaPlaybackItem** from a media source, you can't set the **MediaSource** object directly as the source for a **MediaPlayer** but should instead use the **MediaPlaybackItem**.</span></span>

<span data-ttu-id="7dd52-147">複数のビデオ トラックを含む **MediaPlaybackItem** が再生ソースとして割り当てられると、[**VideoTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotrackschanged) イベントが発生します。項目の変更としてビデオ トラックのリストが変更された場合は、再びイベントが発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-147">The [**VideoTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotrackschanged) event is raised after a **MediaPlaybackItem** containing multiple video tracks is assigned as a playback source, and can be raised again if the list of video tracks changes for the item changes.</span></span> <span data-ttu-id="7dd52-148">このイベントのハンドラーを使うと、ユーザーが利用可能なトラックを切り替えることができるように UI を更新する機会が提供されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-148">The handler for this event gives you the opportunity to update your UI to allow the user to switch between available tracks.</span></span> <span data-ttu-id="7dd52-149">この例では、[**ComboBox**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.ComboBox) を使って利用可能なビデオ トラックを表示します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-149">This example uses a [**ComboBox**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.ComboBox) to display the available video tracks.</span></span>

[!code-xml[VideoComboBox](./code/MediaSource_RS1/cs/MainPage.xaml#SnippetVideoComboBox)]

<span data-ttu-id="7dd52-150">**VideoTracksChanged** ハンドラーで、再生の項目の [**VideoTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotracks) のリストにあるすべてのトラックをループ処理します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-150">In the **VideoTracksChanged** handler, loop through all of the tracks in the playback item's [**VideoTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotracks) list.</span></span> <span data-ttu-id="7dd52-151">各トラックについて、新しい [**ComboBoxItem**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.ComboBoxItem) が作成されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-151">For each track, a new [**ComboBoxItem**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.ComboBoxItem) is created.</span></span> <span data-ttu-id="7dd52-152">トラックにまだラベルがない場合、トラックのインデックスからラベルが生成されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-152">If the track does not already have a label, a label is generated from the track index.</span></span> <span data-ttu-id="7dd52-153">コンボ ボックス項目の [**Tag**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.frameworkelement.tag) プロパティが、後で識別できるようにトラックのインデックスに設定されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-153">The [**Tag**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.frameworkelement.tag) property of the combo box item is set to the track index so that it can be identified later.</span></span> <span data-ttu-id="7dd52-154">最後に、コンボ ボックスに項目が追加されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-154">Finally, the item is added to the combo box.</span></span> <span data-ttu-id="7dd52-155">これらの処理は [**CoreDispatcher.RunAsync**](https://docs.microsoft.com/uwp/api/windows.ui.core.coredispatcher.windows) の呼び出し内で実行されます。UI の変更はすべて UI スレッドで実行される必要があり、このイベントは別のスレッドで発生しているためです。</span><span class="sxs-lookup"><span data-stu-id="7dd52-155">Note that these operations are performed within a [**CoreDispatcher.RunAsync**](https://docs.microsoft.com/uwp/api/windows.ui.core.coredispatcher.windows) call because all UI changes must be made on the UI thread and this event is raised on a different thread.</span></span>

[!code-cs[VideoTracksChanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetVideoTracksChanged)]

<span data-ttu-id="7dd52-156">コンボ ボックスの [**SelectionChanged**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.primitives.selector.selectionchanged) ハンドラーで、選択した項目の **Tag** プロパティからトラックのインデックスが取得されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-156">In the [**SelectionChanged**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.primitives.selector.selectionchanged) handler for the combo box, the track index is retrieved from the selected item's **Tag** property.</span></span> <span data-ttu-id="7dd52-157">メディア再生項目の [**VideoTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotracks) リストの [**SelectedIndex**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackvideotracklist.selectedindex) プロパティを設定すると、**MediaElement** または **MediaPlayer** はアクティブなビデオ トラックを、指定されたインデックスに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-157">Setting the [**SelectedIndex**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackvideotracklist.selectedindex) property of the media playback item's [**VideoTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.videotracks) list causes the **MediaElement** or **MediaPlayer** to switch the active video track to the specified index.</span></span>

[!code-cs[VideoTracksSelectionChanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetVideoTracksSelectionChanged)]

<span data-ttu-id="7dd52-158">複数のオーディオ トラックを含むメディア項目の管理は、ビデオ トラックの場合とまったく同じです。</span><span class="sxs-lookup"><span data-stu-id="7dd52-158">Managing media items with multiple audio tracks works exactly the same as with video tracks.</span></span> <span data-ttu-id="7dd52-159">[  **AudioTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotrackschanged) を処理し、再生項目の [**AudioTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotracks) リストで見つかったオーディオ トラックを使って、UI を更新します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-159">Handle the [**AudioTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotrackschanged) to update your UI with the audio tracks found in the playback item's [**AudioTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotracks) list.</span></span> <span data-ttu-id="7dd52-160">ユーザーがオーディオ トラックを選んだときに、**AudioTracks** リストの [**SelectedIndex**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackaudiotracklist.selectedindex) プロパティを設定すると、**MediaElement** または **MediaPlayer** はアクティブなオーディオ トラックを、指定されたインデックスに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-160">When the user selects an audio track, set the [**SelectedIndex**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackaudiotracklist.selectedindex) property of the **AudioTracks** list to cause the **MediaElement** or **MediaPlayer** to switch the active audio track to the specified index.</span></span>

[!code-xml[AudioComboBox](./code/MediaSource_RS1/cs/MainPage.xaml#SnippetAudioComboBox)]

[!code-cs[AudioTracksChanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetAudioTracksChanged)]

[!code-cs[AudioTracksSelectionChanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetAudioTracksSelectionChanged)]

<span data-ttu-id="7dd52-161">オーディオとビデオに加え、**MediaPlaybackItem** オブジェクトは 0 個以上の [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedMetadataTrack) オブジェクトを格納する場合があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-161">In addition to audio and video, a **MediaPlaybackItem** object may contain zero or more [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedMetadataTrack) objects.</span></span> <span data-ttu-id="7dd52-162">タイミングが設定されたメタデータ トラックは、サブタイトルまたはキャプション テキストを含めることができます。またはアプリに固有のカスタム データを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-162">A timed metadata track can contain subtitle or caption text, or it may contain custom data that is proprietary to your app.</span></span> <span data-ttu-id="7dd52-163">タイミングが設定されたメタデータ トラックには、[**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue) や [**TimedTextCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextCue) など、[**IMediaCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.IMediaCue) を継承するオブジェクトで表されるキューのリストが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-163">A timed metadata track contains a list of cues represented by objects that inherit from [**IMediaCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.IMediaCue), such as a [**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue) or a [**TimedTextCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextCue).</span></span> <span data-ttu-id="7dd52-164">各キューには開始時刻と継続時間があり、キューがいつアクティブ化され、どのくらいの時間アクティブ化されているかを決定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-164">Each cue has a start time and a duration that determines when the cue is activated and for how long.</span></span>

<span data-ttu-id="7dd52-165">オーディオ トラックやビデオ トラックと同様に、**MediaPlaybackItem** の [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.timedmetadatatrackschanged) イベントを処理することによって、メディア項目のタイミングが設定されたメタデータ トラックを検出できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-165">Similar to audio tracks and video tracks, the timed metadata tracks for a media item can be discovered by handling the [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.timedmetadatatrackschanged) event of a **MediaPlaybackItem**.</span></span> <span data-ttu-id="7dd52-166">ただし、タイミングが設定されたメタデータ トラックを使って、ユーザーは一度に複数のメタデータ トラックを有効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-166">With timed metadata tracks, however, the user may want to enable more than one metadata track at a time.</span></span> <span data-ttu-id="7dd52-167">また、アプリ シナリオに応じて、ユーザーの介入なしに、自動的にメタデータ トラックを有効または無効にすることもできます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-167">Also, depending on your app scenario, you may want to enable or disable metadata tracks automatically, without user intervention.</span></span> <span data-ttu-id="7dd52-168">この例では、わかりやすくするために、メディア項目の各メタデータ用の [**ToggleButton**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.Primitives.ToggleButton) を追加し、ユーザーがトラックを有効または無効にすることができるようにしています。各ボタンの **Tag** プロパティは、ボタンが切り替えられたときに識別できるように、関連付けられたメタデータ トラックのインデックスに設定されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-168">For illustration purposes, this example adds a [**ToggleButton**](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.Primitives.ToggleButton) for each metadata track in a media item to allow the user to enable and disable the track. The **Tag** property of each button is set to the index of the associated metadata track so that it can be identified when the button is toggled.</span></span>

[!code-xml[MetaStackPanel](./code/MediaSource_RS1/cs/MainPage.xaml#SnippetMetaStackPanel)]

[!code-cs[TimedMetadataTrackschanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetTimedMetadataTrackschanged)]

<span data-ttu-id="7dd52-169">一度に複数のメタデータ トラックをアクティブ化することができるため、メタデータ トラック リストについて、単にアクティブなインデックスを設定しません。</span><span class="sxs-lookup"><span data-stu-id="7dd52-169">Because more than one metadata track can be active at a time, you don't simply set the active index for the metadata track list.</span></span> <span data-ttu-id="7dd52-170">代わりに、**MediaPlaybackItem** オブジェクトの [**SetPresentationMode**](https://docs.microsoft.com/previous-versions/windows/dn986977(v=win.10)) メソッドを呼び出して、切り替えるトラックのインデックスを渡し、[**TimedMetadataTrackPresentationMode**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.TimedMetadataTrackPresentationMode) 列挙体から値を指定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-170">Instead, call the **MediaPlaybackItem** object's [**SetPresentationMode**](https://docs.microsoft.com/previous-versions/windows/dn986977(v=win.10)) method, passing in the index of the track you want to toggle, and then providing a value from the [**TimedMetadataTrackPresentationMode**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.TimedMetadataTrackPresentationMode) enumeration.</span></span> <span data-ttu-id="7dd52-171">選択する表示モードは、アプリの実装によって異なります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-171">The presentation mode you choose depends on the implementation of your app.</span></span> <span data-ttu-id="7dd52-172">この例では、メタデータ トラックは、有効な場合 **PlatformPresented** に設定されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-172">In this example, the metadata track is set to **PlatformPresented** when enabled.</span></span> <span data-ttu-id="7dd52-173">テキスト ベースのトラックの場合、これは、システムが自動的にトラックにテキスト キューを表示することを意味します。トグル ボタンをオフにすると、表示モードは **Disabled** に設定されます。つまり、テキストは表示されず、キュー イベントは発生しません。</span><span class="sxs-lookup"><span data-stu-id="7dd52-173">For text-based tracks, this means that the system will automatically display the text cues in the track. When the toggle button is toggled off, the presentation mode is set to **Disabled**, which means that no text is displayed and no cue events are raised.</span></span> <span data-ttu-id="7dd52-174">キュー イベントについては、この記事で後述します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-174">Cue events are discussed later in this article.</span></span>

[!code-cs[ToggleChecked](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetToggleChecked)]

[!code-cs[ToggleUnchecked](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetToggleUnchecked)]

<span data-ttu-id="7dd52-175">メタデータ トラックを処理している場合は、[**Cues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.cues) プロパティまたは [**ActiveCues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.activecues) プロパティにアクセスすることで、トラック内の一連のキューにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-175">As you are processing the metadata tracks, you can access the set of cues within the track by accessing the [**Cues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.cues) or [**ActiveCues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.activecues) properties.</span></span> <span data-ttu-id="7dd52-176">こうすることで、UI を更新して、メディア項目のキューの場所を表示することができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-176">You can do this to update your UI to show the cue locations for a media item.</span></span>

## <a name="handle-unsupported-codecs-and-unknown-errors-when-opening-media-items"></a><span data-ttu-id="7dd52-177">メディア項目を開く際にサポートされていないコーデックと不明なエラーを処理する</span><span class="sxs-lookup"><span data-stu-id="7dd52-177">Handle unsupported codecs and unknown errors when opening media items</span></span>
<span data-ttu-id="7dd52-178">Windows 10 バージョン 1607 以降では、アプリが実行されているデバイスでメディア項目の再生に必要なコーデックがサポートされているかどうか、または部分的にサポートされているかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-178">Starting with Windows 10, version 1607, you can check whether the codec required to playback a media item is supported or partially supported on the device on which your app is running.</span></span> <span data-ttu-id="7dd52-179">まず、[**AudioTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotrackschanged) など、**MediaPlaybackItem** トラック変更イベントのイベント ハンドラーで、そのトラックの変更が新しいトラックの挿入かどうかを確認します。そうである場合は、[**AudioTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotracks) コレクションなど、**MediaPlaybackItem** パラメーターの適切なトラック コレクションと共に、**IVectorChangedEventArgs.Index** パラメーターで渡されるインデックスを使用することにより、挿入されるトラックへの参照を取得できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-179">In the event handler for the **MediaPlaybackItem** tracks-changed events, such as [**AudioTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotrackschanged), first check to see if the track change is an insertion of a new track. If so, you can get a reference to the track being inserted by using the index passed in the **IVectorChangedEventArgs.Index** parameter with the appropriate track collection of the **MediaPlaybackItem** parameter, such as the [**AudioTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.audiotracks) collection.</span></span>

<span data-ttu-id="7dd52-180">挿入されるトラックへの参照を取得したら、そのトラックの [**SupportInfo**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.supportinfo) プロパティの [**DecoderStatus**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotracksupportinfo.decoderstatus) を確認します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-180">Once you have a reference to the inserted track, check the [**DecoderStatus**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotracksupportinfo.decoderstatus) of the track's [**SupportInfo**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.supportinfo) property.</span></span> <span data-ttu-id="7dd52-181">この値が [**FullySupported**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus) の場合は、トラックの再生に必要な適切なコーデックがデバイス上に存在します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-181">If the value is [**FullySupported**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus), then the appropriate codec needed to play back the track is present on the device.</span></span> <span data-ttu-id="7dd52-182">この値が [**Degraded**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus) の場合は、システムでトラックを再生することはできるものの、何らかの方法で再生が劣化することになります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-182">If the value is [**Degraded**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus), then the track can be played by the system, but the playback will be degraded in some way.</span></span> <span data-ttu-id="7dd52-183">たとえば、5.1 オーディオ トラックが、2 チャンネル ステレオで再生される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-183">For example, a 5.1 audio track may be played back as 2-channel stereo instead.</span></span> <span data-ttu-id="7dd52-184">このような場合は、UI を更新して、ユーザーに対し品質の低下を通知することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7dd52-184">If this is the case, you may want to update your UI to alert the user of the degradation.</span></span> <span data-ttu-id="7dd52-185">この値が [**UnsupportedSubtype**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus) または [**UnsupportedEncoderProperties**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus) の場合は、デバイス上に存在する現在のコーデックではトラックを再生できません。</span><span class="sxs-lookup"><span data-stu-id="7dd52-185">If the value is [**UnsupportedSubtype**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus) or [**UnsupportedEncoderProperties**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaDecoderStatus), then the track can't be played back at all with the current codecs on the device.</span></span> <span data-ttu-id="7dd52-186">ユーザーに通知してその項目の再生をスキップするか、ユーザーが正しいコーデックをダウンロードできる UI の実装が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-186">You may wish to alert the user and skip playback of the item or implement UI to allow the user to download the correct codec.</span></span> <span data-ttu-id="7dd52-187">トラックの [**GetEncodingProperties**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.getencodingproperties) メソッドは、再生に必要なコーデックを確認するために使用します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-187">The track's [**GetEncodingProperties**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.getencodingproperties) method can be used to determine the required codec for playback.</span></span>

<span data-ttu-id="7dd52-188">最後に、トラックの [**OpenFailed**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.openfailed) イベントを登録します。このイベントは、デバイス上でトラックがサポートされているものの、パイプラインの不明なエラーによってトラックを開けなかった場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-188">Finally, you can register for the track's [**OpenFailed**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.openfailed) event, which will be raised if the track is supported on the device but failed to open due to an unknown error in the pipeline.</span></span>

[!code-cs[AudioTracksChanged_CodecCheck](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetAudioTracksChanged_CodecCheck)]

<span data-ttu-id="7dd52-189">[  **OpenFailed**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.openfailed) イベント ハンドラーでは、**MediaSource** ステータスが不明かどうかを確認できます。不明な場合は、プログラムによって別のトラックを選択して再生できるようにしたり、ユーザーが別のトラックを選べるようにしたり、再生を無視することができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-189">In the [**OpenFailed**](https://docs.microsoft.com/uwp/api/windows.media.core.audiotrack.openfailed) event handler, you can check to see if the **MediaSource** status is unknown, and if so, you can programatically select a different track to play, allow the user to choose a different track, or abandon playback.</span></span>

[!code-cs[OpenFailed](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetOpenFailed)]

## <a name="set-display-properties-used-by-the-system-media-transport-controls"></a><span data-ttu-id="7dd52-190">システム メディア トランスポート コントロールで使用する表示プロパティを設定する</span><span class="sxs-lookup"><span data-stu-id="7dd52-190">Set display properties used by the System Media Transport Controls</span></span>
<span data-ttu-id="7dd52-191">Windows 10 バージョン 1607 以降、[**MediaPlayer**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlayer) で再生されるメディアは既定では自動的にシステム メディア トランスポート コントロール (SMTC) に統合されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-191">Starting with Windows 10, version 1607, media played in a [**MediaPlayer**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlayer) is automatically integrated into the System Media Transport Controls (SMTC) by default.</span></span> <span data-ttu-id="7dd52-192">SMTC で表示されるメタデータを指定するには、**MediaPlaybackItem** の表示プロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-192">You can specify the metadata that will be displayed by the SMTC by updating the display properties for a **MediaPlaybackItem**.</span></span> <span data-ttu-id="7dd52-193">項目の表示プロパティを表すオブジェクトを取得するには、[**GetDisplayProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.getdisplayproperties) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-193">Get an object representing the display properties for an item by calling [**GetDisplayProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.getdisplayproperties).</span></span> <span data-ttu-id="7dd52-194">[  **Type**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaitemdisplayproperties.type) プロパティを設定することによって、再生項目が音楽かビデオかを設定し、</span><span class="sxs-lookup"><span data-stu-id="7dd52-194">Set whether the playback item is music or video by setting the [**Type**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaitemdisplayproperties.type) property.</span></span> <span data-ttu-id="7dd52-195">次に、オブジェクトの [**VideoProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaitemdisplayproperties.videoproperties) または [**MusicProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaitemdisplayproperties.musicproperties) を設定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-195">Then, set the properties of the object's [**VideoProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaitemdisplayproperties.videoproperties) or [**MusicProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaitemdisplayproperties.musicproperties).</span></span> <span data-ttu-id="7dd52-196">項目のプロパティを与えた値に更新するには、[**ApplyDisplayProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.applydisplayproperties) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-196">Call [**ApplyDisplayProperties**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.applydisplayproperties) to update the item's properties to the values you provided.</span></span> <span data-ttu-id="7dd52-197">通常、アプリは Web サービスから表示値を動的に取得しますが、次の例はこのプロセスをハードコードされた値を使って示しています。</span><span class="sxs-lookup"><span data-stu-id="7dd52-197">Typically, an app will retrieve the display values dynamically from a web service, but the following example illustrates this process with hardcoded values.</span></span>

[!code-cs[SetVideoProperties](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetSetVideoProperties)]

[!code-cs[SetMusicProperties](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetSetMusicProperties)]

## <a name="add-external-timed-text-with-timedtextsource"></a><span data-ttu-id="7dd52-198">TimedTextSource を使って外部のタイミングが設定されたテキストを追加する</span><span class="sxs-lookup"><span data-stu-id="7dd52-198">Add external timed text with TimedTextSource</span></span>

<span data-ttu-id="7dd52-199">シナリオによっては、さまざまなロケールのサブタイトルが含まれる個別のファイルなど、メディア項目に関連付けられているタイミングが設定されたテキストが外部のファイルに含まれている場合があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-199">For some scenarios, you may have external files that contains timed text associated with a media item, such as separate files that contain subtitles for different locales.</span></span> <span data-ttu-id="7dd52-200">ストリームや URI から外部のタイミングが設定されたテキスト ファイルを読み込むには、[**TimedTextSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextSource) クラスを使います。</span><span class="sxs-lookup"><span data-stu-id="7dd52-200">Use the [**TimedTextSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextSource) class to load in external timed text files from a stream or URI.</span></span>

<span data-ttu-id="7dd52-201">この例では、**Dictionary** コレクションでソース URI を使ってメディア項目のタイミングが設定されたテキスト ソースのリストを格納し、解決された後のトラックを識別するためにキーと値のペアとして **TimedTextSource** オブジェクトを使用します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-201">This example uses a **Dictionary** collection to store a list of the timed text sources for the media item using the source URI and the **TimedTextSource** object as the key/value pair in order to identify the tracks after they have been resolved.</span></span>

[!code-cs[TimedTextSourceMap](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetTimedTextSourceMap)]

<span data-ttu-id="7dd52-202">[  **CreateFromUri**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromuri) を呼び出すことによって、外部のタイミングが設定されたテキスト ファイルごとに新しい **TimedTextSource** を作成します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-202">Create a new **TimedTextSource** for each external timed text file by calling [**CreateFromUri**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfromuri).</span></span> <span data-ttu-id="7dd52-203">タイミングが設定されたテキスト ソース用のエントリを **Dictionary** に追加します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-203">Add an entry to the **Dictionary** for the timed text source.</span></span> <span data-ttu-id="7dd52-204">[  **TimedTextSource.Resolved**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.resolved) イベントのハンドラーを追加して、項目の読み込みに失敗した場合の処理をしたり、項目が正常に読み込まれた後で追加のプロパティを設定したりします。</span><span class="sxs-lookup"><span data-stu-id="7dd52-204">Add a handler for the [**TimedTextSource.Resolved**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.resolved) event to handle if the item failed to load or to set additional properties after the item was loaded successfully.</span></span>

<span data-ttu-id="7dd52-205">**TimedTextSource** オブジェクトを [**ExternalTimedTextSources**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.externaltimedtextsources) コレクションに追加して、すべてのオブジェクトを **MediaSource** に登録します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-205">Register all of your **TimedTextSource** objects with the **MediaSource** by adding them to the [**ExternalTimedTextSources**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.externaltimedtextsources) collection.</span></span> <span data-ttu-id="7dd52-206">タイミングが設定された外部のテキスト ソースは、ソースから作成された **MediaPlaybackItem** ではなく、**MediaSource** に直接追加されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="7dd52-206">Note that external timed text sources are added to directly the **MediaSource** and not the **MediaPlaybackItem** created from the source.</span></span> <span data-ttu-id="7dd52-207">外部のテキスト トラックを反映するように UI を更新するには、この記事で既に説明したように、**TimedMetadataTracksChanged** イベントを登録して処理します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-207">To update your UI to reflect the external text tracks, register and handle the **TimedMetadataTracksChanged** event as described previously in this article.</span></span>

[!code-cs[TimedTextSource](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetTimedTextSource)]

<span data-ttu-id="7dd52-208">[  **TimedTextSource.Resolved**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.resolved) イベントのハンドラーで、ハンドラーに渡された [**TimedTextSourceResolveResultEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextSourceResolveResultEventArgs) の **Error** プロパティを確認して、タイミングが設定されたテキスト データの読み込み中にエラーが発生したかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-208">In the handler for the [**TimedTextSource.Resolved**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.resolved) event, check the **Error** property of the [**TimedTextSourceResolveResultEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextSourceResolveResultEventArgs) passed into the handler to determine if an error occurred while trying to load the timed text data.</span></span> <span data-ttu-id="7dd52-209">項目が正しく解決された場合は、このハンドラーを使って、解決されたトラックの他のプロパティを更新できます。この例では、以前に **Dictionary** に格納された URI に基づいて、各トラックのラベルを追加します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-209">If the item was resolved successfully, you can use this handler to update additional properties of the resolved track. This example adds a label for each track based on the URI previously stored in the **Dictionary**.</span></span>

[!code-cs[TimedTextSourceResolved](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetTimedTextSourceResolved)]

## <a name="add-additional-metadata-tracks"></a><span data-ttu-id="7dd52-210">その他のメタデータ トラックを追加する</span><span class="sxs-lookup"><span data-stu-id="7dd52-210">Add additional metadata tracks</span></span>

<span data-ttu-id="7dd52-211">コードで動的にカスタム メタデータ トラックを作成し、メディア ソースを関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-211">You can dynamically create custom metadata tracks in code and associate them with a media source.</span></span> <span data-ttu-id="7dd52-212">作成するトラックにサブタイトルやキャプション テキストを含めたり、独自のアプリ データを含めたりすることができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-212">The tracks you create can contain subtitle or caption text, or they can contain your proprietary app data.</span></span>

<span data-ttu-id="7dd52-213">コンストラクターを呼び出して、ID、言語識別子、および [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedMetadataKind) 列挙体からの値を指定することによって、新しい [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedMetadataTrack) を作成します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-213">Create a new [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedMetadataTrack) by calling the constructor and specifying an ID, the language identifier, and a value from the [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedMetadataKind) enumeration.</span></span> <span data-ttu-id="7dd52-214">[  **CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.cueentered) イベントと [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.cueexited) イベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-214">Register handlers for the [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.cueentered) and [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.cueexited) events.</span></span> <span data-ttu-id="7dd52-215">これらのイベントはそれぞれ、キューの開始時刻になったときと、キューの継続時間が終了したときに発生します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-215">These events are raised when the start time for a cue has been reached and when the duration for a cue has expired, respectively.</span></span>

<span data-ttu-id="7dd52-216">作成するメタデータ トラックの種類に適切な新しいキュー オブジェクトを作成し、トラックの ID、開始時刻、継続時間を設定します。この例では、データ トラックが作成されるため、一連の [**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue) オブジェクトが生成され、アプリ固有のデータを格納するバッファーが各キューに提供されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-216">Create a new cue object, appropriate for the type of metadata track you created, and set the ID, start time, and duration for the track. This example creates a data track, so a set of [**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue) objects are generated and a buffer containing app-specific data is provided for each cue.</span></span> <span data-ttu-id="7dd52-217">新しいトラックを登録するには、**MediaSource** オブジェクトの [**ExternalTimedMetadataTracks**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.externaltimedmetadatatracks) コレクションにトラックを追加します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-217">To register the new track, add it to the [**ExternalTimedMetadataTracks**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.externaltimedmetadatatracks) collection of the **MediaSource** object.</span></span>

<span data-ttu-id="7dd52-218">Windows 10 Version 1703 以降では、**DataCue.Properties** プロパティが [**PropertySet**](https://docs.microsoft.com/uwp/api/windows.foundation.collections.propertyset) を公開します。これを使用して、**CueEntered** と **CueExited** イベントで取得できるキー/データのペアにカスタム プロパティを格納することができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-218">Starting with Windows 10, version 1703, the **DataCue.Properties** property exposes a [**PropertySet**](https://docs.microsoft.com/uwp/api/windows.foundation.collections.propertyset) that you can use to store custom properties in key/data pairs that can be retrieved in the **CueEntered** and **CueExited** events.</span></span>  

[!code-cs[AddDataTrack](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetAddDataTrack)]

<span data-ttu-id="7dd52-219">**CueEntered** イベントは、関連付けられたトラックの表示モードが **ApplicationPresented**、**Hidden**、または **PlatformPresented** である限り、キューの開始時間になると発生します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-219">The **CueEntered** event is raised when a cue's start time has been reached as long as the associated track has a presentation mode of **ApplicationPresented**, **Hidden**, or **PlatformPresented.**</span></span> <span data-ttu-id="7dd52-220">トラックの表示モードが **Disabled** である場合、メタデータ トラックのキュー イベントは発生しません。</span><span class="sxs-lookup"><span data-stu-id="7dd52-220">Cue events are not raised for metadata tracks while the presentation mode for the track is **Disabled**.</span></span> <span data-ttu-id="7dd52-221">この例では、キューに関連付けられているカスタム データを、単にデバッグ ウィンドウに出力します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-221">This example simply outputs the custom data associated with the cue to the debug window.</span></span>

[!code-cs[DataCueEntered](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetDataCueEntered)]

<span data-ttu-id="7dd52-222">この例では、トラックを作成するときに **TimedMetadataKind.Caption** を指定し、[**TimedTextCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextCue) オブジェクトを使ってトラックにキューを追加することによって、カスタム テキスト トラックを追加します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-222">This example adds a custom text track by specifying **TimedMetadataKind.Caption** when creating the track and using [**TimedTextCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.TimedTextCue) objects to add cues to the track.</span></span>

[!code-cs[AddTextTrack](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetAddTextTrack)]

[!code-cs[TextCueEntered](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetTextCueEntered)]

## <a name="play-a-list-of-media-items-with-mediaplaybacklist"></a><span data-ttu-id="7dd52-223">MediaPlaybackList を使ってメディア項目のリストを再生する</span><span class="sxs-lookup"><span data-stu-id="7dd52-223">Play a list of media items with MediaPlaybackList</span></span>

<span data-ttu-id="7dd52-224">[  **MediaPlaybackList**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList) を使うことにより、**MediaPlaybackItem** オブジェクトによって表されるメディア項目の再生リストを作成できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-224">The [**MediaPlaybackList**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList) allows you to create a playlist of media items, which are represented by **MediaPlaybackItem** objects.</span></span>

<span data-ttu-id="7dd52-225">**注**  内の項目を[ **MediaPlaybackList** ](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList)すきまがなく再生を使用して描画されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-225">**Note**  Items in a [**MediaPlaybackList**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList) are rendered using gapless playback.</span></span> <span data-ttu-id="7dd52-226">システムは、MP3 または AAC でエンコードされたファイルで提供されるメタデータを使用して、ギャップレス再生に必要な遅延またはパディングの補正を決定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-226">The system will use provided metadata in MP3 or AAC encoded files to determine the delay or padding compensation needed for gapless playback.</span></span> <span data-ttu-id="7dd52-227">MP3 または AAC でエンコードされているファイルでこのメタデータが提供されない場合は、システムがヒューリスティックによって遅延またはパディングを決定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-227">If the MP3 or AAC encoded files don't provide this metadata, then the system determines the delay or padding heuristically.</span></span> <span data-ttu-id="7dd52-228">ロスレス形式 (PCM、FLAC、ALAC など) の場合、これらのエンコーダーによる遅延やパディングが発生しないため、システムが実行する処理はありません。</span><span class="sxs-lookup"><span data-stu-id="7dd52-228">For lossless formats, such as PCM, FLAC, or ALAC, the system takes no action because these encoders don't introduce delay or padding.</span></span>

<span data-ttu-id="7dd52-229">最初に、**MediaPlaybackList** を格納するための変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-229">To get started, declare a variable to store your **MediaPlaybackList**.</span></span>

[!code-cs[DeclareMediaPlaybackList](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetDeclareMediaPlaybackList)]

<span data-ttu-id="7dd52-230">この記事で既に説明した手順と同じ手順で、リストに追加する各メディア項目について **MediaPlaybackItem** を作成します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-230">Create a **MediaPlaybackItem** for each media item you want to add to your list using the same procedure described previously in this article.</span></span> <span data-ttu-id="7dd52-231">**MediaPlaybackList** オブジェクトを初期化し、メディア再生項目を追加します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-231">Initialize your **MediaPlaybackList** object and add the media playback items to it.</span></span> <span data-ttu-id="7dd52-232">[  **CurrentItemChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.currentitemchanged) イベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-232">Register a handler for the [**CurrentItemChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.currentitemchanged) event.</span></span> <span data-ttu-id="7dd52-233">このイベントによって、UI を更新して現在再生中のメディア項目を反映できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-233">This event allows you to update your UI to reflect the currently playing media item.</span></span> <span data-ttu-id="7dd52-234">リスト内の項目が正常に開かれたときに発生する [ItemOpened](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList.ItemOpened)イベントや、リスト内の項目を開くことができないときに発生する [ItemFailed](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList.ItemFailed) イベントに登録することもできます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-234">You can also register for the [ItemOpened](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList.ItemOpened) event, which is raised when an item in the list is successfully opened, and the [ItemFailed](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList.ItemFailed) event, which is raised when an item in the list can't be opened.</span></span>

<span data-ttu-id="7dd52-235">Windows 10 Version 1703 以降では、[MaxPlayedItemsToKeepOpen](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList.MaxPlayedItemsToKeepOpen) プロパティを設定することによって、システムが再生後に開いたままにしておく、**MediaPlaybackList** 内の **MediaPlaybackItem** オブジェクトの最大数を指定できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-235">Starting with Windows 10, version 1703, you can specify the maximum number of **MediaPlaybackItem** objects in the **MediaPlaybackList** that the system will keep open after they have been played by setting the [MaxPlayedItemsToKeepOpen](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackList.MaxPlayedItemsToKeepOpen) property.</span></span> <span data-ttu-id="7dd52-236">**MediaPlaybackItem** を開いたままにしておくと、ユーザーがその項目に切り替えたときに、項目を再び読み込む必要がないため、すぐに項目の再生を開始できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-236">When a **MediaPlaybackItem** is kept open, playback of the item can start instantaneously when the user switches to that item because the item doesn't need to be reloaded.</span></span> <span data-ttu-id="7dd52-237">ただし、項目を開いたままにしておくと、アプリのメモリ消費量も増加するため、この値を設定する場合は、応答性とメモリ使用量のバランスを考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-237">But keeping items open also increases the memory consumption of your app, so you should consider the balance between responsiveness and memory usage when setting this value.</span></span> 

<span data-ttu-id="7dd52-238">リストの再生を有効にするには、**MediaPlayer** の再生ソースを **MediaPlaybackList** に設定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-238">To enable playback of your list, set the playback source of the **MediaPlayer** to your **MediaPlaybackList**.</span></span>

[!code-cs[PlayMediaPlaybackList](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetPlayMediaPlaybackList)]

<span data-ttu-id="7dd52-239">**CurrentItemChanged** イベント ハンドラーで、UI を更新して現在再生中の項目を反映します。再生中の項目は、イベントに渡された [**CurrentMediaPlaybackItemChangedEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.CurrentMediaPlaybackItemChangedEventArgs) オブジェクトの [**NewItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.currentmediaplaybackitemchangedeventargs.newitem) プロパティを使って取得できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-239">In the **CurrentItemChanged** event handler, update your UI to reflect the currently playing item, which can be retrieved using the [**NewItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.currentmediaplaybackitemchangedeventargs.newitem) property of the [**CurrentMediaPlaybackItemChangedEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.CurrentMediaPlaybackItemChangedEventArgs) object passed into the event.</span></span> <span data-ttu-id="7dd52-240">このイベントから UI を更新する場合は、更新が UI スレッドで行われるように、[**CoreDispatcher.RunAsync**](https://docs.microsoft.com/uwp/api/windows.ui.core.coredispatcher.windows) の呼び出し内で実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-240">Remember that if you update the UI from this event, you should do so within a call to [**CoreDispatcher.RunAsync**](https://docs.microsoft.com/uwp/api/windows.ui.core.coredispatcher.windows) so that the updates are made on the UI thread.</span></span>

<span data-ttu-id="7dd52-241">Windows 10 Version 1703 以降では、[CurrentMediaPlaybackItemChangedEventArgs.Reason](https://docs.microsoft.com/uwp/api/windows.media.playback.currentmediaplaybackitemchangedeventargs.Reason) プロパティを調べて、項目が変更された理由 (アプリがプログラムによって項目を切り替えた、以前に再生していた項目の末尾に到達した、エラーが発生したなど) を示す値を取得できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-241">Starting with Windows 10, version 1703, you can check the [CurrentMediaPlaybackItemChangedEventArgs.Reason](https://docs.microsoft.com/uwp/api/windows.media.playback.currentmediaplaybackitemchangedeventargs.Reason) property to get a value that indicates the reason that the item changed, such as the app switching items programatically, the previously playing item reaching its end, or an error occurring.</span></span>

[!code-cs[MediaPlaybackListItemChanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetMediaPlaybackListItemChanged)]


<span data-ttu-id="7dd52-242">メディア プレーヤーで **MediaPlaybackList** の前の項目や次の項目を再生するには、[**MovePrevious**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.moveprevious) または [**MoveNext**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.movenext) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-242">Call [**MovePrevious**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.moveprevious) or [**MoveNext**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.movenext) to cause the media player to play the previous or next item in your **MediaPlaybackList**.</span></span>

[!code-cs[PrevButton](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetPrevButton)]

[!code-cs[NextButton](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetNextButton)]

<span data-ttu-id="7dd52-243">[  **ShuffleEnabled**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.shuffleenabled) プロパティを設定して、メディア プレーヤーがリスト内の項目をランダムな順序で再生するかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-243">Set the [**ShuffleEnabled**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.shuffleenabled) property to specify whether the media player should play the items in your list in random order.</span></span>

[!code-cs[ShuffleButton](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetShuffleButton)]

<span data-ttu-id="7dd52-244">[  **AutoRepeatEnabled**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.autorepeatenabled) プロパティを設定して、メディア プレーヤーがリストをループ再生するかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-244">Set the [**AutoRepeatEnabled**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.autorepeatenabled) property to specify whether the media player should loop playback of your list.</span></span>

[!code-cs[RepeatButton](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetRepeatButton)]


### <a name="handle-the-failure-of-media-items-in-a-playback-list"></a><span data-ttu-id="7dd52-245">再生リスト内のメディア項目のエラーへの対処</span><span class="sxs-lookup"><span data-stu-id="7dd52-245">Handle the failure of media items in a playback list</span></span>
<span data-ttu-id="7dd52-246">[  **ItemFailed**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.itemfailed) イベントは、リスト内の項目を開けない場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-246">The [**ItemFailed**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacklist.itemfailed) event is raised when an item in the list fails to open.</span></span> <span data-ttu-id="7dd52-247">ハンドラーに渡された [**MediaPlaybackItemError**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItemError) オブジェクトの [**ErrorCode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitemerror.errorcode) プロパティは、ネットワーク エラー、デコード エラー、暗号化エラーなど、可能であればエラーの具体的な原因を列挙します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-247">The [**ErrorCode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitemerror.errorcode) property of the [**MediaPlaybackItemError**](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItemError) object passed into the handler enumerates the specific cause of the failure when possible, including network errors, decoding errors, or encryption errors.</span></span>

[!code-cs[ItemFailed](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetItemFailed)]

### <a name="disable-playback-of-items-in-a-playback-list"></a><span data-ttu-id="7dd52-248">再生リストの項目の再生の無効化</span><span class="sxs-lookup"><span data-stu-id="7dd52-248">Disable playback of items in a playback list</span></span>
<span data-ttu-id="7dd52-249">Windows 10 Version 1703 以降では、[MediaPlaybackItem](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem) の [IsDisabledInPlaybackList](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem.IsDisabledInPlaybackList) プロパティを false に設定することにより、**MediaPlaybackItemList** 内の 1 つまたは複数の項目の再生を無効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-249">Starting with Windows 10, version 1703, you can disable playback of one or more items in a **MediaPlaybackItemList** by setting the [IsDisabledInPlaybackList](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem.IsDisabledInPlaybackList) property of a [MediaPlaybackItem](https://docs.microsoft.com/uwp/api/Windows.Media.Playback.MediaPlaybackItem) to false.</span></span> 

<span data-ttu-id="7dd52-250">この機能の一般的なシナリオは、インターネットからストリーム配信される音楽を再生するアプリです。</span><span class="sxs-lookup"><span data-stu-id="7dd52-250">A typical scenario for this feature is for apps that play music streamed from the internet.</span></span> <span data-ttu-id="7dd52-251">このアプリでは、デバイスのネットワーク接続状態の変化をリッスンし、完全にダウンロードされていない項目の再生を無効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-251">The app can listen for changes in the network connection status of the device and disable playback of items that are not fully downloaded.</span></span> <span data-ttu-id="7dd52-252">次の例では、[NetworkInformation.NetworkStatusChanged](https://docs.microsoft.com/uwp/api/Windows.Networking.Connectivity.NetworkInformation.NetworkStatusChanged) イベントのハンドラーが登録されています。</span><span class="sxs-lookup"><span data-stu-id="7dd52-252">In the following example, a handler is registered for the [NetworkInformation.NetworkStatusChanged](https://docs.microsoft.com/uwp/api/Windows.Networking.Connectivity.NetworkInformation.NetworkStatusChanged) event.</span></span>

[!code-cs[RegisterNetworkStatusChanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetRegisterNetworkStatusChanged)]

<span data-ttu-id="7dd52-253">**NetworkStatusChanged** のハンドラーで、[GetInternetConnectionProfile](https://docs.microsoft.com/uwp/api/Windows.Networking.Connectivity.NetworkInformation.GetInternetConnectionProfile) が null (ネットワークが接続されていないことを示す) を返すかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-253">In the handler for **NetworkStatusChanged**, check to see if [GetInternetConnectionProfile](https://docs.microsoft.com/uwp/api/Windows.Networking.Connectivity.NetworkInformation.GetInternetConnectionProfile) returns null, which indicates that the network is not connected.</span></span> <span data-ttu-id="7dd52-254">これに該当する場合、再生リスト内のすべての項目をループ処理し、項目の [TotalDownloadProgress](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TotalDownloadProgress) が 1 未満である (つまり項目が完全にダウンロードされていない) 場合は、項目を無効にします。</span><span class="sxs-lookup"><span data-stu-id="7dd52-254">If this is the case, loop through all of the items in the playback list, and if the [TotalDownloadProgress](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TotalDownloadProgress) for the item is less than 1, meaning that the item has not fully downloaded, disable the item.</span></span> <span data-ttu-id="7dd52-255">ネットワーク接続が有効である場合は、再生リスト内のすべての項目をループ処理し、各項目を有効にします。</span><span class="sxs-lookup"><span data-stu-id="7dd52-255">If the network connection is enabled, loop through all of the items in the playback list and enable each item.</span></span>

[!code-cs[NetworkStatusChanged](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetNetworkStatusChanged)]

### <a name="defer-binding-of-media-content-for-items-in-a-playback-list-by-using-mediabinder"></a><span data-ttu-id="7dd52-256">MediaBinder を使用して再生リスト内の項目に対するメディア コンテンツのバインドを延期する</span><span class="sxs-lookup"><span data-stu-id="7dd52-256">Defer binding of media content for items in a playback list by using MediaBinder</span></span>
<span data-ttu-id="7dd52-257">前の例では、ファイル、URL、ストリームから **MediaSource** が作成され、その後 **MediaPlaybackItem** が作成され、**MediaPlaybackList** に追加されます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-257">In the previous examples, a **MediaSource** is created from a file, URL, or stream, after which a **MediaPlaybackItem** is created and added to a **MediaPlaybackList**.</span></span> <span data-ttu-id="7dd52-258">ユーザーがコンテンツを表示する際に課金されている場合など、いくつかのシナリオでは、再生リスト内の項目を実際に再生する準備ができるまで、**MediaSource** のコンテンツの取得を延期することができます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-258">For some scenarios, such as if the user is being charged for viewing content, you may want to defer the retrieval of the content of a **MediaSource** until the item in the playback list is ready to actually be played.</span></span> <span data-ttu-id="7dd52-259">このシナリオを実装するには、[**MediaBinder**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaBinder) クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-259">To implement this scenario, create an instance of the [**MediaBinder**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaBinder) class.</span></span> <span data-ttu-id="7dd52-260">[  **Token**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaBinder.Token) プロパティを、取得を延期するコンテンツを識別するための、アプリで定義された文字列に設定し、[**Binding**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaBinder.Binding) イベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-260">Set the [**Token**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaBinder.Token) property to an app-defined string that identifies the content for which you want to defer retrieval and then register a handler for the [**Binding**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaBinder.Binding) event.</span></span> <span data-ttu-id="7dd52-261">次に、[**MediaSource.CreateFromMediaBinder**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfrommediabinder) を呼び出すことによって、**Binder** から **MediaSource** を作成します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-261">Next, create a **MediaSource** from the **Binder** by calling [**MediaSource.CreateFromMediaBinder**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.createfrommediabinder).</span></span> <span data-ttu-id="7dd52-262">その後、通常の手順で、**MediaSource** から **MediaPlaybackItem** を作成し、再生リストに追加します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-262">Then, create a **MediaPlaybackItem** from the **MediaSource** and add it to the playback list as usual.</span></span>

[!code-cs[InitMediaBinder](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetInitMediaBinder)]

<span data-ttu-id="7dd52-263">システムは、**MediaBinder** に関連付けられているコンテンツを取得する必要があることを特定すると、**Binding** イベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-263">When the system determines that the content associated with the **MediaBinder** needs to be retrieved, it will raise the **Binding** event.</span></span> <span data-ttu-id="7dd52-264">このイベントのハンドラーで、イベントに渡された [**MediaBindingEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs) から **MediaBinder** インスタンスを取得できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-264">In the handler for this event, you can retrieve the **MediaBinder** instance from the [**MediaBindingEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs) passed into the event.</span></span> <span data-ttu-id="7dd52-265">**Token** プロパティに指定された文字列を取得し、その文字列を使用して取得する必要があるコンテンツを特定します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-265">Retrieve the string you specified for the **Token** property and use it to determine what content should be retrieved.</span></span> <span data-ttu-id="7dd52-266">**MediaBindingEventArgs** は、いくつかの異なる表現でバインドされるコンテンツを設定するためのメソッド ([**SetStorageFile**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setstoragefile)、[**SetStream**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setstream)、[**SetStreamReference**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setstreamreference)、[**SetUri**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.seturi) など) を提供します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-266">The **MediaBindingEventArgs** provides methods for setting the bound content in several different representations, including [**SetStorageFile**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setstoragefile), [**SetStream**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setstream), [**SetStreamReference**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setstreamreference), and [**SetUri**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.seturi).</span></span> 

[!code-cs[BinderBinding](./code/MediaSource_RS1/cs/MainPage.xaml.cs#SnippetBinderBinding)]

<span data-ttu-id="7dd52-267">**Binding** イベント ハンドラーで、Web 要求などの非同期操作を実行している場合、[**MediaBindingEventArgs.GetDeferral**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.GetDeferral) メソッドを呼び出して、操作が完了するまで待機してから続行するようにシステムに指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7dd52-267">Note that if you are performing asynchronous operations, such as web requests, in the **Binding** event handler, you should call the [**MediaBindingEventArgs.GetDeferral**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.GetDeferral) method to instruct the system to wait for your operation to complete before continuing.</span></span> <span data-ttu-id="7dd52-268">操作が完了した後、[**Deferral.Complete**](https://docs.microsoft.com/uwp/api/windows.foundation.deferral.Complete) を呼び出して、システムに続行を指示します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-268">Call [**Deferral.Complete**](https://docs.microsoft.com/uwp/api/windows.foundation.deferral.Complete) after your operation is complete to instruct the system to continue.</span></span>

<span data-ttu-id="7dd52-269">Windows 10 Version 1703 以降では、[**SetAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setadaptivemediasource) を呼び出すことによって、バインドされているコンテンツとして [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) を指定できます。</span><span class="sxs-lookup"><span data-stu-id="7dd52-269">Starting with Windows 10, version 1703, you can supply an [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) as bound content by calling [**SetAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediabindingeventargs.setadaptivemediasource).</span></span> <span data-ttu-id="7dd52-270">アプリでのアダプティブ ストリーミングの使用について詳しくは、「[アダプティブ ストリーミング](adaptive-streaming.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="7dd52-270">For more information on using adaptive streaming in your app, see [Adaptive streaming](adaptive-streaming.md).</span></span>



## <a name="related-topics"></a><span data-ttu-id="7dd52-271">関連トピック</span><span class="sxs-lookup"><span data-stu-id="7dd52-271">Related topics</span></span>
* [<span data-ttu-id="7dd52-272">メディア再生</span><span class="sxs-lookup"><span data-stu-id="7dd52-272">Media playback</span></span>](media-playback.md)
* [<span data-ttu-id="7dd52-273">Media Player とオーディオとビデオの再生します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-273">Play audio and video with MediaPlayer</span></span>](play-audio-and-video-with-mediaplayer.md)
* [<span data-ttu-id="7dd52-274">システムのメディアのトランスポート コントロールとの統合します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-274">Integrate with the Sytem Media Transport Controls</span></span>](integrate-with-systemmediatransportcontrols.md)
* [<span data-ttu-id="7dd52-275">バック グラウンドでメディアを再生します。</span><span class="sxs-lookup"><span data-stu-id="7dd52-275">Play media in the background</span></span>](background-audio.md)

