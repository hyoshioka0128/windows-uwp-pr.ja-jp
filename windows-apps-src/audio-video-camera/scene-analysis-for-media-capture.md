---
ms.assetid: B5D915E4-4280-422C-BA0E-D574C534410B
description: この記事では、SceneAnalysisEffect と FaceDetectionEffect を使ってメディア キャプチャのプレビュー ストリームの内容を分析する方法について説明します。
title: カメラ フレームの分析の効果
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 9714488473bf4bdc118fd56129ea67e00019dcb1
ms.sourcegitcommit: 681c70f964210ab49ac5d06357ae96505bb78741
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2018
ms.locfileid: "7695922"
---
# <a name="effects-for-analyzing-camera-frames"></a><span data-ttu-id="35593-104">カメラ フレームの分析の効果</span><span class="sxs-lookup"><span data-stu-id="35593-104">Effects for analyzing camera frames</span></span>



<span data-ttu-id="35593-105">この記事では、[**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) と [**FaceDetectionEffect**](https://msdn.microsoft.com/library/windows/apps/dn948776) を使ってメディア キャプチャのプレビュー ストリームの内容を分析する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="35593-105">This article describes how to use the [**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) and the [**FaceDetectionEffect**](https://msdn.microsoft.com/library/windows/apps/dn948776) to analyze the content of the media capture preview stream.</span></span>

## <a name="scene-analysis-effect"></a><span data-ttu-id="35593-106">シーン分析効果</span><span class="sxs-lookup"><span data-stu-id="35593-106">Scene analysis effect</span></span>

<span data-ttu-id="35593-107">[**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) は、メディア キャプチャのプレビュー ストリームに含まれるビデオ フレームを分析し、キャプチャ結果を向上させるための処理オプションを推奨します。</span><span class="sxs-lookup"><span data-stu-id="35593-107">The [**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) analyzes the video frames in the media capture preview stream and recommends processing options to improve the capture result.</span></span> <span data-ttu-id="35593-108">現時点では、ハイ ダイナミック レンジ (HDR) 処理を使用してキャプチャを向上できるかどうかの検出がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="35593-108">Currently, the effect supports detecting whether the capture would be improved by using High Dynamic Range (HDR) processing.</span></span>

<span data-ttu-id="35593-109">HDR の使用が推奨された場合は、次の方法で実行できます。</span><span class="sxs-lookup"><span data-stu-id="35593-109">If the effect recommends using HDR, you can do this in the following ways:</span></span>

-   <span data-ttu-id="35593-110">[**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) クラスで、Windows に組み込まれている HDR 処理アルゴリズムを使って写真をキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="35593-110">Use the [**AdvancedPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/mt181386) class to capture photos using the Windows built-in HDR processing algorithm.</span></span> <span data-ttu-id="35593-111">詳しくは、「[ハイ ダイナミック レンジ (HDR) 写真のキャプチャ](high-dynamic-range-hdr-photo-capture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="35593-111">For more information, see [High Dynamic Range (HDR) photo capture](high-dynamic-range-hdr-photo-capture.md).</span></span>

-   <span data-ttu-id="35593-112">[**HdrVideoControl**](https://msdn.microsoft.com/library/windows/apps/dn926680) で、Windows に組み込まれている HDR 処理アルゴリズムを使ってビデオをキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="35593-112">Use the [**HdrVideoControl**](https://msdn.microsoft.com/library/windows/apps/dn926680) to capture video using the Windows built-in HDR processing algorithm.</span></span> <span data-ttu-id="35593-113">詳しくは、「[ビデオ キャプチャのためのキャプチャ デバイス コントロール](capture-device-controls-for-video-capture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="35593-113">For more information, see [Capture device controls for video capture](capture-device-controls-for-video-capture.md).</span></span>

-   <span data-ttu-id="35593-114">[**VariablePhotoSequenceControl**](https://msdn.microsoft.com/library/windows/apps/dn640573) でフレームのシーケンスをキャプチャし、カスタム HDR 実装を使って合成します。</span><span class="sxs-lookup"><span data-stu-id="35593-114">Use the [**VariablePhotoSequenceControl**](https://msdn.microsoft.com/library/windows/apps/dn640573) to capture a sequence of frames that you can then composite using a custom HDR implementation.</span></span> <span data-ttu-id="35593-115">詳しくは、「[可変の写真シーケンス](variable-photo-sequence.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="35593-115">For more information, see [Variable photo sequence](variable-photo-sequence.md).</span></span>

### <a name="scene-analysis-namespaces"></a><span data-ttu-id="35593-116">シーン分析の名前空間</span><span class="sxs-lookup"><span data-stu-id="35593-116">Scene analysis namespaces</span></span>

<span data-ttu-id="35593-117">シーン分析を使うには、基本的なメディア キャプチャに必要な名前空間に加え、次の名前空間をアプリに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-117">To use scene analysis, your app must include the following namespaces in addition to the namespaces required for basic media capture.</span></span>

[!code-cs[SceneAnalysisUsing](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSceneAnalysisUsing)]

### <a name="initialize-the-scene-analysis-effect-and-add-it-to-the-preview-stream"></a><span data-ttu-id="35593-118">シーン分析効果を初期化してプレビュー ストリームに追加する</span><span class="sxs-lookup"><span data-stu-id="35593-118">Initialize the scene analysis effect and add it to the preview stream</span></span>

<span data-ttu-id="35593-119">ビデオ効果は、2 つの API を使って実装されます。1 つは効果の定義であり、キャプチャ デバイスで効果を初期化するために必要となる設定を提供します。もう 1 つは効果のインスタンスであり、効果を制御するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="35593-119">Video effects are implemented using two APIs, an effect definition, which provides settings that the capture device needs to initialize the effect, and an effect instance, which can be used to control the effect.</span></span> <span data-ttu-id="35593-120">効果のインスタンスには、コードのいたるところからアクセスする必要があるので、通常はそのオブジェクトを保持するメンバー変数を宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-120">Since you may want to access the effect instance from multiple places within your code, you should typically declare a member variable to hold the object.</span></span>

[!code-cs[DeclareSceneAnalysisEffect](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDeclareSceneAnalysisEffect)]

<span data-ttu-id="35593-121">アプリで、**MediaCapture** オブジェクトを初期化した後、[**SceneAnalysisEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn948903) の新しいインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="35593-121">In your app, after you have initialized the **MediaCapture** object, create a new instance of [**SceneAnalysisEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn948903).</span></span>

<span data-ttu-id="35593-122">**MediaCapture** オブジェクトに対して [**AddVideoEffectAsync**](https://msdn.microsoft.com/library/windows/apps/dn878035) を呼び出すことで、効果をキャプチャ デバイスに登録します。このとき、**SceneAnalysisEffectDefinition** を指定し、さらに [**MediaStreamType.VideoPreview**](https://msdn.microsoft.com/library/windows/apps/br226640) を指定することで、効果をキャプチャ ストリームではなくビデオ プレビュー ストリームに適用することを示します。</span><span class="sxs-lookup"><span data-stu-id="35593-122">Register the effect with the capture device by calling [**AddVideoEffectAsync**](https://msdn.microsoft.com/library/windows/apps/dn878035) on your **MediaCapture** object, providing the **SceneAnalysisEffectDefinition** and specifying [**MediaStreamType.VideoPreview**](https://msdn.microsoft.com/library/windows/apps/br226640) to indicate that the effect should be applied to the video preview stream, as opposed to the capture stream.</span></span> <span data-ttu-id="35593-123">**AddVideoEffectAsync** は追加されたエフェクトのインスタンスを返します。</span><span class="sxs-lookup"><span data-stu-id="35593-123">**AddVideoEffectAsync** returns an instance of the added effect.</span></span> <span data-ttu-id="35593-124">このメソッドは複数の種類の効果について使用できるため、返されたインスタンスは [**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) オブジェクトにキャストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-124">Because this method can be used with multiple effect types, you must cast the returned instance to a [**SceneAnalysisEffect**](https://msdn.microsoft.com/library/windows/apps/dn948902) object.</span></span>

<span data-ttu-id="35593-125">シーン分析の結果を受け取るには、[**SceneAnalyzed**](https://msdn.microsoft.com/library/windows/apps/dn948920) イベントのハンドラーを登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-125">To receive the results of the scene analysis, you must register a handler for the [**SceneAnalyzed**](https://msdn.microsoft.com/library/windows/apps/dn948920) event.</span></span>

<span data-ttu-id="35593-126">現時点では、シーン分析効果にはハイ ダイナミック レンジ アナライザーのみが含まれます。</span><span class="sxs-lookup"><span data-stu-id="35593-126">Currently, the scene analysis effect only includes the high dynamic range analyzer.</span></span> <span data-ttu-id="35593-127">効果の [**HighDynamicRangeControl.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948827) を true に設定して、HDR 分析を有効にします。</span><span class="sxs-lookup"><span data-stu-id="35593-127">Enable HDR analysis by setting the effect's [**HighDynamicRangeControl.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948827) to true.</span></span>

[!code-cs[CreateSceneAnalysisEffectAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCreateSceneAnalysisEffectAsync)]

### <a name="implement-the-sceneanalyzed-event-handler"></a><span data-ttu-id="35593-128">SceneAnalyzed イベント ハンドラーを実装する</span><span class="sxs-lookup"><span data-stu-id="35593-128">Implement the SceneAnalyzed event handler</span></span>

<span data-ttu-id="35593-129">シーン分析の結果は、**SceneAnalyzed** イベント ハンドラーに返されます。</span><span class="sxs-lookup"><span data-stu-id="35593-129">The results of the scene analysis are returned in the **SceneAnalyzed** event handler.</span></span> <span data-ttu-id="35593-130">ハンドラーに渡された [**SceneAnalyzedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn948922) オブジェクトには、[**SceneAnalysisEffectFrame**](https://msdn.microsoft.com/library/windows/apps/dn948907) オブジェクトが含まれ、これには [**HighDynamicRangeOutput**](https://msdn.microsoft.com/library/windows/apps/dn948830) オブジェクトが含まれています。</span><span class="sxs-lookup"><span data-stu-id="35593-130">The [**SceneAnalyzedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn948922) object passed into the handler has a [**SceneAnalysisEffectFrame**](https://msdn.microsoft.com/library/windows/apps/dn948907) object which has a [**HighDynamicRangeOutput**](https://msdn.microsoft.com/library/windows/apps/dn948830) object.</span></span> <span data-ttu-id="35593-131">ハイ ダイナミック レンジ出力の [**Certainty**](https://msdn.microsoft.com/library/windows/apps/dn948833) プロパティの値は、0 ～ 1.0 となります。0 は、HDR 処理によってキャプチャの結果が向上しないことを示します。1.0 は、HDR 処理によって結果が向上することを示します。</span><span class="sxs-lookup"><span data-stu-id="35593-131">The [**Certainty**](https://msdn.microsoft.com/library/windows/apps/dn948833) property of the high dynamic range output provides a value between 0 and 1.0 where 0 indicates that HDR processing would not help improve the capture result and 1.0 indicates that HDR processing would help.</span></span> <span data-ttu-id="35593-132">HDR を使うかどうかのしきい値を決めておく、またはユーザーに結果を表示してユーザーが決めるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="35593-132">Your can decide the threshold point at which you want to use HDR or show the results to the user and let the user decide.</span></span>

[!code-cs[SceneAnalyzed](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSceneAnalyzed)]

<span data-ttu-id="35593-133">ハンドラーに渡された [**HighDynamicRangeOutput**](https://msdn.microsoft.com/library/windows/apps/dn948830) オブジェクトには、[**FrameControllers**](https://msdn.microsoft.com/library/windows/apps/dn948834) プロパティもあります。このプロパティは、HDR 処理用の可変の写真シーケンスをキャプチャするために推奨されるフレーム コントローラーを指定します。</span><span class="sxs-lookup"><span data-stu-id="35593-133">The [**HighDynamicRangeOutput**](https://msdn.microsoft.com/library/windows/apps/dn948830) object passed into the handler also has a [**FrameControllers**](https://msdn.microsoft.com/library/windows/apps/dn948834) property which contains suggested frame controllers for capturing a variable photo sequence for HDR processing.</span></span> <span data-ttu-id="35593-134">詳しくは、「[可変の写真シーケンス](variable-photo-sequence.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="35593-134">For more information, see [Variable photo sequence](variable-photo-sequence.md).</span></span>

### <a name="clean-up-the-scene-analysis-effect"></a><span data-ttu-id="35593-135">シーン分析効果をクリーンアップする</span><span class="sxs-lookup"><span data-stu-id="35593-135">Clean up the scene analysis effect</span></span>

<span data-ttu-id="35593-136">キャプチャが終了したら、**MediaCapture** オブジェクトを破棄する前に、効果の [**HighDynamicRangeAnalyzer.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948827) プロパティを false に設定してシーン分析効果を無効にし、[**SceneAnalyzed**](https://msdn.microsoft.com/library/windows/apps/dn948920) イベント ハンドラーの登録を解除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-136">When your app is done capturing, before disposing of the **MediaCapture** object, you should disable the scene analysis effect by setting the effect's [**HighDynamicRangeAnalyzer.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948827) property to false and unregister your [**SceneAnalyzed**](https://msdn.microsoft.com/library/windows/apps/dn948920) event handler.</span></span> <span data-ttu-id="35593-137">効果が追加されたのはビデオ プレビュー ストリームであるため、ビデオ プレビュー ストリームを指定して [**MediaCapture.ClearEffectsAsync**](https://msdn.microsoft.com/library/windows/apps/br226592) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="35593-137">Call [**MediaCapture.ClearEffectsAsync**](https://msdn.microsoft.com/library/windows/apps/br226592), specifying the video preview stream since that was the stream to which the effect was added.</span></span> <span data-ttu-id="35593-138">最後に、メンバー変数を null に設定します。</span><span class="sxs-lookup"><span data-stu-id="35593-138">Finally, set your member variable to null.</span></span>

[!code-cs[CleanUpSceneAnalysisEffectAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCleanUpSceneAnalysisEffectAsync)]

## <a name="face-detection-effect"></a><span data-ttu-id="35593-139">顔検出効果</span><span class="sxs-lookup"><span data-stu-id="35593-139">Face detection effect</span></span>

<span data-ttu-id="35593-140">[**FaceDetectionEffect**](https://msdn.microsoft.com/library/windows/apps/dn948776) は、メディア キャプチャのプレビュー ストリーム内で顔の位置を特定します。</span><span class="sxs-lookup"><span data-stu-id="35593-140">The [**FaceDetectionEffect**](https://msdn.microsoft.com/library/windows/apps/dn948776) identifies the location of faces within the media capture preview stream.</span></span> <span data-ttu-id="35593-141">この効果によって、プレビュー ストリーム内で顔が検出されたときに通知を受け取ることができ、プレビュー フレーム内で検出された顔ごとに境界ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="35593-141">The effect allows you to receive a notification whenever a face is detected in the preview stream and provides the bounding box for each detected face within the preview frame.</span></span> <span data-ttu-id="35593-142">サポートされているデバイスでは、シーン内の最も重要な顔に対して露出の強化やフォーカスが行われます。</span><span class="sxs-lookup"><span data-stu-id="35593-142">On supported devices, the face detection effect also provides enhanced exposure and focus on the most important face in the scene.</span></span>

### <a name="face-detection-namespaces"></a><span data-ttu-id="35593-143">顔検出の名前空間</span><span class="sxs-lookup"><span data-stu-id="35593-143">Face detection namespaces</span></span>

<span data-ttu-id="35593-144">顔検出を使うには、基本的なメディア キャプチャに必要な名前空間に加え、次の名前空間をアプリに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-144">To use face detection, your app must include the following namespaces in addition to the namespaces required for basic media capture.</span></span>

[!code-cs[FaceDetectionUsing](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetFaceDetectionUsing)]

### <a name="initialize-the-face-detection-effect-and-add-it-to-the-preview-stream"></a><span data-ttu-id="35593-145">顔検出効果を初期化してプレビュー ストリームに追加する</span><span class="sxs-lookup"><span data-stu-id="35593-145">Initialize the face detection effect and add it to the preview stream</span></span>

<span data-ttu-id="35593-146">ビデオ効果は、2 つの API を使って実装されます。1 つは効果の定義であり、キャプチャ デバイスで効果を初期化するために必要となる設定を提供します。もう 1 つは効果のインスタンスであり、効果を制御するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="35593-146">Video effects are implemented using two APIs, an effect definition, which provides settings that the capture device needs to initialize the effect, and an effect instance, which can be used to control the effect.</span></span> <span data-ttu-id="35593-147">効果のインスタンスには、コードのいたるところからアクセスする必要があるので、通常はそのオブジェクトを保持するメンバー変数を宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-147">Since you may want to access the effect instance from multiple places within your code, you should typically declare a member variable to hold the object.</span></span>

[!code-cs[DeclareFaceDetectionEffect](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDeclareFaceDetectionEffect)]

<span data-ttu-id="35593-148">アプリで、**MediaCapture** オブジェクトを初期化した後、[**FaceDetectionEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn948778) の新しいインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="35593-148">In your app, after you have initialized the **MediaCapture** object, create a new instance of [**FaceDetectionEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn948778).</span></span> <span data-ttu-id="35593-149">[**DetectionMode**](https://msdn.microsoft.com/library/windows/apps/dn948781) プロパティを設定して、より高速な顔検出とより正確な顔検出のどちらを優先するかを決めます。</span><span class="sxs-lookup"><span data-stu-id="35593-149">Set the [**DetectionMode**](https://msdn.microsoft.com/library/windows/apps/dn948781) property to prioritize faster face detection or more accurate face detection.</span></span> <span data-ttu-id="35593-150">顔検出が完了するまで待機して着信フレームが遅延すると、プレビューがぎくしゃくした感じになる場合があるため、[**SynchronousDetectionEnabled**](https://msdn.microsoft.com/library/windows/apps/dn948786) を設定して、顔検出を待機しないよう指定します。</span><span class="sxs-lookup"><span data-stu-id="35593-150">Set [**SynchronousDetectionEnabled**](https://msdn.microsoft.com/library/windows/apps/dn948786) to specify that incoming frames are not delayed waiting for face detection to complete as this can result in a choppy preview experience.</span></span>

<span data-ttu-id="35593-151">**MediaCapture** オブジェクトに対して [**AddVideoEffectAsync**](https://msdn.microsoft.com/library/windows/apps/dn878035) を呼び出すことで、効果をキャプチャ デバイスに登録します。このとき、**FaceDetectionEffectDefinition** を指定し、さらに [**MediaStreamType.VideoPreview**](https://msdn.microsoft.com/library/windows/apps/br226640) を指定することで、効果をキャプチャ ストリームではなくビデオ プレビュー ストリームに適用することを示します。</span><span class="sxs-lookup"><span data-stu-id="35593-151">Register the effect with the capture device by calling [**AddVideoEffectAsync**](https://msdn.microsoft.com/library/windows/apps/dn878035) on your **MediaCapture** object, providing the **FaceDetectionEffectDefinition** and specifying [**MediaStreamType.VideoPreview**](https://msdn.microsoft.com/library/windows/apps/br226640) to indicate that the effect should be applied to the video preview stream, as opposed to the capture stream.</span></span> <span data-ttu-id="35593-152">**AddVideoEffectAsync** は追加されたエフェクトのインスタンスを返します。</span><span class="sxs-lookup"><span data-stu-id="35593-152">**AddVideoEffectAsync** returns an instance of the added effect.</span></span> <span data-ttu-id="35593-153">このメソッドは複数の種類の効果について使用できるため、返されたインスタンスは [**FaceDetectionEffect**](https://msdn.microsoft.com/library/windows/apps/dn948776) オブジェクトにキャストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-153">Because this method can be used with multiple effect types, you must cast the returned instance to a [**FaceDetectionEffect**](https://msdn.microsoft.com/library/windows/apps/dn948776) object.</span></span>

<span data-ttu-id="35593-154">[**FaceDetectionEffect.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948818) プロパティを設定して、効果を有効または無効にします。</span><span class="sxs-lookup"><span data-stu-id="35593-154">Enable or disable the effect by setting the [**FaceDetectionEffect.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948818) property.</span></span> <span data-ttu-id="35593-155">[**FaceDetectionEffect.DesiredDetectionInterval**](https://msdn.microsoft.com/library/windows/apps/dn948814) プロパティを設定して、フレームを分析する頻度を調整します。</span><span class="sxs-lookup"><span data-stu-id="35593-155">Adjust how often the effect analyzes frames by setting the [**FaceDetectionEffect.DesiredDetectionInterval**](https://msdn.microsoft.com/library/windows/apps/dn948814) property.</span></span> <span data-ttu-id="35593-156">これらのプロパティはいずれも、メディア キャプチャの進行中に調整できます。</span><span class="sxs-lookup"><span data-stu-id="35593-156">Both of these properties can be adjusted while media capture is ongoing.</span></span>

[!code-cs[CreateFaceDetectionEffectAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCreateFaceDetectionEffectAsync)]

### <a name="receive-notifications-when-faces-are-detected"></a><span data-ttu-id="35593-157">顔が検出されたときに通知を受け取る</span><span class="sxs-lookup"><span data-stu-id="35593-157">Receive notifications when faces are detected</span></span>

<span data-ttu-id="35593-158">顔が検出されたときに、ビデオ プレビュー内で検出された顔の周りにボックスを描画するなど、特定の操作を実行するには、[**FaceDetected**](https://msdn.microsoft.com/library/windows/apps/dn948820) イベントに登録します。</span><span class="sxs-lookup"><span data-stu-id="35593-158">If you want to perform some action when faces are detected, such as drawing a box around detected faces in the video preview, you can register for the [**FaceDetected**](https://msdn.microsoft.com/library/windows/apps/dn948820) event.</span></span>

[!code-cs[RegisterFaceDetectionHandler](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetRegisterFaceDetectionHandler)]

<span data-ttu-id="35593-159">イベントのハンドラーで、[**FaceDetectedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn948774) の [**FaceDetectionEffectFrame.DetectedFaces**](https://msdn.microsoft.com/library/windows/apps/dn948792) プロパティにアクセスすることにより、フレームで検出されたすべての顔の一覧を取得できます。</span><span class="sxs-lookup"><span data-stu-id="35593-159">In the handler for the event, you can get a list of all faces detected in a frame by accessing the [**FaceDetectionEffectFrame.DetectedFaces**](https://msdn.microsoft.com/library/windows/apps/dn948792) property of the [**FaceDetectedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn948774).</span></span> <span data-ttu-id="35593-160">[**FaceBox**](https://msdn.microsoft.com/library/windows/apps/dn974126) プロパティは、プレビュー ストリームのサイズを基準とした単位で検出された顔を含む四角形を描画する [**BitmapBounds**](https://msdn.microsoft.com/library/windows/apps/br226169) 構造体です。</span><span class="sxs-lookup"><span data-stu-id="35593-160">The [**FaceBox**](https://msdn.microsoft.com/library/windows/apps/dn974126) property is a [**BitmapBounds**](https://msdn.microsoft.com/library/windows/apps/br226169) structure that describes the rectangle containing the detected face in units relative to the preview stream dimensions.</span></span> <span data-ttu-id="35593-161">プレビュー ストリームの座標を画面座標に変換するサンプル コードについては、「[顔検出 UWP のサンプル](http://go.microsoft.com/fwlink/?LinkId=619486)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="35593-161">To view sample code that transforms the preview stream coordinates into screen coordinates, see the [face detection UWP sample](http://go.microsoft.com/fwlink/?LinkId=619486).</span></span>

[!code-cs[FaceDetected](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetFaceDetected)]

### <a name="clean-up-the-face-detection-effect"></a><span data-ttu-id="35593-162">顔検出効果をクリーンアップする</span><span class="sxs-lookup"><span data-stu-id="35593-162">Clean up the face detection effect</span></span>

<span data-ttu-id="35593-163">キャプチャが終了したら、**MediaCapture** オブジェクトを破棄する前に、[**FaceDetectionEffect.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948818) で顔検出効果を無効にし、[**FaceDetected**](https://msdn.microsoft.com/library/windows/apps/dn948820) イベント ハンドラーを登録していた場合は登録を解除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="35593-163">When your app is done capturing, before disposing of the **MediaCapture** object, you should disable the face detection effect with [**FaceDetectionEffect.Enabled**](https://msdn.microsoft.com/library/windows/apps/dn948818) and unregister your [**FaceDetected**](https://msdn.microsoft.com/library/windows/apps/dn948820) event handler if you previously registered one.</span></span> <span data-ttu-id="35593-164">効果が追加されたのはビデオ プレビュー ストリームであるため、ビデオ プレビュー ストリームを指定して [**MediaCapture.ClearEffectsAsync**](https://msdn.microsoft.com/library/windows/apps/br226592) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="35593-164">Call [**MediaCapture.ClearEffectsAsync**](https://msdn.microsoft.com/library/windows/apps/br226592), specifying the video preview stream since that was the stream to which the effect was added.</span></span> <span data-ttu-id="35593-165">最後に、メンバー変数を null に設定します。</span><span class="sxs-lookup"><span data-stu-id="35593-165">Finally, set your member variable to null.</span></span>

[!code-cs[CleanUpFaceDetectionEffectAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCleanUpFaceDetectionEffectAsync)]

### <a name="check-for-focus-and-exposure-support-for-detected-faces"></a><span data-ttu-id="35593-166">検出された顔に対するフォーカスや露出のサポートを確認する</span><span class="sxs-lookup"><span data-stu-id="35593-166">Check for focus and exposure support for detected faces</span></span>

<span data-ttu-id="35593-167">すべてのデバイスに、検出された顔に基づいてフォーカスや露出を調整できるキャプチャ デバイスが搭載されているとは限りません。</span><span class="sxs-lookup"><span data-stu-id="35593-167">Not all devices have a capture device that can adjust its focus and exposure based on detected faces.</span></span> <span data-ttu-id="35593-168">顔検出はデバイス リソースを消費するため、キャプチャを強化する機能を使用できるデバイスでのみ顔検出を有効にすることもできます。</span><span class="sxs-lookup"><span data-stu-id="35593-168">Because face detection consumes device resources, you may only want to enable face detection on devices that can use the feature to enhance capture.</span></span> <span data-ttu-id="35593-169">顔に基づくキャプチャの最適化が利用可能かどうかを確認するには、初期化された [MediaCapture](capture-photos-and-video-with-mediacapture.md) に対する [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) を取得してから、ビデオ デバイス コントローラーの [**RegionsOfInterestControl**](https://msdn.microsoft.com/library/windows/apps/dn279064) を取得します。</span><span class="sxs-lookup"><span data-stu-id="35593-169">To see if face-based capture optimization is available, get the [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) for your initialized [MediaCapture](capture-photos-and-video-with-mediacapture.md) and then get the video device controller's [**RegionsOfInterestControl**](https://msdn.microsoft.com/library/windows/apps/dn279064).</span></span> <span data-ttu-id="35593-170">[**MaxRegions**](https://msdn.microsoft.com/library/windows/apps/dn279069) で少なくとも 1 つの領域がサポートされているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="35593-170">Check to see if the [**MaxRegions**](https://msdn.microsoft.com/library/windows/apps/dn279069) supports at least one region.</span></span> <span data-ttu-id="35593-171">次に、[**AutoExposureSupported**](https://msdn.microsoft.com/library/windows/apps/dn279065) または [**AutoFocusSupported**](https://msdn.microsoft.com/library/windows/apps/dn279066) のいずれかが true であるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="35593-171">Then check to see if either [**AutoExposureSupported**](https://msdn.microsoft.com/library/windows/apps/dn279065) or [**AutoFocusSupported**](https://msdn.microsoft.com/library/windows/apps/dn279066) are true.</span></span> <span data-ttu-id="35593-172">これらの条件が満たされている場合は、デバイスで顔検出を利用してキャプチャを強化できます。</span><span class="sxs-lookup"><span data-stu-id="35593-172">If these conditions are met, then the device can take advantage of face detection to enhance capture.</span></span>

[!code-cs[AreFaceFocusAndExposureSupported](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetAreFaceFocusAndExposureSupported)]

## <a name="related-topics"></a><span data-ttu-id="35593-173">関連トピック</span><span class="sxs-lookup"><span data-stu-id="35593-173">Related topics</span></span>

* [<span data-ttu-id="35593-174">カメラ</span><span class="sxs-lookup"><span data-stu-id="35593-174">Camera</span></span>](camera.md)
* [<span data-ttu-id="35593-175">MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ</span><span class="sxs-lookup"><span data-stu-id="35593-175">Basic photo, video, and audio capture with MediaCapture</span></span>](basic-photo-video-and-audio-capture-with-MediaCapture.md)
 

 




