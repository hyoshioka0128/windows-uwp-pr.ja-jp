---
ms.assetid: 66d0c3dc-81f6-4d9a-904b-281f8a334dd0
description: この記事では、MediaCapture クラスを使用して写真やビデオをキャプチャする最も簡単な方法を示します。
title: MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: d0aa227a47fc3940f3fa5c3010eed70f37067935
ms.sourcegitcommit: 49d58bc66c1c9f2a4f81473bcb25af79e2b1088d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2018
ms.locfileid: "8931786"
---
# <a name="basic-photo-video-and-audio-capture-with-mediacapture"></a><span data-ttu-id="e7f73-104">MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ</span><span class="sxs-lookup"><span data-stu-id="e7f73-104">Basic photo, video, and audio capture with MediaCapture</span></span>


<span data-ttu-id="e7f73-105">この記事では、[**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture) クラスを使用して写真やビデオをキャプチャする最も簡単な方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-105">This article shows the simplest way to capture photos and video using the [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture) class.</span></span> <span data-ttu-id="e7f73-106">**MediaCapture** クラスは、キャプチャ パイプラインに対する低レベルの制御を提供し、高度なキャプチャ シナリオを実現する、堅牢な一連の API を公開しますが、この記事では基本的なメディア キャプチャをアプリにすばやく簡単に追加できるようにすることを目的としています。</span><span class="sxs-lookup"><span data-stu-id="e7f73-106">The **MediaCapture** class exposes a robust set of APIs that provide low-level control over the capture pipeline and enable advanced capture scenarios, but this article is intended to help you add basic media capture to your app quickly and easily.</span></span> <span data-ttu-id="e7f73-107">**MediaCapture** が提供する機能について詳しくは、「[**カメラ**](camera.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-107">To learn about more of the features that  **MediaCapture** provides, see [**Camera**](camera.md).</span></span>

<span data-ttu-id="e7f73-108">写真やビデオをキャプチャするだけで、他のメディア キャプチャ機能を追加しない場合や、独自のカメラ UI を作成する必要がない場合は、[**CameraCaptureUI**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CameraCaptureUI) クラスを使用することができます。このクラスによって、単に Windows の組み込みカメラ アプリを起動し、キャプチャされた写真やビデオのファイルを受信することができます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-108">If you simply want to capture a photo or video and don't intend to add any additional media capture features, or if you don't want to create your own camera UI, you may want to use the [**CameraCaptureUI**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CameraCaptureUI) class, which allows you to simply launch the Windows built-in camera app and receive the photo or video file that was captured.</span></span> <span data-ttu-id="e7f73-109">詳しくは、「[**Windows の組み込みカメラ UI を使った写真とビデオのキャプチャ**](capture-photos-and-video-with-cameracaptureui.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-109">For more information, see [**Capture photos and video with Windows built-in camera UI**](capture-photos-and-video-with-cameracaptureui.md)</span></span>

<span data-ttu-id="e7f73-110">この記事のコードは、[**カメラのスターター キット**](https://go.microsoft.com/fwlink/?linkid=619479)のサンプルを基にしています。</span><span class="sxs-lookup"><span data-stu-id="e7f73-110">The code in this article was adapted from the [**Camera starter kit**](https://go.microsoft.com/fwlink/?linkid=619479) sample.</span></span> <span data-ttu-id="e7f73-111">このサンプルをダウンロードし、該当するコンテキストで使用されているコードを確認することも、サンプルを独自のアプリの開始点として使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-111">You can download the sample to see the code used in context or to use the sample as a starting point for your own app.</span></span>

## <a name="add-capability-declarations-to-the-app-manifest"></a><span data-ttu-id="e7f73-112">アプリ マニフェストに機能宣言を追加する</span><span class="sxs-lookup"><span data-stu-id="e7f73-112">Add capability declarations to the app manifest</span></span>

<span data-ttu-id="e7f73-113">アプリからデバイスのカメラにアクセスするには、アプリでデバイス機能 (*webcam* と *microphone*) の使用を宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-113">In order for your app to access a device's camera, you must declare that your app uses the *webcam* and *microphone* device capabilities.</span></span> <span data-ttu-id="e7f73-114">キャプチャした写真とビデオをユーザーの画像ライブラリまたはビデオ ライブラリに保存する場合は、*picturesLibrary* 機能と *videosLibrary* 機能も宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-114">If you want to save captured photos and videos to the users's Pictures or Videos library, you must also declare the *picturesLibrary* and *videosLibrary* capability.</span></span>

**<span data-ttu-id="e7f73-115">アプリ マニフェストに機能を追加するには</span><span class="sxs-lookup"><span data-stu-id="e7f73-115">To add capabilities to the app manifest</span></span>**

1.  <span data-ttu-id="e7f73-116">Microsoft Visual Studio では、**ソリューション エクスプローラー**で **package.appxmanifest** 項目をダブルクリックし、アプリケーション マニフェストのデザイナーを開きます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-116">In Microsoft Visual Studio, in **Solution Explorer**, open the designer for the application manifest by double-clicking the **package.appxmanifest** item.</span></span>
2.  <span data-ttu-id="e7f73-117">**[機能]** タブをクリックします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-117">Select the **Capabilities** tab.</span></span>
3.  <span data-ttu-id="e7f73-118">**[Web カメラ]** のボックスと **[マイク]** のボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-118">Check the box for **Webcam** and the box for **Microphone**.</span></span>
4.  <span data-ttu-id="e7f73-119">画像ライブラリとビデオ ライブラリにアクセスするには、**画像ライブラリ**のボックスと**ビデオ ライブラリ**のボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-119">For access to the Pictures and Videos library check the boxes for **Pictures Library** and the box for **Videos Library**.</span></span>


## <a name="initialize-the-mediacapture-object"></a><span data-ttu-id="e7f73-120">MediaCapture オブジェクトを初期化する</span><span class="sxs-lookup"><span data-stu-id="e7f73-120">Initialize the MediaCapture object</span></span>
<span data-ttu-id="e7f73-121">この記事で説明されているすべてのキャプチャ メソッドでは、最初の手順として、コンストラクターを呼び出した後、[**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.InitializeAsync) を呼び出すことによって、[**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture) オブジェクトを初期化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-121">All of the capture methods described in this article require the first step of initializing the [**MediaCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture) object by calling the constructor and then calling [**InitializeAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.InitializeAsync).</span></span> <span data-ttu-id="e7f73-122">**MediaCapture** オブジェクトはアプリで複数の場所からアクセスされるため、このオブジェクトを保持するためのクラス変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-122">Since the **MediaCapture** object will be accessed from multiple places in your app, declare a class variable to hold the object.</span></span>  <span data-ttu-id="e7f73-123">キャプチャ操作に失敗した場合に通知されるように、**MediaCapture** オブジェクトの [**Failed**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.Failed) イベントのハンドラーを実装します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-123">Implement a handler for the **MediaCapture** object's [**Failed**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.Failed) event to be notified if a capture operation fails.</span></span>

[!code-cs[DeclareMediaCapture](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetDeclareMediaCapture)]

[!code-cs[InitMediaCapture](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetInitMediaCapture)]

## <a name="set-up-the-camera-preview"></a><span data-ttu-id="e7f73-124">カメラ プレビューの設定</span><span class="sxs-lookup"><span data-stu-id="e7f73-124">Set up the camera preview</span></span>
<span data-ttu-id="e7f73-125">**MediaCapture** を使用して写真、ビデオ、オーディオをキャプチャする場合、カメラのプレビューを表示しないこともできますが、通常は、ユーザーがキャプチャされる内容を確認できるようにプレビュー ストリームを表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-125">It's possible to capture photos, videos, and audio using **MediaCapture** without showing the camera preview, but typically you want to show the preview stream so that the user can see what's being captured.</span></span> <span data-ttu-id="e7f73-126">また、オート フォーカス、自動露出、オート ホワイト バランスなど、**MediaCapture** の一部の機能を有効にするには、プレビュー ストリームが実行されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-126">Also, a few **MediaCapture** features require the preview stream to be running before they can be enbled, including auto focus, auto exposure, and auto white balance.</span></span> <span data-ttu-id="e7f73-127">カメラ プレビューを設定する方法については、「[**カメラ プレビューの表示**](simple-camera-preview-access.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-127">To see how to set up the camera preview, see [**Display the camera preview**](simple-camera-preview-access.md).</span></span>

## <a name="capture-a-photo-to-a-softwarebitmap"></a><span data-ttu-id="e7f73-128">SoftwareBitmap への写真のキャプチャ</span><span class="sxs-lookup"><span data-stu-id="e7f73-128">Capture a photo to a SoftwareBitmap</span></span>
<span data-ttu-id="e7f73-129">[**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap) クラスは、複数の機能間で共通の画像表現を提供するために、Windows 10 で導入されました。</span><span class="sxs-lookup"><span data-stu-id="e7f73-129">The [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap) class was introduced in Windows 10 to provide a common representation of images across multiple features.</span></span> <span data-ttu-id="e7f73-130">写真をキャプチャした後、ファイルにキャプチャするのではなく、XAML で表示するなど、キャプチャしたイメージをアプリですぐに使用する場合は、**SoftwareBitmap** にキャプチャする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-130">If you want to capture a photo and then immediately use the captured image in your app, such as displaying it in XAML, instead of capturing to a file, then you should capture to a **SoftwareBitmap**.</span></span> <span data-ttu-id="e7f73-131">後で画像をディスクに保存するオプションもあります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-131">You still have the option of saving the image to disk later.</span></span>

<span data-ttu-id="e7f73-132">**MediaCapture** オブジェクトを初期化した後、[**LowLagPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoCapture) クラスを使用して、写真を **SoftwareBitmap** にキャプチャできます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-132">After initializing the **MediaCapture** object, you can capture a photo to a **SoftwareBitmap** using the [**LowLagPhotoCapture**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoCapture) class.</span></span> <span data-ttu-id="e7f73-133">このクラスのインスタンスを取得するには、[**PrepareLowLagPhotoCaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagPhotoCaptureAsync) を呼び出して、必要な画像形式を指定する [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties)オブジェクトを渡します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-133">Get an instance of this class by calling [**PrepareLowLagPhotoCaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagPhotoCaptureAsync), passing in an [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties) object specifying the image format you want.</span></span> <span data-ttu-id="e7f73-134">[**CreateUncompressed**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties.CreateUncompressed) は、指定されたピクセル形式で非圧縮エンコードを作成します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-134">[**CreateUncompressed**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties.CreateUncompressed) creates an uncompressed encoding with the specified pixel format.</span></span> <span data-ttu-id="e7f73-135">写真をキャプチャするには、[**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoCapture.CaptureAsync) を呼び出します。これは、[**CapturedPhoto**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CapturedPhoto) オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-135">Capture a photo by calling [**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoCapture.CaptureAsync), which returns a [**CapturedPhoto**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CapturedPhoto) object.</span></span> <span data-ttu-id="e7f73-136">**SoftwareBitmap** を取得するには、[**Frame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CapturedPhoto.Frame) プロパティにアクセスし、次に [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CapturedFrame.SoftwareBitmap) プロパティにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-136">Get a **SoftwareBitmap** by accessing the [**Frame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CapturedPhoto.Frame) property and then the [**SoftwareBitmap**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.CapturedFrame.SoftwareBitmap) property.</span></span>

<span data-ttu-id="e7f73-137">必要に応じて、**CaptureAsync** を繰り返し呼び出して、複数の写真をキャプチャできます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-137">If you want, you can capture multiple photos by repeatedly calling **CaptureAsync**.</span></span> <span data-ttu-id="e7f73-138">キャプチャが完了したら、[**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.AdvancedPhotoCapture.FinishAsync) を呼び出して **LowLagPhotoCapture** セッションをシャットダウンし、関連するリソースを解放します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-138">When you are done capturing, call [**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.AdvancedPhotoCapture.FinishAsync) to shut down the **LowLagPhotoCapture** session and free up the associated resources.</span></span> <span data-ttu-id="e7f73-139">**FinishAsync** を呼び出した後、再び写真のキャプチャを開始するには、もう一度 [**PrepareLowLagPhotoCaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagPhotoCaptureAsync) を呼び出して、キャプチャ セッションを再初期化してから、[**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoCapture.CaptureAsync) を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-139">After calling **FinishAsync**, to begin capturing photos again you will need to call [**PrepareLowLagPhotoCaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagPhotoCaptureAsync) again to reinitialize the capture session before calling [**CaptureAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoCapture.CaptureAsync).</span></span>

[!code-cs[CaptureToSoftwareBitmap](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetCaptureToSoftwareBitmap)]

<span data-ttu-id="e7f73-140">Windows バージョン 1803 以降では、**CaptureAsync** から返された **CapturedFrame** クラスの [**BitmapProperties**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.bitmapproperties) プロパティにアクセスして、キャプチャした写真に関するメタデータを取得できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-140">Starting with Windows, version 1803, you can access the [**BitmapProperties**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.bitmapproperties) property of the **CapturedFrame** class returned from **CaptureAsync** to retrieve metadata about the captured photo.</span></span> <span data-ttu-id="e7f73-141">このデータを **BitmapEncoder** に渡すと、メタデータをファイルに保存できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-141">You can pass this data into a **BitmapEncoder** to save the metadata to a file.</span></span> <span data-ttu-id="e7f73-142">以前は、圧縮されていない画像形式について、このデータにアクセスできませんでした。</span><span class="sxs-lookup"><span data-stu-id="e7f73-142">Previously, there was no way to access this data for uncompressed image formats.</span></span> <span data-ttu-id="e7f73-143">[**ControlValues**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.controlvalues) プロパティにアクセスすると、キャプチャした写真の露出やホワイト バランスなどのコントロールの値を記述した [**CapturedFrameControlValues**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframecontrolvalues) オブジェクトも取得できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-143">You can also access the [**ControlValues**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.controlvalues) property to retrieve a [**CapturedFrameControlValues**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframecontrolvalues) object that describes the control values, such as exposure and white balance, for the captured frame.</span></span>

<span data-ttu-id="e7f73-144">**BitmapEncoder** の使い方および **SoftwareBitmap** オブジェクトの操作 (XAML ページに表示する方法など) について詳しくは、「[**ビットマップ画像の作成、編集、保存**](imaging.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-144">For information about using **BitmapEncoder** and about working with the **SoftwareBitmap** object, including how to display one in a XAML page, see [**Create, edit, and save bitmap images**](imaging.md).</span></span> 

<span data-ttu-id="e7f73-145">キャプチャ デバイス コントロールの値の設定について詳しくは、「[写真とビデオのキャプチャのためのキャプチャ デバイス コントロール](capture-device-controls-for-photo-and-video-capture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-145">For more information on setting capture device control values, see [Capture device controls for photo and video](capture-device-controls-for-photo-and-video-capture.md).</span></span>

<span data-ttu-id="e7f73-146">Windows 10 バージョン 1803 以降では、**MediaCapture** によって返された **CapturedFrame** の [**BitmapProperties**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.bitmapproperties) プロパティにアクセスして、圧縮されていない形式でキャプチャした写真に関する EXIF 情報などのメタデータを取得できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-146">Starting with Windows 10, version 1803, you can get the metadata, such as EXIF information, for photos captured in uncompressed format by accessing the [**BitmapProperties**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.bitmapproperties) property of the **CapturedFrame** returned by **MediaCapture**.</span></span> <span data-ttu-id="e7f73-147">以前のリリースでは、このデータにアクセスできるのは、圧縮ファイル形式にキャプチャされた写真のヘッダーでのみでした。</span><span class="sxs-lookup"><span data-stu-id="e7f73-147">In previous releases this data was only accessible in the header of photos captured to a compressed file format.</span></span> <span data-ttu-id="e7f73-148">このデータを [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder) に渡すと、画像ファイルを手動で書き込むことができます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-148">You can provide this data to a [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder) when manually writing an image file.</span></span> <span data-ttu-id="e7f73-149">ビットマップのエンコードについて詳しくは、「[ビットマップ画像の作成、編集、保存](imaging.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-149">For more information on encoding bitmaps, see [Create, edit, and save bitmap images](imaging.md).</span></span>  <span data-ttu-id="e7f73-150">[**ControlValues**](https://docs.microsoft.com/en-us/uwp/api/windows.media.capture.capturedframe.controlvalues) プロパティにアクセスすると、画像をキャプチャしたときに使用された露出やフラッシュ設定などのフレーム コントロールの値にもアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-150">You can also access the frame control values, such as exposure and flash settings, used when the image was captured by accessing the [**ControlValues**](https://docs.microsoft.com/en-us/uwp/api/windows.media.capture.capturedframe.controlvalues) property.</span></span> <span data-ttu-id="e7f73-151">詳しくは、「[写真とビデオのキャプチャのためのキャプチャ デバイス コントロール](capture-device-controls-for-photo-and-video-capture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-151">For more information, see [Capture device controls for photo and video capture](capture-device-controls-for-photo-and-video-capture.md).</span></span>

## <a name="capture-a-photo-to-a-file"></a><span data-ttu-id="e7f73-152">ファイルへの写真のキャプチャ</span><span class="sxs-lookup"><span data-stu-id="e7f73-152">Capture a photo to a file</span></span>
<span data-ttu-id="e7f73-153">典型的な写真アプリでは、キャプチャした写真をディスクやクラウド ストレージに保存し、写真の向きなどのメタデータをファイルに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-153">A typical photography app will save a captured photo to disk or to cloud storage and will need to add metadata, such as photo orientation, to the file.</span></span> <span data-ttu-id="e7f73-154">次の例では、ファイルに写真をキャプチャする方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-154">The following example shows you how to capture an photo to a file.</span></span> <span data-ttu-id="e7f73-155">後で画像ファイルから **SoftwareBitmap** を作成するオプションもあります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-155">You still have the option of creating a **SoftwareBitmap** from the image file later.</span></span> 

<span data-ttu-id="e7f73-156">この例で示されている方法では、写真をインメモリ ストリームにキャプチャし、写真をストリームからディスク上のファイルにコード変換します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-156">The technique shown in this example captures the photo to an in-memory stream and then transcode the photo from the stream to a file on disk.</span></span> <span data-ttu-id="e7f73-157">この例では、[**GetLibraryAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageLibrary.GetLibraryAsync) を使ってユーザーのピクチャ ライブラリを取得し、次に [**SaveFolder**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageLibrary.SaveFolder) プロパティを使って既定の保存フォルダーを取得します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-157">This example uses [**GetLibraryAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageLibrary.GetLibraryAsync) to get the user's pictures library and then the [**SaveFolder**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageLibrary.SaveFolder) property to get a reference default save folder.</span></span> <span data-ttu-id="e7f73-158">このフォルダーにアクセスするには、必ず**ピクチャ ライブラリ**機能をアプリ マニフェストに追加してください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-158">Remember to add the **Pictures Library** capability to your app manifest to access this folder.</span></span> <span data-ttu-id="e7f73-159">[**CreateFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFolder.CreateFileAsync) は、写真の保存先となる新しい [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFile) を作成します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-159">[**CreateFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFolder.CreateFileAsync) creates a new [**StorageFile**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFile) to which the photo will be saved.</span></span>

<span data-ttu-id="e7f73-160">[**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.Streams.InMemoryRandomAccessStream) を作成し、[**CapturePhotoToStreamAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.CapturePhotoToStreamAsync) を呼び出して、ストリームと、使用する画像形式を指定する [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties) オブジェクトを渡して、写真をストリームにキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-160">Create an [**InMemoryRandomAccessStream**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.Streams.InMemoryRandomAccessStream) and then call [**CapturePhotoToStreamAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.CapturePhotoToStreamAsync) to capture a photo to the stream, passing in the stream and an [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties) object specifying the image format that should be used.</span></span> <span data-ttu-id="e7f73-161">自分でオブジェクトを初期化することによって、カスタム エンコード プロパティを作成することもできますが、このクラスには、[**ImageEncodingProperties.CreateJpeg**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties.CreateJpeg) など、一般的なエンコード形式用の静的メソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="e7f73-161">You can create custom encoding properties by initializing the object yourself, but the class provides static methods, like [**ImageEncodingProperties.CreateJpeg**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.ImageEncodingProperties.CreateJpeg) for common encoding formats.</span></span> <span data-ttu-id="e7f73-162">次に、[**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFile.OpenAsync) を呼び出すことにより、出力ファイルへのファイル ストリームを作成します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-162">Next, create a file stream to the output file by calling [**OpenAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Storage.StorageFile.OpenAsync).</span></span> <span data-ttu-id="e7f73-163">[**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapDecoder) を作成して、インメモリ ストリームから画像をデコードします。次に、[**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder) を作成して、[**CreateForTranscodingAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder.CreateForTranscodingAsync) を呼び出すことによって画像をファイルにエンコードします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-163">Create a [**BitmapDecoder**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapDecoder) to decode the image from the in memory stream and then create a [**BitmapEncoder**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder) to encode the image to file by calling [**CreateForTranscodingAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder.CreateForTranscodingAsync).</span></span>

<span data-ttu-id="e7f73-164">必要に応じて、[**BitmapPropertySet**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapPropertySet) オブジェクトを作成し、イメージ エンコーダーで [**SetPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/br226252.aspx) を呼び出して、画像ファイルに写真に関するメタデータを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-164">You can optionally create a [**BitmapPropertySet**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapPropertySet) object and then call [**SetPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/br226252.aspx) on the image encoder to include metadata about the photo in the image file.</span></span> <span data-ttu-id="e7f73-165">エンコード プロパティについて詳しくは、「[**画像のメタデータ**](image-metadata.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-165">For more information about encoding properties, see [**Image metadata**](image-metadata.md).</span></span> <span data-ttu-id="e7f73-166">デバイスの向きを正しく処理することは、ほとんどの写真アプリに不可欠です。</span><span class="sxs-lookup"><span data-stu-id="e7f73-166">Handling device orientation properly is essential for most photography apps.</span></span> <span data-ttu-id="e7f73-167">詳しくは、「[**MediaCapture を使ってデバイスの向きを処理する**](handle-device-orientation-with-mediacapture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-167">For more information, see [**Handle device orientation with MediaCapture**](handle-device-orientation-with-mediacapture.md).</span></span>

<span data-ttu-id="e7f73-168">最後に、エンコーダー オブジェクトで [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder.FlushAsync) を呼び出して、写真をインメモリ ストリームからファイルにコード変換します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-168">Finally, call [**FlushAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.BitmapEncoder.FlushAsync) on the encoder object to transcode the photo from the in-memory stream to the file.</span></span>

[!code-cs[CaptureToFile](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetCaptureToFile)]

<span data-ttu-id="e7f73-169">ファイルとフォルダーの操作について詳しくは、「[**ファイル、フォルダー、およびライブラリ**](https://msdn.microsoft.com/windows/uwp/files/index)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-169">For more information about working with files and folders, see [**Files, folders, and libraries**](https://msdn.microsoft.com/windows/uwp/files/index).</span></span>

## <a name="capture-a-video"></a><span data-ttu-id="e7f73-170">ビデオのキャプチャ</span><span class="sxs-lookup"><span data-stu-id="e7f73-170">Capture a video</span></span>
<span data-ttu-id="e7f73-171">アプリにビデオ キャプチャ機能をすばやく追加するには、[**LowLagMediaRecording**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording) クラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-171">Quickly add video capture to your app by using the [**LowLagMediaRecording**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording) class.</span></span> <span data-ttu-id="e7f73-172">最初に、オブジェクト用のクラス変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-172">First, declare a class variable to for the object.</span></span>

[!code-cs[LowLagMediaRecording](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetLowLagMediaRecording)]

<span data-ttu-id="e7f73-173">次に、ビデオの保存先となる **StorageFile** オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-173">Next, create a **StorageFile** object to which the video will be saved.</span></span> <span data-ttu-id="e7f73-174">この例に示すように、ユーザーのビデオ ライブラリに保存するには、**ビデオ ライブラリ** 機能をアプリ マニフェストに追加する必要があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-174">Note that to save to the user's video library, as shown in this example, you must add the **Videos Library** capability to your app manifest.</span></span> <span data-ttu-id="e7f73-175">[**PrepareLowLagRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagRecordToStorageFileAsync) を呼び出して、ストレージ ファイルと、ビデオのエンコードを指定する [**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile) オブジェクトを渡すことにより、メディアの記録を初期化します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-175">Call [**PrepareLowLagRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagRecordToStorageFileAsync) to initialize the media recording, passing in the storage file and a [**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile) object specifying the encoding for the video.</span></span> <span data-ttu-id="e7f73-176">このクラスには、[**CreateMp4**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile.CreateMp4) など、一般的なエンコード プロファイルを作成するための静的メソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="e7f73-176">The class provides static methods, like [**CreateMp4**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile.CreateMp4), for creating common video encoding profiles.</span></span>

<span data-ttu-id="e7f73-177">最後に、[**StartAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StartAsync) を呼び出してビデオのキャプチャを開始します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-177">Finally, call [**StartAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StartAsync) to begin capturing video.</span></span>

[!code-cs[StartVideoCapture](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetStartVideoCapture)]

<span data-ttu-id="e7f73-178">ビデオの録画を停止するには、[**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StopAsync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-178">To stop recording video, call [**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StopAsync).</span></span>

[!code-cs[StopRecording](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetStopRecording)]

<span data-ttu-id="e7f73-179">**StartAsync** と **StopAsync** の呼び出しを続行して、他のビデオをキャプチャすることもできます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-179">You can continue to call **StartAsync** and **StopAsync** to capture additional videos.</span></span> <span data-ttu-id="e7f73-180">ビデオのキャプチャが完了したら、[**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.FinishAsync) を呼び出して、キャプチャ セッションを破棄し、関連付けられているリソースをクリーンアップします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-180">When you are done capturing videos, call [**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.FinishAsync) to dispose of the capture session and clean up associated resources.</span></span> <span data-ttu-id="e7f73-181">この呼び出しの後は、再び **PrepareLowLagRecordToStorageFileAsync** を呼び出してキャプチャ セッションを再初期化してから、**StartAsync** を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-181">After this call, you must call **PrepareLowLagRecordToStorageFileAsync** again to reinitialize the capture session before calling **StartAsync**.</span></span>

[!code-cs[FinishAsync](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetFinishAsync)]

<span data-ttu-id="e7f73-182">ビデオをキャプチャするときに、**MediaCapture** オブジェクトの [**RecordLimitationExceeded**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.RecordLimitationExceeded) イベントのハンドラーを登録する必要があります。このイベントは、1 つの録画の上限 (現在は 3 時間) を超える場合に、オペレーティング システムによって生成されます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-182">When capturing video, you should register a handler for the [**RecordLimitationExceeded**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.RecordLimitationExceeded) event of the **MediaCapture** object, which will be raised by the operating system if you surpass the limit for a single recording, currently three hours.</span></span> <span data-ttu-id="e7f73-183">このイベントのハンドラーで、[**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StopAsync) を呼び出して録画を完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-183">In the handler for the event, you should finalize your recording by calling [**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StopAsync).</span></span>

[!code-cs[RecordLimitationExceeded](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetRecordLimitationExceeded)]

[!code-cs[RecordLimitationExceededHandler](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetRecordLimitationExceededHandler)]

### <a name="play-and-edit-captured-video-files"></a><span data-ttu-id="e7f73-184">キャプチャしたビデオ ファイルの再生と編集</span><span class="sxs-lookup"><span data-stu-id="e7f73-184">Play and edit captured video files</span></span>
<span data-ttu-id="e7f73-185">ビデオをファイルにキャプチャした後は、アプリの UI の中でファイルを読み込んで再生できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-185">Once you have captured a video to a file, you may want to load the file and play it back within your app's UI.</span></span> <span data-ttu-id="e7f73-186">この操作には、**[MediaPlayerElement](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.MediaPlayerElement)** XAML コントロールと、それに関連付けられている **[MediaPlayer](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer)** を使用します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-186">You can do this using the **[MediaPlayerElement](https://docs.microsoft.com/uwp/api/Windows.UI.Xaml.Controls.MediaPlayerElement)** XAML control and an associated **[MediaPlayer](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer)**.</span></span> <span data-ttu-id="e7f73-187">XAML ページでメディアを再生する方法について詳しくは、「[MediaPlayer を使ったオーディオとビデオの再生](play-audio-and-video-with-mediaplayer.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-187">For information on playing media in a XAML page, see [Play audio and video with MediaPlayer](play-audio-and-video-with-mediaplayer.md).</span></span>

<span data-ttu-id="e7f73-188">**[CreateFromFileAsync](https://docs.microsoft.com/uwp/api/windows.media.editing.mediaclip.createfromfileasync)** を呼び出すと、ビデオ ファイルから **[MediaClip](https://docs.microsoft.com/uwp/api/windows.media.editing.mediaclip)** オブジェクトを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-188">You can also create a **[MediaClip](https://docs.microsoft.com/uwp/api/windows.media.editing.mediaclip)** object from a video file by calling **[CreateFromFileAsync](https://docs.microsoft.com/uwp/api/windows.media.editing.mediaclip.createfromfileasync)**.</span></span>  <span data-ttu-id="e7f73-189">**[MediaComposition](https://docs.microsoft.com/uwp/api/windows.media.editing.mediacomposition)** は、**MediaClip** オブジェクトのシーケンスの配置、ビデオの長さのトリミング、レイヤーの作成、BGM の追加、ビデオ効果の適用などの基本的なビデオ編集機能を備えています。</span><span class="sxs-lookup"><span data-stu-id="e7f73-189">A **[MediaComposition](https://docs.microsoft.com/uwp/api/windows.media.editing.mediacomposition)** provides basic video editing functionality like arranging the sequence of **MediaClip** objects, trimming video length, creating layers, adding background music, and applying video effects.</span></span> <span data-ttu-id="e7f73-190">メディア コンポジションの操作について詳しくは、「[メディア コンポジションと編集](media-compositions-and-editing.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-190">For more information on working with media compositions, see [Media compositions and editing](media-compositions-and-editing.md).</span></span>

## <a name="pause-and-resume-video-recording"></a><span data-ttu-id="e7f73-191">ビデオ録画の一時停止と再開</span><span class="sxs-lookup"><span data-stu-id="e7f73-191">Pause and resume video recording</span></span>
<span data-ttu-id="e7f73-192">[**PauseAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.PauseAsync) と [**ResumeAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.ResumeAsync) を呼び出すことによって、ビデオの録画を一時停止し、別の出力ファイルを作成せずに録画を再開することができます</span><span class="sxs-lookup"><span data-stu-id="e7f73-192">You can pause a video recording and then resume recording without creating a separate output file by calling [**PauseAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.PauseAsync) and then calling [**ResumeAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.ResumeAsync).</span></span>

[!code-cs[PauseRecordingSimple](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetPauseRecordingSimple)]

[!code-cs[ResumeRecordingSimple](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetResumeRecordingSimple)]

<span data-ttu-id="e7f73-193">Windows 10 バージョン 1607 以降では、ビデオの録画を一時停止し、録画を一時停止する前にキャプチャされた最後のフレームを受信できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-193">Starting with Windows 10, version 1607, you can pause a video recording and receive the last frame captured before the recording was paused.</span></span> <span data-ttu-id="e7f73-194">このフレームをカメラ プレビューにオーバーレイすることにより、ユーザーは、録画を再開する前に、一時停止したフレームとカメラの位置合わせをすることができます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-194">You can then overlay this frame on the camera preview to allow the user to align the camera with the paused frame before resuming recording.</span></span> <span data-ttu-id="e7f73-195">[**PauseWithResultAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.PauseWithResultAsync) を呼び出すと、[**MediaCapturePauseResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapturePauseResult) オブジェクトが返されます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-195">Calling [**PauseWithResultAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.PauseWithResultAsync) returns a [**MediaCapturePauseResult**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapturePauseResult) object.</span></span> <span data-ttu-id="e7f73-196">[**LastFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapturePauseResult.LastFrame) プロパティは、最後のフレームを表す [**VideoFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.VideoFrame) オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="e7f73-196">The [**LastFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapturePauseResult.LastFrame) property is a [**VideoFrame**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.VideoFrame) object representing the last frame.</span></span> <span data-ttu-id="e7f73-197">XAML でこのフレームを表示するには、ビデオ フレームの **SoftwareBitmap** 表現を取得します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-197">To display the frame in XAML, get the **SoftwareBitmap** representation of the video frame.</span></span> <span data-ttu-id="e7f73-198">現時点では、BGRA8 形式、プリマルチプライ済みまたは空のアルファ チャネルの画像のみがサポートされているため、適切な形式を取得するには、必要に応じて、[**Convert**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap.Covert) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-198">Currently, only images in BGRA8 format with premultiplied or empty alpha channel are supported, so call [**Convert**](https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.Imaging.SoftwareBitmap.Covert) if necessary to get the correct format.</span></span>  <span data-ttu-id="e7f73-199">新しい [**SoftwareBitmapSource**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource) オブジェクトを作成し、[**SetBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource.SetBitmapAsync) を呼び出して初期化します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-199">Create a new [**SoftwareBitmapSource**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource) object and call [**SetBitmapAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Media.Imaging.SoftwareBitmapSource.SetBitmapAsync) to initialize it.</span></span> <span data-ttu-id="e7f73-200">最後に、XAML の [**Image**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Image) コントロールの **Source** プロパティを設定して画像を表示します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-200">Finally, set the **Source** property of a XAML [**Image**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.Image) control to display the image.</span></span> <span data-ttu-id="e7f73-201">この方法が機能するには、画像が **CaptureElement** コントロールと整列されており、不透明度の値が 1 未満である必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-201">For this trick to work, your image must be aligned with the **CaptureElement** control and should have an opacity value less than one.</span></span> <span data-ttu-id="e7f73-202">UI は UI スレッドでのみ変更できるため、[**RunAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Core.CoreDispatcher.RunAsync) 内でこの呼び出しを行ってください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-202">Don't forget that you can only modify the UI on the UI thread, so make this call inside [**RunAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Core.CoreDispatcher.RunAsync).</span></span>

<span data-ttu-id="e7f73-203">**PauseWithResultAsync** は、録画された合計時間を追跡する必要がある場合に、前のセグメントで録画されたビデオの持続時間も返します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-203">**PauseWithResultAsync** also returns the duration of the video that was recorded in the preceeding segment in case you need to track how much total time has been recorded.</span></span>

[!code-cs[PauseCaptureWithResult](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetPauseCaptureWithResult)]

<span data-ttu-id="e7f73-204">録画を再開するときは、画像のソースを null に設定し、非表示にすることができます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-204">When you resume recording, you can set the source of the image to null and hide it.</span></span>

[!code-cs[ResumeCaptureWithResult](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetResumeCaptureWithResult)]

<span data-ttu-id="e7f73-205">[**StopWithResultAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StopWithResultAsync) を呼び出すことによってビデオを停止したときに、結果のフレームを取得することもできます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-205">Note that you can also get a result frame when you stop the video by calling [**StopWithResultAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StopWithResultAsync).</span></span>


## <a name="capture-audio"></a><span data-ttu-id="e7f73-206">オーディオのキャプチャ</span><span class="sxs-lookup"><span data-stu-id="e7f73-206">Capture audio</span></span> 
<span data-ttu-id="e7f73-207">前に示したビデオのキャプチャと同じ手法を用いて、アプリにオーディオ キャプチャ機能を簡単に追加することができます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-207">You can quickly add audio capture to your app by using the same technique shown above for capturing video.</span></span> <span data-ttu-id="e7f73-208">次の例では、アプリケーション データ フォルダーに **StorageFile** を作成します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-208">The example below creates a **StorageFile** in the application data folder.</span></span> <span data-ttu-id="e7f73-209">[**PrepareLowLagRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagRecordToStorageFileAsync) を呼び出して、ファイルと、[**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile) を渡すことによって、キャプチャ セッションを初期化します。この例では、MediaEncodingProfile は静的メソッド [**CreateMp3**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile.CreateMp3) によって生成されます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-209">Call [**PrepareLowLagRecordToStorageFileAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.MediaCapture.PrepareLowLagRecordToStorageFileAsync) to initialize the capture session, passing in the file and a [**MediaEncodingProfile**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile) which is generated in this example by the [**CreateMp3**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaProperties.MediaEncodingProfile.CreateMp3) static method.</span></span> <span data-ttu-id="e7f73-210">録音を開始するには、[**StartAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StartAsync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-210">To begin recording, call [**StartAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.StartAsync).</span></span>

[!code-cs[StartAudioCapture](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetStartAudioCapture)]


<span data-ttu-id="e7f73-211">オーディオの録音を停止するには、[**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoSequenceCapture.StopAsync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-211">Call [**StopAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagPhotoSequenceCapture.StopAsync) to stop the audio recording.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e7f73-212">関連トピック</span><span class="sxs-lookup"><span data-stu-id="e7f73-212">Related topics</span></span>

* [<span data-ttu-id="e7f73-213">カメラ</span><span class="sxs-lookup"><span data-stu-id="e7f73-213">Camera</span></span>](camera.md)
[!code-cs[StopRecording](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetStopRecording)]

<span data-ttu-id="e7f73-214">複数のオーディオ ファイルを録音するには、**StartAsync** と **StopAsync** を複数回呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-214">You can call **StartAsync** and **StopAsync** multiple times to record several audio files.</span></span> <span data-ttu-id="e7f73-215">オーディオのキャプチャが完了したら、[**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.FinishAsync) を呼び出して、キャプチャ セッションを破棄し、関連付けられているリソースをクリーンアップします。</span><span class="sxs-lookup"><span data-stu-id="e7f73-215">When you are done capturing audio, call [**FinishAsync**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Capture.LowLagMediaRecording.FinishAsync) to dispose of the capture session and clean up associated resources.</span></span> <span data-ttu-id="e7f73-216">この呼び出しの後は、再び **PrepareLowLagRecordToStorageFileAsync** を呼び出してキャプチャ セッションを再初期化してから、**StartAsync** を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-216">After this call, you must call **PrepareLowLagRecordToStorageFileAsync** again to reinitialize the capture session before calling **StartAsync**.</span></span>

[!code-cs[FinishAsync](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetFinishAsync)]


## <a name="detect-and-respond-to-audio-level-changes-by-the-system"></a><span data-ttu-id="e7f73-217">システムによるオーディオ レベルの変更を検出して対応する</span><span class="sxs-lookup"><span data-stu-id="e7f73-217">Detect and respond to audio level changes by the system</span></span>
<span data-ttu-id="e7f73-218">Windows 10、バージョン 1803 以降では、アプリのオーディオ キャプチャやオーディオ レンダリング ストリームのオーディオ レベルが、システムによって低下した場合やミュートされた場合に、アプリがそれを検出できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-218">Starting with Windows 10, version 1803, your app can detect when the system lowers or mutes the audio level of your app's audio capture and audio render streams.</span></span> <span data-ttu-id="e7f73-219">たとえば、アプリがバックグラウンドに移動すると、アプリのストリームがシステムによってミュートされることがあります。</span><span class="sxs-lookup"><span data-stu-id="e7f73-219">For example, the system may mute your app's streams when it goes into the background.</span></span> <span data-ttu-id="e7f73-220">[**AudioStateMonitor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor) クラスを使用すると、オーディオ ストリームの音量がシステムによって変更されたときに、イベントを受け取るように登録できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-220">The [**AudioStateMonitor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor) class allows you to register to receive an event when the system modifies the volume of an audio stream.</span></span> <span data-ttu-id="e7f73-221">オーディオ キャプチャ ストリーム監視用の \*\*AudioStateMonitor \*\*のインスタンスを取得するには、[**CreateForCaptureMonitoring**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.createforcapturemonitoring#Windows_Media_Audio_AudioStateMonitor_CreateForCaptureMonitoring) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-221">Get an instance of **AudioStateMonitor** for monitoring audio capture streams by calling [**CreateForCaptureMonitoring**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.createforcapturemonitoring#Windows_Media_Audio_AudioStateMonitor_CreateForCaptureMonitoring).</span></span> <span data-ttu-id="e7f73-222">オーディオ レンダリング ストリーム監視用のインスタンスを取得するには、[**CreateForRenderMonitoring**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.createforrendermonitoring) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-222">Get an instance for monitoring audio render streams by calling [**CreateForRenderMonitoring**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.createforrendermonitoring).</span></span> <span data-ttu-id="e7f73-223">対応するストリーム カテゴリのオーディオがシステムによって変更されたときに通知を受け取るには、各モニターの [**SoundLevelChanged**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.soundlevelchanged) イベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-223">Register a handler for the [**SoundLevelChanged**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.soundlevelchanged) event of each monitor to be notified when the audio for the corresponding stream category is changed by the system.</span></span>

[!code-cs[AudioStateMonitorUsing](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetAudioStateMonitorUsing)]

[!code-cs[AudioStateVars](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetAudioStateVars)]

[!code-cs[RegisterAudioStateMonitor](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetRegisterAudioStateMonitor)]

<span data-ttu-id="e7f73-224">キャプチャ ストリームの **SoundLevelChanged** ハンドラーで、**AudioStateMonitor** センダーの [**SoundLevel**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.soundlevel)プロパティを確認すると、新しいサウンド レベルを判定できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-224">In the **SoundLevelChanged** handler for the capture stream, you can check the [**SoundLevel**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiostatemonitor.soundlevel) property of the **AudioStateMonitor** sender to determine the new sound level.</span></span> <span data-ttu-id="e7f73-225">キャプチャー ストリームは、システムによって下げないで (つまり "ダッキング" しないで) ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-225">Note that a capture stream should never be lowered, or "ducked", by the system.</span></span> <span data-ttu-id="e7f73-226">ミュートとフル音量の間の切り替えのみを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-226">It should only ever be muted or switched back to full volume.</span></span> <span data-ttu-id="e7f73-227">オーディオ ストリームがミュートになっている場合は、実行中のキャプチャを停止できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-227">If the audio stream is muted, you can stop a capture in progress.</span></span> <span data-ttu-id="e7f73-228">オーディオ ストリームがフル音量に戻った場合は、もう一度キャプチャを開始できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-228">If the audio stream is restored to full volume, you can start capturing again.</span></span> <span data-ttu-id="e7f73-229">次の例では、複数のブール型のクラス変数を使用して、オーディオが現在キャプチャ中か、それともオーディオ状態の変更のためにキャプチャが停止しているかを追跡しています。</span><span class="sxs-lookup"><span data-stu-id="e7f73-229">The following example uses some boolean class variables to track whether the app is currently capturing audio and if the capture was stopped due to the audio state change.</span></span> <span data-ttu-id="e7f73-230">これらの変数を使用すると、オーディオ キャプチャをプログラムによって停止または開始する適切な時期を判断できます。</span><span class="sxs-lookup"><span data-stu-id="e7f73-230">These variables are used to determine when it's appropriate to programmatically stop or start audio capture.</span></span>

[!code-cs[CaptureSoundLevelChanged](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetCaptureSoundLevelChanged)]

<span data-ttu-id="e7f73-231">次のコード例では、オーディオ レンダリング用の **SoundLevelChanged** ハンドラーの実装を示しています。</span><span class="sxs-lookup"><span data-stu-id="e7f73-231">The following code example illustrates an implementation of the **SoundLevelChanged** handler for audio rendering.</span></span> <span data-ttu-id="e7f73-232">アプリのシナリオや、再生しているコンテンツの種類に応じて、サウンド レベルがダッキングされている間、オーディオ再生を一時停止します。</span><span class="sxs-lookup"><span data-stu-id="e7f73-232">Depending on your app scenario, and the type of content you are playing, you may want to pause audio playback when the sound level is ducked.</span></span> <span data-ttu-id="e7f73-233">メディア再生のサウンド レベルの変更を処理する方法について詳しくは、「[MediaPlayer を使ったオーディオとビデオの再生](play-audio-and-video-with-mediaplayer.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e7f73-233">For more information on handling sound level changes for media playback, see [Play audio and video with MediaPlayer](play-audio-and-video-with-mediaplayer.md).</span></span>

[!code-cs[RenderSoundLevelChanged](./code/SimpleCameraPreview_Win10/cs/MainPage.xaml.cs#SnippetRenderSoundLevelChanged)]


* [<span data-ttu-id="e7f73-234">Windows の組み込みカメラ UI を使った写真とビデオのキャプチャ</span><span class="sxs-lookup"><span data-stu-id="e7f73-234">Capture photos and video with Windows built-in camera UI</span></span>](capture-photos-and-video-with-cameracaptureui.md)
* [<span data-ttu-id="e7f73-235">MediaCapture を使ってデバイスの向きを処理する</span><span class="sxs-lookup"><span data-stu-id="e7f73-235">Handle device orientation with MediaCapture</span></span>](handle-device-orientation-with-mediacapture.md)
* [<span data-ttu-id="e7f73-236">ビットマップ画像の作成、編集、保存</span><span class="sxs-lookup"><span data-stu-id="e7f73-236">Create, edit, and save bitmap images</span></span>](imaging.md)
* [<span data-ttu-id="e7f73-237">ファイル、フォルダー、およびライブラリ</span><span class="sxs-lookup"><span data-stu-id="e7f73-237">Files, folders, and libraries</span></span>](https://msdn.microsoft.com/windows/uwp/files/index)

