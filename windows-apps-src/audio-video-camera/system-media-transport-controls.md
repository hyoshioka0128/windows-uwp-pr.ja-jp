---
ms.assetid: EFCF84D0-2F4C-454D-97DA-249E9EAA806C
description: SystemMediaTransportControls クラスを使うと、Windows に組み込まれているシステム メディア トランスポート コントロールをアプリで使って、現在アプリで再生中のメディアに関してコントロールに表示されるメタデータを更新できるようになります。
title: システム メディア トランスポート コントロールの手動制御
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: 6be1680d1ce843c1fbe7105dc2027e764095495a
ms.sourcegitcommit: b034650b684a767274d5d88746faeea373c8e34f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2019
ms.locfileid: "57635657"
---
# <a name="manual-control-of-the-system-media-transport-controls"></a><span data-ttu-id="d17d0-104">システム メディア トランスポート コントロールの手動制御</span><span class="sxs-lookup"><span data-stu-id="d17d0-104">Manual control of the System Media Transport Controls</span></span>


<span data-ttu-id="d17d0-105">Windows 10 バージョン 1607 以降、[**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer) クラスを使ってメディアを再生する UWP アプリは、既定でシステム メディア トランスポート コントロール (SMTC) と自動的に統合されます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-105">Starting with Windows 10, version 1607, UWP apps that use the [**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer) class to play media are automatically integrated with the System Media Transport Controls (SMTC) by default.</span></span> <span data-ttu-id="d17d0-106">これは、ほとんどのシナリオの SMTC と対話するための推奨される方法です。</span><span class="sxs-lookup"><span data-stu-id="d17d0-106">This is the recommended way of interacting with the SMTC for most scenarios.</span></span> <span data-ttu-id="d17d0-107">SMTC の **MediaPlayer** との既定の統合のカスタマイズについて詳しくは、「[システム メディア トランスポート コントロールとの統合](integrate-with-systemmediatransportcontrols.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="d17d0-107">For more information on customizing the SMTC's default integration with **MediaPlayer**, see [Integrate with the System Media Transport Controls](integrate-with-systemmediatransportcontrols.md).</span></span>

<span data-ttu-id="d17d0-108">SMTC の手動コントロールの実装が必要になるシナリオがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-108">There are a few scenarios where you may need to implement manual control of the SMTC.</span></span> <span data-ttu-id="d17d0-109">たとえば、[**MediaTimelineController**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaTimelineController) を使って 1 つ以上のメディア プレーヤーの再生を制御する場合です。</span><span class="sxs-lookup"><span data-stu-id="d17d0-109">These include if you are using a [**MediaTimelineController**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.MediaTimelineController) to control playback of one or more media players.</span></span> <span data-ttu-id="d17d0-110">複数のメディア プレーヤーを使用していて、アプリ用に SMTC の 1 つのインスタンスだけが必要な場合もそうです。</span><span class="sxs-lookup"><span data-stu-id="d17d0-110">Or if you are using multiple media players and only want to have one instance of SMTC for your app.</span></span> <span data-ttu-id="d17d0-111">[  **MediaElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaElement) を使ってメディアを再生する場合は、SMTC を手動で制御する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-111">You must manually control the SMTC if you are using [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaElement) to play media.</span></span>

## <a name="set-up-transport-controls"></a><span data-ttu-id="d17d0-112">トランスポート コントロールをセットアップする</span><span class="sxs-lookup"><span data-stu-id="d17d0-112">Set up transport controls</span></span>
<span data-ttu-id="d17d0-113">**MediaPlayer** 使ってメディアを再生している場合は、[**MediaPlayer.SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.SystemMediaTransportControls) プロパティにアクセスして [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.SystemMediaTransportControls) のインスタンスを取得できます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-113">If you are using **MediaPlayer** to play media, you can get an instance of the [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.SystemMediaTransportControls) class by accessing the [**MediaPlayer.SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.SystemMediaTransportControls) property.</span></span> <span data-ttu-id="d17d0-114">SMTC を手動で制御する場合は、[**CommandManager.IsEnabled**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackCommandManager.IsEnabled) プロパティを false に設定して、**MediaPlayer** によって提供される自動統合を無効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-114">If you are going to manually control the SMTC, you should disable the automatic integration provided by **MediaPlayer** by setting the [**CommandManager.IsEnabled**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackCommandManager.IsEnabled) property to false.</span></span>

> [!NOTE] 
> <span data-ttu-id="d17d0-115">[  **IsEnabled**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackCommandManager.IsEnabled) を false に設定して、[**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer) の [**MediaPlaybackCommandManager**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackCommandManager) を無効にすると、**MediaPlayerElement** で提供される **MediaPlayer** と [**TransportControls**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement.TransportControls) の間のリンクが解除されます。このため組み込みトランスポート コントロールはプレーヤーの再生を自動的に制御しなくなります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-115">If you disable the [**MediaPlaybackCommandManager**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackCommandManager) of the [**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer) by setting [**IsEnabled**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackCommandManager.IsEnabled) to false, it will break the link between the **MediaPlayer** the [**TransportControls**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement.TransportControls) provided by the **MediaPlayerElement**, so the built-in transport controls will no longer automatically control the playback of the player.</span></span> <span data-ttu-id="d17d0-116">代わりに、独自のコントロールを実装して、**MediaPlayer** を制御する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-116">Instead, you must implement your own controls to control the **MediaPlayer**.</span></span>

[!code-cs[InitSMTCMediaPlayer](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetInitSMTCMediaPlayer)]

<span data-ttu-id="d17d0-117">[  **GetForCurrentView**](https://msdn.microsoft.com/library/windows/apps/dn278708) を呼び出して、[**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) のインスタンスを取得することもできます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-117">You can also get an instance of the [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) by calling [**GetForCurrentView**](https://msdn.microsoft.com/library/windows/apps/dn278708).</span></span> <span data-ttu-id="d17d0-118">**MediaElement** を使ってメディアを再生している場合は、この方法でオブジェクトを取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-118">You must get the object with this method if you are using **MediaElement** to play media.</span></span>

[!code-cs[InitSMTCMediaElement](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetInitSMTCMediaElement)]

<span data-ttu-id="d17d0-119">**SystemMediaTransportControls** オブジェクトの対応する "is enabled" プロパティ ([**IsPlayEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278714)、[**IsPauseEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278713)、[**IsNextEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278712)、[**IsPreviousEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278715) など) を設定することで、アプリで使うボタンを有効にします。</span><span class="sxs-lookup"><span data-stu-id="d17d0-119">Enable the buttons that your app will use by setting the corresponding "is enabled" property of the **SystemMediaTransportControls** object, such as [**IsPlayEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278714), [**IsPauseEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278713), [**IsNextEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278712), and [**IsPreviousEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278715).</span></span> <span data-ttu-id="d17d0-120">利用可能なすべてのコントロールの一覧については、**SystemMediaTransportControls** のリファレンス ドキュメントをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="d17d0-120">See the **SystemMediaTransportControls** reference documentation for a complete list of available controls.</span></span>

[!code-cs[EnableContols](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetEnableContols)]

<span data-ttu-id="d17d0-121">ユーザーがボタンを押したときに通知を受信するために、[**ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) イベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-121">Register a handler for the [**ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) event to receive notifications when the user presses a button.</span></span>

[!code-cs[RegisterButtonPressed](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetRegisterButtonPressed)]

## <a name="handle-system-media-transport-controls-button-presses"></a><span data-ttu-id="d17d0-122">システム メディア トランスポート コントロールの押されたボタンを処理する</span><span class="sxs-lookup"><span data-stu-id="d17d0-122">Handle system media transport controls button presses</span></span>

<span data-ttu-id="d17d0-123">[  **ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) イベントは、有効なボタンの 1 つが押されたときにシステム トランスポート コントロールで発生します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-123">The [**ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) event is raised by the system transport controls when one of the enabled buttons is pressed.</span></span> <span data-ttu-id="d17d0-124">イベント ハンドラーに渡される [**SystemMediaTransportControlsButtonPressedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn278683) の [**Button**](https://msdn.microsoft.com/library/windows/apps/dn278685) プロパティは、有効なボタンのうちどれが押されたかを示す [**SystemMediaTransportControlsButton**](https://msdn.microsoft.com/library/windows/apps/dn278681) 列挙体のメンバーです。</span><span class="sxs-lookup"><span data-stu-id="d17d0-124">The [**Button**](https://msdn.microsoft.com/library/windows/apps/dn278685) property of the [**SystemMediaTransportControlsButtonPressedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn278683) passed into the event handler is a member of the [**SystemMediaTransportControlsButton**](https://msdn.microsoft.com/library/windows/apps/dn278681) enumeration that indicates which of the enabled buttons was pressed.</span></span>

<span data-ttu-id="d17d0-125">[  **ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) イベント ハンドラーから UI スレッド上のオブジェクト ([**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) オブジェクトなど) を更新するには、[**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211) を介して呼び出しをマーシャリングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-125">In order to update objects on the UI thread from the [**ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) event handler, such as a [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) object, you must marshal the calls through the [**CoreDispatcher**](https://msdn.microsoft.com/library/windows/apps/br208211).</span></span> <span data-ttu-id="d17d0-126">これは、**ButtonPressed** イベント ハンドラーが UI スレッドから呼び出されず、UI を直接変更しようとすると例外が発生するためです。</span><span class="sxs-lookup"><span data-stu-id="d17d0-126">This is because the **ButtonPressed** event handler is not called from the UI thread and therefore an exception will be thrown if you attempt to modify the UI directly.</span></span>

[!code-cs[SystemMediaTransportControlsButtonPressed](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetSystemMediaTransportControlsButtonPressed)]

## <a name="update-the-system-media-transport-controls-with-the-current-media-status"></a><span data-ttu-id="d17d0-127">現在のメディアの状態でシステム メディア トランスポート コントロールを更新する</span><span class="sxs-lookup"><span data-stu-id="d17d0-127">Update the system media transport controls with the current media status</span></span>

<span data-ttu-id="d17d0-128">システムで現在の状態を反映してコントロールを更新できるように、メディアの状態が変更されたときには、それを [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) に通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-128">You should notify the [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) when the state of the media has changed so that the system can update the controls to reflect the current state.</span></span> <span data-ttu-id="d17d0-129">そのためには、メディアの状態が変更されたときに発生する [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) の [**CurrentStateChanged**](https://msdn.microsoft.com/library/windows/apps/br227375) イベント内から、[**PlaybackStatus**](https://msdn.microsoft.com/library/windows/apps/dn278719) プロパティを適切な [**MediaPlaybackStatus**](https://msdn.microsoft.com/library/windows/apps/dn278665) 値に設定します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-129">To do this, set the [**PlaybackStatus**](https://msdn.microsoft.com/library/windows/apps/dn278719) property to the appropriate [**MediaPlaybackStatus**](https://msdn.microsoft.com/library/windows/apps/dn278665) value from within the [**CurrentStateChanged**](https://msdn.microsoft.com/library/windows/apps/br227375) event of the [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926), which is raised when the media state changes.</span></span>

[!code-cs[SystemMediaTransportControlsStateChange](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetSystemMediaTransportControlsStateChange)]

## <a name="update-the-system-media-transport-controls-with-media-info-and-thumbnails"></a><span data-ttu-id="d17d0-130">メディアの情報と縮小表示でシステム メディア トランスポート コントロールを更新する</span><span class="sxs-lookup"><span data-stu-id="d17d0-130">Update the system media transport controls with media info and thumbnails</span></span>

<span data-ttu-id="d17d0-131">[  **SystemMediaTransportControlsDisplayUpdater**](https://msdn.microsoft.com/library/windows/apps/dn278686) クラスを使って、現在再生されているメディア項目の曲のタイトルやアルバム アートなど、トランスポート コントロールに表示されるメディア情報を更新します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-131">Use the [**SystemMediaTransportControlsDisplayUpdater**](https://msdn.microsoft.com/library/windows/apps/dn278686) class to update the media info that is displayed by the transport controls, such as the song title or the album art for the currently playing media item.</span></span> <span data-ttu-id="d17d0-132">[  **SystemMediaTransportControls.DisplayUpdater**](https://msdn.microsoft.com/library/windows/apps/dn278707) プロパティを使って、このクラスのインスタンスを取得します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-132">Get an instance of this class with the [**SystemMediaTransportControls.DisplayUpdater**](https://msdn.microsoft.com/library/windows/apps/dn278707) property.</span></span> <span data-ttu-id="d17d0-133">一般的なシナリオの場合、メタデータを渡すための推奨される方法は、現在再生中のメディア ファイルを渡して [**CopyFromFileAsync**](https://msdn.microsoft.com/library/windows/apps/dn278694) を呼び出すことです。</span><span class="sxs-lookup"><span data-stu-id="d17d0-133">For typical scenarios, the recommended way to pass the metadata is to call [**CopyFromFileAsync**](https://msdn.microsoft.com/library/windows/apps/dn278694), passing in the currently playing media file.</span></span> <span data-ttu-id="d17d0-134">表示アップデーターによって、ファイルからメタデータと縮小表示画像が自動的に抽出されます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-134">The display updater will automatically extract the metadata and thumbnail image from the file.</span></span>

<span data-ttu-id="d17d0-135">[  **Update**](https://msdn.microsoft.com/library/windows/apps/dn278701) を呼び出すことで、システム メディア トランスポート コントロールの UI が新しいメタデータと縮小表示によって更新されます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-135">Call the [**Update**](https://msdn.microsoft.com/library/windows/apps/dn278701) to cause the system media transport controls to update its UI with the new metadata and thumbnail.</span></span>

[!code-cs[SystemMediaTransportControlsUpdater](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetSystemMediaTransportControlsUpdater)]

<span data-ttu-id="d17d0-136">必要に応じて、[**DisplayUpdater**](https://msdn.microsoft.com/library/windows/apps/dn278707) クラスによって公開される [**MusicProperties**](https://msdn.microsoft.com/library/windows/apps/dn278696)、[**ImageProperties**](https://msdn.microsoft.com/library/windows/apps/dn278695)、または [**VideoProperties**](https://msdn.microsoft.com/library/windows/apps/dn278702) オブジェクトの値を設定することにより、システム メディア トランスポート コントロールに表示されるメタデータを手動で更新できます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-136">If your scenario requires it, you can update the metadata displayed by the system media transport controls manually by setting the values of the [**MusicProperties**](https://msdn.microsoft.com/library/windows/apps/dn278696), [**ImageProperties**](https://msdn.microsoft.com/library/windows/apps/dn278695), or [**VideoProperties**](https://msdn.microsoft.com/library/windows/apps/dn278702) objects exposed by the [**DisplayUpdater**](https://msdn.microsoft.com/library/windows/apps/dn278707) class.</span></span>

[!code-cs[SystemMediaTransportControlsUpdaterManual](./code/SMTCWin10/cs/MainPage.xaml.cs#SystemMediaTransportControlsUpdaterManual)]

## <a name="update-the-system-media-transport-controls-timeline-properties"></a><span data-ttu-id="d17d0-137">システム メディア トランスポート コントロールのタイムライン プロパティを更新する</span><span class="sxs-lookup"><span data-stu-id="d17d0-137">Update the system media transport controls timeline properties</span></span>

<span data-ttu-id="d17d0-138">システム トランスポート コントロールには、メディア項目の現在の再生位置、開始時刻、終了時刻など、現在再生中のメディア項目のタイムラインに関する情報が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-138">The system transport controls display information about the timeline of the currently playing media item, including the current playback position, the start time, and the end time of the media item.</span></span> <span data-ttu-id="d17d0-139">システム メディア トランスポート コントロールのタイムライン プロパティを更新するには、新しい [**SystemMediaTransportControlsTimelineProperties**](https://msdn.microsoft.com/library/windows/apps/mt218746) オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-139">To update the system transport controls timeline properties, create a new [**SystemMediaTransportControlsTimelineProperties**](https://msdn.microsoft.com/library/windows/apps/mt218746) object.</span></span> <span data-ttu-id="d17d0-140">再生中のメディア項目の現在の状態を反映するように、オブジェクトのプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-140">Set the properties of the object to reflect the current state of the playing media item.</span></span> <span data-ttu-id="d17d0-141">[  **SystemMediaTransportControls.UpdateTimelineProperties**](https://msdn.microsoft.com/library/windows/apps/mt218760) を呼び出して、コントロールのタイムラインを更新します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-141">Call [**SystemMediaTransportControls.UpdateTimelineProperties**](https://msdn.microsoft.com/library/windows/apps/mt218760) to cause the controls to update the timeline.</span></span>

[!code-cs[UpdateTimelineProperties](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetUpdateTimelineProperties)]

-   <span data-ttu-id="d17d0-142">再生中の項目のタイムラインをシステム コントロールに表示するには、[**StartTime**](https://msdn.microsoft.com/library/windows/apps/mt218751)、[**EndTime**](https://msdn.microsoft.com/library/windows/apps/mt218747)、および [**Position**](https://msdn.microsoft.com/library/windows/apps/mt218755) の値を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-142">You must provide a value for the [**StartTime**](https://msdn.microsoft.com/library/windows/apps/mt218751), [**EndTime**](https://msdn.microsoft.com/library/windows/apps/mt218747) and [**Position**](https://msdn.microsoft.com/library/windows/apps/mt218755) in order for the system controls to display a timeline for your playing item.</span></span>

-   <span data-ttu-id="d17d0-143">[**MinSeekTime** ](https://msdn.microsoft.com/library/windows/apps/mt218749)と[ **MaxSeekTime** ](https://msdn.microsoft.com/library/windows/apps/mt218748)シークできるユーザーのタイムライン内の範囲を指定できます。</span><span class="sxs-lookup"><span data-stu-id="d17d0-143">[**MinSeekTime**](https://msdn.microsoft.com/library/windows/apps/mt218749) and [**MaxSeekTime**](https://msdn.microsoft.com/library/windows/apps/mt218748) allow you to specify the range within the timeline that the user can seek.</span></span> <span data-ttu-id="d17d0-144">一般的なシナリオとしては、コンテンツ プロバイダーがメディアに広告を含める場合などがあります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-144">A typical scenario for this is to allow content providers to include advertisement breaks in their media.</span></span>

    <span data-ttu-id="d17d0-145">[  **PositionChangeRequest**](https://msdn.microsoft.com/library/windows/apps/mt218755) を発生させるには、[**MinSeekTime**](https://msdn.microsoft.com/library/windows/apps/mt218749) と [**MaxSeekTime**](https://msdn.microsoft.com/library/windows/apps/mt218748) を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-145">You must set [**MinSeekTime**](https://msdn.microsoft.com/library/windows/apps/mt218749) and [**MaxSeekTime**](https://msdn.microsoft.com/library/windows/apps/mt218748) in order for the [**PositionChangeRequest**](https://msdn.microsoft.com/library/windows/apps/mt218755) to be raised.</span></span>

-   <span data-ttu-id="d17d0-146">システム コントロールは、メディアの再生と同期させておくことをお勧めします。そのためには、再生中にこれらのプロパティを約 5 秒ごとに更新し、一時停止や新しい位置へのシークなど、再生に変更が加えられたときには、再度更新します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-146">It is recommended that you keep the system controls in sync with your media playback by updating these properties approximately every 5 seconds during playback and again whenever the state of playback changes, such as pausing or seeking to a new position.</span></span>

## <a name="respond-to-player-property-changes"></a><span data-ttu-id="d17d0-147">プレーヤーのプロパティの変更に応答する</span><span class="sxs-lookup"><span data-stu-id="d17d0-147">Respond to player property changes</span></span>

<span data-ttu-id="d17d0-148">再生中のメディア項目の状態ではなく、メディア プレーヤー自体の現在の状態に関連した、一連のシステム トランスポート コントロール プロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-148">There is a set of system transport controls properties that relate to the current state of the media player itself, rather than the state of the playing media item.</span></span> <span data-ttu-id="d17d0-149">これらの各プロパティは、ユーザーが関連するコントロールを調整したときに発生するイベントと対応しています。</span><span class="sxs-lookup"><span data-stu-id="d17d0-149">Each of these properties is matched with an event that is raised when the user adjusts the associated control.</span></span> <span data-ttu-id="d17d0-150">これらのプロパティとイベントを次に示します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-150">These properties and events include:</span></span>

| <span data-ttu-id="d17d0-151">プロパティ</span><span class="sxs-lookup"><span data-stu-id="d17d0-151">Property</span></span>                                                                  | <span data-ttu-id="d17d0-152">event</span><span class="sxs-lookup"><span data-stu-id="d17d0-152">Event</span></span>                                                                                                   |
|---------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="d17d0-153">**AutoRepeatMode**</span><span class="sxs-lookup"><span data-stu-id="d17d0-153">**AutoRepeatMode**</span></span>](https://msdn.microsoft.com/library/windows/apps/mt218753) | [<span data-ttu-id="d17d0-154">**AutoRepeatModeChangeRequested**</span><span class="sxs-lookup"><span data-stu-id="d17d0-154">**AutoRepeatModeChangeRequested**</span></span>](https://msdn.microsoft.com/library/windows/apps/mt218754) |
| [<span data-ttu-id="d17d0-155">**PlaybackRate**</span><span class="sxs-lookup"><span data-stu-id="d17d0-155">**PlaybackRate**</span></span>](https://msdn.microsoft.com/library/windows/apps/mt218756)     | [<span data-ttu-id="d17d0-156">**PlaybackRateChangeRequested**</span><span class="sxs-lookup"><span data-stu-id="d17d0-156">**PlaybackRateChangeRequested**</span></span>](https://msdn.microsoft.com/library/windows/apps/mt218757)     |
| [<span data-ttu-id="d17d0-157">**ShuffleEnabled**</span><span class="sxs-lookup"><span data-stu-id="d17d0-157">**ShuffleEnabled**</span></span>](https://msdn.microsoft.com/library/windows/apps/mt218758) | [<span data-ttu-id="d17d0-158">**ShuffleEnabledChangeRequested**</span><span class="sxs-lookup"><span data-stu-id="d17d0-158">**ShuffleEnabledChangeRequested**</span></span>](https://msdn.microsoft.com/library/windows/apps/mt218759) |

 
<span data-ttu-id="d17d0-159">これらのコントロールの 1 つに対するユーザーの操作を処理するには、最初に、関連付けられているイベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-159">To handle user interaction with one of these controls, first register a handler for the associated event.</span></span>

[!code-cs[RegisterPlaybackChangedHandler](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetRegisterPlaybackChangedHandler)]

<span data-ttu-id="d17d0-160">まず、イベントのハンドラーで、要求された値が有効な予想される範囲内にあることを確認します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-160">In the handler for the event, first make sure that the requested value is within a valid and expected range.</span></span> <span data-ttu-id="d17d0-161">範囲内の場合は、[**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) の対応するプロパティを設定してから、[**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) オブジェクトの対応するプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-161">If it is, set the corresponding property on [**MediaElement**](https://msdn.microsoft.com/library/windows/apps/br242926) and then set the corresponding property on the [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) object.</span></span>

[!code-cs[PlaybackChangedHandler](./code/SMTCWin10/cs/MainPage.xaml.cs#SnippetPlaybackChangedHandler)]

-   <span data-ttu-id="d17d0-162">これらのプレーヤー プロパティ イベントの 1 つが発生するためには、プロパティの初期値を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-162">In order for one of these player property events to be raised, you must set an initial value for the property.</span></span> <span data-ttu-id="d17d0-163">たとえば、[**PlaybackRateChangeRequested**](https://msdn.microsoft.com/library/windows/apps/mt218757) は、[**PlaybackRate**](https://msdn.microsoft.com/library/windows/apps/mt218756) プロパティの値を少なくとも 1 回設定するまでは発生しません。</span><span class="sxs-lookup"><span data-stu-id="d17d0-163">For example, [**PlaybackRateChangeRequested**](https://msdn.microsoft.com/library/windows/apps/mt218757) will not be raised until after you have set a value for the [**PlaybackRate**](https://msdn.microsoft.com/library/windows/apps/mt218756) property at least one time.</span></span>

## <a name="use-the-system-media-transport-controls-for-background-audio"></a><span data-ttu-id="d17d0-164">バックグラウンド オーディオに対してシステム メディア トランスポート コントロールを使う</span><span class="sxs-lookup"><span data-stu-id="d17d0-164">Use the system media transport controls for background audio</span></span>

<span data-ttu-id="d17d0-165">**MediaPlayer** によって提供される自動 SMTC 統合を使用していない場合は、SMTC と手動で統合してバック グラウンド オーディオを有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-165">If you are not using the automatic SMTC integration provided by **MediaPlayer** you must manually integrate with the SMTC to enable background audio.</span></span> <span data-ttu-id="d17d0-166">少なくとも、アプリで [**IsPlayEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278714) と [**IsPauseEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278713) を true に設定して、再生ボタンと一時停止ボタンを有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-166">At a minimum, your app must enable the play and pause buttons by setting [**IsPlayEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278714) and [**IsPauseEnabled**](https://msdn.microsoft.com/library/windows/apps/dn278713) to true.</span></span> <span data-ttu-id="d17d0-167">アプリは、[**ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) イベントも処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-167">Your app must also handle the [**ButtonPressed**](https://msdn.microsoft.com/library/windows/apps/dn278706) event.</span></span> <span data-ttu-id="d17d0-168">アプリがこれらの要件を満たしていない場合、アプリがバックグラウンドに移動したときにオーディオ再生は停止します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-168">If your app does not meet these requirements, audio playback will stop when your app moves to the background.</span></span>

<span data-ttu-id="d17d0-169">バックグラウンド オーディオ用に新しい 1 プロセスのモデルを使うアプリは、[**GetForCurrentView**](https://msdn.microsoft.com/library/windows/apps/dn278708) を呼び出して [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) のインスタンスを取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d17d0-169">Apps that use the new one-process model for background audio should get an instance of the [**SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn278677) by calling [**GetForCurrentView**](https://msdn.microsoft.com/library/windows/apps/dn278708).</span></span> <span data-ttu-id="d17d0-170">バックグラウンド オーディオ用に従来の 2 プロセスのモデルを使うアプリは、[**BackgroundMediaPlayer.Current.SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn926635) を使ってバックグラウンド プロセスから SMTC にアクセスする必要があります</span><span class="sxs-lookup"><span data-stu-id="d17d0-170">Apps that use the legacy two-process model for background audio must use [**BackgroundMediaPlayer.Current.SystemMediaTransportControls**](https://msdn.microsoft.com/library/windows/apps/dn926635) to get access to the SMTC from their background process.</span></span>

<span data-ttu-id="d17d0-171">バックグラウンドでのオーディオ再生について詳しくは、「[バックグラウンドでのメディアの再生](background-audio.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="d17d0-171">For more information on playing audio in the background, see [Play media in the background](background-audio.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d17d0-172">関連トピック</span><span class="sxs-lookup"><span data-stu-id="d17d0-172">Related topics</span></span>
* [<span data-ttu-id="d17d0-173">メディア再生</span><span class="sxs-lookup"><span data-stu-id="d17d0-173">Media playback</span></span>](media-playback.md)
* [<span data-ttu-id="d17d0-174">トランスポート コントロールをシステムのメディアと統合します。</span><span class="sxs-lookup"><span data-stu-id="d17d0-174">Integrate with the System Media Transport Controls</span></span>](integrate-with-systemmediatransportcontrols.md) 
* [<span data-ttu-id="d17d0-175">システムのメディア転送サンプル</span><span class="sxs-lookup"><span data-stu-id="d17d0-175">System Media Tranport sample</span></span>](https://github.com/Microsoft/Windows-universal-samples/tree/dev/Samples/SystemMediaTransportControls) 

 




