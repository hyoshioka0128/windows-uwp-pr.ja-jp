---
ms.assetid: 0186EA01-8446-45BA-A109-C5EB4B80F368
description: この記事では、AdvancedPhotoCapture クラスを使って、ハイ ダイナミック レンジ (HDR) とローライトの写真をキャプチャする方法について説明します。
title: ハイ ダイナミック レンジ (HDR) とローライトの写真のキャプチャ
ms.date: 02/08/2017
ms.topic: article
keywords: windows 10, uwp
ms.localizationpriority: medium
ms.openlocfilehash: b5a8e19961fa7cd1dd67e52339f49fd012f21f06
ms.sourcegitcommit: ac7f3422f8d83618f9b6b5615a37f8e5c115b3c4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2019
ms.locfileid: "66361741"
---
# <a name="high-dynamic-range-hdr-and-low-light-photo-capture"></a><span data-ttu-id="53f4d-104">ハイ ダイナミック レンジ (HDR) とローライトの写真のキャプチャ</span><span class="sxs-lookup"><span data-stu-id="53f4d-104">High dynamic range (HDR) and low-light photo capture</span></span>



<span data-ttu-id="53f4d-105">この記事では、[**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) クラスを使って、ハイ ダイナミック レンジ (HDR) の写真をキャプチャする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-105">This article shows you how to use the [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) class to capture high dynamic range (HDR) photos.</span></span> <span data-ttu-id="53f4d-106">最終的な画像の処理が完了する前に、この API を使って、HDR キャプチャから参照フレームを取得することもできます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-106">This API also allows you to obtain a reference frame from the HDR capture before the processing of the final image is complete.</span></span>

<span data-ttu-id="53f4d-107">HDR キャプチャに関連したその他の記事を以下に示します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-107">Other articles related to HDR capture include:</span></span>

-   <span data-ttu-id="53f4d-108">[  **SceneAnalysisEffect**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.SceneAnalysisEffect) でメディア キャプチャのプレビュー ストリームの内容をシステムで評価し、HDR 処理によるキャプチャ結果の向上が期待できるかどうかを判断できます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-108">You can use the [**SceneAnalysisEffect**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.SceneAnalysisEffect) to allow the system to evaluate the content of the media capture preview stream to determine if HDR processing would improve the capture result.</span></span> <span data-ttu-id="53f4d-109">詳しくは、「[メディア キャプチャのシーン分析](scene-analysis-for-media-capture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-109">For more information, see [Scene analysis for MediaCapture](scene-analysis-for-media-capture.md).</span></span>

-   <span data-ttu-id="53f4d-110">[  **HdrVideoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.HdrVideoControl) で、Windows に組み込まれている HDR 処理アルゴリズムを使ってビデオをキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-110">Use the [**HdrVideoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.HdrVideoControl) to capture video using the Windows built-in HDR processing algorithm.</span></span> <span data-ttu-id="53f4d-111">詳しくは、「[ビデオ キャプチャのためのキャプチャ デバイス コントロール](capture-device-controls-for-video-capture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-111">For more information, see [Capture device controls for video capture](capture-device-controls-for-video-capture.md).</span></span>

-   <span data-ttu-id="53f4d-112">[  **VariablePhotoSequenceCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.Core.VariablePhotoSequenceCapture) を使うと、キャプチャ設定がそれぞれ異なる一連の写真をキャプチャすることができます。HDR またはその他の処理アルゴリズムを独自に実装することが可能です。</span><span class="sxs-lookup"><span data-stu-id="53f4d-112">You can use the [**VariablePhotoSequenceCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.Core.VariablePhotoSequenceCapture) to capture a sequence of photos, each with different capture settings, and implement your own HDR or other processing algorithm.</span></span> <span data-ttu-id="53f4d-113">詳しくは、「[可変の写真シーケンス](variable-photo-sequence.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-113">For more information, see [Variable photo sequence](variable-photo-sequence.md).</span></span>



> [!NOTE] 
> <span data-ttu-id="53f4d-114">Windows 10、バージョン 1709 以降では、ビデオ録画と **AdvancedPhotoCapture** の使用の同時実行がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-114">Starting with Windows 10, version 1709, recording video and using **AdvancedPhotoCapture** concurrently is supported.</span></span>  <span data-ttu-id="53f4d-115">これは、それより前のバージョンではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="53f4d-115">This is not supported in previous versions.</span></span> <span data-ttu-id="53f4d-116">この変更により、 **[LowLagMediaRecording](https://docs.microsoft.com/uwp/api/windows.media.capture.lowlagmediarecording)** と **[AdvancedPhotoCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture)** の準備を同時に実行できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="53f4d-116">This change means that you can have a prepared **[LowLagMediaRecording](https://docs.microsoft.com/uwp/api/windows.media.capture.lowlagmediarecording)** and **[AdvancedPhotoCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture)** at the same time.</span></span> <span data-ttu-id="53f4d-117"> **[MediaCapture.PrepareAdvancedPhotoCaptureAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync)** と **[AdvancedPhotoCapture.FinishAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.FinishAsync)** の呼び出しの間に、ビデオ録画を開始または停止できます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-117">You can start or stop video recording between calls to **[MediaCapture.PrepareAdvancedPhotoCaptureAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync)** and **[AdvancedPhotoCapture.FinishAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.FinishAsync)**.</span></span> <span data-ttu-id="53f4d-118">またビデオの録画中に、 **[AdvancedPhotoCapture.CaptureAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.CaptureAsync)** を呼び出すこともできます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-118">You can also call **[AdvancedPhotoCapture.CaptureAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.CaptureAsync)** while video is recording.</span></span> <span data-ttu-id="53f4d-119">ただし、ビデオの録画中の HDR 写真のキャプチャなど、一部の **AdvancedPhotoCapture** のシナリオでは、HDR キャプチャによって一部のビデオ フレームが変更され、好ましくないユーザー エクスペリエンスが生じることがあります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-119">However, some **AdvancedPhotoCapture** scenarios, like capturing an HDR photo while recording video would cause some video frames to be altered by the HDR capture, resulting in a negative user experience.</span></span> <span data-ttu-id="53f4d-120">このため、ビデオの録画中は、 **[AdvancedPhotoControl.SupportedModes](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.SupportedModes)** によって返されるモードが通常とは異なります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-120">For this reason, the list of modes returned by the **[AdvancedPhotoControl.SupportedModes](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.SupportedModes)** will be different while video is recording.</span></span> <span data-ttu-id="53f4d-121">ビデオ録画を開始または停止した場合は、直後にこの値をチェックして、目的のモードが現在のビデオ録画状態でサポートされていることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-121">You should check this value immediately after starting or stopping video recording to ensure that the desired mode is supported in the current video recording state.</span></span>


> [!NOTE] 
> <span data-ttu-id="53f4d-122">Windows 10、バージョン 1709 以降では、**AdvancedPhotoCapture** を HDR モードに設定すると、[**FlashControl.Enabled**](https://docs.microsoft.com/uwp/api/windows.media.devices.flashcontrol.enabled) プロパティの設定が無視されるため、フラッシュが作動しません。</span><span class="sxs-lookup"><span data-stu-id="53f4d-122">Starting with Windows 10, version 1709, when the **AdvancedPhotoCapture** is set to HDR mode, the setting of the [**FlashControl.Enabled**](https://docs.microsoft.com/uwp/api/windows.media.devices.flashcontrol.enabled) property is ignored and the flash is never fired.</span></span> <span data-ttu-id="53f4d-123">また他のキャプチャ モードでは、**FlashControl.Enabled** の場合、**AdvancedPhotoCapture** 設定が上書きされ、通常の写真がフラッシュを使ってキャプチャされます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-123">For other capture modes, if the **FlashControl.Enabled**, it will override the **AdvancedPhotoCapture** settings and cause a normal photo to be captured with flash.</span></span> <span data-ttu-id="53f4d-124">[  **Auto**](https://docs.microsoft.com/uwp/api/windows.media.devices.flashcontrol.auto) が true に設定されている場合、**AdvancedPhotoCapture** がフラッシュを使用できるかどうかは、現在のシーン条件に対してカメラのドライバーに設定された既定の動作に依存します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-124">If [**Auto**](https://docs.microsoft.com/uwp/api/windows.media.devices.flashcontrol.auto) is set to true, the **AdvancedPhotoCapture** may or may not use flash, depending on the camera driver's default behavior for the conditions in the current scene.</span></span> <span data-ttu-id="53f4d-125">以前のリリースでは、**AdvancedPhotoCapture** のフラッシュ設定が、常に **FlashControl.Enabled** の設定を上書きします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-125">On previous releases, the **AdvancedPhotoCapture** flash setting always overrides the **FlashControl.Enabled** setting.</span></span>

> [!NOTE] 
> <span data-ttu-id="53f4d-126">この記事の内容は、写真やビデオの基本的なキャプチャ機能を実装するための手順を紹介した「[MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ](basic-photo-video-and-audio-capture-with-MediaCapture.md)」で取り上げた概念やコードに基づいています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-126">This article builds on concepts and code discussed in [Basic photo, video, and audio capture with MediaCapture](basic-photo-video-and-audio-capture-with-MediaCapture.md), which describes the steps for implementing basic photo and video capture.</span></span> <span data-ttu-id="53f4d-127">そちらの記事で基本的なメディア キャプチャのパターンを把握してから、高度なキャプチャ シナリオに進むことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-127">We recommend that you familiarize yourself with the basic media capture pattern in that article before moving on to more advanced capture scenarios.</span></span> <span data-ttu-id="53f4d-128">この記事で紹介しているコードは、MediaCapture のインスタンスが既に作成され、適切に初期化されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-128">The code in this article assumes that your app already has an instance of MediaCapture that has been properly initialized.</span></span>

<span data-ttu-id="53f4d-129">**AdvancedPhotoCapture** クラスの使い方を示す、ユニバーサル Windows のサンプルがあります。コンテキスト内で API を使用する方法を確認したり、独自のアプリを作成し始めたりすることができます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-129">There is a Universal Windows Sample demonstrating the use of the **AdvancedPhotoCapture** class that you can use to see the API used in context or as a starting point for your own app.</span></span> <span data-ttu-id="53f4d-130">詳しくは、「[カメラの高度なキャプチャのサンプル](https://go.microsoft.com/fwlink/?LinkID=620517)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-130">For more information see, [Camera Advanced Capture sample](https://go.microsoft.com/fwlink/?LinkID=620517).</span></span>

## <a name="advanced-photo-capture-namespaces"></a><span data-ttu-id="53f4d-131">高度な写真キャプチャの名前空間</span><span class="sxs-lookup"><span data-stu-id="53f4d-131">Advanced photo capture namespaces</span></span>

<span data-ttu-id="53f4d-132">この記事のコード例では、基本的なメディア キャプチャに必要な名前空間に加え、次の名前空間の API を使用します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-132">The code examples in this article use APIs in the following namespaces in addition to the namespaces required for basic media capture.</span></span>

[!code-cs[HDRPhotoUsing](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetHDRPhotoUsing)]

## <a name="hdr-photo-capture"></a><span data-ttu-id="53f4d-133">HDR 写真キャプチャ</span><span class="sxs-lookup"><span data-stu-id="53f4d-133">HDR photo capture</span></span>

### <a name="determine-if-hdr-photo-capture-is-supported-on-the-current-device"></a><span data-ttu-id="53f4d-134">HDR 写真キャプチャが現在のデバイスでサポートされているかどうかを調べる</span><span class="sxs-lookup"><span data-stu-id="53f4d-134">Determine if HDR photo capture is supported on the current device</span></span>

<span data-ttu-id="53f4d-135">この記事で説明されている HDR キャプチャ手法には、[**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) オブジェクトが使われています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-135">The HDR capture technique described in this article is performed using the [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) object.</span></span> <span data-ttu-id="53f4d-136">デバイスによっては、**AdvancedPhotoCapture** での HDR キャプチャがサポートされません。</span><span class="sxs-lookup"><span data-stu-id="53f4d-136">Not all devices support HDR capture with **AdvancedPhotoCapture**.</span></span> <span data-ttu-id="53f4d-137">現在アプリを実行しているデバイスが、この手法をサポートしているかどうかを調べるには、**MediaCapture** オブジェクトの [**VideoDeviceController**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.VideoDeviceController) を取得し、その [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) プロパティを取得します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-137">Determine if the device on which your app is currently running supports the technique by getting the **MediaCapture** object's [**VideoDeviceController**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.VideoDeviceController) and then getting the [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) property.</span></span> <span data-ttu-id="53f4d-138">ビデオ デバイス コントローラーの [**SupportedModes**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.supportedmodes) コレクションに [**AdvancedPhotoMode.Hdr**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode) が含まれているかどうかを確認してください。コレクションに含まれている場合、**AdvancedPhotoCapture** を使った HDR キャプチャがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-138">Check the video device controller's [**SupportedModes**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.supportedmodes) collection to see if it includes [**AdvancedPhotoMode.Hdr**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode). If it does, HDR capture using **AdvancedPhotoCapture** is supported.</span></span>

[!code-cs[HdrSupported](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetHdrSupported)]

### <a name="configure-and-prepare-the-advancedphotocapture-object"></a><span data-ttu-id="53f4d-139">AdvancedPhotoCapture オブジェクトを構成して準備する</span><span class="sxs-lookup"><span data-stu-id="53f4d-139">Configure and prepare the AdvancedPhotoCapture object</span></span>

<span data-ttu-id="53f4d-140">[  **AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) インスタンスにはコード内の複数の場所からアクセスする必要があるため、そのオブジェクトを保持するメンバー変数を宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-140">Because you will need to access the [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) instance from multiple places within your code, you should declare a member variable to hold the object.</span></span>

[!code-cs[DeclareAdvancedCapture](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDeclareAdvancedCapture)]

<span data-ttu-id="53f4d-141">アプリのコードで、**MediaCapture** オブジェクトを初期化した後、[**AdvancedPhotoCaptureSettings**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoCaptureSettings) オブジェクトを作成し、そのモードを [**AdvancedPhotoMode.Hdr**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode) に設定します。作成した **AdvancedPhotoCaptureSettings** オブジェクトを [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) オブジェクトの [**Configure**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.configure) メソッドに渡して呼び出します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-141">In your app, after you have initialized the **MediaCapture** object, create an [**AdvancedPhotoCaptureSettings**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoCaptureSettings) object and set the mode to [**AdvancedPhotoMode.Hdr**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode). Call the [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) object's [**Configure**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.configure) method, passing in the **AdvancedPhotoCaptureSettings** object you created.</span></span>

<span data-ttu-id="53f4d-142">**MediaCapture** オブジェクトの [**PrepareAdvancedPhotoCaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync) を呼び出す際に [**ImageEncodingProperties**](https://docs.microsoft.com/uwp/api/Windows.Media.MediaProperties.ImageEncodingProperties) オブジェクトを渡し、キャプチャで使うエンコードの種類を指定します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-142">Call the **MediaCapture** object's [**PrepareAdvancedPhotoCaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync), passing in an [**ImageEncodingProperties**](https://docs.microsoft.com/uwp/api/Windows.Media.MediaProperties.ImageEncodingProperties) object specifying the type of encoding the capture should use.</span></span> <span data-ttu-id="53f4d-143">**ImageEncodingProperties** には、**MediaCapture** でサポートされる画像エンコードを作成するための静的メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-143">The **ImageEncodingProperties** class provides static methods for creating the image encodings that are supported by **MediaCapture**.</span></span>

<span data-ttu-id="53f4d-144">**PrepareAdvancedPhotoCaptureAsync** からは [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) オブジェクトが返されます。写真キャプチャの初期化にはこのオブジェクトを使うことになります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-144">**PrepareAdvancedPhotoCaptureAsync** returns the [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) object you will use to initiate photo capture.</span></span> <span data-ttu-id="53f4d-145">後ほど説明する [**OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) と [**AllPhotosCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.allphotoscaptured) のハンドラーは、このオブジェクトを使って登録することができます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-145">You can use this object to register handlers for the [**OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) and [**AllPhotosCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.allphotoscaptured) which are discussed later in this article.</span></span>

[!code-cs[CreateAdvancedCaptureAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCreateAdvancedCaptureAsync)]

### <a name="capture-an-hdr-photo"></a><span data-ttu-id="53f4d-146">HDR 写真をキャプチャする</span><span class="sxs-lookup"><span data-stu-id="53f4d-146">Capture an HDR photo</span></span>

<span data-ttu-id="53f4d-147">HDR 写真をキャプチャするには、[**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) オブジェクトの [**CaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync) メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-147">Capture an HDR photo by calling the [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) object's [**CaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync) method.</span></span> <span data-ttu-id="53f4d-148">このメソッドから返される [**AdvancedCapturedPhoto**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedCapturedPhoto) オブジェクトの [**Frame**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedcapturedphoto.frame) プロパティに、キャプチャされた写真が格納されています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-148">This method returns an [**AdvancedCapturedPhoto**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedCapturedPhoto) object that provides the captured photo in its [**Frame**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedcapturedphoto.frame) property.</span></span>

[!code-cs[CaptureHdrPhotoAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCaptureHdrPhotoAsync)]

<span data-ttu-id="53f4d-149">ほとんどの写真アプリは、他のアプリやデバイスで正しく表示できるように、キャプチャされた写真の回転情報を画像ファイルにエンコードします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-149">Most photography apps will want to encode a captured photo's rotation into the image file so that it can be displayed correctly by other apps and devices.</span></span> <span data-ttu-id="53f4d-150">次の例は、**CameraRotationHelper** ヘルパー クラスを使用して、ファイルの正しい向きを計算する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-150">This example shows the use of the helper class **CameraRotationHelper** to calculate the proper orientation for the file.</span></span> <span data-ttu-id="53f4d-151">このクラスの全容については、「[**MediaCapture を使ってデバイスの向きを処理する**](handle-device-orientation-with-mediacapture.md)」で説明しています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-151">This class is described and listed in full in the article [**Handle device orientation with MediaCapture**](handle-device-orientation-with-mediacapture.md).</span></span>

<span data-ttu-id="53f4d-152">画像をディスクに保存する **SaveCapturedFrameAsync** ヘルパー メソッドについては、この記事で後述しています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-152">The **SaveCapturedFrameAsync** helper method, which saves the image to disk, is discussed later in this article.</span></span>

### <a name="get-optional-reference-frame"></a><span data-ttu-id="53f4d-153">必要に応じて参照フレームを取得する</span><span class="sxs-lookup"><span data-stu-id="53f4d-153">Get optional reference frame</span></span>

<span data-ttu-id="53f4d-154">HDR プロセスは複数のフレームをキャプチャします。そのすべてのフレームがキャプチャされると、それらが単一の画像として合成されます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-154">The HDR process captures multiple frames and then composites them into a single image after all of the frames have been captured.</span></span> <span data-ttu-id="53f4d-155">フレームがキャプチャされた後、HDR プロセス全体が完了する前に、[**OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) イベントを処理することでそのフレームにアクセスすることができます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-155">You can get access to a frame after it is captured but before the entire HDR process is complete by handling the [**OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) event.</span></span> <span data-ttu-id="53f4d-156">HDR 写真の最終的な結果だけが目的であれば、この処理は不要です。</span><span class="sxs-lookup"><span data-stu-id="53f4d-156">You don't need to do this if you are only interested in the final HDR photo result.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="53f4d-157">[**OptionalReferencePhotoCaptured** ](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) HDR ハードウェアをサポートし、参照フレームを生成しないデバイスでは発生しません。</span><span class="sxs-lookup"><span data-stu-id="53f4d-157">[**OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) is not raised on devices that support hardware HDR and therefore do not generate reference frames.</span></span> <span data-ttu-id="53f4d-158">アプリ側で、このイベントが生成されないケースに対処する必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-158">Your app should handle the case where this event is not raised.</span></span>

<span data-ttu-id="53f4d-159">参照フレームは **CaptureAsync** 呼び出しのコンテキストから離れて届くため、**OptionalReferencePhotoCaptured** ハンドラーにコンテキスト情報を渡すためのしくみが用意されています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-159">Because the reference frame arrives out of context of the call to **CaptureAsync**, a mechanism is provided to pass context information to the **OptionalReferencePhotoCaptured** handler.</span></span> <span data-ttu-id="53f4d-160">まず、コンテキスト情報を保持するオブジェクトを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-160">First you should call an object that will contain your context information.</span></span> <span data-ttu-id="53f4d-161">このオブジェクトの名前と内容は自由に設定してください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-161">The name and contents of this object is up to you.</span></span> <span data-ttu-id="53f4d-162">この例のオブジェクトには、キャプチャのファイル名とカメラの向きを追跡するためのメンバーが定義されています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-162">This example defines an object that has members to track the file name and camera orientation of the capture.</span></span>

[!code-cs[AdvancedCaptureContext](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetAdvancedCaptureContext)]

<span data-ttu-id="53f4d-163">コンテキスト オブジェクトの新しいインスタンスを作成して、そのメンバーにデータを設定した後、パラメーターとしてオブジェクトを受け取る [**CaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync) のオーバーロードにそのオブジェクトを渡します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-163">Create a new instance of your context object, populate its members, and then pass it into the overload of [**CaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync) that accepts an object as a parameter.</span></span>

[!code-cs[CaptureWithContext](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCaptureWithContext)]

<span data-ttu-id="53f4d-164">[  **OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) イベント ハンドラーで、[**OptionalReferencePhotoCapturedEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.OptionalReferencePhotoCapturedEventArgs) オブジェクトの [**Context**](https://docs.microsoft.com/uwp/api/windows.media.capture.optionalreferencephotocapturedeventargs.context) プロパティを、先ほど定義したコンテキスト オブジェクト クラスにキャストします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-164">In the [**OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) event handler, cast the [**Context**](https://docs.microsoft.com/uwp/api/windows.media.capture.optionalreferencephotocapturedeventargs.context) property of the [**OptionalReferencePhotoCapturedEventArgs**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.OptionalReferencePhotoCapturedEventArgs) object to your context object class.</span></span> <span data-ttu-id="53f4d-165">この例では、最終的な HDR 画像と区別するために参照フレーム画像のファイル名を変更した上で **SaveCapturedFrameAsync** ヘルパー メソッドを呼び出し、画像を保存しています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-165">This example modifies the file name to distinguish the reference frame image from the final HDR image and then calls the **SaveCapturedFrameAsync** helper method to save the image.</span></span>

[!code-cs[OptionalReferencePhotoCaptured](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetOptionalReferencePhotoCaptured)]

### <a name="receive-a-notification-when-all-frames-have-been-captured"></a><span data-ttu-id="53f4d-166">すべてのフレームがキャプチャされたときに通知を受け取る</span><span class="sxs-lookup"><span data-stu-id="53f4d-166">Receive a notification when all frames have been captured</span></span>

<span data-ttu-id="53f4d-167">HDR 写真のキャプチャには、2 つのステップがあります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-167">The HDR photo capture has two steps.</span></span> <span data-ttu-id="53f4d-168">複数のフレームをキャプチャするステップと、その後、それらのフレームが最終的な HDR 画像に加工するステップです。</span><span class="sxs-lookup"><span data-stu-id="53f4d-168">First, multiple frames are captured, and then the frames are processed into the final HDR image.</span></span> <span data-ttu-id="53f4d-169">ソース HDR フレームのキャプチャ中に別のキャプチャを開始することはできませんが、すべてのフレームがキャプチャされた後であれば、HDR の後処理が完了していなくても、キャプチャを開始することができます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-169">You can't initiate another capture while the source HDR frames are still being captured, but you can initiate a capture after all of the frames have been captured but before the HDR post-processing is complete.</span></span> <span data-ttu-id="53f4d-170">HDR キャプチャが完了すると [**AllPhotosCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.allphotoscaptured) イベントが発生するので、そのタイミングで別のキャプチャを開始することができます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-170">The [**AllPhotosCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.allphotoscaptured) event is raised when the HDR captures are complete, letting you know that you can initiate another capture.</span></span> <span data-ttu-id="53f4d-171">たとえば HDR キャプチャの開始時に UI のキャプチャ ボタンを無効にし、その後 **AllPhotosCaptured** が発生した時点で再度ボタンを有効にする、という使い方が考えられます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-171">A typical scenario is to disable your UI's capture button when HDR capture begins and then reenable it when **AllPhotosCaptured** is raised.</span></span>

[!code-cs[AllPhotosCaptured](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetAllPhotosCaptured)]

### <a name="clean-up-the-advancedphotocapture-object"></a><span data-ttu-id="53f4d-172">AdvancedPhotoCapture オブジェクトのクリーンアップ</span><span class="sxs-lookup"><span data-stu-id="53f4d-172">Clean up the AdvancedPhotoCapture object</span></span>

<span data-ttu-id="53f4d-173">キャプチャが終了したら、**MediaCapture** オブジェクトを破棄する前に、[**FinishAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.finishasync) を呼び出し、メンバー変数を null に設定して [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) オブジェクトをシャットダウンする必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-173">When your app is done capturing, before disposing of the **MediaCapture** object, you should shut down the [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) object by calling [**FinishAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.finishasync) and setting your member variable to null.</span></span>

[!code-cs[CleanUpAdvancedPhotoCapture](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCleanUpAdvancedPhotoCapture)]


## <a name="low-light-photo-capture"></a><span data-ttu-id="53f4d-174">ローライトの写真のキャプチャ</span><span class="sxs-lookup"><span data-stu-id="53f4d-174">Low-light photo capture</span></span>
<span data-ttu-id="53f4d-175">Windows 10 バージョン 1607 以降では、**AdvancedPhotoCapture** により、ローライトの設定でキャプチャされた写真の品質を高める組み込みアルゴリズムを使って、写真をキャプチャすることが可能です。</span><span class="sxs-lookup"><span data-stu-id="53f4d-175">Starting with Windows 10, version 1607, **AdvancedPhotoCapture** can be used to capture photos using a built-in algorithm that enhances the quality of photos captured in low-light settings.</span></span> <span data-ttu-id="53f4d-176">[  **AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) クラスの低光量機能を使うと、システムは現在のシーンを評価し、必要に応じて、低光量の状況に合わせてアルゴリズムを適用します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-176">When you use the low-light feature of the [**AdvancedPhotoCapture**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedPhotoCapture) class, the system will evaluate the current scene and, if needed, apply an algorithm to compensate for low-light conditions.</span></span> <span data-ttu-id="53f4d-177">システムでアルゴリズムが必要ないと判断された場合は、通常のキャプチャが実行されます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-177">If the system determines that the algorithm is not needed, a regular capture is performed instead.</span></span>

<span data-ttu-id="53f4d-178">低光量写真のキャプチャを使用する前に、現在アプリを実行しているデバイスがこの手法をサポートしているかどうかを調べます。このためには、**MediaCapture** オブジェクトの [**VideoDeviceController**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.VideoDeviceController) を取得し、その [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) プロパティを取得します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-178">Before using low-light photo capture, determine if the device on which your app is currently running supports the technique by getting the **MediaCapture** object's [**VideoDeviceController**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.VideoDeviceController) and then getting the [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) property.</span></span> <span data-ttu-id="53f4d-179">ビデオ デバイス コントローラーの [**SupportedModes**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.supportedmodes) コレクションに [**AdvancedPhotoMode.LowLight**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode) が含まれているかどうかを確認してください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-179">Check the video device controller's [**SupportedModes**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.supportedmodes) collection to see if it includes [**AdvancedPhotoMode.LowLight**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode).</span></span> <span data-ttu-id="53f4d-180">コレクションに含まれている場合、**AdvancedPhotoCapture** を使ったローライトのキャプチャがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-180">If it does, low-light capture using **AdvancedPhotoCapture** is supported.</span></span> 
[!code-cs[LowLightSupported1](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetLowLightSupported1)]

[!code-cs[LowLightSupported2](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetLowLightSupported2)]

<span data-ttu-id="53f4d-181">次に、**AdvancedPhotoCapture** オブジェクトを格納するためのメンバー変数を宣言します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-181">Next, declare a member variable to store the **AdvancedPhotoCapture** object.</span></span> 

[!code-cs[DeclareAdvancedCapture](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetDeclareAdvancedCapture)]

<span data-ttu-id="53f4d-182">アプリのコードで、**MediaCapture** オブジェクトを初期化した後、[**AdvancedPhotoCaptureSettings**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoCaptureSettings) オブジェクトを作成し、そのモードを [**AdvancedPhotoMode.LowLight**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode) に設定します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-182">In your app, after you have initialized the **MediaCapture** object, create an [**AdvancedPhotoCaptureSettings**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoCaptureSettings) object and set the mode to [**AdvancedPhotoMode.LowLight**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoMode).</span></span> <span data-ttu-id="53f4d-183">作成した **AdvancedPhotoCaptureSettings** オブジェクトを [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) オブジェクトの [**Configure**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.configure) メソッドに渡して呼び出します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-183">Call the [**AdvancedPhotoControl**](https://docs.microsoft.com/uwp/api/Windows.Media.Devices.AdvancedPhotoControl) object's [**Configure**](https://docs.microsoft.com/uwp/api/windows.media.devices.advancedphotocontrol.configure) method, passing in the **AdvancedPhotoCaptureSettings** object you created.</span></span>

<span data-ttu-id="53f4d-184">**MediaCapture** オブジェクトの [**PrepareAdvancedPhotoCaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync) を呼び出す際に [**ImageEncodingProperties**](https://docs.microsoft.com/uwp/api/Windows.Media.MediaProperties.ImageEncodingProperties) オブジェクトを渡し、キャプチャで使うエンコードの種類を指定します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-184">Call the **MediaCapture** object's [**PrepareAdvancedPhotoCaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync), passing in an [**ImageEncodingProperties**](https://docs.microsoft.com/uwp/api/Windows.Media.MediaProperties.ImageEncodingProperties) object specifying the type of encoding the capture should use.</span></span> 

[!code-cs[CreateAdvancedCaptureLowLightAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCreateAdvancedCaptureLowLightAsync)]

<span data-ttu-id="53f4d-185">写真をキャプチャするには、[**CaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-185">To capture a photo, call [**CaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync).</span></span>

[!code-cs[CaptureLowLight](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCaptureLowLight)]

<span data-ttu-id="53f4d-186">前述の HDR の例のように、この例は **CameraRotationHelper** というヘルパー クラスを使って、画像にエンコードする必要がある回転値を特定し、他のアプリやデバイスで正しく表示できるようにします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-186">Like the HDR example above, this example uses a helper class called **CameraRotationHelper** to determine the rotation value that should be encoded into the image so that it can be displayed properly by other apps and devices.</span></span> <span data-ttu-id="53f4d-187">このクラスの全容については、「[**MediaCapture を使ってデバイスの向きを処理する**](handle-device-orientation-with-mediacapture.md)」で説明しています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-187">This class is described and listed in full in the article [**Handle device orientation with MediaCapture**](handle-device-orientation-with-mediacapture.md).</span></span>

<span data-ttu-id="53f4d-188">画像をディスクに保存する **SaveCapturedFrameAsync** ヘルパー メソッドについては、この記事で後述しています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-188">The **SaveCapturedFrameAsync** helper method, which saves the image to disk, is discussed later in this article.</span></span>

<span data-ttu-id="53f4d-189">**AdvancedPhotoCapture** オブジェクトを再構成しなくても低光量の写真を複数キャプチャすることができますが、キャプチャが終わったら [**FinishAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.finishasync) を呼び出し、オブジェクトと、関連付けられているリソースをクリーンアップする必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-189">You can capture multiple low-light photos without reconfiguring the **AdvancedPhotoCapture** object, but when you are done capturing, you should call [**FinishAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.finishasync) to clean up the object and associated resources.</span></span>

[!code-cs[CleanUpAdvancedPhotoCapture](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCleanUpAdvancedPhotoCapture)]

## <a name="working-with-advancedcapturedphoto-objects"></a><span data-ttu-id="53f4d-190">AdvancedCapturedPhoto オブジェクトを操作する</span><span class="sxs-lookup"><span data-stu-id="53f4d-190">Working with AdvancedCapturedPhoto objects</span></span>
<span data-ttu-id="53f4d-191">[**AdvancedPhotoCapture.CaptureAsync** ](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync)を返します、 [ **AdvancedCapturedPhoto** ](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedCapturedPhoto)キャプチャした写真を表すオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="53f4d-191">[**AdvancedPhotoCapture.CaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.captureasync) returns an [**AdvancedCapturedPhoto**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.AdvancedCapturedPhoto) object representing the captured photo.</span></span> <span data-ttu-id="53f4d-192">このオブジェクトが公開するのは、画像を表す [**CapturedFrame**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.CapturedFrame) オブジェクトを返す、[**Frame**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedcapturedphoto.frame) プロパティです。</span><span class="sxs-lookup"><span data-stu-id="53f4d-192">This object exposes the [**Frame**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedcapturedphoto.frame) property which returns a [**CapturedFrame**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.CapturedFrame) object representing the image.</span></span> <span data-ttu-id="53f4d-193">[  **OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) イベントも、イベント引数で **CapturedFrame** オブジェクトを提供します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-193">The [**OptionalReferencePhotoCaptured**](https://docs.microsoft.com/uwp/api/windows.media.capture.advancedphotocapture.optionalreferencephotocaptured) event also provides a **CapturedFrame** object in its event args.</span></span> <span data-ttu-id="53f4d-194">この型のオブジェクトを取得した後は、[**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) の作成や、ファイルへの画像の保存など、多くのことを実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-194">After you get an object of this type, there are a number of things you can do with it, including creating a [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.SoftwareBitmap) or saving the image to a file.</span></span> 

## <a name="get-a-softwarebitmap-from-a-capturedframe"></a><span data-ttu-id="53f4d-195">CapturedFrame から SoftwareBitmap を取得する</span><span class="sxs-lookup"><span data-stu-id="53f4d-195">Get a SoftwareBitmap from a CapturedFrame</span></span>
<span data-ttu-id="53f4d-196">**SoftwareBitmap** を **CapturedFrame** オブジェクトから取得するのは、オブジェクトの [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.softwarebitmap) プロパティにアクセスするだけなので、簡単です。</span><span class="sxs-lookup"><span data-stu-id="53f4d-196">It's trivial to get a **SoftwareBitmap** from a **CapturedFrame** object by simply accessing the [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.media.capture.capturedframe.softwarebitmap) property of the object.</span></span> <span data-ttu-id="53f4d-197">ただし、**AdvancedPhotoCapture** での **SoftwareBitmap** の使用は、ほとんどのエンコード形式においてサポートされていないため、使用する前にプロパティが null になっていないことを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-197">However, most encoding formats do not support **SoftwareBitmap** with **AdvancedPhotoCapture**, so you should check and make sure the property is not null before using it.</span></span>

[!code-cs[SoftwareBitmapFromCapturedFrame](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSoftwareBitmapFromCapturedFrame)]

<span data-ttu-id="53f4d-198">現在のリリースで、**AdvancedPhotoCapture** での **SoftwareBitmap** の使用をサポートしている唯一のエンコード形式は、非圧縮形式の NV12 です。</span><span class="sxs-lookup"><span data-stu-id="53f4d-198">In the current release, the only encoding format that supports **SoftwareBitmap** for **AdvancedPhotoCapture** is uncompressed NV12.</span></span> <span data-ttu-id="53f4d-199">したがってこの機能を使用する場合は、[**PrepareAdvancedPhotoCaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync) を呼び出す際にそのエンコーディングを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-199">So, if you want to use this feature, you must specify that encoding when you call [**PrepareAdvancedPhotoCaptureAsync**](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture.prepareadvancedphotocaptureasync).</span></span> 

[!code-cs[UncompressedNv12](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetUncompressedNv12)]

<span data-ttu-id="53f4d-200">もちろん、ファイルに画像を保存し、別個の手順で **SoftwareBitmap** にファイルを読み込むことも常に可能です。</span><span class="sxs-lookup"><span data-stu-id="53f4d-200">Of course, you can always save the image to a file and then load the file into a **SoftwareBitmap** in a separate step.</span></span> <span data-ttu-id="53f4d-201">**SoftwareBitmap** の操作について詳しくは、「[**ビットマップ画像の作成、編集、保存**](imaging.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-201">For more information about working with **SoftwareBitmap**, see [**Create, edit, and save bitmap images**](imaging.md).</span></span>

## <a name="save-a-capturedframe-to-a-file"></a><span data-ttu-id="53f4d-202">CapturedFrame をファイルに保存する</span><span class="sxs-lookup"><span data-stu-id="53f4d-202">Save a CapturedFrame to a file</span></span>
<span data-ttu-id="53f4d-203">[  **CapturedFrame**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.CapturedFrame) クラスは IInputStream インターフェイスを実装するので、[**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder) への入力として使用できます。その後、[**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder) を使えば画像データをディスクに書き込むことができます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-203">The [**CapturedFrame**](https://docs.microsoft.com/uwp/api/Windows.Media.Capture.CapturedFrame) class implements the IInputStream interface, so it can be used as the input to a [**BitmapDecoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapDecoder), and then a [**BitmapEncoder**](https://docs.microsoft.com/uwp/api/Windows.Graphics.Imaging.BitmapEncoder) can be used to write the image data to disk.</span></span>

<span data-ttu-id="53f4d-204">次の例では、ユーザーの画像ライブラリに新しいフォルダーが作成され、そのフォルダー内にファイルが作成されています。</span><span class="sxs-lookup"><span data-stu-id="53f4d-204">In the following example, a new folder in the user's pictures library is created and a file is created within this folder.</span></span> <span data-ttu-id="53f4d-205">このディレクトリにアクセスするためには、アプリが **Pictures Library** 機能をアプリ マニフェスト ファイルに含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="53f4d-205">Note that your app will need to include the **Pictures Library** capability in your app manifest file in order to access this directory.</span></span> <span data-ttu-id="53f4d-206">すると、ファイル ストリームが指定のファイルに開かれます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-206">A file stream is then opened to the specified file.</span></span> <span data-ttu-id="53f4d-207">次に、**CapturedFrame** からデコーダーを作成するために [**BitmapDecoder.CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapdecoder.createasync) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-207">Next, the [**BitmapDecoder.CreateAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapdecoder.createasync) is called to create the decoder from the **CapturedFrame**.</span></span> <span data-ttu-id="53f4d-208">その後 [**CreateForTranscodingAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createfortranscodingasync) がファイル ストリームとデコーダーからエンコーダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="53f4d-208">Then [**CreateForTranscodingAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.createfortranscodingasync) creates an encoder from the file stream and the decoder.</span></span>

<span data-ttu-id="53f4d-209">次に、エンコーダーの [**BitmapProperties**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.bitmapproperties) を使って画像ファイルに写真の向きをエンコードします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-209">The next steps encode the orientation of the photo into the image file by using the [**BitmapProperties**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.bitmapproperties) of the encoder.</span></span> <span data-ttu-id="53f4d-210">画像をキャプチャする際の向きの処理について詳しくは、「[**MediaCapture を使ってデバイスの向きを処理する**](handle-device-orientation-with-mediacapture.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="53f4d-210">For more information about handling orientation when capturing images, see [**Handle device orientation with MediaCapture**](handle-device-orientation-with-mediacapture.md).</span></span>

<span data-ttu-id="53f4d-211">最後に、[**FlushAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.flushasync) を呼び出すことで、画像をファイルに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="53f4d-211">Finally, the image is written to the file with a call to [**FlushAsync**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.bitmapencoder.flushasync).</span></span>

[!code-cs[SaveCapturedFrameAsync](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetSaveCapturedFrameAsync)]

## <a name="related-topics"></a><span data-ttu-id="53f4d-212">関連トピック</span><span class="sxs-lookup"><span data-stu-id="53f4d-212">Related topics</span></span>

* [<span data-ttu-id="53f4d-213">カメラ</span><span class="sxs-lookup"><span data-stu-id="53f4d-213">Camera</span></span>](camera.md)
* [<span data-ttu-id="53f4d-214">MediaCapture で基本的な写真、ビデオ、およびオーディオのキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="53f4d-214">Basic photo, video, and audio capture with MediaCapture</span></span>](basic-photo-video-and-audio-capture-with-MediaCapture.md)
