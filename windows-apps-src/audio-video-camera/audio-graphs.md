---
ms.assetid: CB924E17-C726-48E7-A445-364781F4CCA1
description: この記事では、Windows.Media.Audio 名前空間の API を使ってオーディオのルーティング、ミキシング、処理のシナリオでオーディオ グラフを作成する方法について説明します。
title: オーディオ グラフ
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 0211e451c3e700da34d24e39a5045f9e046020a8
ms.sourcegitcommit: 89ff8ff88ef58f4fe6d3b1368fe94f62e59118ad
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/30/2018
ms.locfileid: "8214220"
---
# <a name="audio-graphs"></a><span data-ttu-id="5b5c5-104">オーディオ グラフ</span><span class="sxs-lookup"><span data-stu-id="5b5c5-104">Audio graphs</span></span>



<span data-ttu-id="5b5c5-105">この記事では、[**Windows.Media.Audio**](https://msdn.microsoft.com/library/windows/apps/dn914341) 名前空間の API を使ってオーディオのルーティング、ミキシング、処理のシナリオでオーディオ グラフを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-105">This article shows how to use the APIs in the [**Windows.Media.Audio**](https://msdn.microsoft.com/library/windows/apps/dn914341) namespace to create audio graphs for audio routing, mixing, and processing scenarios.</span></span>

<span data-ttu-id="5b5c5-106">*オーディオ グラフ*は、相互接続されたオーディオ ノードのセットです。オーディオ データは、ここを通って流れます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-106">An *audio graph* is a set of interconnected audio nodes through which audio data flows.</span></span> 

- <span data-ttu-id="5b5c5-107">*オーディオ入力ノード*は、オーディオ入力デバイス、オーディオ ファイル、またはカスタム コードから、オーディオ データをグラフに提供します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-107">*Audio input nodes* supply audio data to the graph from audio input devices, audio files, or from custom code.</span></span> 

- <span data-ttu-id="5b5c5-108">*オーディオ出力ノード*は、グラフで処理されたオーディオの目的地です。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-108">*Audio output nodes* are the destination for audio processed by the graph.</span></span> <span data-ttu-id="5b5c5-109">オーディオは、グラフからオーディオ出力デバイス、オーディオ ファイル、またはカスタム コードにルーティングできます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-109">Audio can be routed out of the graph to audio output devices, audio files, or custom code.</span></span> 

- <span data-ttu-id="5b5c5-110">*サブミックス ノード*は、1 つまたは複数のノードからのオーディオを結合して 1 つの出力にします。この出力は、グラフ内の他のノードにルーティングすることができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-110">*Submix nodes* take audio from one or more nodes and combine them into a single output that can be routed to other nodes in the graph.</span></span> 

<span data-ttu-id="5b5c5-111">すべてのノードが作成され、ノード間の接続が設定された後、オーディオ グラフを開始すると、オーディオ データが入力ノードからサブミックス ノードを通って出力ノードまで流れます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-111">After all of the nodes have been created and the connections between them set up, you simply start the audio graph and the audio data flows from the input nodes, through any submix nodes, to the output nodes.</span></span> <span data-ttu-id="5b5c5-112">このモデルでは、デバイスのマイクからオーディオ ファイルへの録音、ファイルからデバイスのスピーカーへのオーディオ再生、複数ソースからのオーディオ ミキシングなどのシナリオが、すばやく簡単に実装できるようになります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-112">This model makes scenarios such as recording from a device's microphone to an audio file, playing audio from a file to a device's speaker, or mixing audio from multiple sources quick and easy to implement.</span></span>

<span data-ttu-id="5b5c5-113">オーディオ エフェクトをオーディオ グラフに追加することで、その他のシナリオも有効になります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-113">Additional scenarios are enabled with the addition of audio effects to the audio graph.</span></span> <span data-ttu-id="5b5c5-114">オーディオ グラフ内の各ノードには、ノードを通過するオーディオに対してオーディオ処理を実行するオーディオ エフェクトを 0 個以上設定できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-114">Every node in an audio graph can be populated with zero or more audio effects that perform audio processing on the audio passing through the node.</span></span> <span data-ttu-id="5b5c5-115">エコー、イコライザー、リミッティング、リバーブなど、いくつかの組み込みエフェクトがあり、これらはわずか数行のコードでオーディオ ノードにアタッチできます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-115">There are several built-in effects such as echo, equalizer, limiting, and reverb that can be attached to an audio node with just a few lines of code.</span></span> <span data-ttu-id="5b5c5-116">組み込みエフェクトとまったく同様に動作するカスタム オーディオ エフェクトを独自に作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-116">You can also create your own custom audio effects that work exactly the same as the built-in effects.</span></span>

> [!NOTE]
> <span data-ttu-id="5b5c5-117">[AudioGraph UWP サンプル](http://go.microsoft.com/fwlink/?LinkId=619481)は、この概要で説明するコードを実装します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-117">The [AudioGraph UWP sample](http://go.microsoft.com/fwlink/?LinkId=619481) implements the code discussed in this overview.</span></span> <span data-ttu-id="5b5c5-118">サンプルをダウンロードすると、コンテキスト内のコードを確認できます。独自のアプリの出発点として使うこともできます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-118">You can download the sample to see the code in context or to use as a starting point for your own app.</span></span>

## <a name="choosing-windows-runtime-audiograph-or-xaudio2"></a><span data-ttu-id="5b5c5-119">Windows ランタイム AudioGraph または XAudio2 の選択</span><span class="sxs-lookup"><span data-stu-id="5b5c5-119">Choosing Windows Runtime AudioGraph or XAudio2</span></span>

<span data-ttu-id="5b5c5-120">Windows ランタイム オーディオ グラフ API で提供される機能は、COM ベースの [XAudio2 API](https://msdn.microsoft.com/library/windows/desktop/hh405049) を使って実装することもできます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-120">The Windows Runtime audio graph APIs offer functionality that can also be implemented by using the COM-based [XAudio2 APIs](https://msdn.microsoft.com/library/windows/desktop/hh405049).</span></span> <span data-ttu-id="5b5c5-121">XAudio2 とは異なる Windows ランタイム オーディオ グラフ フレームワークの特徴を次に示します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-121">The following are features of the Windows Runtime audio graph framework that differ from XAudio2.</span></span>

<span data-ttu-id="5b5c5-122">Windows ランタイム オーディオ グラフ API:</span><span class="sxs-lookup"><span data-stu-id="5b5c5-122">The Windows Runtime audio graph APIs:</span></span>

-   <span data-ttu-id="5b5c5-123">XAudio2 よりもずっと簡単です。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-123">Are significantly easier to use than XAudio2.</span></span>
-   <span data-ttu-id="5b5c5-124">C++ 用にサポートされていますが、C# からも使用できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-124">Can be used from C# in addition to being supported for C++.</span></span>
-   <span data-ttu-id="5b5c5-125">オーディオ ファイル (圧縮ファイル形式など) を使うことができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-125">Can use audio files, including compressed file formats, directly.</span></span> <span data-ttu-id="5b5c5-126">XAudio2 はオーディオ バッファーのみで動作します。ファイル I/O 機能はありません。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-126">XAudio2 only operates on audio buffers and does not provide any file I/O capabilities.</span></span>
-   <span data-ttu-id="5b5c5-127">Windows 10 では、低待機時間オーディオ パイプラインを使用できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-127">Can use the low-latency audio pipeline in Windows10.</span></span>
-   <span data-ttu-id="5b5c5-128">既定のエンドポイント パラメーターの使用時にエンドポイントの自動切り替えをサポートします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-128">Support automatic endpoint switching when default endpoint parameters are used.</span></span> <span data-ttu-id="5b5c5-129">たとえば、ユーザーがデバイスのスピーカーからヘッドホンに切り替えると、オーディオが自動的に新しい入力にリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-129">For example, if the user switches from a device's speaker to a headset, the audio is automatically redirected to the new input.</span></span>

## <a name="audiograph-class"></a><span data-ttu-id="5b5c5-130">AudioGraph クラス</span><span class="sxs-lookup"><span data-stu-id="5b5c5-130">AudioGraph class</span></span>

<span data-ttu-id="5b5c5-131">[**AudioGraph**](https://msdn.microsoft.com/library/windows/apps/dn914176) クラスは、グラフを構成するすべてのノードの親です。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-131">The [**AudioGraph**](https://msdn.microsoft.com/library/windows/apps/dn914176) class is the parent of all nodes that make up the graph.</span></span> <span data-ttu-id="5b5c5-132">すべての種類のオーディオ ノードのインスタンス作成に、このオブジェクトを使います。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-132">Use this object to create instances of all of the audio node types.</span></span> <span data-ttu-id="5b5c5-133">**AudioGraph** クラスのインスタンスを作成するには、[**AudioGraphSettings**](https://msdn.microsoft.com/library/windows/apps/dn914185) オブジェクトを初期化し、グラフの構成設定を含めて、[**AudioGraph.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/dn914216) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-133">Create an instance of the **AudioGraph** class by initializing an [**AudioGraphSettings**](https://msdn.microsoft.com/library/windows/apps/dn914185) object containing configuration settings for the graph, and then calling [**AudioGraph.CreateAsync**](https://msdn.microsoft.com/library/windows/apps/dn914216).</span></span> <span data-ttu-id="5b5c5-134">返された [**CreateAudioGraphResult**](https://msdn.microsoft.com/library/windows/apps/dn914273) により、作成されたオーディオ グラフへのアクセスが可能になります。オーディオ グラフの作成に失敗すると、エラー値が返されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-134">The returned [**CreateAudioGraphResult**](https://msdn.microsoft.com/library/windows/apps/dn914273) gives access to the created audio graph or provides an error value if audio graph creation fails.</span></span>

[!code-cs[DeclareAudioGraph](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareAudioGraph)]

[!code-cs[InitAudioGraph](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetInitAudioGraph)]

-   <span data-ttu-id="5b5c5-135">オーディオ ノードのすべての種類は、**AudioGraph** クラスの Create\* メソッドで作成します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-135">All audio node types are created by using the Create\* methods of the **AudioGraph** class.</span></span>
-   <span data-ttu-id="5b5c5-136">[**AudioGraph.Start**](https://msdn.microsoft.com/library/windows/apps/dn914244) メソッドを呼び出すと、オーディオ グラフによってオーディオ データの処理が開始されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-136">The [**AudioGraph.Start**](https://msdn.microsoft.com/library/windows/apps/dn914244) method causes the audio graph to start processing audio data.</span></span> <span data-ttu-id="5b5c5-137">[**AudioGraph.Stop**](https://msdn.microsoft.com/library/windows/apps/dn914245) メソッドは、オーディオ処理を停止します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-137">The [**AudioGraph.Stop**](https://msdn.microsoft.com/library/windows/apps/dn914245) method stops audio processing.</span></span> <span data-ttu-id="5b5c5-138">グラフの実行中、グラフ内の各ノードは個別に開始および停止できますが、グラフが停止すると、すべてのノードが非アクティブになります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-138">Each node in the graph can be started and stopped independently while the graph is running, but no nodes are active when the graph is stopped.</span></span> <span data-ttu-id="5b5c5-139">[**ResetAllNodes**](https://msdn.microsoft.com/library/windows/apps/dn914242) を呼び出すと、グラフ内のすべてのノードで、現在のオーディオ バッファー内にあるすべてのデータが破棄されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-139">[**ResetAllNodes**](https://msdn.microsoft.com/library/windows/apps/dn914242) causes all nodes in the graph to discard any data currently in their audio buffers.</span></span>
-   <span data-ttu-id="5b5c5-140">グラフで、オーディオ データの新しいクォンタムの処理が開始されると、[**QuantumStarted**](https://msdn.microsoft.com/library/windows/apps/dn914241) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-140">The [**QuantumStarted**](https://msdn.microsoft.com/library/windows/apps/dn914241) event occurs when the graph is starting the processing of a new quantum of audio data.</span></span> <span data-ttu-id="5b5c5-141">クォンタムの処理が完了すると、[**QuantumProcessed**](https://msdn.microsoft.com/library/windows/apps/dn914240) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-141">The [**QuantumProcessed**](https://msdn.microsoft.com/library/windows/apps/dn914240) event occurs when the processing of a quantum is completed.</span></span>

-   <span data-ttu-id="5b5c5-142">[**AudioGraphSettings**](https://msdn.microsoft.com/library/windows/apps/dn914185) プロパティのうち、必須であるのは [**AudioRenderCategory**](https://msdn.microsoft.com/library/windows/apps/dn297724) のみです。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-142">The only [**AudioGraphSettings**](https://msdn.microsoft.com/library/windows/apps/dn914185) property that is required is [**AudioRenderCategory**](https://msdn.microsoft.com/library/windows/apps/dn297724).</span></span> <span data-ttu-id="5b5c5-143">この値を指定することにより、システムは指定されたカテゴリについてオーディオ パイプラインを最適化します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-143">Specifying this value allows the system to optimize the audio pipeline for the specified category.</span></span>
-   <span data-ttu-id="5b5c5-144">オーディオ グラフのクォンタム サイズにより、同時に処理されるサンプルの数が決定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-144">The quantum size of the audio graph determines the number of samples that are processed at one time.</span></span> <span data-ttu-id="5b5c5-145">既定では、既定のサンプル レートのクォンタム サイズは 10 ミリ秒ベースです。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-145">By default, the quantum size is 10 ms based at the default sample rate.</span></span> <span data-ttu-id="5b5c5-146">[**DesiredSamplesPerQuantum**](https://msdn.microsoft.com/library/windows/apps/dn914205) プロパティを設定することでカスタムのクォンタム サイズを指定する場合は、[**QuantumSizeSelectionMode**](https://msdn.microsoft.com/library/windows/apps/dn914208) プロパティを **ClosestToDesired** に設定しないと、指定した値が無視されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-146">If you specify a custom quantum size by setting the [**DesiredSamplesPerQuantum**](https://msdn.microsoft.com/library/windows/apps/dn914205) property, you must also set the [**QuantumSizeSelectionMode**](https://msdn.microsoft.com/library/windows/apps/dn914208) property to **ClosestToDesired** or the supplied value is ignored.</span></span> <span data-ttu-id="5b5c5-147">この値を使うと、指定した値にできる限り近いクォンタム サイズがシステムによって選択されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-147">If this value is used, the system will choose a quantum size as close as possible to the one you specify.</span></span> <span data-ttu-id="5b5c5-148">実際のクォンタム サイズを確認するには、**AudioGraph** の [**SamplesPerQuantum**](https://msdn.microsoft.com/library/windows/apps/dn914243) を作成後にチェックします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-148">To determine the actual quantum size, check the [**SamplesPerQuantum**](https://msdn.microsoft.com/library/windows/apps/dn914243) of the **AudioGraph** after it has been created.</span></span>
-   <span data-ttu-id="5b5c5-149">オーディオ グラフの使用対象がファイルのみであり、オーディオ デバイスに出力する予定がない場合は、[**DesiredSamplesPerQuantum**](https://msdn.microsoft.com/library/windows/apps/dn914205) プロパティを設定せずに、既定のクォンタム サイズを使うことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-149">If you only plan to use the audio graph with files and don't plan to output to an audio device, it is recommended that you use the default quantum size by not setting the [**DesiredSamplesPerQuantum**](https://msdn.microsoft.com/library/windows/apps/dn914205) property.</span></span>
-   <span data-ttu-id="5b5c5-150">[**DesiredRenderDeviceAudioProcessing**](https://msdn.microsoft.com/library/windows/apps/dn958522) プロパティは、オーディオ グラフの出力に対してプライマリ レンダリング デバイスで実行される処理の量を決定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-150">The [**DesiredRenderDeviceAudioProcessing**](https://msdn.microsoft.com/library/windows/apps/dn958522) property determines the amount of processing the primary render device performs on the output of the audio graph.</span></span> <span data-ttu-id="5b5c5-151">**Default** 設定を使うと、指定されたオーディオ レンダリング カテゴリに対してシステムが既定のオーディオ処理を使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-151">The **Default** setting allows the system to use the default audio processing for the specified audio render category.</span></span> <span data-ttu-id="5b5c5-152">この処理により、一部のデバイス (特に、小型スピーカーが搭載されているモバイル デバイス) ではオーディオのサウンドが大幅に改善される場合があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-152">This processing can significantly improve the sound of audio on some devices, particularly mobile devices with small speakers.</span></span> <span data-ttu-id="5b5c5-153">**Raw** 設定を使うと、実行する信号処理の量を最小化してパフォーマンスを向上できることがありますが、一部のデバイスでは音質が低下する場合があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-153">The **Raw** setting can improve performance by minimizing the amount of signal processing performed, but can result in inferior sound quality on some devices.</span></span>
-   <span data-ttu-id="5b5c5-154">[**QuantumSizeSelectionMode**](https://msdn.microsoft.com/library/windows/apps/dn914208) が **LowestLatency** に設定されていると、オーディオ グラフは [**DesiredRenderDeviceAudioProcessing**](https://msdn.microsoft.com/library/windows/apps/dn958522) に対して自動的に **Raw** を使います。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-154">If the [**QuantumSizeSelectionMode**](https://msdn.microsoft.com/library/windows/apps/dn914208) is set to **LowestLatency**, the audio graph will automatically use **Raw** for [**DesiredRenderDeviceAudioProcessing**](https://msdn.microsoft.com/library/windows/apps/dn958522).</span></span>
- <span data-ttu-id="5b5c5-155">Windows 10、バージョン 1803 では、[**AudioGraphSettings.MaxPlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiographsettings.maxplaybackspeedfactor) プロパティを設定することで、[**AudioFileInputNode.PlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiofileinputnode.playbackspeedfactor) プロパティ、[**AudioFrameInputNode.PlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audioframeinputnode.playbackspeedfactor) プロパティ、[**MediaSourceInputNode.PlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.mediasourceinputnode.playbackspeedfactor) プロパティに使用する最大値を設定できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-155">Starting with Windows 10, version 1803, you can set the [**AudioGraphSettings.MaxPlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiographsettings.maxplaybackspeedfactor) property to set a maximum value used for the [**AudioFileInputNode.PlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiofileinputnode.playbackspeedfactor), [**AudioFrameInputNode.PlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.audioframeinputnode.playbackspeedfactor), and [**MediaSourceInputNode.PlaybackSpeedFactor**](https://docs.microsoft.com/uwp/api/windows.media.audio.mediasourceinputnode.playbackspeedfactor) properties.</span></span> <span data-ttu-id="5b5c5-156">オーディオ グラフが、1 より大きい再生速度係数をサポートしている場合、システムは、オーディオ データの十分なバッファーを維持するために、追加のメモリを割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-156">When an audio graph supports a playback speed factor greater than 1, the system must allocate additional memory in order to maintain a sufficient buffer of audio data.</span></span> <span data-ttu-id="5b5c5-157">このため、**MaxPlaybackSpeedFactor** をアプリで必要な最小値に設定すると、アプリによるメモリ消費量が減少します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-157">For this reason, setting **MaxPlaybackSpeedFactor** to the lowest value required by your app will reduce the memory consumption of your app.</span></span> <span data-ttu-id="5b5c5-158">アプリが、通常の速度でのみコンテンツを再生する場合は、MaxPlaybackSpeedFactor を 1 に設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-158">If your app will only play back content at normal speed, it is recommended that you set MaxPlaybackSpeedFactor to 1.</span></span>
-   <span data-ttu-id="5b5c5-159">[**EncodingProperties**](https://msdn.microsoft.com/library/windows/apps/dn958523) は、グラフで使用されるオーディオ形式を決定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-159">The [**EncodingProperties**](https://msdn.microsoft.com/library/windows/apps/dn958523) determines the audio format used by the graph.</span></span> <span data-ttu-id="5b5c5-160">サポートされているのは 32 ビットの浮動小数点形式のみです。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-160">Only 32-bit float formats are supported.</span></span>
-   <span data-ttu-id="5b5c5-161">[**PrimaryRenderDevice**](https://msdn.microsoft.com/library/windows/apps/dn958524) は、オーディオ グラフのプライマリ レンダリング デバイスを設定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-161">The [**PrimaryRenderDevice**](https://msdn.microsoft.com/library/windows/apps/dn958524) sets the primary render device for the audio graph.</span></span> <span data-ttu-id="5b5c5-162">このプロパティを設定しなかった場合は、既定のシステム デバイスが使われます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-162">If you don't set this, the default system device is used.</span></span> <span data-ttu-id="5b5c5-163">プライマリ レンダリング デバイスは、グラフの他のノードのクォンタム サイズの計算に使われます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-163">The primary render device is used to calculate the quantum sizes for other nodes in the graph.</span></span> <span data-ttu-id="5b5c5-164">システムにオーディオ レンダリング デバイスが存在しない場合、オーディオ グラフの作成は失敗します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-164">If there are no audio render devices present on the system, audio graph creation will fail.</span></span>

<span data-ttu-id="5b5c5-165">オーディオ グラフでは、既定のオーディオ レンダリング デバイスを使うことも、[**Windows.Devices.Enumeration.DeviceInformation**](https://msdn.microsoft.com/library/windows/apps/br225393) クラスを使ってシステムで利用可能なオーディオ レンダリング デバイスの一覧を取得することもできます。これには、[**FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/br225432) を呼び出して、[**Windows.Media.Devices.MediaDevice.GetAudioRenderSelector**](https://msdn.microsoft.com/library/windows/apps/br226817) から返されるオーディオ レンダリング デバイス セレクターを渡します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-165">You can let the audio graph use the default audio render device or use the [**Windows.Devices.Enumeration.DeviceInformation**](https://msdn.microsoft.com/library/windows/apps/br225393) class to get a list of the system's available audio render devices by calling [**FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/br225432) and passing in the audio render device selector returned by [**Windows.Media.Devices.MediaDevice.GetAudioRenderSelector**](https://msdn.microsoft.com/library/windows/apps/br226817).</span></span> <span data-ttu-id="5b5c5-166">返された **DeviceInformation** オブジェクトのうちいずれかをプログラムで選択するか、ユーザーがデバイスを選択できるように UI を表示して、選択されたデバイスを [**PrimaryRenderDevice**](https://msdn.microsoft.com/library/windows/apps/dn958524) プロパティに設定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-166">You can choose one of the returned **DeviceInformation** objects programatically or show UI to allow the user to select a device and then use it to set the [**PrimaryRenderDevice**](https://msdn.microsoft.com/library/windows/apps/dn958524) property.</span></span>

[!code-cs[EnumerateAudioRenderDevices](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetEnumerateAudioRenderDevices)]

##  <a name="device-input-node"></a><span data-ttu-id="5b5c5-167">デバイス入力ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-167">Device input node</span></span>

<span data-ttu-id="5b5c5-168">デバイス入力ノードは、システムに接続されているオーディオ キャプチャ デバイス (マイクなど) からオーディオを取得し、グラフに渡します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-168">A device input node feeds audio into the graph from an audio capture device connected to the system, such as a microphone.</span></span> <span data-ttu-id="5b5c5-169">システムの既定オーディオ キャプチャ デバイスを使う [**DeviceInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914082) オブジェクトを作成するには、[**CreateDeviceInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914218) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-169">Create a [**DeviceInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914082) object that uses the system's default audio capture device by calling [**CreateDeviceInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914218).</span></span> <span data-ttu-id="5b5c5-170">[**AudioRenderCategory**](https://msdn.microsoft.com/library/windows/apps/dn297724) を指定すると、指定されたカテゴリのオーディオ パイプラインがシステムによって最適化されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-170">Provide an [**AudioRenderCategory**](https://msdn.microsoft.com/library/windows/apps/dn297724) to allow the system to optimize the audio pipeline for the specified category.</span></span>

[!code-cs[DeclareDeviceInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareDeviceInputNode)]


[!code-cs[CreateDeviceInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateDeviceInputNode)]

<span data-ttu-id="5b5c5-171">デバイス入力ノードに特定のオーディオ キャプチャ デバイスを指定する場合は、[**Windows.Devices.Enumeration.DeviceInformation**](https://msdn.microsoft.com/library/windows/apps/br225393) クラスを使ってシステムで利用可能なオーディオ キャプチャ デバイスの一覧を取得することもできます。これには、[**FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/br225432) を呼び出して、[**Windows.Media.Devices.MediaDevice.GetAudioRenderSelector**](https://msdn.microsoft.com/library/windows/apps/br226817) から返されるオーディオ レンダリング デバイス セレクターを渡します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-171">If you want to specify a specific audio capture device for the device input node, you can use the [**Windows.Devices.Enumeration.DeviceInformation**](https://msdn.microsoft.com/library/windows/apps/br225393) class to get a list of the system's available audio capture devices by calling [**FindAllAsync**](https://msdn.microsoft.com/library/windows/apps/br225432) and passing in the audio render device selector returned by [**Windows.Media.Devices.MediaDevice.GetAudioRenderSelector**](https://msdn.microsoft.com/library/windows/apps/br226817).</span></span> <span data-ttu-id="5b5c5-172">返された **DeviceInformation** オブジェクトのうちいずれかをプログラムで選択するか、ユーザーがデバイスを選択できるように UI を表示して、選択されたデバイスを [**CreateDeviceInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914218) に渡します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-172">You can choose one of the returned **DeviceInformation** objects programmatically or show UI to allow the user to select a device and then pass it into [**CreateDeviceInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914218).</span></span>

[!code-cs[EnumerateAudioCaptureDevices](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetEnumerateAudioCaptureDevices)]

##  <a name="device-output-node"></a><span data-ttu-id="5b5c5-173">デバイス出力ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-173">Device output node</span></span>

<span data-ttu-id="5b5c5-174">デバイス出力ノードは、オーディオをグラフからスピーカーやヘッドセットなどのオーディオ レンダリング デバイスにプッシュします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-174">A device output node pushes audio from the graph to an audio render device, such as speakers or a headset.</span></span> <span data-ttu-id="5b5c5-175">[**DeviceOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914098) を作成するには、[**CreateDeviceOutputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn958525) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-175">Create a [**DeviceOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914098) by calling [**CreateDeviceOutputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn958525).</span></span> <span data-ttu-id="5b5c5-176">出力ノードでは、オーディオ グラフの [**PrimaryRenderDevice**](https://msdn.microsoft.com/library/windows/apps/dn958524) が使われます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-176">The output node uses the [**PrimaryRenderDevice**](https://msdn.microsoft.com/library/windows/apps/dn958524) of the audio graph.</span></span>

[!code-cs[DeclareDeviceOutputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareDeviceOutputNode)]

[!code-cs[CreateDeviceOutputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateDeviceOutputNode)]

##  <a name="file-input-node"></a><span data-ttu-id="5b5c5-177">ファイル入力ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-177">File input node</span></span>

<span data-ttu-id="5b5c5-178">ファイル入力ノードを使うと、データをオーディオ ファイルからグラフに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-178">A file input node allows you to feed data from an audio file into the graph.</span></span> <span data-ttu-id="5b5c5-179">[**AudioFileInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914108) を作成するには、[**CreateFileInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914226) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-179">Create an [**AudioFileInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914108) by calling [**CreateFileInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914226).</span></span>

[!code-cs[DeclareFileInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareFileInputNode)]


[!code-cs[CreateFileInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateFileInputNode)]

-   <span data-ttu-id="5b5c5-180">ファイル入力ノードでは、ファイル形式として mp3、wav、wma、m4a がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-180">File input nodes support the following file formats: mp3, wav, wma, m4a.</span></span>
-   <span data-ttu-id="5b5c5-181">ファイル内の再生開始位置にタイム オフセットを指定するには、[**StartTime**](https://msdn.microsoft.com/library/windows/apps/dn914130) プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-181">Set the [**StartTime**](https://msdn.microsoft.com/library/windows/apps/dn914130) property to specify the time offset into the file where playback should begin.</span></span> <span data-ttu-id="5b5c5-182">このプロパティが null の場合は、ファイルの先頭が使用されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-182">If this property is null, the beginning of the file is used.</span></span> <span data-ttu-id="5b5c5-183">ファイル内の再生終了位置にタイム オフセットを指定するには、[**EndTime**](https://msdn.microsoft.com/library/windows/apps/dn914118) プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-183">Set the [**EndTime**](https://msdn.microsoft.com/library/windows/apps/dn914118) property to specify the time offset into the file where playback should end.</span></span> <span data-ttu-id="5b5c5-184">このプロパティが null の場合は、ファイルの末尾が使用されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-184">If this property is null, the end of the file is used.</span></span> <span data-ttu-id="5b5c5-185">開始時刻の値は、終了時刻の値より小さくする必要があります。また、終了時刻の値はオーディオ ファイルの長さを超えないように設定する必要があります。オーディオ ファイルの長さを確認するには、[**Duration**](https://msdn.microsoft.com/library/windows/apps/dn914116) プロパティの値をチェックします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-185">The start time value must be lower than the end time value, and the end time value must be less than or equal to the duration of the audio file, which can be determined by checking the [**Duration**](https://msdn.microsoft.com/library/windows/apps/dn914116) property value.</span></span>
-   <span data-ttu-id="5b5c5-186">オーディオ ファイル内の位置をシークするには、[**Seek**](https://msdn.microsoft.com/library/windows/apps/dn914127) を呼び出し、ファイル内の再生位置の移動先にタイム オフセットを指定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-186">Seek to a position in the audio file by calling [**Seek**](https://msdn.microsoft.com/library/windows/apps/dn914127) and specifying the time offset into the file to which the playback position should be moved.</span></span> <span data-ttu-id="5b5c5-187">指定された値は、[**StartTime**](https://msdn.microsoft.com/library/windows/apps/dn914130) から [**EndTime**](https://msdn.microsoft.com/library/windows/apps/dn914118) の範囲内である必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-187">The specified value must be within the [**StartTime**](https://msdn.microsoft.com/library/windows/apps/dn914130) and [**EndTime**](https://msdn.microsoft.com/library/windows/apps/dn914118) range.</span></span> <span data-ttu-id="5b5c5-188">ノードの現在の再生位置を取得するには、読み取り専用の [**Position**](https://msdn.microsoft.com/library/windows/apps/dn914124) プロパティを使います。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-188">Get the current playback position of the node with the read-only [**Position**](https://msdn.microsoft.com/library/windows/apps/dn914124) property.</span></span>
-   <span data-ttu-id="5b5c5-189">オーディオ ファイルのループ処理を有効にするには、[**LoopCount**](https://msdn.microsoft.com/library/windows/apps/dn914120) プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-189">Enable looping of the audio file by setting the [**LoopCount**](https://msdn.microsoft.com/library/windows/apps/dn914120) property.</span></span> <span data-ttu-id="5b5c5-190">この値は、null 以外であれば、初回の再生後にファイルが再生される回数を示します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-190">When non-null, this value indicates the number of times the file will be played in after the initial playback.</span></span> <span data-ttu-id="5b5c5-191">たとえば、**LoopCount** を 1 に設定すると、このファイルは合計 2 回再生されます。値を 5 に設定すると、ファイルは合計 6 回再生されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-191">So, for example, setting **LoopCount** to 1 will cause the file to be played 2 times in total, and setting it to 5 will cause the file to be played 6 times in total.</span></span> <span data-ttu-id="5b5c5-192">**LoopCount** を null に設定すると、ファイルが無限にループされます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-192">Setting **LoopCount** to null causes the file to be looped indefinitely.</span></span> <span data-ttu-id="5b5c5-193">ループを停止するには、値を 0 に設定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-193">To stop looping, set the value to 0.</span></span>
-   <span data-ttu-id="5b5c5-194">オーディオ ファイルの再生速度を調整するには、[**PlaybackSpeedFactor**](https://msdn.microsoft.com/library/windows/apps/dn914123) を設定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-194">Adjust the speed at which the audio file is played back by setting the [**PlaybackSpeedFactor**](https://msdn.microsoft.com/library/windows/apps/dn914123).</span></span> <span data-ttu-id="5b5c5-195">値 1 は、ファイルの元の速度を示します、0.5 は半分の速度、2 は 2 倍の速度を示します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-195">A value of 1 indicates the original speed of the file, .5 is half-speed, and 2 is double speed.</span></span>

##  <a name="mediasource-input-node"></a><span data-ttu-id="5b5c5-196">MediaSource 入力ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-196">MediaSource input node</span></span>

<span data-ttu-id="5b5c5-197">[**MediaSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaSource) クラスは、さまざまなソースのメディアを参照するための一般的な方法を提供し、基になるメディア形式 (ディスク上のファイル、ストリーム、アダプティブ ストリーミング ネットワーク ソースなど) に関係なく、メディア データにアクセスするための一般的なモデルを公開します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-197">The [**MediaSource**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.MediaSource) class provides a common way to reference media from different sources and exposes a common model for accessing media data regardless of the underlying media format which could be a file on disk, a stream, or an adaptive streaming network source.</span></span> <span data-ttu-id="5b5c5-198">[\*\*MediaSourceAudioInputNode](https://docs.microsoft.com/uwp/api/windows.media.audio.mediasourceaudioinputnode) ノードを使用すると、**MediaSource** からオーディオ グラフにオーディオ データを渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-198">A [\*\*MediaSourceAudioInputNode](https://docs.microsoft.com/uwp/api/windows.media.audio.mediasourceaudioinputnode) node lets you direct audio data from a **MediaSource** into the audio graph.</span></span> <span data-ttu-id="5b5c5-199">**MediaSourceAudioInputNode** を作成するには、[**CreateMediaSourceAudioInputNodeAsync**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiograph.createmediasourceaudioinputnodeasync#Windows_Media_Audio_AudioGraph_CreateMediaSourceAudioInputNodeAsync_Windows_Media_Core_MediaSource_) を呼び出して、再生するコンテンツを表す **MediaSource** オブジェクトを渡します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-199">Create a **MediaSourceAudioInputNode** by calling [**CreateMediaSourceAudioInputNodeAsync**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiograph.createmediasourceaudioinputnodeasync#Windows_Media_Audio_AudioGraph_CreateMediaSourceAudioInputNodeAsync_Windows_Media_Core_MediaSource_), passing in a **MediaSource** object representing the content you wish to play.</span></span> <span data-ttu-id="5b5c5-200">[\* \* CreateMediaSourceAudioInputNodeResult](https://docs.microsoft.com/uwp/api/windows.media.audio.createmediasourceaudioinputnoderesult) が返され、その [**Status**](https://docs.microsoft.com/uwp/api/windows.media.audio.createmediasourceaudioinputnoderesult.status) プロパティを確認すると、操作の状態を判断できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-200">A [\*\*CreateMediaSourceAudioInputNodeResult](https://docs.microsoft.com/uwp/api/windows.media.audio.createmediasourceaudioinputnoderesult) is returned which you can use to determine the status of the operation by checking the [**Status**](https://docs.microsoft.com/uwp/api/windows.media.audio.createmediasourceaudioinputnoderesult.status) property.</span></span> <span data-ttu-id="5b5c5-201">状態が **Success** の場合は、[**Node**](https://docs.microsoft.com/uwp/api/windows.media.audio.createmediasourceaudioinputnoderesult.node) プロパティにアクセスして、作成された \*\*MediaSourceAudioInputNode \*\* を取得できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-201">If the status is **Success**, you can get the created **MediaSourceAudioInputNode** by accessing the [**Node**](https://docs.microsoft.com/uwp/api/windows.media.audio.createmediasourceaudioinputnoderesult.node) property.</span></span> <span data-ttu-id="5b5c5-202">以下では、ネットワーク経由のコンテンツのストリーミングを表す AdaptiveMediaSource オブジェクトからノードを作成する例を示します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-202">The following example shows the creation of a node from an AdaptiveMediaSource object representing content streaming over the network.</span></span> <span data-ttu-id="5b5c5-203">**MediaSource** の使用方法について詳しくは、「[メディア項目、プレイリスト、トラック](media-playback-with-mediasource.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-203">For more inforation on working with **MediaSource**, see [Media items, playlists, and tracks](media-playback-with-mediasource.md).</span></span> <span data-ttu-id="5b5c5-204">インターネット経由のストリーミング メディア コンテンツについて詳しくは、「[アダプティブ ストリーミング](adaptive-streaming.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-204">For more information on streaming media content over the internet, see [Adaptive streaming](adaptive-streaming.md).</span></span>

[!code-cs[DeclareMediaSourceInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareMediaSourceInputNode)]

[!code-cs[CreateMediaSourceInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateMediaSourceInputNode)]

<span data-ttu-id="5b5c5-205">再生が **MediaSource** コンテンツの最後に達したときに通知を受け取るには、[**MediaSourceCompleted**](https://docs.microsoft.com/uwp/api/windows.media.audio.mediasourceaudioinputnode.mediasourcecompleted) イベントのハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-205">To receive a notification when playback has reached the end of the **MediaSource** content, register a handler for the [**MediaSourceCompleted**](https://docs.microsoft.com/uwp/api/windows.media.audio.mediasourceaudioinputnode.mediasourcecompleted) event.</span></span> 

[!code-cs[RegisterMediaSourceCompleted](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetRegisterMediaSourceCompleted)]

[!code-cs[MediaSourceCompleted](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetMediaSourceCompleted)]

<span data-ttu-id="5b5c5-206">ディスクからファイルを再生した場合は、ほとんどが正常に完了しますが、ネットワーク ソースからストリームされたメディアは、ネットワーク接続状況の変化など、オーディオ グラフの制御の及ばない問題によって再生中に失敗することがあります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-206">While playing a file from diskis likely to always complete successfully, media streamed from a network source may fail during playback due to a change in network connection or other issues that are outside the control of the audio graph.</span></span> <span data-ttu-id="5b5c5-207">**MediaSource** が再生中に再生できなくなった場合、オーディオ グラフで [**UnrecoverableErrorOccurred**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiograph.unrecoverableerroroccurred) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-207">If a **MediaSource** becomes unplayable during playback, the audio graph will raise the [**UnrecoverableErrorOccurred**](https://docs.microsoft.com/uwp/api/windows.media.audio.audiograph.unrecoverableerroroccurred) event.</span></span> <span data-ttu-id="5b5c5-208">このイベントのハンドラーを使用して、オーディオ グラフを停止および破棄すると、グラフを再初期化できるようになります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-208">You can use the handler for this event to stop and dispose of the audio graph and then reinitialize your graph.</span></span> 

[!code-cs[RegisterUnrecoverableError](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetRegisterUnrecoverableError)]

[!code-cs[UnrecoverableError](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetUnrecoverableError)]

##  <a name="file-output-node"></a><span data-ttu-id="5b5c5-209">ファイル出力ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-209">File output node</span></span>

<span data-ttu-id="5b5c5-210">ファイル出力ノードを使用すると、オーディオ データをグラフからオーディオ ファイルに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-210">A file output node lets you direct audio data from the graph into an audio file.</span></span> <span data-ttu-id="5b5c5-211">[**AudioFileOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914133) を作成するには、[**CreateFileOutputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914227) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-211">Create an [**AudioFileOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914133) by calling [**CreateFileOutputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914227).</span></span>

[!code-cs[DeclareFileOutputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareFileOutputNode)]


[!code-cs[CreateFileOutputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateFileOutputNode)]

-   <span data-ttu-id="5b5c5-212">ファイル出力ノードでは、ファイル形式として mp3、wav、wma、m4a がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-212">File output nodes support the following file formats: mp3, wav, wma, m4a.</span></span>
-   <span data-ttu-id="5b5c5-213">[**AudioFileOutputNode.FinalizeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914140) を呼び出す前に、[**AudioFileOutputNode.Stop**](https://msdn.microsoft.com/library/windows/apps/dn914144) を呼び出して、ノードの処理を停止する必要があります。そうしないと例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-213">You must call [**AudioFileOutputNode.Stop**](https://msdn.microsoft.com/library/windows/apps/dn914144) to stop the node's processing before calling [**AudioFileOutputNode.FinalizeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914140) or an exception will be thrown.</span></span>

##  <a name="audio-frame-input-node"></a><span data-ttu-id="5b5c5-214">オーディオ フレーム入力ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-214">Audio frame input node</span></span>

<span data-ttu-id="5b5c5-215">オーディオ フレーム入力ノードでは、独自のコードで生成したオーディオ データをオーディオ グラフにプッシュすることができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-215">An audio frame input node allows you to push audio data that you generate in your own code into the audio graph.</span></span> <span data-ttu-id="5b5c5-216">これにより、カスタムのソフトウェア シンセサイザーを作成するなどのシナリオが可能になります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-216">This enables scenarios like creating a custom software synthesizer.</span></span> <span data-ttu-id="5b5c5-217">[**AudioFrameInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914147) を作成するには、[**CreateFrameInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914230) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-217">Create an [**AudioFrameInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914147) by calling [**CreateFrameInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914230).</span></span>

[!code-cs[DeclareFrameInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareFrameInputNode)]


[!code-cs[CreateFrameInputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateFrameInputNode)]

<span data-ttu-id="5b5c5-218">オーディオ グラフでオーディオ データの次のクォンタムの処理を開始する準備ができると、[**FrameInputNode.QuantumStarted**](https://msdn.microsoft.com/library/windows/apps/dn958507) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-218">The [**FrameInputNode.QuantumStarted**](https://msdn.microsoft.com/library/windows/apps/dn958507) event is raised when the audio graph is ready to begin processing the next quantum of audio data.</span></span> <span data-ttu-id="5b5c5-219">カスタム生成したオーディオ データは、このイベントに対するハンドラー内で指定します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-219">You supply your custom generated audio data from within the handler to this event.</span></span>

[!code-cs[QuantumStarted](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetQuantumStarted)]

-   <span data-ttu-id="5b5c5-220">**QuantumStarted** イベント ハンドラーに渡された [**FrameInputNodeQuantumStartedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn958533) オブジェクトには [**RequiredSamples**](https://msdn.microsoft.com/library/windows/apps/dn958534) プロパティがあります。このプロパティは、クォンタムを処理するためにオーディオ グラフが必要とするサンプル数を示します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-220">The [**FrameInputNodeQuantumStartedEventArgs**](https://msdn.microsoft.com/library/windows/apps/dn958533) object passed into the **QuantumStarted** event handler exposes the [**RequiredSamples**](https://msdn.microsoft.com/library/windows/apps/dn958534) property that indicates how many samples the audio graph needs to fill up the quantum to be processed.</span></span>
-   <span data-ttu-id="5b5c5-221">オーディオ データを設定した [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) オブジェクトをグラフに渡すには、[**AudioFrameInputNode.AddFrame**](https://msdn.microsoft.com/library/windows/apps/dn914148) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-221">Call [**AudioFrameInputNode.AddFrame**](https://msdn.microsoft.com/library/windows/apps/dn914148) to pass an [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) object filled with audio data into the graph.</span></span>
- <span data-ttu-id="5b5c5-222">Windows 10、バージョン 1803 では、オーディオ データで **MediaFrameReader** を使用するための新しい API セットが導入されました。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-222">A new set of APIs for using **MediaFrameReader** with audio data were introduced in Windows 10, version 1803.</span></span> <span data-ttu-id="5b5c5-223">これらの API を使用すると、メディア フレーム ソースから **AudioFrame** オブジェクトを取得し、それを **AddFrame** メソッドを使用して **FrameInputNode** に渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-223">These APIs allow you to obtain **AudioFrame** objects from a media frame source, which can be passed into a **FrameInputNode** using the **AddFrame** method.</span></span> <span data-ttu-id="5b5c5-224">詳しくは、「[MediaFrameReader を使ったオーディオ フレームの処理](process-audio-frames-with-mediaframereader.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-224">For more information, see [Process audio frames with MediaFrameReader](process-audio-frames-with-mediaframereader.md).</span></span>
-   <span data-ttu-id="5b5c5-225">**GenerateAudioData** ヘルパー メソッドの実装例を下に示します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-225">An example implementation of the **GenerateAudioData** helper method is shown below.</span></span>

<span data-ttu-id="5b5c5-226">[**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) にオーディオ データを設定するには、オーディオ フレームの基になるメモリ バッファーにアクセスできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-226">To populate an [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) with audio data, you must get access to the underlying memory buffer of the audio frame.</span></span> <span data-ttu-id="5b5c5-227">これには、該当する名前空間に以下のコードを追加して、COM インターフェイス **IMemoryBufferByteAccess** を初期化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-227">To do this you must initialize the **IMemoryBufferByteAccess** COM interface by adding the following code within your namespace.</span></span>

[!code-cs[ComImportIMemoryBufferByteAccess](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetComImportIMemoryBufferByteAccess)]

<span data-ttu-id="5b5c5-228">次のコードは、[**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) を作成し、オーディオ データを設定する **GenerateAudioData** ヘルパー メソッドの実装例を示しています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-228">The following code shows an example implementation of a **GenerateAudioData** helper method that creates an [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) and populates it with audio data.</span></span>

[!code-cs[GenerateAudioData](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetGenerateAudioData)]

-   <span data-ttu-id="5b5c5-229">このメソッドは、Windows ランタイム型よりも低いレベルの RAW バッファーにアクセスするため、**unsafe** キーワードを使って宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-229">Because this method accesses the raw buffer underlying the Windows Runtime types, it must be declared using the **unsafe** keyword.</span></span> <span data-ttu-id="5b5c5-230">また、Microsoft Visual Studio でアンセーフ コードのコンパイルを許可するようにプロジェクトを構成する必要があります。プロジェクトの **[プロパティ]** ページを開き、**[ビルド]** プロパティ ページをクリックして、**[アンセーフ コードの許可]** チェック ボックスをオンにしてください。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-230">You must also configure your project in Microsoft Visual Studio to allow the compilation of unsafe code by opening the project's **Properties** page, clicking the **Build** property page, and selecting the **Allow Unsafe Code** checkbox.</span></span>
-   <span data-ttu-id="5b5c5-231">**Windows.Media** 名前空間で [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) の新しいインスタンスを初期化するには、必要なバッファー サイズをコンストラクターに渡します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-231">Initialize a new instance of [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871), in the **Windows.Media** namespace, by passing in the desired buffer size to the constructor.</span></span> <span data-ttu-id="5b5c5-232">バッファー サイズとは、サンプル数に各サンプルのサイズを掛けた値です。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-232">The buffer size is the number of samples multiplied by the size of each sample.</span></span>
-   <span data-ttu-id="5b5c5-233">オーディオ フレームの [**AudioBuffer**](https://msdn.microsoft.com/library/windows/apps/dn958454) を取得するには、[**LockBuffer**](https://msdn.microsoft.com/library/windows/apps/dn930878) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-233">Get the [**AudioBuffer**](https://msdn.microsoft.com/library/windows/apps/dn958454) of the audio frame by calling [**LockBuffer**](https://msdn.microsoft.com/library/windows/apps/dn930878).</span></span>
-   <span data-ttu-id="5b5c5-234">オーディオ バッファーから [**IMemoryBufferByteAccess**](https://msdn.microsoft.com/library/windows/desktop/mt297505) COM インターフェイスのインスタンスを取得するには、[**CreateReference**](https://msdn.microsoft.com/library/windows/apps/dn958457) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-234">Get an instance of the [**IMemoryBufferByteAccess**](https://msdn.microsoft.com/library/windows/desktop/mt297505) COM interface from the audio buffer by calling [**CreateReference**](https://msdn.microsoft.com/library/windows/apps/dn958457).</span></span>
-   <span data-ttu-id="5b5c5-235">生のオーディオ バッファー データへのポインターを取得するには、[**IMemoryBufferByteAccess.GetBuffer**](https://msdn.microsoft.com/library/windows/desktop/mt297506) を呼び出してオーディオ データのサンプル データ型にキャストします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-235">Get a pointer to raw audio buffer data by calling [**IMemoryBufferByteAccess.GetBuffer**](https://msdn.microsoft.com/library/windows/desktop/mt297506) and cast it to the sample data type of the audio data.</span></span>
-   <span data-ttu-id="5b5c5-236">オーディオ グラフへの提出用に、バッファーにデータを設定して [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) を返します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-236">Fill the buffer with data and return the [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) for submission into the audio graph.</span></span>

##  <a name="audio-frame-output-node"></a><span data-ttu-id="5b5c5-237">オーディオ フレーム出力ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-237">Audio frame output node</span></span>

<span data-ttu-id="5b5c5-238">オーディオ フレーム出力ノードでは、独自に作成したカスタム コードを使い、オーディオ グラフからオーディオ データ出力を受信し、処理することができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-238">An audio frame output node allows you to receive and process audio data output from the audio graph with custom code that you create.</span></span> <span data-ttu-id="5b5c5-239">サンプル シナリオでは、オーディオ出力に対して信号分析を実行します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-239">An example scenario for this is performing signal analysis on the audio output.</span></span> <span data-ttu-id="5b5c5-240">[**AudioFrameOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914166) を作成するには、[**CreateFrameOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914233) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-240">Create an [**AudioFrameOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914166) by calling [**CreateFrameOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914233).</span></span>

[!code-cs[DeclareFrameOutputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetDeclareFrameOutputNode)]

[!code-cs[CreateFrameOutputNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateFrameOutputNode)]

<span data-ttu-id="5b5c5-241">オーディオ グラフでオーディオ データのクォンタムの処理が開始すると、[**AudioGraph.QuantumStarted**](https://docs.microsoft.com/uwp/api/Windows.Media.Audio.AudioGraph.QuantumStarted) イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-241">The [**AudioGraph.QuantumStarted**](https://docs.microsoft.com/uwp/api/Windows.Media.Audio.AudioGraph.QuantumStarted) event is raised when the audio graph has begins processing a quantum of audio data.</span></span> <span data-ttu-id="5b5c5-242">オーディオ データには、このイベントのハンドラー内からアクセスすることができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-242">You can access the audio data from within the handler for this event.</span></span> 

> [!NOTE]
> <span data-ttu-id="5b5c5-243">オーディオ フレームを一定間隔で、オーディオ グラフと同期させて取得する場合は、同期 **QuantumStarted** イベント ハンドラー内から [AudioFrameOutputNode.GetFrame](https://docs.microsoft.com/uwp/api/windows.media.audio.audioframeoutputnode.GetFrame) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-243">If you want to retrieve audio frames on a regular cadence, synchronized with the audio graph, call [AudioFrameOutputNode.GetFrame](https://docs.microsoft.com/uwp/api/windows.media.audio.audioframeoutputnode.GetFrame) from within the synchronous **QuantumStarted** event handler.</span></span> <span data-ttu-id="5b5c5-244">**QuantumProcessed** イベントは、オーディオ エンジンがオーディオ処理を完了した後、非同期的に発生するため、一定間隔でない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-244">The **QuantumProcessed** event is raised asynchronously after the audio engine has completed audio processing, which means its cadence may be irregular.</span></span> <span data-ttu-id="5b5c5-245">したがって、オーディオ フレーム データの同期処理に **QuantumProcessed** イベントを使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-245">Therefore you should not use the **QuantumProcessed** event for synchronized processing of audio frame data.</span></span>

[!code-cs[SnippetQuantumStartedFrameOutput](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetQuantumStartedFrameOutput)]

-   <span data-ttu-id="5b5c5-246">オーディオ データを設定した [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) オブジェクトをグラフから取得するには、[**GetFrame**](https://msdn.microsoft.com/library/windows/apps/dn914171) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-246">Call [**GetFrame**](https://msdn.microsoft.com/library/windows/apps/dn914171) to get an [**AudioFrame**](https://msdn.microsoft.com/library/windows/apps/dn930871) object filled with audio data from the graph.</span></span>
-   <span data-ttu-id="5b5c5-247">**ProcessFrameOutput** ヘルパー メソッドの実装例を下に示します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-247">An example implementation of the **ProcessFrameOutput** helper method is shown below.</span></span>

[!code-cs[ProcessFrameOutput](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetProcessFrameOutput)]

-   <span data-ttu-id="5b5c5-248">上に示したオーディオ フレーム入力ノードの例と同様、基になっているオーディオ バッファーにアクセスするために、**IMemoryBufferByteAccess** COM インターフェイスを宣言して、アンセーフ コードが許可されるようにプロジェクトを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-248">Like the audio frame input node example above, you will need to declare the **IMemoryBufferByteAccess** COM interface and configure your project to allow unsafe code in order to access the underlying audio buffer.</span></span>
-   <span data-ttu-id="5b5c5-249">オーディオ フレームの [**AudioBuffer**](https://msdn.microsoft.com/library/windows/apps/dn958454) を取得するには、[**LockBuffer**](https://msdn.microsoft.com/library/windows/apps/dn930878) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-249">Get the [**AudioBuffer**](https://msdn.microsoft.com/library/windows/apps/dn958454) of the audio frame by calling [**LockBuffer**](https://msdn.microsoft.com/library/windows/apps/dn930878).</span></span>
-   <span data-ttu-id="5b5c5-250">オーディオ バッファーから **IMemoryBufferByteAccess** COM インターフェイスのインスタンスを取得するには、[**CreateReference**](https://msdn.microsoft.com/library/windows/apps/dn958457) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-250">Get an instance of the **IMemoryBufferByteAccess** COM interface from the audio buffer by calling [**CreateReference**](https://msdn.microsoft.com/library/windows/apps/dn958457).</span></span>
-   <span data-ttu-id="5b5c5-251">生のオーディオ バッファー データへのポインターを取得するには、**IMemoryBufferByteAccess.GetBuffer** を呼び出してオーディオ データのサンプル データ型にキャストします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-251">Get a pointer to raw audio buffer data by calling **IMemoryBufferByteAccess.GetBuffer** and cast it to the sample data type of the audio data.</span></span>

## <a name="node-connections-and-submix-nodes"></a><span data-ttu-id="5b5c5-252">ノード接続とサブミックス ノード</span><span class="sxs-lookup"><span data-stu-id="5b5c5-252">Node connections and submix nodes</span></span>

<span data-ttu-id="5b5c5-253">すべての種類の入力ノードには **AddOutgoingConnection** メソッドがあります。このメソッドでは、そのノードで生成されたオーディオをメソッドに渡されたノードにルーティングします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-253">All input nodes types expose the **AddOutgoingConnection** method that routes the audio produced by the node to the node that is passed into the method.</span></span> <span data-ttu-id="5b5c5-254">次の例では、[**AudioFileInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914108) を [**AudioDeviceOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914098) に接続します。これは、デバイスのスピーカーでオーディオ ファイルを再生するための単純な設定です。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-254">The following example connects an [**AudioFileInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914108) to an [**AudioDeviceOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914098), which is a simple setup for playing an audio file on the device's speaker.</span></span>

[!code-cs[AddOutgoingConnection1](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetAddOutgoingConnection1)]

<span data-ttu-id="5b5c5-255">入力ノードから別ノードへは、複数の接続を作成できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-255">You can create more than one connection from an input node to other nodes.</span></span> <span data-ttu-id="5b5c5-256">次の例では、[**AudioFileInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914108) から [**AudioFileOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914133) への接続を追加しています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-256">The following example adds another connection from the [**AudioFileInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914108) to an [**AudioFileOutputNode**](https://msdn.microsoft.com/library/windows/apps/dn914133).</span></span> <span data-ttu-id="5b5c5-257">ここで、オーディオ ファイルからのオーディオがデバイスのスピーカーで再生され、オーディオ ファイルにも出力されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-257">Now, the audio from the audio file is played to the device's speaker and is also written out to an audio file.</span></span>

[!code-cs[AddOutgoingConnection2](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetAddOutgoingConnection2)]

<span data-ttu-id="5b5c5-258">出力ノードでも、他のノードから複数の接続を受け取ることができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-258">Output nodes can also receive more than one connection from other nodes.</span></span> <span data-ttu-id="5b5c5-259">次の例では、[**AudioDeviceInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914082) から [**AudioDeviceOutput**](https://msdn.microsoft.com/library/windows/apps/dn914098) ノードへの接続が作成されています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-259">In the following example a connection is made from a [**AudioDeviceInputNode**](https://msdn.microsoft.com/library/windows/apps/dn914082) to the [**AudioDeviceOutput**](https://msdn.microsoft.com/library/windows/apps/dn914098) node.</span></span> <span data-ttu-id="5b5c5-260">この出力ノードには、ファイル入力ノードとデバイス入力ノードからの接続があるため、出力には両方のソースからのオーディオのミックスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-260">Because the output node has connections from the file input node and the device input node, the output will contain a mix of audio from both sources.</span></span> <span data-ttu-id="5b5c5-261">**AddOutgoingConnection** には、接続を通過する信号のゲイン値を指定するためのオーバーロードが用意されています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-261">**AddOutgoingConnection** provides an overload that lets you specify a gain value for the signal passing through the connection.</span></span>

[!code-cs[AddOutgoingConnection3](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetAddOutgoingConnection3)]

<span data-ttu-id="5b5c5-262">出力ノードでは複数ノードからの接続を許容できますが、ミックスを出力に渡す前に、1 つ以上のノードからの信号の中間ミックスを作成することも検討してください。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-262">Although output nodes can accept connections from multiple nodes, you may want to create an intermediate mix of signals from one or more nodes before passing the mix to an output.</span></span> <span data-ttu-id="5b5c5-263">たとえば、グラフ内のオーディオ信号のサブセットに対し、レベルの設定やエフェクトの適用を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-263">For example, you may want to set the level or apply effects to a subset of the audio signals in a graph.</span></span> <span data-ttu-id="5b5c5-264">そのためには、[**AudioSubmixNode**](https://msdn.microsoft.com/library/windows/apps/dn914247) を使用します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-264">To do this, use the [**AudioSubmixNode**](https://msdn.microsoft.com/library/windows/apps/dn914247).</span></span> <span data-ttu-id="5b5c5-265">サブミックス ノードには、1 つ以上の入力ノードまたは他のサブミックス ノードから接続することができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-265">You can connect to a submix node from one or more input nodes or other submix nodes.</span></span> <span data-ttu-id="5b5c5-266">次の例では、[**AudioGraph.CreateSubmixNode**](https://msdn.microsoft.com/library/windows/apps/dn914236) で新しいサブミックス ノードを作成しています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-266">In the following example, a new submix node is created with [**AudioGraph.CreateSubmixNode**](https://msdn.microsoft.com/library/windows/apps/dn914236).</span></span> <span data-ttu-id="5b5c5-267">次に、ファイル入力ノードとフレーム出力ノードからサブミックス ノードへの接続が追加されています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-267">Then, connections are added from a file input node and a frame output node to the submix node.</span></span> <span data-ttu-id="5b5c5-268">最後に、サブミックス ノードがファイル出力ノードに接続されています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-268">Finally, the submix node is connected to a file output node.</span></span>

[!code-cs[CreateSubmixNode](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateSubmixNode)]

## <a name="starting-and-stopping-audio-graph-nodes"></a><span data-ttu-id="5b5c5-269">オーディオ グラフ ノードの開始と停止</span><span class="sxs-lookup"><span data-stu-id="5b5c5-269">Starting and stopping audio graph nodes</span></span>

<span data-ttu-id="5b5c5-270">[**AudioGraph.Start**](https://msdn.microsoft.com/library/windows/apps/dn914244) が呼び出されると、オーディオ グラフはオーディオ データの処理を開始します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-270">When [**AudioGraph.Start**](https://msdn.microsoft.com/library/windows/apps/dn914244) is called, the audio graph begins processing audio data.</span></span> <span data-ttu-id="5b5c5-271">すべてのノードの種類に、個々のノードでデータの処理を開始または停止する **Start** メソッドと **Stop** メソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-271">Every node type provides **Start** and **Stop** methods that cause the individual node to start or stop processing data.</span></span> <span data-ttu-id="5b5c5-272">[**AudioGraph.Stop**](https://msdn.microsoft.com/library/windows/apps/dn914245) が呼び出されると、個々のノードの状態に関係なく、すべてのノードでのすべてのオーディオ処理が停止しますが、オーディオ グラフが停止している間も各ノードの状態が設定されることは考えられます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-272">When [**AudioGraph.Stop**](https://msdn.microsoft.com/library/windows/apps/dn914245) is called, all audio processing in the all nodes is stopped regardless of the state of individual nodes, but the state of each node can be set while the audio graph is stopped.</span></span> <span data-ttu-id="5b5c5-273">たとえば、グラフの停止中に各ノードで **Stop** を呼び出してから **AudioGraph.Start** を呼び出した場合、個々のノードは停止状態のままです。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-273">For example, you could call **Stop** on an individual node while the graph is stopped and then call **AudioGraph.Start**, and the individual node will remain in the stopped state.</span></span>

<span data-ttu-id="5b5c5-274">すべてのノードの種類には **ConsumeInput** プロパティが用意されています。これが false に設定されると、ノードではオーディオ処理を続行できますが、他のノードから入力されているオーディオ データの使用が停止されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-274">All node types expose the **ConsumeInput** property that, when set to false, allows the node to continue audio processing but stops it from consuming any audio data being input from other nodes.</span></span>

<span data-ttu-id="5b5c5-275">すべてのノードの種類には **Reset** メソッドが用意されています。このメソッドが呼び出されると、ノードのバッファーにある現在のオーディオ データがすべて破棄されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-275">All node types expose the **Reset** method that causes the node to discard any audio data currently in its buffer.</span></span>

## <a name="adding-audio-effects"></a><span data-ttu-id="5b5c5-276">オーディオ エフェクトの追加</span><span class="sxs-lookup"><span data-stu-id="5b5c5-276">Adding audio effects</span></span>

<span data-ttu-id="5b5c5-277">オーディオ グラフ API を使うと、グラフ内のすべての種類のノードに、オーディオ エフェクトを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-277">The audio graph API allows you to add audio effects to every type of node in a graph.</span></span> <span data-ttu-id="5b5c5-278">個々の出力ノード、入力ノード、およびサブミックス ノードに追加できるオーディオ エフェクトの数に制限はありません (ハードウェア性能によってのみ制限されます)。次の例では、組み込みのエコー エフェクトをサブミックス ノードに追加する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-278">Output nodes, input nodes, and submix nodes can each have an unlimited number of audio effects, limited only by the capabilities of the hardware.The following example demonstrates adding the built-in echo effect to a submix node.</span></span>

[!code-cs[AddEffect](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetAddEffect)]

-   <span data-ttu-id="5b5c5-279">すべてのオーディオ エフェクトには、[**IAudioEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn608044) が実装されています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-279">All audio effects implement [**IAudioEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn608044).</span></span> <span data-ttu-id="5b5c5-280">すべてのノードには、そのノードに適用されたエフェクトの一覧を表す **EffectDefinitions** プロパティが用意されています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-280">Every node exposes an **EffectDefinitions** property representing the list of effects applied to that node.</span></span> <span data-ttu-id="5b5c5-281">エフェクトを追加するには、エフェクトの定義オブジェクトをこの一覧に追加します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-281">Add an effect by adding it's definition object to the list.</span></span>
-   <span data-ttu-id="5b5c5-282">**Windows.Media.Audio** 名前空間には、複数のエフェクト定義クラスがあります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-282">There are several effect definition classes that are provided in the **Windows.Media.Audio** namespace.</span></span> <span data-ttu-id="5b5c5-283">次のようなクラスがあります。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-283">These include:</span></span>
    -   [**<span data-ttu-id="5b5c5-284">EchoEffectDefinition</span><span class="sxs-lookup"><span data-stu-id="5b5c5-284">EchoEffectDefinition</span></span>**](https://msdn.microsoft.com/library/windows/apps/dn914276)
    -   [**<span data-ttu-id="5b5c5-285">EqualizerEffectDefinition</span><span class="sxs-lookup"><span data-stu-id="5b5c5-285">EqualizerEffectDefinition</span></span>**](https://msdn.microsoft.com/library/windows/apps/dn914287)
    -   [**<span data-ttu-id="5b5c5-286">LimiterEffectDefinition</span><span class="sxs-lookup"><span data-stu-id="5b5c5-286">LimiterEffectDefinition</span></span>**](https://msdn.microsoft.com/library/windows/apps/dn914306)
    -   [**<span data-ttu-id="5b5c5-287">ReverbEffectDefinition</span><span class="sxs-lookup"><span data-stu-id="5b5c5-287">ReverbEffectDefinition</span></span>**](https://msdn.microsoft.com/library/windows/apps/dn914313)
-   <span data-ttu-id="5b5c5-288">[**IAudioEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn608044) を実装する独自のオーディオ エフェクトを作成し、オーディオ グラフ内の任意のノードに適用することができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-288">You can create your own audio effects that implement [**IAudioEffectDefinition**](https://msdn.microsoft.com/library/windows/apps/dn608044) and apply them to any node in an audio graph.</span></span>
-   <span data-ttu-id="5b5c5-289">すべてのノードの種類には、**DisableEffectsByDefinition** メソッドが用意されています。このメソッドは、ノードの **EffectDefinitions** リストに含まれる、指定の定義を使って追加されたすべてのエフェクトを無効にします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-289">Every node type exposes a **DisableEffectsByDefinition** method that disables all effects in the node's **EffectDefinitions** list that were added using the specified definition.</span></span> <span data-ttu-id="5b5c5-290">**EnableEffectsByDefinition** は、指定の定義を持つエフェクトを有効にします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-290">**EnableEffectsByDefinition** enables the effects with the specified definition.</span></span>

## <a name="spatial-audio"></a><span data-ttu-id="5b5c5-291">空間オーディオ</span><span class="sxs-lookup"><span data-stu-id="5b5c5-291">Spatial audio</span></span>
<span data-ttu-id="5b5c5-292">Windows 10 バージョン 1607 以降、**AudioGraph** は空間オーディオをサポートしています。これにより、任意の入力またはサブミックス ノードからのオーディオが出力される 3D 空間内の場所を指定することができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-292">Starting with Windows 10, version 1607, **AudioGraph** supports spatial audio, which allows you to specify the location in 3D space from which audio from any input or submix node is emitted.</span></span> <span data-ttu-id="5b5c5-293">また、オーディオ出力の形状や方向、ノードのオーディオのドップラー偏移に使用される速度を指定することや、距離に応じたオーディオの減衰を記述する減衰モデルを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-293">You can also specify a shape and direction in which audio is emitted,a velocity that will be used to Doppler shift the node's audio, and define a decay model that describes how the audio is attenuated with distance.</span></span> 

<span data-ttu-id="5b5c5-294">エミッターを作成するには、最初に、エミッターから出力されるサウンドの形状を作成します。これには、円すい状または無指向性を指定できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-294">To create an emitter, you can first create a shape in which the sound is projected from the emitter, which can be a cone or omnidirectional.</span></span> <span data-ttu-id="5b5c5-295">[**AudioNodeEmitterShape**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitterShape) クラスは、これらの各形状を作成するための静的メソッドを提供します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-295">The [**AudioNodeEmitterShape**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitterShape) class provides static methods for creating each of these shapes.</span></span> <span data-ttu-id="5b5c5-296">次に、減衰モデルを作成します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-296">Next, create a decay model.</span></span> <span data-ttu-id="5b5c5-297">これは、リスナーからの距離が増加するにつれて、エミッターからのオーディオの音量をどのように減少させるかを定義します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-297">This defines how the volume of the audio from the emitter decreases as the distance from the listener increases.</span></span> <span data-ttu-id="5b5c5-298">[**CreateNatural**](https://msdn.microsoft.com/library/windows/apps/mt711740) メソッドは、距離二乗減衰モデルを使用してサウンドの自然減衰をエミュレートする減衰モデルを作成します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-298">The [**CreateNatural**](https://msdn.microsoft.com/library/windows/apps/mt711740) method creates a decay model that emulates the natural decay of sound using a distance squared falloff model.</span></span> <span data-ttu-id="5b5c5-299">最後に、[**AudioNodeEmitterSettings**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitterSettings) オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-299">Finally, create an [**AudioNodeEmitterSettings**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitterSettings) object.</span></span> <span data-ttu-id="5b5c5-300">現時点では、このオブジェクトは、エミッターのオーディオの速度ベースのドップラー減衰を有効または無効にするためにのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-300">Currently, this object is only used to enable and disable velocity-based Doppler attenuation of the emitter's audio.</span></span> <span data-ttu-id="5b5c5-301">[**AudioNodeEmitter**](https://msdn.microsoft.com/library/windows/apps/mt694324.aspx) コンストラクターを呼び出して、作成した初期化オブジェクトを渡します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-301">Call the [**AudioNodeEmitter**](https://msdn.microsoft.com/library/windows/apps/mt694324.aspx) constructor, passing in the initialization objects you just created.</span></span> <span data-ttu-id="5b5c5-302">既定では、エミッターは原点に置かれますが、エミッターの位置は [**Position**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitter.Position) プロパティで設定できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-302">By default, the emitter is placed at the origin, but you can set the position of the emitter with the [**Position**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitter.Position) property.</span></span>

> [!NOTE]
> <span data-ttu-id="5b5c5-303">オーディオ ノード エミッターは、48 kHz のサンプル レートとモノラルでフォーマットされているオーディオのみを処理できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-303">Audio node emitters can only process audio that is formatted in mono with a sample rate of 48kHz.</span></span> <span data-ttu-id="5b5c5-304">ステレオ オーディオや別のサンプル レートのオーディオを使用しようとすると、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-304">Attempting to use stereo audio or audio with a different sample rate will result in an exception.</span></span>

<span data-ttu-id="5b5c5-305">目的のノードの種類の作成メソッドをオーバーロードした作成メソッドを使用してオーディオ ノードを作成する場合、オーディオ ノードにエミッターを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-305">You assign the emitter to an audio node when you create it by using the overloaded creation method for the type of node you want.</span></span> <span data-ttu-id="5b5c5-306">この例では、[**CreateFileInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914225) を使用して、指定されたファイルとノードに関連付ける [**AudioNodeEmitter**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitter) オブジェクトから、ファイル入力ノードを作成しています。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-306">In this example, [**CreateFileInputNodeAsync**](https://msdn.microsoft.com/library/windows/apps/dn914225) is used to create a file input node from a specified file and the [**AudioNodeEmitter**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitter) object you want to associate with the node.</span></span>

[!code-cs[CreateEmitter](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetCreateEmitter)]

<span data-ttu-id="5b5c5-307">グラフからのオーディオをユーザーに対して出力する [**AudioDeviceOutputNode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioDeviceOutputNode) には、[**Listener**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioDeviceOutputNode.Listener) プロパティでアクセスできるリスナー オブジェクトがあります。このオブジェクトは、3D 空間でのユーザーの位置、向き、速度を表します。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-307">The [**AudioDeviceOutputNode**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioDeviceOutputNode) that outputs audio from the graph to the user has a listener object, accessed with the [**Listener**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioDeviceOutputNode.Listener) property, which represents the location, orientation, and velocity of the user in the 3D space.</span></span> <span data-ttu-id="5b5c5-308">グラフ内のすべてのエミッターの位置は、エミッター オブジェクトの位置と向きを基準とします。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-308">The positions of all of the emitters in the graph are relative to the position and orientation of the emitter object.</span></span> <span data-ttu-id="5b5c5-309">既定では、リスナーは原点 (0,0,0) に位置し、Z 軸に沿って前向きですが、リスナーの位置と向きは、[**Position**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeListener.Position) プロパティと [**Orientation**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeListener.Orientation) プロパティを使って設定できます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-309">By default, the listener is located at the origin (0,0,0) facing forward along the Z axis, but you can set it's position and orientation with the [**Position**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeListener.Position) and [**Orientation**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeListener.Orientation) properties.</span></span>

[!code-cs[Listener](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetListener)]

<span data-ttu-id="5b5c5-310">実行時にエミッターの位置、速度、方向を更新することで、3D 空間でのオーディオ ソースの動きをシミュレートすることができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-310">You can update the location, velocity, and direction of emitters at runtime to simulate the movement of an audio source through 3D space.</span></span>

[!code-cs[UpdateEmitter](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetUpdateEmitter)]

<span data-ttu-id="5b5c5-311">また、実行時にリスナー オブジェクトの位置、速度、向きを更新することで、3D 空間でのユーザーの動きをシミュレートすることができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-311">You can also update the location, velocity, and orientation of the listener object at runtime to simulate the movement of the user through 3D space.</span></span>

[!code-cs[UpdateListener](./code/AudioGraph/cs/MainPage.xaml.cs#SnippetUpdateListener)]

<span data-ttu-id="5b5c5-312">既定では、空間オーディオは、リスナーを基準とするオーディオの形状、速度、位置に基づいてオーディオを減衰する、Microsoft の頭部伝達関数 (HRTF) アルゴリズムを使用して計算されます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-312">By default, spatial audio is calculated using Microsoft's head-relative transfer function (HRTF) algorithm to attenuate the audio based on its shape, velocity, and position relative to the listener.</span></span> <span data-ttu-id="5b5c5-313">[**SpatialAudioModel**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitter.SpatialAudioModel) プロパティを **FoldDown** に設定することにより、単純なステレオ ミックス メソッドを使用して、正確性は下がるが、必要な CPU とメモリ リソースが少ない空間オーディオをシミュレートすることができます。</span><span class="sxs-lookup"><span data-stu-id="5b5c5-313">You can set the [**SpatialAudioModel**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Audio.AudioNodeEmitter.SpatialAudioModel) property to **FoldDown** to use a simple stereo mix method of simulating spatial audio that is less accurate but requires less CPU and memory resources.</span></span>

## <a name="see-also"></a><span data-ttu-id="5b5c5-314">関連項目</span><span class="sxs-lookup"><span data-stu-id="5b5c5-314">See also</span></span>
- [<span data-ttu-id="5b5c5-315">メディア再生</span><span class="sxs-lookup"><span data-stu-id="5b5c5-315">Media playback</span></span>](media-playback.md)
 

 




