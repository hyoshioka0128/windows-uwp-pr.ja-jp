---
author: drewbatgit
ms.assetid: 
description: "この記事では、複数のソースから同時にビデオをキャプチャして、複数のビデオ トラックが埋め込まれている 1 つのファイルを作成する方法について説明します。"
title: "MediaFrameSourceGroup を使用して複数のソースからキャプチャする"
ms.author: drewbat
ms.date: 09/12/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: "Windows 10, UWP, キャプチャ, ビデオ"
ms.localizationpriority: medium
ms.openlocfilehash: 56996cf9edb5aef317421e5ca8eef05153328bf9
ms.sourcegitcommit: f9a4854b6aecfda472fb3f8b4a2d3b271b327800
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
# <a name="capture-from-multiple-sources-using-mediaframesourcegroup"></a><span data-ttu-id="36625-104">MediaFrameSourceGroup を使用して複数のソースからキャプチャする</span><span class="sxs-lookup"><span data-stu-id="36625-104">Capture from multiple sources using MediaFrameSourceGroup</span></span>

<span data-ttu-id="36625-105">この記事では、複数のソースから同時にビデオをキャプチャして、複数のビデオ トラックが埋め込まれている 1 つのファイルを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="36625-105">This article shows you how to capture video from multiple sources simultaneously to a single file with multiple embedded video tracks.</span></span> <span data-ttu-id="36625-106">RS3 以降では、1 つの **[MediaEncodingProfile](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile)** に対して複数の **[VideoStreamDescriptor](https://docs.microsoft.com/uwp/api/windows.media.core.videostreamdescriptor)** オブジェクトを指定できます。</span><span class="sxs-lookup"><span data-stu-id="36625-106">Starting with RS3, you can specify multiple **[VideoStreamDescriptor](https://docs.microsoft.com/uwp/api/windows.media.core.videostreamdescriptor)** objects for a single **[MediaEncodingProfile](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile)**.</span></span> <span data-ttu-id="36625-107">これにより、複数のストリームを同時に 1 つのファイルにエンコードすることができます。</span><span class="sxs-lookup"><span data-stu-id="36625-107">This enables you to encode multiple streams simultaneously to a single file.</span></span> <span data-ttu-id="36625-108">この操作でエンコードされたビデオ ストリームは、1 つの **[MediaFrameSourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup)** に含める必要があります。このクラスでは、現在のデバイスが備えている、同時使用が可能なカメラのセットを指定します。</span><span class="sxs-lookup"><span data-stu-id="36625-108">The video streams that are encoded in this operation must be included in a single **[MediaFrameSourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup)** which specifies a set of cameras on the current device that can be used at the same time.</span></span> 

<span data-ttu-id="36625-109">**[MediaFrameReader](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader)** クラスと共に **[MediaFrameSourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup)** を使用して、複数のカメラを利用するリアルタイムなコンピューター ビジョンのシナリオを実現する方法については、「[MediaFrameReader を使ったメディア フレームの処理](process-media-frames-with-mediaframereader.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36625-109">For information on using **[MediaFrameSourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup)** with the **[MediaFrameReader](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframereader)** class to enable real-time computer vision scenarios that use multiple cameras, see [Process media frames with MediaFrameReader](process-media-frames-with-mediaframereader.md).</span></span>

<span data-ttu-id="36625-110">この記事の残りの部分では、2 台のカラー カメラでビデオを録画し、複数のビデオ トラックが埋め込まれている 1 つのファイルを作成する手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="36625-110">The rest of this article will walk you through the steps of recording video from two color cameras to a single file with multiple video tracks.</span></span>

## <a name="find-available-sensor-groups"></a><span data-ttu-id="36625-111">利用可能なセンサー グループを検索する</span><span class="sxs-lookup"><span data-stu-id="36625-111">Find available sensor groups</span></span>
<span data-ttu-id="36625-112">**MediaFrameSourceGroup** は、同時にアクセスできるフレーム ソース (通常はカメラ) のコレクションを表します。</span><span class="sxs-lookup"><span data-stu-id="36625-112">A **MediaFrameSourceGroup** represents a collection of frame sources, typically cameras, that can be accessed simulataneously.</span></span> <span data-ttu-id="36625-113">利用可能なフレーム ソース グループのセットはデバイスごとに異なります。そのため、この例の最初の手順では、利用可能なフレーム ソース グループの一覧を取得し、シナリオで必要となるカメラを含んでいるグループを探します。この例では、2 台のカラー カメラが必要となります。</span><span class="sxs-lookup"><span data-stu-id="36625-113">The set of available frame source groups is different for each device, so the first step in this example is to get the list of available frame source groups and finding one that contains the necessary cameras for the scenario, which in this case requires two color cameras.</span></span>

<span data-ttu-id="36625-114">**[MediaFrameSourceGroup.FindAllAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup#Windows_Media_Capture_Frames_MediaFrameSourceGroup_FindAllAsync)** メソッドは、現在のデバイスで利用可能なすべてのソース グループを返します。</span><span class="sxs-lookup"><span data-stu-id="36625-114">The **[MediaFrameSourceGroup.FindAllAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourcegroup#Windows_Media_Capture_Frames_MediaFrameSourceGroup_FindAllAsync)** method returns all source groups available on the current device.</span></span> <span data-ttu-id="36625-115">返された各 **MediaFrameSourceGroup** には、グループ内にある各フレーム ソースを記述する **[MediaFrameSourceInfo](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourceinfo)** オブジェクトの一覧が含まれています。</span><span class="sxs-lookup"><span data-stu-id="36625-115">Each returned **MediaFrameSourceGroup** has a list of **[MediaFrameSourceInfo](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourceinfo)** objects that describes each frame source in the group.</span></span> <span data-ttu-id="36625-116">Linq クエリを使用して、2 台のカラー カメラ (前面カメラと背面カメラ) を含んでいるソース グループを検索します。</span><span class="sxs-lookup"><span data-stu-id="36625-116">A Linq query is used to find a source group that contains two color cameras, one on the front panel and one on the back.</span></span> <span data-ttu-id="36625-117">各カラー カメラについて選択した **MediaFrameSourceGroup** と **MediaFrameSourceInfo** を含んでいる匿名オブジェクトが返されます。</span><span class="sxs-lookup"><span data-stu-id="36625-117">An anonymous object is returned that contains the selected **MediaFrameSourceGroup** and the **MediaFrameSourceInfo** for each color camera.</span></span> <span data-ttu-id="36625-118">Linq 構文を使用する代わりに、各グループをループ処理してから、各 **MediaFrameSourceInfo** をループ処理し、要件を満たしているグループを検索することもできます。</span><span class="sxs-lookup"><span data-stu-id="36625-118">Instead of using Linq syntax, you could instead loop through each group, and then each **MediaFrameSourceInfo** to look for a group that meets your requirements.</span></span>

<span data-ttu-id="36625-119">すべてのデバイスが 2 台のカラー カメラを含むソース グループを保持しているわけではありません。そのため、ビデオをキャプチャする前に、ソース グループが検出済みであるかどうかを確認する必要があります</span><span class="sxs-lookup"><span data-stu-id="36625-119">Note that not every device will contain a source group that contains two color cameras, so you should check to make sure that a source group was found before trying to capture video.</span></span>

[!code-cs[MultiRecordFindSensorGroups](./code/SimpleCameraPreview_Win10/cs/MainPage.MultiRecord.xaml.cs#SnippetMultiRecordFindSensorGroups)]

## <a name="initialize-the-mediacapture-object"></a><span data-ttu-id="36625-120">MediaCapture オブジェクトを初期化する</span><span class="sxs-lookup"><span data-stu-id="36625-120">Initialize the MediaCapture object</span></span>
<span data-ttu-id="36625-121">**[MediaCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture)** クラスは、UWP アプリでのほとんどのオーディオ、ビデオ、および写真のキャプチャ操作で使用されるプライマリ クラスです。</span><span class="sxs-lookup"><span data-stu-id="36625-121">The **[MediaCapture](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture)** class is the primary class that is used for most audio, video, and photo capture operations in UWP apps.</span></span> <span data-ttu-id="36625-122">初期化パラメーターを含んでいる **[MediaCaptureInitializationSettings](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings)** オブジェクトを渡して **[InitializeAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_InitializeAsync)** を呼び出し、オブジェクトを初期化します。</span><span class="sxs-lookup"><span data-stu-id="36625-122">Initialize the object by calling **[InitializeAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_InitializeAsync)**, passing in a **[MediaCaptureInitializationSettings](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings)** object that contains initialization parameters.</span></span> <span data-ttu-id="36625-123">この例では、指定した設定は **[SourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings#Windows_Media_Capture_MediaCaptureInitializationSettings_SourceGroup)** プロパティのみで、前のコード例で取得された **MediaFrameSourceGroup** に設定されています。</span><span class="sxs-lookup"><span data-stu-id="36625-123">In this example, the only specified setting is the **[SourceGroup](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacaptureinitializationsettings#Windows_Media_Capture_MediaCaptureInitializationSettings_SourceGroup)** property, which is set to the **MediaFrameSourceGroup** that was retrieved in the previous code example.</span></span>

<span data-ttu-id="36625-124">メディアをキャプチャする場合に **MediaCapture** や他の UWP アプリの機能を使用して実行できるその他の操作については、「[カメラ](camera.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36625-124">For information on other operations you can perform with **MediaCapture** and other UWP app features for capturing media, see [Camera](camera.md).</span></span>

[!code-cs[MultiRecordInitMediaCapture](./code/SimpleCameraPreview_Win10/cs/MainPage.MultiRecord.xaml.cs#SnippetMultiRecordInitMediaCapture)]

## <a name="create-a-mediaencodingprofile"></a><span data-ttu-id="36625-125">MediaEncodingProfile を作成する</span><span class="sxs-lookup"><span data-stu-id="36625-125">Create a MediaEncodingProfile</span></span>
<span data-ttu-id="36625-126">**[MediaEncodingProfile](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile)** クラスは、キャプチャしたオーディオやビデオをファイルに書き込む際のエンコードの方法をメディア キャプチャ パイプラインに伝えます。</span><span class="sxs-lookup"><span data-stu-id="36625-126">The **[MediaEncodingProfile](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile)** class tells the media capture pipeline how captured audio and video should be encoded as they are written to a file.</span></span> <span data-ttu-id="36625-127">一般的なキャプチャやコード変換のシナリオでは、このクラスによって、一般的なプロファイル (**[CreateAvi](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_CreateAvi_Windows_Media_MediaProperties_VideoEncodingQuality_)** や **[CreateMp3](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_CreateMp3_Windows_Media_MediaProperties_AudioEncodingQuality_)** など) を作成するための一連の静的メソッドが提供されます。</span><span class="sxs-lookup"><span data-stu-id="36625-127">For typical capture and transcoding scenarios, this class provides a set of static methods for creating common profiles, like **[CreateAvi](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_CreateAvi_Windows_Media_MediaProperties_VideoEncodingQuality_)** and **[CreateMp3](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_CreateMp3_Windows_Media_MediaProperties_AudioEncodingQuality_)**.</span></span> <span data-ttu-id="36625-128">この例では、Mpeg4 コンテナーと H264 ビデオ エンコードを使用して、エンコード プロファイルを手動で作成します。</span><span class="sxs-lookup"><span data-stu-id="36625-128">For this example, an encoding profile is manually created using an Mpeg4 container and H264 video encoding.</span></span> <span data-ttu-id="36625-129">ビデオ エンコードの設定は、**[VideoEncodingProperties](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.videoencodingproperties)** オブジェクトを使用して指定します。</span><span class="sxs-lookup"><span data-stu-id="36625-129">Video encoding settings are specified using a **[VideoEncodingProperties](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.videoencodingproperties)** object.</span></span> <span data-ttu-id="36625-130">このシナリオで使用される各カラー カメラに対して、**VideoStreamDescriptor** オブジェクトを構成します。</span><span class="sxs-lookup"><span data-stu-id="36625-130">For each color camera used in this scenario, a **VideoStreamDescriptor** object is configured.</span></span> <span data-ttu-id="36625-131">記述子は、エンコードを指定する **VideoEncodingProperties** オブジェクトを使用して作成されます。</span><span class="sxs-lookup"><span data-stu-id="36625-131">The descriptor is constructed with the **VideoEncodingProperties** object specifying the encoding.</span></span> <span data-ttu-id="36625-132">**VideoStreamDescriptor** の **[Label](https://docs.microsoft.com/uwp/api/windows.media.core.videostreamdescriptor#Windows_Media_Core_VideoStreamDescriptor_Label)** プロパティは、ストリームにキャプチャされるメディア フレーム ソースの ID に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36625-132">The **[Label](https://docs.microsoft.com/uwp/api/windows.media.core.videostreamdescriptor#Windows_Media_Core_VideoStreamDescriptor_Label)** property of the **VideoStreamDescriptor** must be set to the ID of the media frame source that will be captured to the stream.</span></span> <span data-ttu-id="36625-133">この方法によって、キャプチャ パイプラインは、どのストリーム記述子とエンコード プロパティが各カメラで使用されるかを識別します。</span><span class="sxs-lookup"><span data-stu-id="36625-133">This is how the capture pipeline knows which stream descriptor and encoding properties should be used for each camera.</span></span> <span data-ttu-id="36625-134">フレーム ソースの ID は、**MediaFrameSourceGroup** が選択されたときに、**[MediaFrameSourceInfo](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourceinfo)** オブジェクト (前のセクションをご覧ください) によって公開されます。</span><span class="sxs-lookup"><span data-stu-id="36625-134">The ID of the frame source is exposed by the **[MediaFrameSourceInfo](https://docs.microsoft.com/uwp/api/windows.media.capture.frames.mediaframesourceinfo)** objects that were found in the previous section, when a **MediaFrameSourceGroup** was selected.</span></span>


<span data-ttu-id="36625-135">RS3 以降では、**[SetVideoTracks](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_SetVideoTracks_Windows_Foundation_Collections_IIterable_Windows_Media_Core_VideoStreamDescriptor__)** を呼び出すことによって、**MediaEncodingProfile** に対して複数のエンコード プロパティを設定できます。</span><span class="sxs-lookup"><span data-stu-id="36625-135">Starting with RS3, you can set multiple encoding properties on a **MediaEncodingProfile** by calling **[SetVideoTracks](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_SetVideoTracks_Windows_Foundation_Collections_IIterable_Windows_Media_Core_VideoStreamDescriptor__)**.</span></span> <span data-ttu-id="36625-136">ビデオ ストリーム記述子の一覧は、**[GetVideoTracks](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_GetVideoTracks)** を呼び出して取得することができます。</span><span class="sxs-lookup"><span data-stu-id="36625-136">You can retrieve the list of video stream descriptors by calling **[GetVideoTracks](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_GetVideoTracks)**.</span></span> <span data-ttu-id="36625-137">1 つのストリーム記述子を格納する **[Video](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_Video)** プロパティを設定した場合、**SetVideoTracks** を呼び出して設定した記述子の一覧は、指定した 1 つの記述子を含んでいる一覧に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="36625-137">Note that if you set the **[Video](https://docs.microsoft.com/uwp/api/windows.media.mediaproperties.mediaencodingprofile#Windows_Media_MediaProperties_MediaEncodingProfile_Video)** property, which stores a single stream descriptor, the descriptor list you set by calling **SetVideoTracks** will be replaced with a list containing the single descriptor you specified.</span></span>


[!code-cs[MultiRecordMediaEncodingProfile](./code/SimpleCameraPreview_Win10/cs/MainPage.MultiRecord.xaml.cs#SnippetMultiRecordMediaEncodingProfile)]

## <a name="record-using-the-multi-stream-mediaencodingprofile"></a><span data-ttu-id="36625-138">マルチストリームの MediaEncodingProfile を使用して録画する</span><span class="sxs-lookup"><span data-stu-id="36625-138">Record using the multi-stream MediaEncodingProfile</span></span>
<span data-ttu-id="36625-139">この例の最期の手順では、キャプチャしたメディアが書き込まれる **StorageFile** と前のコード例で作成した **MediaEncodingProfile** を渡して **[StartRecordToStorageFileAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_StartRecordToStorageFileAsync_Windows_Media_MediaProperties_MediaEncodingProfile_Windows_Storage_IStorageFile_)** を呼び出し、ビデオ キャプチャを開始します。</span><span class="sxs-lookup"><span data-stu-id="36625-139">The final step in this example is to initiate video capture by calling **[StartRecordToStorageFileAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_StartRecordToStorageFileAsync_Windows_Media_MediaProperties_MediaEncodingProfile_Windows_Storage_IStorageFile_)**, passing in the **StorageFile** to which the captured media is written, and the **MediaEncodingProfile** created in the previous code example.</span></span> <span data-ttu-id="36625-140">数秒待機した後で、**[StopRecordAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_StopRecordAsync)** が呼び出され録画が停止します。</span><span class="sxs-lookup"><span data-stu-id="36625-140">After waiting a few seconds, the recording is stopped with a call to **[StopRecordAsync](https://docs.microsoft.com/uwp/api/windows.media.capture.mediacapture#Windows_Media_Capture_MediaCapture_StopRecordAsync)**.</span></span>

[!code-cs[MultiRecordToFile](./code/SimpleCameraPreview_Win10/cs/MainPage.MultiRecord.xaml.cs#SnippetMultiRecordToFile)]

<span data-ttu-id="36625-141">操作が完了すると、各カメラからキャプチャしたビデオを含むビデオ ファイルが作成されます。このファイルでは、それぞれのビデオが個別のストリームとしてエンコードされています。</span><span class="sxs-lookup"><span data-stu-id="36625-141">When the operation is complete, a video file will have been created that contains the video captured from each camera encoded as a separate stream within the file.</span></span> <span data-ttu-id="36625-142">複数のビデオ トラックが含まれているメディア ファイルを再生する方法について詳しくは、「[メディア項目、プレイリスト、トラック](media-playback-with-mediasource.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36625-142">For information on playing media files containing multiple video tracks, see [Media items, playlists, and tracks](media-playback-with-mediasource.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="36625-143">関連トピック</span><span class="sxs-lookup"><span data-stu-id="36625-143">Related topics</span></span>

* [<span data-ttu-id="36625-144">カメラ</span><span class="sxs-lookup"><span data-stu-id="36625-144">Camera</span></span>](camera.md)
* [<span data-ttu-id="36625-145">MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ</span><span class="sxs-lookup"><span data-stu-id="36625-145">Basic photo, video, and audio capture with MediaCapture</span></span>](basic-photo-video-and-audio-capture-with-MediaCapture.md)
* [<span data-ttu-id="36625-146">MediaFrameReader を使ったメディア フレームの処理</span><span class="sxs-lookup"><span data-stu-id="36625-146">Process media frames with MediaFrameReader</span></span>](process-media-frames-with-mediaframereader.md)
* [<span data-ttu-id="36625-147">メディア項目、プレイリスト、トラック</span><span class="sxs-lookup"><span data-stu-id="36625-147">Media items, playlists, and tracks</span></span>](media-playback-with-mediasource.md)


 

 




