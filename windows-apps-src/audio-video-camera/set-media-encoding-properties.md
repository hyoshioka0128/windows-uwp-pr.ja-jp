---
ms.assetid: 09BA9250-A476-4803-910E-52F0A51704B1
description: この記事では、IMediaEncodingProperties インターフェイスを使用して、カメラのプレビュー ストリームとキャプチャした写真/ビデオの解像度およびフレーム レートを設定する方法を説明します。
title: MediaCapture の形式、解像度、およびフレーム レートの設定
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: f81ab1ef635bf4cfb20c289d6998c242f7aa47fc
ms.sourcegitcommit: b11f305dbf7649c4b68550b666487c77ea30d98f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/27/2018
ms.locfileid: "7836214"
---
# <a name="set-format-resolution-and-frame-rate-for-mediacapture"></a><span data-ttu-id="397df-104">MediaCapture の形式、解像度、およびフレーム レートの設定</span><span class="sxs-lookup"><span data-stu-id="397df-104">Set format, resolution, and frame rate for MediaCapture</span></span>



<span data-ttu-id="397df-105">この記事では、[**IMediaEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701011) インターフェイスを使用して、カメラのプレビュー ストリームとキャプチャした写真/ビデオの解像度およびフレーム レートを設定する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="397df-105">This article shows you how to use the [**IMediaEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701011) interface to set the resolution and frame rate of the camera preview stream and captured photos and video.</span></span> <span data-ttu-id="397df-106">プレビュー ストリームの縦横比をキャプチャしたメディアの縦横比と一致させる方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="397df-106">It also shows how to ensure that the aspect ratio of the preview stream matches that of the captured media.</span></span>

<span data-ttu-id="397df-107">カメラ プロファイルは、カメラのストリーム プロパティを検出および設定するための高度な方法ですが、すべてのデバイスではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="397df-107">Camera profiles offer a more advanced way of discovering and setting the stream properties of the camera, but they are not supported for all devices.</span></span> <span data-ttu-id="397df-108">詳しくは、「[カメラ プロファイル](camera-profiles.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="397df-108">For more information, see [Camera profiles](camera-profiles.md).</span></span>

<span data-ttu-id="397df-109">この記事のコードは、[CameraResolution サンプル](http://go.microsoft.com/fwlink/p/?LinkId=624252&clcid=0x409)を基にしています。</span><span class="sxs-lookup"><span data-stu-id="397df-109">The code in this article was adapted from the [CameraResolution sample](http://go.microsoft.com/fwlink/p/?LinkId=624252&clcid=0x409).</span></span> <span data-ttu-id="397df-110">このサンプルをダウンロードし、該当するコンテキストで使用されているコードを確認することも、サンプルを独自のアプリの開始点として使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="397df-110">You can download the sample to see the code used in context or to use the sample as a starting point for your own app.</span></span>

> [!NOTE] 
> <span data-ttu-id="397df-111">この記事の内容は、写真やビデオの基本的なキャプチャ機能を実装するための手順を紹介した「[MediaCapture を使った基本的な写真、ビデオ、およびオーディオのキャプチャ](basic-photo-video-and-audio-capture-with-MediaCapture.md)」で取り上げた概念やコードに基づいています。</span><span class="sxs-lookup"><span data-stu-id="397df-111">This article builds on concepts and code discussed in [Basic photo, video, and audio capture with MediaCapture](basic-photo-video-and-audio-capture-with-MediaCapture.md), which describes the steps for implementing basic photo and video capture.</span></span> <span data-ttu-id="397df-112">そちらの記事で基本的なメディア キャプチャのパターンを把握してから、高度なキャプチャ シナリオに進むことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="397df-112">It is recommended that you familiarize yourself with the basic media capture pattern in that article before moving on to more advanced capture scenarios.</span></span> <span data-ttu-id="397df-113">この記事で紹介しているコードは、MediaCapture のインスタンスが既に作成され、適切に初期化されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="397df-113">The code in this article assumes that your app already has an instance of MediaCapture that has been properly initialized.</span></span>

## <a name="a-media-encoding-properties-helper-class"></a><span data-ttu-id="397df-114">メディア エンコード プロパティのヘルパー クラス</span><span class="sxs-lookup"><span data-stu-id="397df-114">A media encoding properties helper class</span></span>

<span data-ttu-id="397df-115">[**IMediaEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701011) インターフェイスの機能をラップする単純なヘルパー クラスを作成すると、特定の条件を満たす一連のエンコード プロパティを容易に選択できます。</span><span class="sxs-lookup"><span data-stu-id="397df-115">Creating a simple helper class to wrap the functionality of the [**IMediaEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701011) interface makes it easier to select a set of encoding properties that meet particular criteria.</span></span> <span data-ttu-id="397df-116">特に、エンコード プロパティの機能の次のような動作に対して、このヘルパー クラスが便利です。</span><span class="sxs-lookup"><span data-stu-id="397df-116">This helper class is particularly useful due to the following behavior of the encoding properties feature:</span></span>

<span data-ttu-id="397df-117">**警告** 、 [**VideoDeviceController.GetAvailableMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211994)メソッド**VideoRecord**や**写真**など、 [**MediaStreamType**](https://msdn.microsoft.com/library/windows/apps/br226640)列挙のメンバーを受け取り、どちら[**の一覧を返しますImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993)またはストリームを伝える[**VideoEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701217)オブジェクトがキャプチャした写真やビデオの解像度などの設定をエンコードします。</span><span class="sxs-lookup"><span data-stu-id="397df-117">**Warning** The [**VideoDeviceController.GetAvailableMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211994) method takes a member of the [**MediaStreamType**](https://msdn.microsoft.com/library/windows/apps/br226640) enumeration, such as **VideoRecord** or **Photo**, and returns a list of either [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993) or [**VideoEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701217) objects that convey the stream encoding settings, such as the resolution of the captured photo or video.</span></span> <span data-ttu-id="397df-118">指定された **MediaStreamType** 値に関係なく、**GetAvailableMediaStreamProperties** を呼び出した結果には、**ImageEncodingProperties** または **VideoEncodingProperties** が含まれている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="397df-118">The results of calling **GetAvailableMediaStreamProperties** may include **ImageEncodingProperties** or **VideoEncodingProperties** regardless of what **MediaStreamType** value is specified.</span></span> <span data-ttu-id="397df-119">このため、いずれかのプロパティ値にアクセスする前に、常に各戻り値の型を確認し、適切な型にキャストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="397df-119">For this reason, you should always check the type of each returned value and cast it to the appropriate type before attempting to access any of the property values.</span></span>

<span data-ttu-id="397df-120">次に示すヘルパー クラスでは、型の確認と [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993) または [**VideoEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701217) へのキャストを処理しています。これにより、アプリのコードでは、2 つの型を区別する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="397df-120">The helper class defined below handles the type checking and casting for [**ImageEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh700993) or [**VideoEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701217) so that your app code doesn't need to distinguish between the two types.</span></span> <span data-ttu-id="397df-121">これに加えて、ヘルパー クラスは、プロパティの縦横比、フレーム レート (ビデオ エンコード プロパティの場合のみ)、アプリの UI でエンコード プロパティをわかりやすく表示するためのフレンドリ名を使用できるように、プロパティを公開します。</span><span class="sxs-lookup"><span data-stu-id="397df-121">In addition to this, the helper class exposes properties for the aspect ratio of the properties, the frame rate (for video encoding properties only), and a friendly name that makes it easier to display the encoding properties in the app's UI.</span></span>

<span data-ttu-id="397df-122">ヘルパー クラスのソース ファイルには、[**Windows.Media.MediaProperties**](https://msdn.microsoft.com/library/windows/apps/hh701296) 名前空間を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="397df-122">You must include the [**Windows.Media.MediaProperties**](https://msdn.microsoft.com/library/windows/apps/hh701296) namespace in the source file for the helper class.</span></span>

[!code-cs[MediaEncodingPropertiesUsing](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetMediaEncodingPropertiesUsing)]

[!code-cs[StreamPropertiesHelper](./code/BasicMediaCaptureWin10/cs/StreamPropertiesHelper.cs#SnippetStreamPropertiesHelper)]

## <a name="determine-if-the-preview-and-capture-streams-are-independent"></a><span data-ttu-id="397df-123">プレビュー ストリームとキャプチャ ストリームの独立性の判断</span><span class="sxs-lookup"><span data-stu-id="397df-123">Determine if the preview and capture streams are independent</span></span>

<span data-ttu-id="397df-124">デバイスによっては、プレビュー ストリームとキャプチャ ストリームに同じハードウェア ピンが使用されることがあります。</span><span class="sxs-lookup"><span data-stu-id="397df-124">On some devices, the same hardware pin is used for both preview and capture streams.</span></span> <span data-ttu-id="397df-125">このようなデバイスでは、一方のエンコード プロパティを設定すると、他方も設定されます。</span><span class="sxs-lookup"><span data-stu-id="397df-125">On these devices, setting the encoding properties of one will also set the other.</span></span> <span data-ttu-id="397df-126">キャプチャとプレビューに別々のハードウェア ピンが使用されるデバイスでは、ストリームごとのプロパティを個々に設定できます。</span><span class="sxs-lookup"><span data-stu-id="397df-126">On devices that use different hardware pins for capture and preview, the properties can be set for each stream independently.</span></span> <span data-ttu-id="397df-127">プレビュー ストリームとキャプチャ ストリームが独立しているかどうかを判断するには、次のコードを使用します。</span><span class="sxs-lookup"><span data-stu-id="397df-127">Use the following code to determine if the preview and capture streams are independent.</span></span> <span data-ttu-id="397df-128">このテストの結果に基づいて UI を調整し、ストリームの設定を個々に有効化または無効化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="397df-128">You should adjust your UI to enable or disable the setting of the streams independently based on the result of this test.</span></span>

[!code-cs[CheckIfStreamsAreIdentical](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetCheckIfStreamsAreIdentical)]

## <a name="get-a-list-of-available-stream-properties"></a><span data-ttu-id="397df-129">利用可能なストリーム プロパティのリストの取得</span><span class="sxs-lookup"><span data-stu-id="397df-129">Get a list of available stream properties</span></span>

<span data-ttu-id="397df-130">キャプチャ デバイスについて利用可能なストリーム プロパティのリストを取得するには、アプリの [MediaCapture](capture-photos-and-video-with-mediacapture.md) オブジェクトの [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) を取得し、[**GetAvailableMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211994) を呼び出して、いずれか 1 つの [**MediaStreamType**](https://msdn.microsoft.com/library/windows/apps/br226640) 値 (**VideoPreview**、**VideoRecord**、**Photo**) を渡します。</span><span class="sxs-lookup"><span data-stu-id="397df-130">Get a list of the available stream properties for a capture device by getting the [**VideoDeviceController**](https://msdn.microsoft.com/library/windows/apps/br226825) for your app's [MediaCapture](capture-photos-and-video-with-mediacapture.md) object and then calling [**GetAvailableMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211994) and passing in one of the [**MediaStreamType**](https://msdn.microsoft.com/library/windows/apps/br226640) values, **VideoPreview**, **VideoRecord**, or **Photo**.</span></span> <span data-ttu-id="397df-131">この例では、**GetAvailableMediaStreamProperties** から返されたそれぞれの [**IMediaEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701011) 値に対し、この記事で定義した **StreamPropertiesHelper** オブジェクトのリストを Linq 構文で作成しています。</span><span class="sxs-lookup"><span data-stu-id="397df-131">In this example, Linq syntax is used to create a list of **StreamPropertiesHelper** objects, defined previously in this article, for each of the [**IMediaEncodingProperties**](https://msdn.microsoft.com/library/windows/apps/hh701011) values returned from **GetAvailableMediaStreamProperties**.</span></span> <span data-ttu-id="397df-132">この例では、まず Linq 拡張メソッドを使用して、返されたプロパティを解像度順のフレーム レート順に並べ替えます。</span><span class="sxs-lookup"><span data-stu-id="397df-132">This example first uses Linq extension methods to order the returned properties based first on resolution and then on frame rate.</span></span>

<span data-ttu-id="397df-133">アプリに、解像度またはフレーム レートに関する特定の要件がある場合は、メディア エンコード プロパティのセットをプログラムで選択できます。</span><span class="sxs-lookup"><span data-stu-id="397df-133">If your app has specific resolution or frame rate requirements, you can select a set of media encoding properties programmatically.</span></span> <span data-ttu-id="397df-134">一般的なカメラ アプリでは、目的の設定をユーザーが選択できるように、利用可能なプロパティのリストが UI で公開されます。</span><span class="sxs-lookup"><span data-stu-id="397df-134">A typical camera app will instead expose the list of available properties in the UI and allow the user to select their desired settings.</span></span> <span data-ttu-id="397df-135">**StreamPropertiesHelper** オブジェクトのリストにある各項目に対して、**ComboBoxItem** が作成されます。</span><span class="sxs-lookup"><span data-stu-id="397df-135">A **ComboBoxItem** is created for each item in the list of **StreamPropertiesHelper** objects in the list.</span></span> <span data-ttu-id="397df-136">コンテンツは、ヘルパー クラスから返されたフレンドリ名に設定されています。タグは、関連付けられているエンコード プロパティを後で取得できるように、ヘルパー クラス自体に設定されています。</span><span class="sxs-lookup"><span data-stu-id="397df-136">The content is set to the friendly name returned by the helper class and the tag is set to the helper class itself so it can be used later to retrieve the associated encoding properties.</span></span> <span data-ttu-id="397df-137">次に、メソッドに渡された **ComboBox** に、各 **ComboBoxItem** が追加されます。</span><span class="sxs-lookup"><span data-stu-id="397df-137">Each **ComboBoxItem** is then added to the **ComboBox** passed into the method.</span></span>

[!code-cs[PopulateStreamPropertiesUI](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetPopulateStreamPropertiesUI)]

## <a name="set-the-desired-stream-properties"></a><span data-ttu-id="397df-138">目的のストリーム プロパティを設定する</span><span class="sxs-lookup"><span data-stu-id="397df-138">Set the desired stream properties</span></span>

<span data-ttu-id="397df-139">目的のエンコード プロパティを使用するようにビデオ デバイスのコントローラーに指示するには、[**SetMediaStreamPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/hh700895) を呼び出します。このとき、写真、ビデオ、プレビューのうち、どのプロパティを設定するかを示す **MediaStreamType** 値を渡します。</span><span class="sxs-lookup"><span data-stu-id="397df-139">Tell the video device controller to use your desired encoding properties by calling [**SetMediaStreamPropertiesAsync**](https://msdn.microsoft.com/library/windows/apps/hh700895), passing in the **MediaStreamType** value indicating whether the photo, video, or preview properties should be set.</span></span> <span data-ttu-id="397df-140">この例では、**PopulateStreamPropertiesUI** ヘルパー メソッドによって設定されたいずれかの **ComboBox** オブジェクトからユーザーが項目を選択すると、要求されたエンコード プロパティが設定されます。</span><span class="sxs-lookup"><span data-stu-id="397df-140">This example sets the requested encoding properties when the user selects an item in one of the **ComboBox** objects populated with the **PopulateStreamPropertiesUI** helper method.</span></span>

[!code-cs[PreviewSettingsChanged](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetPreviewSettingsChanged)]

[!code-cs[PhotoSettingsChanged](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetPhotoSettingsChanged)]

[!code-cs[VideoSettingsChanged](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetVideoSettingsChanged)]

## <a name="match-the-aspect-ratio-of-the-preview-and-capture-streams"></a><span data-ttu-id="397df-141">プレビューとキャプチャ ストリームの縦横比を一致させる</span><span class="sxs-lookup"><span data-stu-id="397df-141">Match the aspect ratio of the preview and capture streams</span></span>

<span data-ttu-id="397df-142">一般的なカメラ アプリでは、ユーザーがビデオや写真のキャプチャ解像度を選択するための UI を提供することも、プログラムによってプレビュー解像度を設定することもあります。</span><span class="sxs-lookup"><span data-stu-id="397df-142">A typical camera app will provide UI for the user to select the video or photo capture resolution but will programmatically set the preview resolution.</span></span> <span data-ttu-id="397df-143">アプリの最適なプレビュー ストリーム解像度を選択するための方法はいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="397df-143">There are a few different strategies for selecting the best preview stream resolution for your app:</span></span>

-   <span data-ttu-id="397df-144">UI フレームワークで必要なプレビューのスケーリングを実行できるように、利用可能な最高のプレビュー解像度を選択します。</span><span class="sxs-lookup"><span data-stu-id="397df-144">Select the highest available preview resolution, letting the UI framework perform any necessary scaling of the preview.</span></span>

-   <span data-ttu-id="397df-145">最終的にキャプチャされたメディアに最も近い表現がプレビューに表示されるように、キャプチャ解像度に最も近いプレビュー解像度を選択します。</span><span class="sxs-lookup"><span data-stu-id="397df-145">Select the preview resolution closest to the capture resolution so that the preview displays the closest representation to the final captured media.</span></span>

-   <span data-ttu-id="397df-146">必要以上のピクセルがプレビュー ストリーム パイプラインを通過しないように、[**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/br209278) のサイズに最も近いプレビュー解像度を選択します。</span><span class="sxs-lookup"><span data-stu-id="397df-146">Select the preview resolution closest to the size of the [**CaptureElement**](https://msdn.microsoft.com/library/windows/apps/br209278) so that no more pixels than necessary are going through the preview stream pipeline.</span></span>

<span data-ttu-id="397df-147">**重要な**をカメラのプレビュー ストリームの縦横比が異なるを設定し、キャプチャ ストリームの一部のデバイスで変更することができます。</span><span class="sxs-lookup"><span data-stu-id="397df-147">**Important** It is possible, on some devices, to set a different aspect ratio for the camera's preview stream and capture stream.</span></span> <span data-ttu-id="397df-148">この不一致によってフレームのトリミングが生じた場合、プレビューで表示されなかったコンテンツがキャプチャしたメディアに存在するという結果を招く可能性があり、これは否定的なユーザー エクスペリエンスにつながります。</span><span class="sxs-lookup"><span data-stu-id="397df-148">Frame cropping caused by this mismatch can result in content being present in the captured media that was not visible in the preview which can result in a negative user experience.</span></span> <span data-ttu-id="397df-149">プレビュー ストリームとキャプチャ ストリームには、微小な公差範囲内で同一の縦横比を使用することを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="397df-149">It is strongly recommended that you use the same aspect ratio, within a small tolerance window, for the preview and capture streams.</span></span> <span data-ttu-id="397df-150">縦横比がほぼ一致していれば、キャプチャとプレビューにまったく異なる解像度を有効にしても問題ありません。</span><span class="sxs-lookup"><span data-stu-id="397df-150">It is fine to have entirely different resolutions enabled for capture and preview as long as the aspect ratio match closely.</span></span>


<span data-ttu-id="397df-151">写真やビデオのキャプチャ ストリームをプレビュー ストリームの縦横比に一致させるために、この例では [**VideoDeviceController.GetMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211995) を呼び出し、**VideoPreview** 列挙値を渡して、プレビュー ストリームの現在のストリーム プロパティを要求しています。</span><span class="sxs-lookup"><span data-stu-id="397df-151">To ensure that the photo or video capture streams match the aspect ratio of the preview stream, this example calls [**VideoDeviceController.GetMediaStreamProperties**](https://msdn.microsoft.com/library/windows/apps/br211995) and passes in the **VideoPreview** enum value to request the current stream properties for the preview stream.</span></span> <span data-ttu-id="397df-152">次に、プレビュー ストリームとまったく同じでなくても、近似値であれば、その縦横比を許容できるように、縦横比の微小な公差範囲を定義しています。</span><span class="sxs-lookup"><span data-stu-id="397df-152">Next a small aspect ratio tolerance window is defined so that we can include aspect ratios that are not exactly the same as the preview stream, as long as they are close.</span></span> <span data-ttu-id="397df-153">次に、プレビュー ストリームについて定義済みの公差範囲に縦横比が含まれるような **StreamPropertiesHelper** オブジェクトだけを選択できるように、Linq 拡張メソッドが使用されています。</span><span class="sxs-lookup"><span data-stu-id="397df-153">Next, a Linq extension method is used to select just the **StreamPropertiesHelper** objects where the aspect ratio is within the defined tolerance range of the preview stream.</span></span>

[!code-cs[MatchPreviewAspectRatio](./code/BasicMediaCaptureWin10/cs/MainPage.xaml.cs#SnippetMatchPreviewAspectRatio)]

 

 




