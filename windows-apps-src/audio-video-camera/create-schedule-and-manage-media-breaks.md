---
author: drewbatgit
ms.assetid: 0309c7a1-8e4c-4326-813a-cbd9f8b8300d
description: この記事では、メディア再生アプリ用にメディアの中断を作成、スケジュール、管理する方法について説明します。
title: メディアの中断の作成、スケジュール、管理
ms.author: drewbat
ms.date: 02/08/2017
ms.topic: article
keywords: Windows 10, UWP
ms.localizationpriority: medium
ms.openlocfilehash: 0feb7f6771254bf500e4b64fd0e632daad9817e4
ms.sourcegitcommit: 71e8eae5c077a7740e5606298951bb78fc42b22c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/13/2018
ms.locfileid: "6674673"
---
# <a name="create-schedule-and-manage-media-breaks"></a><span data-ttu-id="87b57-104">メディアの中断の作成、スケジュール、管理</span><span class="sxs-lookup"><span data-stu-id="87b57-104">Create, schedule, and manage media breaks</span></span>

<span data-ttu-id="87b57-105">この記事では、メディア再生アプリ用にメディアの中断を作成、スケジュール、管理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="87b57-105">This article shows you how to create, schedule, and manage media breaks to your media playback app.</span></span> <span data-ttu-id="87b57-106">通常、メディアの中断は、オーディオ広告やビデオ広告をメディア コンテンツに挿入する目的で使います。</span><span class="sxs-lookup"><span data-stu-id="87b57-106">Media breaks are typically used to insert audio or video ads into media content.</span></span> <span data-ttu-id="87b57-107">Windows 10 バージョン 1607 以降では、[**MediaBreakManager**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager) クラスを使って、[**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer) で再生する任意の [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem) にメディアの中断を簡単かつ迅速に追加できます。</span><span class="sxs-lookup"><span data-stu-id="87b57-107">Starting with Windows 10, version 1607, you can use the [**MediaBreakManager**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager) class to quickly and easily add media breaks to any [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem) that you play with a [**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer).</span></span>


<span data-ttu-id="87b57-108">メディアの中断を 1 つ以上スケジュールすると、再生中の指定した時間に、システムがメディア コンテンツを自動的に再生します。</span><span class="sxs-lookup"><span data-stu-id="87b57-108">After you schedule one or more media breaks, the system will automatically play your media content at the specified time during playback.</span></span> <span data-ttu-id="87b57-109">**MediaBreakManager** では、ユーザーがメディアを中断、終了、またはスキップしたときにアプリが反応できるように、イベントが提供されています。</span><span class="sxs-lookup"><span data-stu-id="87b57-109">The **MediaBreakManager** provides events so that your app can react when media breaks start, end, or when they are skipped by the user.</span></span> <span data-ttu-id="87b57-110">[**MediaPlaybackSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession) にアクセスしてメディアの中断を確認し、ダウンロードや進行状況の更新のバッファリングなどのイベントを監視することもできます。</span><span class="sxs-lookup"><span data-stu-id="87b57-110">You can also access a [**MediaPlaybackSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession) for your media breaks to monitor events such as download and buffering progress updates.</span></span>

## <a name="schedule-media-breaks"></a><span data-ttu-id="87b57-111">メディアの中断のスケジュール</span><span class="sxs-lookup"><span data-stu-id="87b57-111">Schedule media breaks</span></span>
<span data-ttu-id="87b57-112">各 **MediaPlaybackItem** オブジェクトには、アイテムの再生時に再生されるメディアの中断の構成に使う独自の [**MediaBreakSchedule**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule) があります。</span><span class="sxs-lookup"><span data-stu-id="87b57-112">Every **MediaPlaybackItem** object has its own [**MediaBreakSchedule**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule) that you use to configure the media breaks that will play when the item is played.</span></span> <span data-ttu-id="87b57-113">アプリでメディアの中断を使うための最初の手順は、メイン再生コンテンツ用の [ **MediaPlaybackItem** ](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem) の作成です。</span><span class="sxs-lookup"><span data-stu-id="87b57-113">The first step for using media breaks in your app is to create a [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem) for your main playback content.</span></span> 

[!code-cs[MoviePlaybackItem](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetMoviePlaybackItem)]

<span data-ttu-id="87b57-114">**MediaPlaybackItem**、[**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackList)、他の基本的なメディアの再生 API の操作の参照については、「[メディア項目、プレイリスト、トラック](media-playback-with-mediasource.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="87b57-114">For more information about working with **MediaPlaybackItem**, [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackList) and other fundamental media playback APIs, see [Media items, playlists, and tracks](media-playback-with-mediasource.md).</span></span>

<span data-ttu-id="87b57-115">次の例は、**MediaPlaybackItem** にプリロール区切りを追加する方法を示しています。これは、区切りが属する再生アイテムを再生する前に、システムがメディアの中断を再生することを意味します。</span><span class="sxs-lookup"><span data-stu-id="87b57-115">The next example shows how to add a preroll break to the **MediaPlaybackItem**, which means that the system will play the media break before playing the playback item to which the break belongs.</span></span> <span data-ttu-id="87b57-116">まず、新しい [**MediaBreak** ](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreak) オブジェクトがインスタンス化されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-116">First a new [**MediaBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreak) object is instantiated.</span></span> <span data-ttu-id="87b57-117">この例では、コンストラクター [**MediaBreakInsertionMethod.Interrupt**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakInsertionMethod) と共に呼び出されます。つまり、区切りコンテンツの再生中はメイン コンテンツが一時停止されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-117">In this example, the constructor is called with [**MediaBreakInsertionMethod.Interrupt**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakInsertionMethod), meaning that the main content will be paused while the break content is played.</span></span> 

<span data-ttu-id="87b57-118">次に、区切り中に再生されるコンテンツ (広告など) 用に新しい **MediaPlaybackItem** が作成されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-118">Next, a new **MediaPlaybackItem** is created for the content that will be played during the break, such as an ad.</span></span> <span data-ttu-id="87b57-119">この再生アイテムの [**CanSkip**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.CanSkip) プロパティは false に設定されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-119">The [**CanSkip**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.CanSkip) property of this playback item is set to false.</span></span> <span data-ttu-id="87b57-120">つまり、ユーザーは組み込みのメディア コントロールを使ってアイテムをスキップできません。</span><span class="sxs-lookup"><span data-stu-id="87b57-120">This means that the user will not be able to skip the item using the built-in media controls.</span></span> <span data-ttu-id="87b57-121">ただし、[**SkipCurrentBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.SkipCurrentBreak) を呼び出すことで、広告をプログラムによりスキップすることを選ぶことはできます。</span><span class="sxs-lookup"><span data-stu-id="87b57-121">Your app can still choose to skip the add programatically by calling [**SkipCurrentBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.SkipCurrentBreak).</span></span> 

<span data-ttu-id="87b57-122">メディアの中断の [**PlaybackList**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreak.PlaybackList) プロパティは、複数のメディア アイテムをプレイリストとして再生できるようにする [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackList) です。</span><span class="sxs-lookup"><span data-stu-id="87b57-122">The media break's [**PlaybackList**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreak.PlaybackList) property is a [**MediaPlaybackList**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackList) that allows you to play multiple media items as a playlist.</span></span> <span data-ttu-id="87b57-123">一覧の **Items** コレクションから 1 つまたは複数の **MediaPlaybackItem** オブジェクトを追加し、メディアの中断のプレイリストに含めます。</span><span class="sxs-lookup"><span data-stu-id="87b57-123">Add one or more **MediaPlaybackItem** objects from the list's **Items** collection to include them in the media break's playlist.</span></span>

<span data-ttu-id="87b57-124">最後に、メイン コンテンツ再生アイテムの [ **BreakSchedule** ](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.BreakSchedule) プロパティを使ってメディアの中断をスケジュールします。</span><span class="sxs-lookup"><span data-stu-id="87b57-124">Finally, schedule the media break by using the main content playback item's [**BreakSchedule**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.BreakSchedule) property.</span></span> <span data-ttu-id="87b57-125">プリロール区切りにする中断を、スケジュール オブジェクトの [ **PrerollBreak** ](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.PrerollBreak) プロパティに割り当てることで指定します。</span><span class="sxs-lookup"><span data-stu-id="87b57-125">Specify the break to be a preroll break by assigning it to the [**PrerollBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.PrerollBreak) property of the schedule object.</span></span>

[!code-cs[PreRollBreak](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetPreRollBreak)]

<span data-ttu-id="87b57-126">これで、メイン メディア アイテムを再生できるようになりました。作成したメディアの中断は、メイン コンテンツの前に再生されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-126">Now you can play back the main media item, and the media break that you created will play before the main content.</span></span> <span data-ttu-id="87b57-127">新しい [**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer) オブジェクトを作成し、オプションで [**AutoPlay**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.AutoPlay) プロパティをtrue に設定して再生を自動的に開始します。</span><span class="sxs-lookup"><span data-stu-id="87b57-127">Create a new [**MediaPlayer**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer) object and optionally set the [**AutoPlay**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.AutoPlay) property to true to start playback automatically.</span></span> <span data-ttu-id="87b57-128">**MediaPlayer** の [**Source**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.Source) プロパティをメイン コンテンツ再生アイテムに設定します。</span><span class="sxs-lookup"><span data-stu-id="87b57-128">Set the [**Source**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.Source) property of the **MediaPlayer** to your main content playback item.</span></span> <span data-ttu-id="87b57-129">必須ではありませんが、**MediaPlayer** を [**MediaPlayerElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement) に割り当てて XAML ページでメディアをレンダリングできます。</span><span class="sxs-lookup"><span data-stu-id="87b57-129">It's not required, but you can assign the **MediaPlayer** to a [**MediaPlayerElement**](https://msdn.microsoft.com/library/windows/apps/Windows.UI.Xaml.Controls.MediaPlayerElement) to render the media in a XAML page.</span></span> <span data-ttu-id="87b57-130">**MediaPlayer** の使い方の詳細については、「[MediaPlayer を使ったオーディオとビデオの再生](play-audio-and-video-with-mediaplayer.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="87b57-130">For more information about using **MediaPlayer**, see [Play audio and video with MediaPlayer](play-audio-and-video-with-mediaplayer.md).</span></span>

[!code-cs[Play](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetPlay)]

<span data-ttu-id="87b57-131">プリロール区切りを同じ手法を使って、メイン コンテンツを含む **MediaPlaybackItem** の再生が終わったら再生されるポストロール区切りを追加します。ただし、**MediaBreak** オブジェクトを[**PostrollBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.PostrollBreak) プロパティに再生する点が異なります。</span><span class="sxs-lookup"><span data-stu-id="87b57-131">Add a postroll break that plays after the **MediaPlaybackItem** containing your main content finishes playing, by using the same technique as a preroll break, except that you assign your **MediaBreak** object to the [**PostrollBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.PostrollBreak) property.</span></span>

[!code-cs[PostRollBreak](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetPostRollBreak)]

<span data-ttu-id="87b57-132">メイン コンテンツの再生中の指定した時点で再生されるミッドロール区切りを 1 つ以上スケジュールすることもできます。</span><span class="sxs-lookup"><span data-stu-id="87b57-132">You can also schedule one or more midroll breaks that play at a specified time within the playback of the main content.</span></span> <span data-ttu-id="87b57-133">次の例では、メイン メディア アイテムの再生中に区切りが生成される時間を指定する **TimeSpan** オブジェクトを受け入れるコンストラクター オーバーロードを使って [**MediaBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreak) が作成されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-133">In the following example, the [**MediaBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreak) is created with the constructor overload that accepts a **TimeSpan** object, which specifies the time within the playback of the main media item when the break will be played.</span></span> <span data-ttu-id="87b57-134">ここでも、[**MediaBreakInsertionMethod.Interrupt**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakInsertionMethod) が指定され、区切りの生成中にメイン コンテンツの再生が一時停止されることが示されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-134">Again, [**MediaBreakInsertionMethod.Interrupt**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakInsertionMethod) is specified to indicate that the main content's playback will be paused while the break plays.</span></span> <span data-ttu-id="87b57-135">[**InsertMidrollBreak**](https://msdn.microsoft.com/library/windows/apps/mt670692) を呼び出すことで、ミッドロール区切りがスケジュールに追加されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-135">The midroll break is added to the schedule by calling [**InsertMidrollBreak**](https://msdn.microsoft.com/library/windows/apps/mt670692).</span></span> <span data-ttu-id="87b57-136">[**MidrollBreaks**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.MidrollBreaks) プロパティにアクセスすることで、スケジュールに含まれている現在のミッドロール区切りの読み取り専用一覧を取得できます。</span><span class="sxs-lookup"><span data-stu-id="87b57-136">You can get a read-only list of the current midroll breaks in the schedule by accessing the [**MidrollBreaks**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.MidrollBreaks) property.</span></span>

[!code-cs[MidrollBreak](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetMidrollBreak)]

<span data-ttu-id="87b57-137">次のミッドロール区切りの例では、[**MediaBreakInsertionMethod.Replace**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakInsertionMethod) 挿入メソッドを使います。つまり、区切りの再生中もメイン コンテンツの再生が続けられます。</span><span class="sxs-lookup"><span data-stu-id="87b57-137">The next midroll break example shown uses the [**MediaBreakInsertionMethod.Replace**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakInsertionMethod) insertion method, which means that the system will continue processing the main content while the break is playing.</span></span> <span data-ttu-id="87b57-138">このオプションは通常、広告の再生中にライブ ストリームを一時停止して遅れを生じさせたくないライブ ストリーミング メディア アプリにより使われます。</span><span class="sxs-lookup"><span data-stu-id="87b57-138">This option is typically used by live streaming media apps where you don't want the content to pause and fall behind the live stream while the ad is played.</span></span> 

<span data-ttu-id="87b57-139">この例では、2 つの [**TimeSpan**](https://msdn.microsoft.com/library/windows/apps/Windows.Foundation.TimeSpan) パラメーターを受け入れる [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem) コンストラクターのオーバーロードも使います。</span><span class="sxs-lookup"><span data-stu-id="87b57-139">This example also uses an overload of the [**MediaPlaybackItem**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem) constructor that accepts two [**TimeSpan**](https://msdn.microsoft.com/library/windows/apps/Windows.Foundation.TimeSpan) parameters.</span></span> <span data-ttu-id="87b57-140">最初のパラメーターは、メディアの中断アイテム内の、再生が開始される開始点を指定します。</span><span class="sxs-lookup"><span data-stu-id="87b57-140">The first parameter specifies the starting point within the media break item where playback will begin.</span></span> <span data-ttu-id="87b57-141">2 番目のパラメーターは、メディアの中断アイテムが再生される時間の長さを指定します。</span><span class="sxs-lookup"><span data-stu-id="87b57-141">The second parameter specifies the duration for which the media break item will be played.</span></span> <span data-ttu-id="87b57-142">したがって、次の例では、20 分の時点でメイン コンテンツに対して **MediaBreak** が再生を開始します。</span><span class="sxs-lookup"><span data-stu-id="87b57-142">So, in the following example, the **MediaBreak** will begin playing at 20 minutes into the main content.</span></span> <span data-ttu-id="87b57-143">再生されると、区切りメディア アイテムの先頭から 30 秒後にメディア アイテムが開始され、15 秒間再生されてからメイン メディア コンテンツが再生を再開します。</span><span class="sxs-lookup"><span data-stu-id="87b57-143">When it plays, the media item will start 30 seconds from the beginning of the break media item and will play for 15 seconds before the main media content resumes playing.</span></span>

[!code-cs[MidrollBreak2](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetMidrollBreak2)]

## <a name="skip-media-breaks"></a><span data-ttu-id="87b57-144">メディアの中断のスキップ</span><span class="sxs-lookup"><span data-stu-id="87b57-144">Skip media breaks</span></span>
<span data-ttu-id="87b57-145">この記事で既に説明したように、**MediaPlaybackItem** の [**CanSkip**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.CanSkip) プロパティを設定し、ユーザーが組み込みコントロールを使ってコンテンツをスキップできないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="87b57-145">As mentioned previously in this article, the [**CanSkip**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.CanSkip) property of a **MediaPlaybackItem** can be set to prevent the user from skipping the content with the built-in controls.</span></span> <span data-ttu-id="87b57-146">ただし、いつでもコードから [**SkipCurrentBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.SkipCurrentBreak) を呼び出すと現在の中断をスキップできます。</span><span class="sxs-lookup"><span data-stu-id="87b57-146">However, you can call [**SkipCurrentBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.SkipCurrentBreak) from your code at any time to skip the current break.</span></span>

[!code-cs[SkipButtonClick](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetSkipButtonClick)]

## <a name="handle-mediabreak-events"></a><span data-ttu-id="87b57-147">MediaBreak イベントの処理</span><span class="sxs-lookup"><span data-stu-id="87b57-147">Handle MediaBreak events</span></span>

<span data-ttu-id="87b57-148">メディアの中断の状態の変化に基づいてアクションを実行するために登録できる、メディアの中断に関連するいくつかのイベントがあります。</span><span class="sxs-lookup"><span data-stu-id="87b57-148">There are several events related to media breaks that you can register for in order to take action based on the changing state of media breaks.</span></span>

[!code-cs[RegisterMediaBreakEvents](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetRegisterMediaBreakEvents)]

<span data-ttu-id="87b57-149">[**BreakStarted**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.BreakStarted) は、メディアの中断が開始すると発生します。</span><span class="sxs-lookup"><span data-stu-id="87b57-149">The [**BreakStarted**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.BreakStarted) is raised when a media break starts.</span></span> <span data-ttu-id="87b57-150">メディア コンテンツを再生していることがユーザーにわかるように UI を更新できます。</span><span class="sxs-lookup"><span data-stu-id="87b57-150">You may want to update your UI to let the user know that media break content is playing.</span></span> <span data-ttu-id="87b57-151">この例では、ハンドラーに渡された [**MediaBreakStartedEventArgs**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakStartedEventArgs) を使って、開始されたメディアの中断への参照を取得します。</span><span class="sxs-lookup"><span data-stu-id="87b57-151">This example uses the [**MediaBreakStartedEventArgs**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakStartedEventArgs) passed into the handler to get a reference to the media break that started.</span></span> <span data-ttu-id="87b57-152">次に、[**CurrentItemIndex**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackList.CurrentItemIndex) プロパティを使って、メディアの中断のプレイリストにある再生メディア アイテムが決定されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-152">Then the [**CurrentItemIndex**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackList.CurrentItemIndex) property is used to determine which media item in the media break's playlist is being played.</span></span> <span data-ttu-id="87b57-153">その後、UI が更新され、現在の広告インデックスと中断中の残りの広告数がユーザーに表示されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-153">Then the UI is updated to show the user the current ad index and the number of ads remaining in the break.</span></span> <span data-ttu-id="87b57-154">UI の更新は UI スレッドに加える必要があるため、[**RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317) の呼び出し内で呼び出しを行う必要がある点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="87b57-154">Remember that updates to the UI must be made on the UI thread, so the call should be made inside a call to [**RunAsync**](https://msdn.microsoft.com/library/windows/apps/hh750317).</span></span> 

[!code-cs[BreakStarted](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetBreakStarted)]

<span data-ttu-id="87b57-155">[**BreakEnded**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.BreakEnded) は、中断内のすべてのメディア アイテムが再生を終えるか、スキップされたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="87b57-155">[**BreakEnded**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.BreakEnded) is raised when all of the media items in the break have finished playing or have been skipped over.</span></span> <span data-ttu-id="87b57-156">このイベントのハンドラーを使って UI を更新し、メディアの中断コンテンツがそれ以上再生されないことを示すことができます。</span><span class="sxs-lookup"><span data-stu-id="87b57-156">You can use the handler for this event to update the UI to indicate that media break content is no longer playing.</span></span>

[!code-cs[BreakEnded](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetBreakEnded)]

<span data-ttu-id="87b57-157">**BreakSkipped** イベントは、[**CanSkip**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.CanSkip) が true になっているアイテムの再生中ユーザーが組み込み UI の *[次へ]* ボタンを押したとき、または [**SkipCurrentBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.SkipCurrentBreak) を呼び出すことでコードで中断をスキップしたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="87b57-157">The **BreakSkipped** event is raised when the user presses the *Next* button in the built-in UI during playback of an item for which [**CanSkip**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackItem.CanSkip) is true, or when you skip a break in your code by calling [**SkipCurrentBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.SkipCurrentBreak).</span></span>

<span data-ttu-id="87b57-158">次の例では、**MediaPlayer** の [**Source**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.Source) プロパティを使って、メイン コンテンツのメディア アイテムへの参照を取得します。</span><span class="sxs-lookup"><span data-stu-id="87b57-158">The following example uses the [**Source**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlayer.Source) property of the **MediaPlayer** to get a reference to the media item for the main content.</span></span> <span data-ttu-id="87b57-159">スキップされたメディアの中断は、このアイテムの中断スケジュールに属しています。</span><span class="sxs-lookup"><span data-stu-id="87b57-159">The skipped media break belongs to the break schedule of this item.</span></span> <span data-ttu-id="87b57-160">次に、スキップされたメディアの中断がスケジュールの [**PrerollBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.PrerollBreak) プロパティに設定されたメディアの中断と同じであるかどうかをコードがチェックします。</span><span class="sxs-lookup"><span data-stu-id="87b57-160">Next, the code checks to see if the media break that was skipped is the same as the media break set to the [**PrerollBreak**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSchedule.PrerollBreak) property of the schedule.</span></span> <span data-ttu-id="87b57-161">同じである場合、プリロール区切りがスキップされた中断であることを意味します。この場合、新しいミッドロール区切りが作成され、メイン コンテンツの 10 分の時点で再生されるようにスケジュールされます。</span><span class="sxs-lookup"><span data-stu-id="87b57-161">If so, this means that the preroll break was the break that was skipped, and in this case, a new midroll break is created and scheduled to play 10 minutes into the main content.</span></span>

[!code-cs[BreakSkipped](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetBreakSkipped)]

<span data-ttu-id="87b57-162">[**BreaksSeekedOver**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.BreaksSeekedOver) は、メイン メディア アイテムの再生位置が、1 つ以上のメディアの中断のスケジュールされた時間を超えたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="87b57-162">[**BreaksSeekedOver**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager.BreaksSeekedOver) is raised when the playback position of the main media item passes over the scheduled time for one or more media breaks.</span></span> <span data-ttu-id="87b57-163">次の例では、1 つ以上のメディアの中断が要求されたかどうか、再生位置が先に移動されたかどうか、先に移動された時間が 10 分未満であるかどうかがチェックされます。</span><span class="sxs-lookup"><span data-stu-id="87b57-163">The following example checks to see if more than one media break was seeked over, if the playback position was moved forward, and if it was moved forward less than 10 minutes.</span></span> <span data-ttu-id="87b57-164">その場合、要求された最初の中断 (イベント引数により開示された [**SeekedOverBreaks**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSeekedOverEventArgs.SeekedOverBreaks) コレクションから取得されます) が、**MediaPlayer.BreakManager** の [**PlayBreak**](https://msdn.microsoft.com/library/windows/apps/mt670689) メソッドを呼び出すことですぐに再生されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-164">If so, the first break that was seeked over, obtained from the [**SeekedOverBreaks**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakSeekedOverEventArgs.SeekedOverBreaks) collection exposed by the event args, is played immediately with a call to the [**PlayBreak**](https://msdn.microsoft.com/library/windows/apps/mt670689) method of the **MediaPlayer.BreakManager**.</span></span>

[!code-cs[BreakSeekedOver](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetBreakSeekedOver)]


## <a name="access-the-current-playback-session"></a><span data-ttu-id="87b57-165">現在の再生セッションへのアクセス</span><span class="sxs-lookup"><span data-stu-id="87b57-165">Access the current playback session</span></span>
<span data-ttu-id="87b57-166">[**MediaPlaybackSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession) オブジェクトは、**MediaPlayer** クラスを使って、現在再生中のメディア コンテンツに関連するデータとイベントを提供します。</span><span class="sxs-lookup"><span data-stu-id="87b57-166">The [**MediaPlaybackSession**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession) object uses the **MediaPlayer** class to provide data and events related to the currently playing media content.</span></span> <span data-ttu-id="87b57-167">[ **MediaBreakManager** ](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager) にも、再生中のメディアの中断コンテンツに特に関連するデータとイベントを取得するためにアクセスできる **MediaPlaybackSession** があります。</span><span class="sxs-lookup"><span data-stu-id="87b57-167">The [**MediaBreakManager**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaBreakManager) also has a **MediaPlaybackSession** that you can access to get data and events specifically related to the media break content that is being played.</span></span> <span data-ttu-id="87b57-168">再生セッションから入手できる情報には、現在の再生状態、再生中か一時停止中か、コンテンツ内の現在の再生位置などがあります。</span><span class="sxs-lookup"><span data-stu-id="87b57-168">Information you can get from the playback session includes the current playback state, playing or paused, and the current playback position within the content.</span></span> <span data-ttu-id="87b57-169">メディアの中断コンテンツの縦横比がメイン コンテンツと異なる場合、[**NaturalVideoWidth**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.NaturalVideoWidth) プロパティおよび [**NaturalVideoHeight**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.NaturalVideoHeight) プロパティと [**NaturalVideoSizeChanged**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.NaturalVideoSizeChanged) を使って、ビデオ UI を調整することができます。</span><span class="sxs-lookup"><span data-stu-id="87b57-169">You can use the [**NaturalVideoWidth**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.NaturalVideoWidth) and [**NaturalVideoHeight**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.NaturalVideoHeight) properties and the [**NaturalVideoSizeChanged**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.NaturalVideoSizeChanged) to adjust your video UI if the media break content has a different aspect ratio than your main content.</span></span> <span data-ttu-id="87b57-170">アプリのパフォーマンスに関する貴重な利用統計情報を示す、[**BufferingStarted**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.BufferingStarted)、[**BufferingEnded**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.BufferingEnded)、[**DownloadProgressChanged**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.DownloadProgressChanged) などのイベントを受け取ることもできます。</span><span class="sxs-lookup"><span data-stu-id="87b57-170">You can also receive events such as [**BufferingStarted**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.BufferingStarted), [**BufferingEnded**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.BufferingEnded), and [**DownloadProgressChanged**](https://msdn.microsoft.com/library/windows/apps/Windows.Media.Playback.MediaPlaybackSession.DownloadProgressChanged) that can provide valuable telemetry about the performance of your app.</span></span>

<span data-ttu-id="87b57-171">次の例では、**BufferingProgressChanged イベント**のハンドラーを登録します。イベント ハンドラーでは、UI が更新されて現在のバッファリングの進行状況が表示されます。</span><span class="sxs-lookup"><span data-stu-id="87b57-171">The following example registers a handler for the **BufferingProgressChanged event**; in the event handler, it updates the UI to show the current buffering progress.</span></span>

[!code-cs[RegisterBufferingProgressChanged](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetRegisterBufferingProgressChanged)]

[!code-cs[BufferingProgressChanged](./code/MediaBreaks_RS1/cs/MainPage.xaml.cs#SnippetBufferingProgressChanged)]

## <a name="related-topics"></a><span data-ttu-id="87b57-172">関連トピック</span><span class="sxs-lookup"><span data-stu-id="87b57-172">Related topics</span></span>
* [<span data-ttu-id="87b57-173">メディア再生</span><span class="sxs-lookup"><span data-stu-id="87b57-173">Media playback</span></span>](media-playback.md)
* [<span data-ttu-id="87b57-174">MediaPlayer を使ったオーディオとビデオの再生</span><span class="sxs-lookup"><span data-stu-id="87b57-174">Play audio and video with MediaPlayer</span></span>](play-audio-and-video-with-mediaplayer.md)
* [<span data-ttu-id="87b57-175">システム メディア トランスポート コントロールの手動制御</span><span class="sxs-lookup"><span data-stu-id="87b57-175">Manual control of the System Media Transport Controls</span></span>](system-media-transport-controls.md)

 

 




