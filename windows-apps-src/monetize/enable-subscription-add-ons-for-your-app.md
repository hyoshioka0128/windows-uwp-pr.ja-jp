---
author: Xansky
description: Windows.Services.Store 名前空間を使ってサブスクリプション アドオンを実装する方法について説明します。
title: アプリのサブスクリプション アドオンの有効化
keywords: Windows 10, UWP, サブスクリプション, アドオン, アプリ内購入, IAP, Windows.Services.Store
ms.author: mhopkins
ms.date: 12/06/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
ms.localizationpriority: medium
ms.openlocfilehash: 3575d4d30515a3c26bf99e1cc37afa3b98f4e7dc
ms.sourcegitcommit: 106aec1e59ba41aae2ac00f909b81bf7121a6ef1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/15/2018
ms.locfileid: "4612819"
---
# <a name="enable-subscription-add-ons-for-your-app"></a><span data-ttu-id="bc779-104">アプリのサブスクリプション アドオンの有効化</span><span class="sxs-lookup"><span data-stu-id="bc779-104">Enable subscription add-ons for your app</span></span>

<span data-ttu-id="bc779-105">ユニバーサル Windows プラットフォーム (UWP) アプリでは、ユーザーに*サブスクリプション* アドオンのアプリ内購入を提供できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-105">Your Universal Windows Platform (UWP) app can offer in-app purchases of *subscription* add-ons to your customers.</span></span> <span data-ttu-id="bc779-106">サブスクリプションを使用すると、自動の定期的な課金期間を設定してアプリ内でデジタル製品 (アプリの機能やデジタル コンテンツなど) を販売できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-106">You can use subscriptions to sell digital products in your app (such as app features or digital content) with automated recurring billing periods.</span></span>

> [!NOTE]
> <span data-ttu-id="bc779-107">アプリ内でサブスクリプション アドオンの購入を有効にするには、Visual Studio でプロジェクトが **Windows 10 Anniversary Edition (10.0、ビルド 14393)** またはそれ以降のリリース (これは、Windows 10 バージョン 1607 に対応) をターゲットにしている必要があります。また、**Windows.ApplicationModel.Store** 名前空間の代わりに、**Windows.Services.Store** 名前空間の API を使用して、アプリ内購入エクスペリエンスを実装している必要があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-107">To enable the purchase of subscription add-ons in your app, your project must target **Windows 10 Anniversary Edition (10.0; Build 14393)** or a later release in Visual Studio (this corresponds to Windows 10, version 1607), and it must use the APIs in the **Windows.Services.Store** namespace to implement the in-app purchase experience instead of the **Windows.ApplicationModel.Store** namespace.</span></span> <span data-ttu-id="bc779-108">これらの名前空間の違いについて詳しくは、「[アプリ内購入と試用版](in-app-purchases-and-trials.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bc779-108">For more information about the differences between these namespaces, see [In-app purchases and trials](in-app-purchases-and-trials.md).</span></span>

## <a name="feature-highlights"></a><span data-ttu-id="bc779-109">機能の概要</span><span class="sxs-lookup"><span data-stu-id="bc779-109">Feature highlights</span></span>

<span data-ttu-id="bc779-110">UWP アプリのサブスクリプション アドオンでは、次の機能をサポートします。</span><span class="sxs-lookup"><span data-stu-id="bc779-110">Subscription add-ons for UWP apps support the following features:</span></span>

* <span data-ttu-id="bc779-111">サブスクリプション期間を 1 か月、3 か月、6 か月、1 年、または 2 年から選択できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-111">You can choose from subscription periods of 1 month, 3 months, 6 months, 1 year, or 2 years.</span></span>
* <span data-ttu-id="bc779-112">サブスクリプションに 1 週間または 1 か月の無料試用期間を追加できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-112">You can add free trial periods of 1 week or 1 month to your subscription.</span></span>
* <span data-ttu-id="bc779-113">Windows SDK では、アプリで利用可能なサブスクリプション アドオンに関する情報を入手したり、サブスクリプション アドオンを購入できるようにしたりするためにアプリで利用できる [API を提供](#code-examples)しています。</span><span class="sxs-lookup"><span data-stu-id="bc779-113">The Windows SDK [provides APIs](#code-examples) you can use in your app to get info about available subscription add-ons for the app and enable the purchase of a subscription add-on.</span></span> <span data-ttu-id="bc779-114">また、サービスから呼び出して[ユーザーのサブスクリプションを管理](#manage-subscriptions)できる REST API も提供しています。</span><span class="sxs-lookup"><span data-stu-id="bc779-114">We also provide REST APIs you can call from your services to [manage subscriptions for a user](#manage-subscriptions).</span></span>
* <span data-ttu-id="bc779-115">サブスクリプションの取得数、アクティブなサブスクリプション会員数、および特定の期間中に取り消されたサブスクリプション数を表示する分析レポートを確認できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-115">You can view analytic reports that provide the number of subscription acquisitions, active subscribers, and canceled subscriptions in a given time period.</span></span>
* <span data-ttu-id="bc779-116">ユーザーは、自分の Microsoft アカウントの [http://account.microsoft.com/services](http://account.microsoft.com/services) ページでサブスクリプションを管理できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-116">Customers can manage their subscription on the [http://account.microsoft.com/services](http://account.microsoft.com/services) page for their Microsoft account.</span></span> <span data-ttu-id="bc779-117">ユーザーはこのページを使用して、取得したサブスクリプションすべての表示、サブスクリプションの取り消し、およびサブスクリプションに関連付けられた支払方法の変更ができます。</span><span class="sxs-lookup"><span data-stu-id="bc779-117">Customers can use this page to view all of the subscriptions they have acquired, cancel a subscription, and change the form of payment that is associated with their subscription.</span></span>

## <a name="steps-to-enable-a-subscription-add-on-for-your-app"></a><span data-ttu-id="bc779-118">アプリのサブスクリプション アドオンを有効化する手順</span><span class="sxs-lookup"><span data-stu-id="bc779-118">Steps to enable a subscription add-on for your app</span></span>

<span data-ttu-id="bc779-119">アプリでサブスクリプション アドオンを購入できるようにするには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="bc779-119">To enable the purchase of subscription add-ons in your app, follow these steps.</span></span>

1. <span data-ttu-id="bc779-120">デベロッパー センター ダッシュボードでサブスクリプションの[アドオンの申請を作成](../publish/add-on-submissions.md)し、申請を公開します。</span><span class="sxs-lookup"><span data-stu-id="bc779-120">[Create an add-on submission](../publish/add-on-submissions.md) for your subscription in the Dev Center dashboard and publish the submission.</span></span> <span data-ttu-id="bc779-121">アドオンの申請プロセスに従い、次のプロパティをよく確認します。</span><span class="sxs-lookup"><span data-stu-id="bc779-121">As you follow the add-on submission process, pay close attention to the following properties:</span></span>

    * <span data-ttu-id="bc779-122">[製品の種類](../publish/set-your-add-on-product-id.md#product-type): **[サブスクリプション]** を選択していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="bc779-122">[Product type](../publish/set-your-add-on-product-id.md#product-type): Make sure you select **Subscription**.</span></span>

    * <span data-ttu-id="bc779-123">[サブスクリプション期間](../publish/enter-add-on-properties.md#subscription-period): サブスクリプションの定期的な課金期間を選択します。</span><span class="sxs-lookup"><span data-stu-id="bc779-123">[Subscription period](../publish/enter-add-on-properties.md#subscription-period): Choose the recurring billing period for your subscription.</span></span> <span data-ttu-id="bc779-124">アドオンの公開後にサブスクリプション期間を変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="bc779-124">You cannot change the subscription period after you publish your add-on.</span></span>

        <span data-ttu-id="bc779-125">各サブスクリプション アドオンがサポートするのは、単一のサブスクリプション期間と試用期間だけです。</span><span class="sxs-lookup"><span data-stu-id="bc779-125">Each subscription add-on supports a single subscription period and trial period.</span></span> <span data-ttu-id="bc779-126">アプリで提供するサブスクリプションの種類ごとに異なるサブスクリプション アドオンを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-126">You must create a different subscription add-on for each type of subscription you want to offer in your app.</span></span> <span data-ttu-id="bc779-127">たとえば、試用期間のない月間サブスクリプション、1 か月の試用期間のある月間サブスクリプション、試用期間のない年間サブスクリプション、1 か月の試用期間のある年間サブスクリプションを提供する場合、サブスクリプション アドオンを 4 つ作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-127">For example, if you wanted to offer a monthly subscription with no trial, a monthly subscription with a one-month trial, an annual subscription with no trial, and an annual subscription with a one-month trial, you would need to create four subscription add-ons.</span></span>

    * <span data-ttu-id="bc779-128">[試用期間](../publish/enter-add-on-properties.md#free-trial): ユーザーがサブスクリプション コンテンツを購入する前に試すことのできる期間を 1 週間にするか、1 か月にするかを選択することを検討します。</span><span class="sxs-lookup"><span data-stu-id="bc779-128">[Trial period](../publish/enter-add-on-properties.md#free-trial): Consider choosing a 1 week or 1 month trial period for your subscription to enable users to try your subscription content before they buy it.</span></span> <span data-ttu-id="bc779-129">サブスクリプション アドオンの公開後に試用期間を変更または削除することはできません。</span><span class="sxs-lookup"><span data-stu-id="bc779-129">You cannot change or remove the trial period after you publish your subscription add-on.</span></span>

        <span data-ttu-id="bc779-130">サブスクリプションの無料試用版を取得するには、ユーザーは有効な支払方法の設定も含めて標準のアプリ内購入プロセスに従って、サブスクリプションを購入する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-130">To acquire a free trial of your subscription, a user must purchase your subscription through the standard in-app purchase process, including a valid form of payment.</span></span> <span data-ttu-id="bc779-131">試用期間中に料金を請求されることはありません。</span><span class="sxs-lookup"><span data-stu-id="bc779-131">They are not charged any money during the trial period.</span></span> <span data-ttu-id="bc779-132">試用期間の終わりに、サブスクリプションは自動的に完全なサブスクリプションに変わり、有料サブスクリプションの最初の期間の料金がユーザーの支払方法に請求されます。</span><span class="sxs-lookup"><span data-stu-id="bc779-132">At the end of the trial period, the subscription automatically converts to the full subscription and the user's payment instrument will be charged for the first period of the paid subscription.</span></span> <span data-ttu-id="bc779-133">ユーザーが試用期間中にサブスクリプションを取り消した場合、試用期間が終わるまでサブスクリプションは有効のままです。</span><span class="sxs-lookup"><span data-stu-id="bc779-133">If the user chooses to cancel their subscription during the trial period, the subscription remains active until the end of the trial period.</span></span> <span data-ttu-id="bc779-134">一部の試用期間は、すべてのサブスクリプション期間では利用できません。</span><span class="sxs-lookup"><span data-stu-id="bc779-134">Some trial periods are not available for all subscription periods.</span></span>

        > [!NOTE]
        > <span data-ttu-id="bc779-135">各ユーザーは、サブスクリプション アドオンの無料試用版を 1 回だけ取得できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-135">Each customer can acquire a free trial for a subscription add-on only one time.</span></span> <span data-ttu-id="bc779-136">ユーザーがサブスクリプションの無料試用版を取得したら、Microsoft Store では、同じユーザーが今後同じ無料試用版のサブスクリプションを取得しないようにします。</span><span class="sxs-lookup"><span data-stu-id="bc779-136">After a customer acquires a free trial for a subscription, the Store prevents the same customer from ever acquiring the same free trial subscription again.</span></span>

    * <span data-ttu-id="bc779-137">[可視性](../publish/set-add-on-pricing-and-availability.md#visibility): サブスクリプションのアプリ内購入エクスペリエンスのテストだけに使用するテスト用アドオンを作成している場合は、**[ストアに表示しない]** オプションのいずれかを選択することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="bc779-137">[Visibility](../publish/set-add-on-pricing-and-availability.md#visibility): If you are creating a test add-on that you will only use to test the in-app purchase experience for your subscription, we recommend that you select one of the **Hidden in the Store** options.</span></span> <span data-ttu-id="bc779-138">それ以外の場合は、シナリオに最適な可視化オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="bc779-138">Otherwise, you can select the best visibility option for your scenario.</span></span>

    * <span data-ttu-id="bc779-139">[価格](../publish/set-add-on-pricing-and-availability.md?#pricing): このセクションでサブスクリプションの価格を選択します。</span><span class="sxs-lookup"><span data-stu-id="bc779-139">[Pricing](../publish/set-add-on-pricing-and-availability.md?#pricing): Choose the price of your subscription in this section.</span></span> <span data-ttu-id="bc779-140">アドオンの公開後にサブスクリプションの価格を上げることはできません。</span><span class="sxs-lookup"><span data-stu-id="bc779-140">You cannot raise the price of the subscription after you publish the add-on.</span></span> <span data-ttu-id="bc779-141">ただし、後で価格を下げることはできます。</span><span class="sxs-lookup"><span data-stu-id="bc779-141">However, you can lower the price later.</span></span>
        > [!IMPORTANT]
        > <span data-ttu-id="bc779-142">アドオンの作成時、既定では、最初の価格は **[無料]** に設定されています。</span><span class="sxs-lookup"><span data-stu-id="bc779-142">By default, when you create any add-on the price is initially set to **Free**.</span></span> <span data-ttu-id="bc779-143">サブスクリプション アドオンの申請の完了後にアドオンの価格を上げることはできないため、ここで必ずサブスクリプションの価格を選択してください。</span><span class="sxs-lookup"><span data-stu-id="bc779-143">Because you cannot raise the price of a subscription add-on after you complete the add-on submission, be sure to choose the price of your subscription here.</span></span>

2. <span data-ttu-id="bc779-144">アプリで [**Windows.Services.Store**](https://docs.microsoft.com/uwp/api/windows.services.store) 名前空間の API を使用して、現在のユーザーが既にサブスクリプション アドオンを取得しているかどうかを確認し、そのユーザーにアドオンをアプリ内購入として販売するかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="bc779-144">In your app, use APIs in the [**Windows.Services.Store**](https://docs.microsoft.com/uwp/api/windows.services.store) namespace to determine whether the current user has already acquired your subscription add-on and then offer it for sale to the user as an in-app purchase.</span></span> <span data-ttu-id="bc779-145">詳細については、この記事の[コード サンプル](#code-examples)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bc779-145">See the [code examples](#code-examples) in this article for more details.</span></span>

3. <span data-ttu-id="bc779-146">アプリで、サブスクリプションのアプリ内購入の実装をテストします。</span><span class="sxs-lookup"><span data-stu-id="bc779-146">Test the in-app purchase implementation of your subscription in your app.</span></span> <span data-ttu-id="bc779-147">ストアからアプリを開発用デバイスに 1 回ダウンロードして、そのライセンスをテストに使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-147">You'll need to download your app once from the Store to your development device to use its license for testing.</span></span> <span data-ttu-id="bc779-148">詳細については、アプリ内購入の[テスト ガイダンス](in-app-purchases-and-trials.md#testing)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bc779-148">For more information, see our [testing guidance](in-app-purchases-and-trials.md#testing) for in-app purchases.</span></span>  

4. <span data-ttu-id="bc779-149">テストしたコードを含む更新したアプリ パッケージを含めたアプリの申請を作成して公開します。</span><span class="sxs-lookup"><span data-stu-id="bc779-149">Create and publish an app submission that includes your updated app package, including your tested code.</span></span> <span data-ttu-id="bc779-150">詳しくは、「[アプリの申請](../publish/app-submissions.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bc779-150">For more information, see [App submissions](../publish/app-submissions.md).</span></span>

<span id="code-examples"/>

## <a name="code-examples"></a><span data-ttu-id="bc779-151">コード例</span><span class="sxs-lookup"><span data-stu-id="bc779-151">Code examples</span></span>

<span data-ttu-id="bc779-152">このセクションのコード例では、[**Windows.Services.Store**](https://docs.microsoft.com/uwp/api/windows.services.store) 名前空間の API を使用して現在のアプリのサブスクリプション アドオンに関する情報を取得する方法および現在のユーザーの代わりにサブスクリプション アドオンの購入を要求する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="bc779-152">The code examples in this section demonstrate how to use the APIs in the [**Windows.Services.Store**](https://docs.microsoft.com/uwp/api/windows.services.store) namespace to get info about subscription add-ons for the current app and request the purchase a subscription add-on on behalf of the current user.</span></span>

<span data-ttu-id="bc779-153">これらの例には、次の前提条件があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-153">These examples have the following prerequisites:</span></span>
* <span data-ttu-id="bc779-154">**Windows 10 Anniversary Edition (10.0、ビルド 14393)** 以降のリリースをターゲットとするユニバーサル Windows プラットフォーム (UWP) アプリの Visual Studio プロジェクト。</span><span class="sxs-lookup"><span data-stu-id="bc779-154">A Visual Studio project for a Universal Windows Platform (UWP) app that targets **Windows 10 Anniversary Edition (10.0; Build 14393)** or a later release.</span></span>
* <span data-ttu-id="bc779-155">Windows デベロッパー センター ダッシュボードで[アプリの申請を作成](https://docs.microsoft.com/windows/uwp/publish/app-submissions)し、このアプリが Microsoft Store で公開されている。</span><span class="sxs-lookup"><span data-stu-id="bc779-155">You have [created an app submission](https://docs.microsoft.com/windows/uwp/publish/app-submissions) in the Windows Dev Center dashboard and this app is published in the Store.</span></span> <span data-ttu-id="bc779-156">必要に応じで、テスト中にストアでアプリを検索できないようにアプリを構成することも可能です。</span><span class="sxs-lookup"><span data-stu-id="bc779-156">You can optionally configure the app so it is not discoverable in the Store while you test it.</span></span> <span data-ttu-id="bc779-157">詳しくは、[テスト ガイダンス](in-app-purchases-and-trials.md#testing)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bc779-157">For more information, see the [testing guidance](in-app-purchases-and-trials.md#testing).</span></span>
* <span data-ttu-id="bc779-158">デベロッパー センター ダッシュボードで[アプリのサブスクリプション アドオンを作成](../publish/add-on-submissions.md)した。</span><span class="sxs-lookup"><span data-stu-id="bc779-158">You have [created a subscription add-on for the app](../publish/add-on-submissions.md) in the Dev Center dashboard.</span></span>

<span data-ttu-id="bc779-159">これらの例のコードは、次の点を前提としています。</span><span class="sxs-lookup"><span data-stu-id="bc779-159">The code in these examples assumes:</span></span>
* <span data-ttu-id="bc779-160">コード ファイルに **Windows.Services.Store** 名前空間と **System.Threading.Tasks** 名前空間を使うための **using** ステートメントがある。</span><span class="sxs-lookup"><span data-stu-id="bc779-160">The code file has **using** statements for the **Windows.Services.Store** and **System.Threading.Tasks** namespaces.</span></span>
* <span data-ttu-id="bc779-161">アプリは、アプリを起動したユーザーのコンテキストでのみ動作するシングル ユーザー アプリである。</span><span class="sxs-lookup"><span data-stu-id="bc779-161">The app is a single-user app that runs only in the context of the user that launched the app.</span></span> <span data-ttu-id="bc779-162">詳しくは、「[アプリ内購入と試用版](in-app-purchases-and-trials.md#api_intro)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bc779-162">For more information, see [In-app purchases and trials](in-app-purchases-and-trials.md#api_intro).</span></span>

> [!NOTE]
> <span data-ttu-id="bc779-163">[デスクトップ ブリッジ](https://developer.microsoft.com/windows/bridges/desktop)を使用するデスクトップ アプリケーションがある場合、これらの例には示されていないコードを追加して [**StoreContext**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext) オブジェクトを構成することが必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="bc779-163">If you have a desktop application that uses the [Desktop Bridge](https://developer.microsoft.com/windows/bridges/desktop), you may need to add additional code not shown in these examples to configure the [**StoreContext**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext) object.</span></span> <span data-ttu-id="bc779-164">詳しくは、「[デスクトップ ブリッジを使用するデスクトップ アプリケーションでの StoreContext クラスの使用](in-app-purchases-and-trials.md#desktop)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="bc779-164">For more information, see [Using the StoreContext class in a desktop application that uses the Desktop Bridge](in-app-purchases-and-trials.md#desktop).</span></span>

### <a name="purchase-a-subscription-add-on"></a><span data-ttu-id="bc779-165">サブスクリプション アドオンの購入</span><span class="sxs-lookup"><span data-stu-id="bc779-165">Purchase a subscription add-on</span></span>

<span data-ttu-id="bc779-166">この例では、現在のユーザーに代わって、アプリの既知のサブスクリプション アドオンの購入を要求する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="bc779-166">This example demonstrates how to request the purchase of a known subscription add-on for your app on behalf of the current customer.</span></span> <span data-ttu-id="bc779-167">この例は、サブスクリプションに試用期間がある場合の処理方法も示しています。</span><span class="sxs-lookup"><span data-stu-id="bc779-167">This example also shows how to handle the case where the subscription has a trial period.</span></span>

1. <span data-ttu-id="bc779-168">コードではまず、ユーザーがサブスクリプションのアクティブなライセンスを既に持っているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="bc779-168">The code first determines whether the customer already has an active license for the subscription.</span></span> <span data-ttu-id="bc779-169">ユーザーがアクティブなラインセンスを既に持っている場合は、必要に応じてコードでサブスクリプション機能のロックを解除する必要があります (これはアプリに固有の処理なので、例ではコメントで示されています)。</span><span class="sxs-lookup"><span data-stu-id="bc779-169">If the customer already has an active license, your code should unlock the subscription features as necessary (because this is proprietary to your app, this is identified with a comment in the example).</span></span>
2. <span data-ttu-id="bc779-170">次に、ユーザーに代わって購入するサブスクリプションを表す [**StoreProduct**](https://docs.microsoft.com/uwp/api/windows.services.store.storeproduct) オブジェクトを取得します。</span><span class="sxs-lookup"><span data-stu-id="bc779-170">Next, the code gets the [**StoreProduct**](https://docs.microsoft.com/uwp/api/windows.services.store.storeproduct) object that represents the subscription you want to purchase on behalf of the customer.</span></span> <span data-ttu-id="bc779-171">コードでは、購入するサブスクリプション アドオンの [Store ID](in-app-purchases-and-trials.md#store-ids) が既にわかっていて、その値が *subscriptionStoreId* 変数に割り当てられていると想定しています。</span><span class="sxs-lookup"><span data-stu-id="bc779-171">The code assumes that you already know the [Store ID](in-app-purchases-and-trials.md#store-ids) of the subscription add-on you want to purchase, and that you have assigned this value to the *subscriptionStoreId* variable.</span></span>
3. <span data-ttu-id="bc779-172">コードは次に、サブスクリプションに試用期間があるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="bc779-172">The code then determines whether a trial is available for the subscription.</span></span> <span data-ttu-id="bc779-173">アプリでは、必要に応じてこの情報を使って、利用可能な試用版サブスクリプションまたは製品版サブスクリプションの詳細をユーザーに表示することができます。</span><span class="sxs-lookup"><span data-stu-id="bc779-173">Optionally, your app can use this information to display details about the available trial or full subscription to the customer.</span></span>
4. <span data-ttu-id="bc779-174">最後に、コードで [**RequestPurchaseAsync**](https://docs.microsoft.com/uwp/api/windows.services.store.storeproduct.RequestPurchaseAsync) メソッドを呼び出して、サブスクリプションの購入を要求します。</span><span class="sxs-lookup"><span data-stu-id="bc779-174">Finally, the code calls [**RequestPurchaseAsync**](https://docs.microsoft.com/uwp/api/windows.services.store.storeproduct.RequestPurchaseAsync) method to request the purchase of the subscription.</span></span> <span data-ttu-id="bc779-175">サブスクリプションに試用版がある場合は、試用版がユーザーに提供されます。</span><span class="sxs-lookup"><span data-stu-id="bc779-175">If a trial is available for the subscription, the trial will be offered to the customer for purchase.</span></span> <span data-ttu-id="bc779-176">それ以外の場合は、製品版のサブスクリプションが購入用に提供されます。</span><span class="sxs-lookup"><span data-stu-id="bc779-176">Otherwise, the full subscription will be offered for purchase.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[Subscriptions](./code/InAppPurchasesAndLicenses_RS1/cs/PurchaseSubscriptionAddOnTrialPage.xaml.cs#PurchaseTrialSubscription)]

### <a name="get-info-about-subscription-add-ons-for-the-current-app"></a><span data-ttu-id="bc779-177">現在のアプリのサブスクリプション アドオンの情報の取得</span><span class="sxs-lookup"><span data-stu-id="bc779-177">Get info about subscription add-ons for the current app</span></span>

<span data-ttu-id="bc779-178">このコード例では、アプリで利用可能なすべてのサブスクリプション アドオンの情報を取得する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="bc779-178">This code example demonstrates how to get info for all the subscription add-ons that are available in your app.</span></span> <span data-ttu-id="bc779-179">この情報を取得するには、まず [**GetAssociatedStoreProductsAsync**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext.GetAssociatedStoreProductsAsync) メソッドを使用して、アプリで利用可能なアドオンそれぞれを表す [**StoreProduct**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreProduct) オブジェクトのコレクションを取得します。</span><span class="sxs-lookup"><span data-stu-id="bc779-179">To get this info, first use the [**GetAssociatedStoreProductsAsync**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreContext.GetAssociatedStoreProductsAsync) method to get the collection of [**StoreProduct**](https://docs.microsoft.com/uwp/api/Windows.Services.Store.StoreProduct) objects that represent each of the available add-ons for the app.</span></span> <span data-ttu-id="bc779-180">次に、各製品の [**StoreSku**](https://docs.microsoft.com/uwp/api/windows.services.store.storesku) を取得し、[**IsSubscription**](https://docs.microsoft.com/uwp/api/windows.services.store.storesku.IsSubscription) プロパティと [**SubscriptionInfo**](https://docs.microsoft.com/uwp/api/windows.services.store.storesku.SubscriptionInfo) プロパティを使ってサブスクリプション情報にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="bc779-180">Then, get the [**StoreSku**](https://docs.microsoft.com/uwp/api/windows.services.store.storesku) for each product and use the [**IsSubscription**](https://docs.microsoft.com/uwp/api/windows.services.store.storesku.IsSubscription) and [**SubscriptionInfo**](https://docs.microsoft.com/uwp/api/windows.services.store.storesku.SubscriptionInfo) properties to access the subscription info.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[Subscriptions](./code/InAppPurchasesAndLicenses_RS1/cs/GetSubscriptionAddOnsPage.xaml.cs#GetSubscriptions)]

<span id="manage-subscriptions" />

## <a name="manage-subscriptions-from-your-services"></a><span data-ttu-id="bc779-181">サービスからのサブスクリプションの管理</span><span class="sxs-lookup"><span data-stu-id="bc779-181">Manage subscriptions from your services</span></span>

<span data-ttu-id="bc779-182">更新したアプリがストアで公開され、ユーザーがサブスクリプション アドオンを購入できるようになったら、ユーザーのサブスクリプションの管理が必要になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-182">After your updated app is in the Store and customers can buy your subscription add-on, you may have scenarios where you need to manage the subscription for a customer.</span></span> <span data-ttu-id="bc779-183">サービスから呼び出して次のサブスクリプション管理タスクを実行できる REST API が用意されています。</span><span class="sxs-lookup"><span data-stu-id="bc779-183">We provide REST APIs you can call from your services to perform the following subscription management tasks:</span></span>

* <span data-ttu-id="bc779-184">[ユーザーが使う権利を持っているサブスクリプションを取得する](get-subscriptions-for-a-user.md)。</span><span class="sxs-lookup"><span data-stu-id="bc779-184">[Get the subscriptions that a user has an entitlement to use](get-subscriptions-for-a-user.md).</span></span> <span data-ttu-id="bc779-185">サブスクリプションがクロスプラットフォーム サービスの一部である場合は、この API を呼び出して、指定のユーザーにサブスクリプションの権利があるかどうかや、UWP アプリのコンテキストにおけるサブスクリプションの状態を判断することができます。</span><span class="sxs-lookup"><span data-stu-id="bc779-185">If your subscription is part of a cross-platform service, you can call this API to determine whether the specified user has an entitlement for your subscription and the status of their subscription in the context of your UWP app.</span></span> <span data-ttu-id="bc779-186">その後、この情報を使用して、サービスでサポートしている他のプラットフォームにおけるサブスクリプションの状態を更新できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-186">You can then use this information to update the status of the subscription on other platforms that your service supports.</span></span>

* <span data-ttu-id="bc779-187">[特定のユーザーのサブスクリプションに関する請求の状態を変更する](change-the-billing-state-of-a-subscription-for-a-user.md)。</span><span class="sxs-lookup"><span data-stu-id="bc779-187">[Change the billing state of a subscription for a given user](change-the-billing-state-of-a-subscription-for-a-user.md).</span></span> <span data-ttu-id="bc779-188">この API を使用して、サブスクリプションの取り消し、延長、または自動更新の無効化を行えます。</span><span class="sxs-lookup"><span data-stu-id="bc779-188">Use this API to cancel, extend, or disable automatic renewal for a subscription.</span></span>

## <a name="cancellations"></a><span data-ttu-id="bc779-189">取り消し</span><span class="sxs-lookup"><span data-stu-id="bc779-189">Cancellations</span></span>

<span data-ttu-id="bc779-190">ユーザーは、Microsoft アカウントの [http://account.microsoft.com/services](http://account.microsoft.com/services) ページを使って、取得したすべてのサブスクリプションの表示、サブスクリプションの取り消し、サブスクリプションに関連付けられている支払い方法の変更ができます。</span><span class="sxs-lookup"><span data-stu-id="bc779-190">Customers can use the [http://account.microsoft.com/services](http://account.microsoft.com/services) page for their Microsoft account to view all of the subscriptions they have acquired, cancel a subscription, and change the form of payment that is associated with their subscription.</span></span> <span data-ttu-id="bc779-191">ユーザーがこのページを使ってサブスクリプションを取り消した場合でも、現在の請求期間中はサブスクリプションを引き続き利用できます。</span><span class="sxs-lookup"><span data-stu-id="bc779-191">When a customer cancels a subscription using this page, they continue to have access to the subscription for the duration of the current billing period.</span></span> <span data-ttu-id="bc779-192">現在の請求期間に対する払い戻しは一切行われません。</span><span class="sxs-lookup"><span data-stu-id="bc779-192">They do not get a refund for any part of the current billing period.</span></span> <span data-ttu-id="bc779-193">現在の請求期間の終了時に、サブスクリプションが無効になります。</span><span class="sxs-lookup"><span data-stu-id="bc779-193">At the end of the current billing period, their subscription is deactivated.</span></span>

<span data-ttu-id="bc779-194">REST API を使用して、ユーザーの代わりにサブスクリプションを取り消して、[特定のユーザーのサブスクリプションに関する請求の状態を変更](change-the-billing-state-of-a-subscription-for-a-user.md)することもできます。</span><span class="sxs-lookup"><span data-stu-id="bc779-194">You can also cancel a subscription on behalf of a user by using our REST API to [change the billing state of a subscription for a given user](change-the-billing-state-of-a-subscription-for-a-user.md).</span></span>

## <a name="subscription-renewals-and-grace-periods"></a><span data-ttu-id="bc779-195">サブスクリプションの更新と猶予期間</span><span class="sxs-lookup"><span data-stu-id="bc779-195">Subscription renewals and grace periods</span></span>

<span data-ttu-id="bc779-196">請求期間中のある時点で、ユーザーのクレジット カードに対して次の請求期間分の請求が試みられます。</span><span class="sxs-lookup"><span data-stu-id="bc779-196">At some point during each billing period, we will attempt to charge the customer's credit card for the next billing period.</span></span> <span data-ttu-id="bc779-197">この請求に失敗すると、ユーザーのサブスクリプションは*催促中*の状態になります。</span><span class="sxs-lookup"><span data-stu-id="bc779-197">If the charge fails, the customer's subscription enters the *dunning* state.</span></span> <span data-ttu-id="bc779-198">つまり、現在の請求期間が終わるまでの間、サブスクリプションはアクティブですが、サブスクリプションを自動更新するためにクレジット カードへの請求が定期的に試みられます。</span><span class="sxs-lookup"><span data-stu-id="bc779-198">This means that their subscription is still active for the remainder of the current billing period, but we will periodically try to charge their credit card to automatically renew the subscription.</span></span> <span data-ttu-id="bc779-199">この状態は、現在の請求期間が終了して次の請求期間が更新される日まで、最大で 2 週間続く可能性があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-199">This state can last up to two weeks, until the end of the current billing period and the renew date for the next billing period.</span></span>

<span data-ttu-id="bc779-200">サブスクリプションの請求に対する猶予期間は用意されていません。</span><span class="sxs-lookup"><span data-stu-id="bc779-200">We do not offer grace periods for subscription billing.</span></span> <span data-ttu-id="bc779-201">現在の請求期間が終了するまでにユーザーのクレジット カードに請求できなかった場合、サブスクリプションは取り消され、現在の請求期間後にユーザーがサブスクリプションにアクセスすることはできなくなります。</span><span class="sxs-lookup"><span data-stu-id="bc779-201">If we are unable to successfully charge the customer's credit card by the end of the current billing period, the subscription will be canceled and the customer will no longer have access to the subscription after the current billing period.</span></span>

## <a name="unsupported-scenarios"></a><span data-ttu-id="bc779-202">サポートされていないシナリオ</span><span class="sxs-lookup"><span data-stu-id="bc779-202">Unsupported scenarios</span></span>

<span data-ttu-id="bc779-203">次のシナリオは、サブスクリプション アドオンで現在サポートされていません。</span><span class="sxs-lookup"><span data-stu-id="bc779-203">The following scenarios are not currently supported for subscription add-ons.</span></span>

* <span data-ttu-id="bc779-204">現時点では、ストアを通じたユーザーへのサブスクリプションの直接販売はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="bc779-204">Selling subscriptions to customers directly via the Store is not supported at this time.</span></span> <span data-ttu-id="bc779-205">サブスクリプションはデジタル製品のアプリ内購入でのみ利用可能です。</span><span class="sxs-lookup"><span data-stu-id="bc779-205">Subscriptions are available for in-app purchases of digital products only.</span></span>
* <span data-ttu-id="bc779-206">ユーザーが Microsoft アカウントの [http://account.microsoft.com/services](http://account.microsoft.com/services) ページを使ってサブスクリプション期間を切り替えることはできません。</span><span class="sxs-lookup"><span data-stu-id="bc779-206">Customers cannot switch subscription periods using the [http://account.microsoft.com/services](http://account.microsoft.com/services) page for their Microsoft account.</span></span> <span data-ttu-id="bc779-207">異なるサブスクリプション期間に切り替えるには、ユーザーは現在のサブスクリプションを取り消して、アプリで別のサブスクリプション期間のサブスクリプションを購入する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bc779-207">To switch to a different subscription period, customers much cancel their current subscription and then purchase a subscription with a different subscription period from your app.</span></span>
* <span data-ttu-id="bc779-208">サブスクリプション アドオンでは現在、サブスクリプション レベルの切り替えはサポートされていません (たとえば、ユーザーをベーシック サブスクリプションから機能の多いプレミアム サブスクリプションに切り替えるなど)。</span><span class="sxs-lookup"><span data-stu-id="bc779-208">Tier switching is currently not supported for subscription add-ons (for example, switching a customer from a basic subscription to a premium subscription with more features).</span></span>
* <span data-ttu-id="bc779-209">サブスクリプション アドオンでは現在、[セール](../publish/put-apps-and-add-ons-on-sale.md)と[プロモーション コード](../publish/generate-promotional-codes.md)はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="bc779-209">[Sales](../publish/put-apps-and-add-ons-on-sale.md) and [promotional codes](../publish/generate-promotional-codes.md) are currently not supported for subscription add-ons.</span></span>


## <a name="related-topics"></a><span data-ttu-id="bc779-210">関連トピック</span><span class="sxs-lookup"><span data-stu-id="bc779-210">Related topics</span></span>

* [<span data-ttu-id="bc779-211">アプリ内購入と試用版</span><span class="sxs-lookup"><span data-stu-id="bc779-211">In-app purchases and trials</span></span>](in-app-purchases-and-trials.md)
* [<span data-ttu-id="bc779-212">アプリとアドオンの製品情報の取得</span><span class="sxs-lookup"><span data-stu-id="bc779-212">Get product info for apps and add-ons</span></span>](get-product-info-for-apps-and-add-ons.md)
