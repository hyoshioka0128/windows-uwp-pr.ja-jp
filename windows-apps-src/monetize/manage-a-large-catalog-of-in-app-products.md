---
author: Xansky
ms.assetid: 5E722AFF-539D-456E-8C4A-ADE90CF7674A
description: アプリ内製品のカタログが大きくなる場合、カタログを管理するためにこのトピックで説明するプロセスを採用できます。
title: アプリ内製品の大規模なカタログの管理
ms.author: mhopkins
ms.date: 08/25/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Windows 10, UWP, アプリ内購入, IAP, アドオン, カタログ, Windows.ApplicationModel.Store
ms.localizationpriority: medium
ms.openlocfilehash: fad186ed63557024fb71a6ec3c6997833afb7f4c
ms.sourcegitcommit: 1c6325aa572868b789fcdd2efc9203f67a83872a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/17/2018
ms.locfileid: "4754120"
---
# <a name="manage-a-large-catalog-of-in-app-products"></a><span data-ttu-id="a858d-104">アプリ内製品の大規模なカタログの管理</span><span class="sxs-lookup"><span data-stu-id="a858d-104">Manage a large catalog of in-app products</span></span>

<span data-ttu-id="a858d-105">アプリ内製品のカタログが大きくなる場合、カタログを管理するためにこのトピックで説明するプロセスを採用できます。</span><span class="sxs-lookup"><span data-stu-id="a858d-105">If your app offers a large in-app product catalog, you can optionally follow the process described in this topic to help manage your catalog.</span></span> <span data-ttu-id="a858d-106">Windows 10 より前のリリースでは、開発者アカウントごとに 200 製品の表示制限があり、このトピックで説明するプロセスを使ってこの制限を回避できます。</span><span class="sxs-lookup"><span data-stu-id="a858d-106">In releases before Windows 10, the Store has a limit of 200 product listings per developer account, and the process described in this topic can be used to work around that limitation.</span></span> <span data-ttu-id="a858d-107">Windows 10 以降では、開発者アカウントごとに表示されるストアの製品数に制限がないため、この記事で説明されているプロセスは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="a858d-107">Starting with Windows 10, the Store has no limit to the number of product listings per developer account, and the process described in this article is no longer necessary.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a858d-108">この記事では、[Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) 名前空間のメンバーの使用方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a858d-108">This article demonstrates how to use members of the [Windows.ApplicationModel.Store](https://msdn.microsoft.com/library/windows/apps/windows.applicationmodel.store.aspx) namespace.</span></span> <span data-ttu-id="a858d-109">この名前空間は更新されなくなり、新機能も追加されないため、代わりに [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx) 名前空間を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a858d-109">This namespace is no longer being updated with new features, and we recommend that you use the [Windows.Services.Store](https://msdn.microsoft.com/library/windows/apps/windows.services.store.aspx) namespace instead.</span></span> <span data-ttu-id="a858d-110">**Windows.Services.Store** 名前空間は、Microsoft Store で管理されるコンシューマブルなアドオンやサブスクリプションなど、最新の種類のアドオンをサポートしており、Windows デベロッパー センターと Microsoft Store で今後サポートされる製品および機能の種類と互換性を持つように設計されています。</span><span class="sxs-lookup"><span data-stu-id="a858d-110">The **Windows.Services.Store** namespace supports the latest add-on types, such as Store-managed consumable add-ons and subscriptions, and is designed to be compatible with future types of products and features supported by Windows Dev Center and the Store.</span></span> <span data-ttu-id="a858d-111">**Windows.Services.Store** 名前空間は、Windows 10 バージョン 1607 で導入され、Visual Studio で、**Windows 10 Anniversary Edition (10.0、ビルド 14393)** 以降のリリースをターゲットとするプロジェクトでのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="a858d-111">The **Windows.Services.Store** namespace was introduced in Windows 10, version 1607, and it can only be used in projects that target **Windows 10 Anniversary Edition (10.0; Build 14393)** or a later release in Visual Studio.</span></span> <span data-ttu-id="a858d-112">詳しくは、「[アプリ内購入と試用版](in-app-purchases-and-trials.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="a858d-112">For more information, see [In-app purchases and trials](in-app-purchases-and-trials.md).</span></span>

<span data-ttu-id="a858d-113">この機能を有効にするには、特定の価格帯に対して少数の製品エントリを作成し、個々のエントリで、カタログ内の多数の製品を表します。</span><span class="sxs-lookup"><span data-stu-id="a858d-113">To enable this capability, you will create a handful of product entries for specific price tiers, with each one able to represent hundreds of products within a catalog.</span></span> <span data-ttu-id="a858d-114">[RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.requestproductpurchaseasync) メソッドのオーバーロードを使って、ストアに掲載されたアプリ内購入製品に関連する、アプリで定義された販売を指定します。</span><span class="sxs-lookup"><span data-stu-id="a858d-114">Use the [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.requestproductpurchaseasync) method overload that specifies an app-defined offer associated with an in-app product listed in the Store.</span></span> <span data-ttu-id="a858d-115">呼び出し中に販売と製品の関連付けを指定することに加えて、アプリでは、大規模なカタログ販売の詳細を格納する [ProductPurchaseDisplayProperties](https://msdn.microsoft.com/library/windows/apps/dn263384) オブジェクトも渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="a858d-115">In addition to specifying an offer and product association during the call, your app should also pass a [ProductPurchaseDisplayProperties](https://msdn.microsoft.com/library/windows/apps/dn263384) object that contains the large catalog offer details.</span></span> <span data-ttu-id="a858d-116">これらの詳細が指定されていない場合、一覧に掲載された製品の詳細が代わりに使われます。</span><span class="sxs-lookup"><span data-stu-id="a858d-116">If these details are not provided, the details for the listed product will be used instead.</span></span>

<span data-ttu-id="a858d-117">ストアでは、結果の [PurchaseResults](https://msdn.microsoft.com/library/windows/apps/dn263392) で、購入要求からの *offerId* のみを使います。</span><span class="sxs-lookup"><span data-stu-id="a858d-117">The Store will only use the *offerId* from the purchase request in the resulting [PurchaseResults](https://msdn.microsoft.com/library/windows/apps/dn263392).</span></span> <span data-ttu-id="a858d-118">このプロセスは、[ストアにアプリ内製品を掲載した](../publish/add-on-submissions.md)ときに最初に提供された情報を直接変更するわけではありません。</span><span class="sxs-lookup"><span data-stu-id="a858d-118">This process does not directly modify the information originally provided when [listing the in-app product in the Store](../publish/add-on-submissions.md).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a858d-119">前提条件</span><span class="sxs-lookup"><span data-stu-id="a858d-119">Prerequisites</span></span>

-   <span data-ttu-id="a858d-120">このトピックでは、ストアの一覧に表示される 1 つのアプリ内購入製品を使って複数のアプリ内販売を表現することに対する、ストアのサポートについて説明します。</span><span class="sxs-lookup"><span data-stu-id="a858d-120">This topic covers Store support for the representation of multiple in-app offers using a single in-app product listed in the Store.</span></span> <span data-ttu-id="a858d-121">アプリ内購入に詳しくない場合は、「[アプリ内製品購入の有効化](enable-in-app-product-purchases.md)」を読んで、ライセンス情報と、ストアでアプリ内購入を適切に一覧表示する方法を確かめてください。</span><span class="sxs-lookup"><span data-stu-id="a858d-121">If you are unfamiliar with in-app purchases please review [Enable in-app product purchases](enable-in-app-product-purchases.md) to learn about license information, and how to properly list your in-app purchase in the Store.</span></span>
-   <span data-ttu-id="a858d-122">新しいアプリ内販売のコード記述やテストを初めて行うときは、[CurrentApp](https://msdn.microsoft.com/library/windows/apps/hh779765) オブジェクトではなく、[CurrentAppSimulator](https://msdn.microsoft.com/library/windows/apps/hh779766) オブジェクトを使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="a858d-122">When you code and test new in-app offers for the first time, you must use the [CurrentAppSimulator](https://msdn.microsoft.com/library/windows/apps/hh779766) object instead of the [CurrentApp](https://msdn.microsoft.com/library/windows/apps/hh779765) object.</span></span> <span data-ttu-id="a858d-123">そうすることで、実稼働サーバーを呼び出すのではなく、ライセンス サーバーへのシミュレートされた呼び出しを使って、ライセンス ロジックを検証できます。</span><span class="sxs-lookup"><span data-stu-id="a858d-123">This way you can verify your license logic using simulated calls to the license server instead of calling the live server.</span></span> <span data-ttu-id="a858d-124">そのためには、%userprofile%\\AppData\\local\\packages\\&lt;package name&gt;\\LocalState\\Microsoft\\Windows Store\\ApiData で WindowsStoreProxy.xml という名前のファイルをカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a858d-124">To do this, you need to customize the file named WindowsStoreProxy.xml in %userprofile%\\AppData\\local\\packages\\&lt;package name&gt;\\LocalState\\Microsoft\\Windows Store\\ApiData.</span></span> <span data-ttu-id="a858d-125">このファイルは、アプリを初めて実行するときに Microsoft Visual Studio シミュレーターによって作られます。カスタマイズされたファイルを実行時に読み込むこともできます。</span><span class="sxs-lookup"><span data-stu-id="a858d-125">The Microsoft Visual Studio simulator creates this file when you run your app for the first time—or you can also load a custom one at runtime.</span></span> <span data-ttu-id="a858d-126">詳しくは、「[CurrentAppSimulator での WindowsStoreProxy.xml ファイルの使用](in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#proxy)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="a858d-126">For more info, see [Using the WindowsStoreProxy.xml file with CurrentAppSimulator](in-app-purchases-and-trials-using-the-windows-applicationmodel-store-namespace.md#proxy).</span></span>
-   <span data-ttu-id="a858d-127">このトピックでは、[ストア サンプル](https://github.com/Microsoft/Windows-universal-samples/tree/win10-1507/Samples/Store)で提供されているコード例も参照します。</span><span class="sxs-lookup"><span data-stu-id="a858d-127">This topic also references code examples provided in the [Store sample](https://github.com/Microsoft/Windows-universal-samples/tree/win10-1507/Samples/Store).</span></span> <span data-ttu-id="a858d-128">このサンプルを利用すると、ユニバーサル Windows プラットフォーム (UWP) アプリに提供されるさまざまな収益化オプションを体験できます。</span><span class="sxs-lookup"><span data-stu-id="a858d-128">This sample is a great way to get hands-on experience with the different monetization options provided for Universal Windows Platform (UWP) apps.</span></span>

## <a name="make-the-purchase-request-for-the-in-app-product"></a><span data-ttu-id="a858d-129">アプリ内製品に対する購入要求</span><span class="sxs-lookup"><span data-stu-id="a858d-129">Make the purchase request for the in-app product</span></span>

<span data-ttu-id="a858d-130">大規模なカタログ内の特定の製品に対する購入要求は、他のアプリ内購入要求とほとんど同様に処理されます。</span><span class="sxs-lookup"><span data-stu-id="a858d-130">The purchase request for a specific product within a large catalog is handled in much the same way as any other purchase request within an app.</span></span> <span data-ttu-id="a858d-131">アプリが新しい [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.requestproductpurchaseasync) メソッドのオーバーロードを呼び出すときに、アプリは *OfferId* と、アプリ内製品の名前が設定された [ProductPurchaseDisplayProperties](https://msdn.microsoft.com/library/windows/apps/dn263390) オブジェクトの両方を提供します。</span><span class="sxs-lookup"><span data-stu-id="a858d-131">When your app calls the new [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.requestproductpurchaseasync) method overload, your app provides both an *OfferId* and a [ProductPurchaseDisplayProperties](https://msdn.microsoft.com/library/windows/apps/dn263390) object populated with the name of the in-app product.</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[ManageCatalog](./code/InAppPurchasesAndLicenses/cs/ManageCatalog.cs#MakePurchaseRequest)]

## <a name="report-fulfillment-of-the-in-app-offer"></a><span data-ttu-id="a858d-132">アプリ内販売のフルフィルメントの報告</span><span class="sxs-lookup"><span data-stu-id="a858d-132">Report fulfillment of the in-app offer</span></span>

<span data-ttu-id="a858d-133">アプリでは、販売のローカルのフルフィルメントが完了したらすぐに、ストアに製品フルフィルメントを報告する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a858d-133">Your app will need to report product fulfillment to the Store as soon as the offer has been fulfilled locally.</span></span> <span data-ttu-id="a858d-134">大規模なカタログのシナリオでは、アプリで販売のフルフィルメントを報告しなかった場合、ユーザーは、その同じストアの製品一覧を使ってアプリ内販売を購入できなくなります。</span><span class="sxs-lookup"><span data-stu-id="a858d-134">In a large catalog scenario, if your app does not report offer fulfillment, the user will be unable to purchase any in-app offers using that same Store product listing.</span></span>

<span data-ttu-id="a858d-135">前に説明したように、ストアでは提供された販売情報のみを使って [PurchaseResults](https://msdn.microsoft.com/library/windows/apps/dn263392) を設定し、大規模なカタログ販売とストアの製品一覧の間に永続的な関連付けは作成しません。</span><span class="sxs-lookup"><span data-stu-id="a858d-135">As mentioned earlier, the Store only uses provided offer info to populate the [PurchaseResults](https://msdn.microsoft.com/library/windows/apps/dn263392), and does not create a persistent association between a large catalog offer and Store product listing.</span></span> <span data-ttu-id="a858d-136">その結果、製品に対するユーザーの権限を追跡し、製品固有のコンテキスト (購入される項目の名前やその詳細など) を [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.requestproductpurchaseasync) 操作の外部でユーザーに提供します。</span><span class="sxs-lookup"><span data-stu-id="a858d-136">As a result you need to track user entitlement for products, and provide product-specific context (such as the name of the item being purchased or details about it) to the user outside of the [RequestProductPurchaseAsync](https://docs.microsoft.com/uwp/api/windows.applicationmodel.store.currentapp.requestproductpurchaseasync) operation.</span></span>

<span data-ttu-id="a858d-137">次のコードは、フルフィルメントの呼び出しと、特定の販売情報が挿入される UI メッセージング パターンを示しています。</span><span class="sxs-lookup"><span data-stu-id="a858d-137">The following code demonstrates the fulfillment call, and a UI messaging pattern in which the specific offer info is inserted.</span></span> <span data-ttu-id="a858d-138">この特定の製品情報がない場合、この例では製品の [ListingInformation](https://msdn.microsoft.com/library/windows/apps/br225163) からの情報を使います。</span><span class="sxs-lookup"><span data-stu-id="a858d-138">In the absence of that specific product info, the example uses info from the product [ListingInformation](https://msdn.microsoft.com/library/windows/apps/br225163).</span></span>

> [!div class="tabbedCodeSnippets"]
[!code-cs[ManageCatalog](./code/InAppPurchasesAndLicenses/cs/ManageCatalog.cs#ReportFulfillment)]

## <a name="related-topics"></a><span data-ttu-id="a858d-139">関連トピック</span><span class="sxs-lookup"><span data-stu-id="a858d-139">Related topics</span></span>

* [<span data-ttu-id="a858d-140">アプリ内製品購入の有効化</span><span class="sxs-lookup"><span data-stu-id="a858d-140">Enable in-app product purchases</span></span>](enable-in-app-product-purchases.md)
* [<span data-ttu-id="a858d-141">コンシューマブルなアプリ内製品購入の有効化</span><span class="sxs-lookup"><span data-stu-id="a858d-141">Enable consumable in-app product purchases</span></span>](enable-consumable-in-app-product-purchases.md)
* [<span data-ttu-id="a858d-142">ストア サンプル (試用版とアプリ内購入のデモンストレーション)</span><span class="sxs-lookup"><span data-stu-id="a858d-142">Store sample (demonstrates trials and in-app purchases)</span></span>](https://github.com/Microsoft/Windows-universal-samples/tree/win10-1507/Samples/Store)
* [<span data-ttu-id="a858d-143">RequestProductPurchaseAsync</span><span class="sxs-lookup"><span data-stu-id="a858d-143">RequestProductPurchaseAsync</span></span>](https://msdn.microsoft.com/library/windows/apps/dn263382)
* [<span data-ttu-id="a858d-144">ProductPurchaseDisplayProperties</span><span class="sxs-lookup"><span data-stu-id="a858d-144">ProductPurchaseDisplayProperties</span></span>](https://msdn.microsoft.com/library/windows/apps/dn263384)
