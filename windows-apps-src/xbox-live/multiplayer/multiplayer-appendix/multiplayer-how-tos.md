---
title: Multiplayer how-tos
author: KevinAsgari
description: Describes how to implement common tasks in Xbox Live Multiplayer 2015.
ms.assetid: 99c5b7c4-018c-4f7a-b2c9-0deed0e34097
ms.author: kevinasg
ms.date: 08-29-2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: xbox live, xbox, games, uwp, windows 10, xbox one, multiplayer 2015
ms.openlocfilehash: 932a61bbdf3dc6e1bd3584f1487fd8341b98df20
ms.sourcegitcommit: bf5cbc3c1fda6ba2dab2a198ede7b9b1b54583e9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/11/2017
---
# <a name="multiplayer-how-tos"></a><span data-ttu-id="99ede-104">Multiplayer how-to's</span><span class="sxs-lookup"><span data-stu-id="99ede-104">Multiplayer how-to's</span></span>

<span data-ttu-id="99ede-105">このトピックには、マルチプレイヤー 2015 の使用に関連する特定のタスクの実装方法についての情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="99ede-105">This topic contains information on how to implement specific tasks related to using multiplayer 2015.</span></span>

* <span data-ttu-id="99ede-106">MPSD セッション変更通知のサブスクライブ</span><span class="sxs-lookup"><span data-stu-id="99ede-106">Subscribe for MPSD session change notifications</span></span>
* <span data-ttu-id="99ede-107">MPSD セッションの作成</span><span class="sxs-lookup"><span data-stu-id="99ede-107">Create an MPSD session</span></span>
* <span data-ttu-id="99ede-108">MPSD セッションのアービターの設定</span><span class="sxs-lookup"><span data-stu-id="99ede-108">Set an arbiter for an MPSD session</span></span>
* <span data-ttu-id="99ede-109">Manage Title Activation</span><span class="sxs-lookup"><span data-stu-id="99ede-109">Manage Title Activation</span></span>
* <span data-ttu-id="99ede-110">ユーザーを参加可能にする</span><span class="sxs-lookup"><span data-stu-id="99ede-110">Make the user joinable</span></span>
* <span data-ttu-id="99ede-111">ゲームへの招待の送信</span><span class="sxs-lookup"><span data-stu-id="99ede-111">Send game invites</span></span>
* <span data-ttu-id="99ede-112">ロビー セッションからゲーム セッションへの参加</span><span class="sxs-lookup"><span data-stu-id="99ede-112">Join a game session from a lobby session</span></span>
* <span data-ttu-id="99ede-113">タイトルのアクティベーションからの MPSD セッションへの参加</span><span class="sxs-lookup"><span data-stu-id="99ede-113">Join an MPSD session from a Title Activation</span></span>
* <span data-ttu-id="99ede-114">ユーザーの現在のアクティビティの設定</span><span class="sxs-lookup"><span data-stu-id="99ede-114">Set the user's current activity</span></span>
* <span data-ttu-id="99ede-115">MPSD セッションの更新</span><span class="sxs-lookup"><span data-stu-id="99ede-115">Update an MPSD session</span></span>
* <span data-ttu-id="99ede-116">MPSD セッションからの退出</span><span class="sxs-lookup"><span data-stu-id="99ede-116">Leave an MPSD session</span></span>
* <span data-ttu-id="99ede-117">マッチメイキング中に空きセッション スロットを埋める</span><span class="sxs-lookup"><span data-stu-id="99ede-117">Fill open session slots during matchmaking</span></span>
* <span data-ttu-id="99ede-118">マッチ チケットの作成</span><span class="sxs-lookup"><span data-stu-id="99ede-118">Create a match ticket</span></span>
* <span data-ttu-id="99ede-119">マッチ チケットのステータスの取得</span><span class="sxs-lookup"><span data-stu-id="99ede-119">Get match ticket status</span></span>

## <a name="subscribe-for-mpsd-session-change-notifications"></a><span data-ttu-id="99ede-120">MPSD セッション変更通知のサブスクライブ</span><span class="sxs-lookup"><span data-stu-id="99ede-120">Subscribe for MPSD session change notifications</span></span>

| <span data-ttu-id="99ede-121">注意</span><span class="sxs-lookup"><span data-stu-id="99ede-121">Note</span></span>                                                                                                                                                                                                                                                                                                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-122">Subscribing for changes to a session requires the associated player to be active in the session.</span><span class="sxs-lookup"><span data-stu-id="99ede-122">Subscribing for changes to a session requires the associated player to be active in the session.</span></span> <span data-ttu-id="99ede-123">The connectionRequiredForActiveMembers field must also be set to true in the /constants/system/capabilities object for the session.</span><span class="sxs-lookup"><span data-stu-id="99ede-123">The connectionRequiredForActiveMembers field must also be set to true in the /constants/system/capabilities object for the session.</span></span> <span data-ttu-id="99ede-124">This field is usually set in the session template.</span><span class="sxs-lookup"><span data-stu-id="99ede-124">This field is usually set in the session template.</span></span> <span data-ttu-id="99ede-125">See [MPSD Session Templates](multiplayer-session-directory.md).</span><span class="sxs-lookup"><span data-stu-id="99ede-125">See [MPSD Session Templates](multiplayer-session-directory.md).</span></span> |



<span data-ttu-id="99ede-126">To receive MPSD session change notifications, the title can follow the procedure below.</span><span class="sxs-lookup"><span data-stu-id="99ede-126">To receive MPSD session change notifications, the title can follow the procedure below.</span></span>

1.  <span data-ttu-id="99ede-127">Use the same **XboxLiveContext Class** object for all calls by the same user.</span><span class="sxs-lookup"><span data-stu-id="99ede-127">Use the same **XboxLiveContext Class** object for all calls by the same user.</span></span> <span data-ttu-id="99ede-128">Subscriptions are tied to the lifetime of this object.</span><span class="sxs-lookup"><span data-stu-id="99ede-128">Subscriptions are tied to the lifetime of this object.</span></span> <span data-ttu-id="99ede-129">If there are multiple local users, use a separate **XboxLiveContext** object for each user.</span><span class="sxs-lookup"><span data-stu-id="99ede-129">If there are multiple local users, use a separate **XboxLiveContext** object for each user.</span></span>
2.  <span data-ttu-id="99ede-130">Implement event handlers for the **RealTimeActivityService.MultiplayerSessionChanged Event** and the **RealTimeActivityService.MultiplayerSubscriptionsLost Event**.</span><span class="sxs-lookup"><span data-stu-id="99ede-130">Implement event handlers for the **RealTimeActivityService.MultiplayerSessionChanged Event** and the **RealTimeActivityService.MultiplayerSubscriptionsLost Event**.</span></span>
3.  <span data-ttu-id="99ede-131">If subscribing to changes for more than one user, add code to your **MultiplayerSessionChanged** event handler to avoid unnecessary work.</span><span class="sxs-lookup"><span data-stu-id="99ede-131">If subscribing to changes for more than one user, add code to your **MultiplayerSessionChanged** event handler to avoid unnecessary work.</span></span> <span data-ttu-id="99ede-132">Use the **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property** and the **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property**.</span><span class="sxs-lookup"><span data-stu-id="99ede-132">Use the **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property** and the **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property**.</span></span> <span data-ttu-id="99ede-133">Use of these properties allows tracking of the last change seen and ignoring of older changes.</span><span class="sxs-lookup"><span data-stu-id="99ede-133">Use of these properties allows tracking of the last change seen and ignoring of older changes.</span></span>
4.  <span data-ttu-id="99ede-134">Call the **RealTimeActivityService.EnableMultiplayerSubscriptions Method** to allow subscriptions.</span><span class="sxs-lookup"><span data-stu-id="99ede-134">Call the **RealTimeActivityService.EnableMultiplayerSubscriptions Method** to allow subscriptions.</span></span>
5.  <span data-ttu-id="99ede-135">Create a local session object and join that session as active.</span><span class="sxs-lookup"><span data-stu-id="99ede-135">Create a local session object and join that session as active.</span></span>
6.  <span data-ttu-id="99ede-136">Make calls for each user to the **MultiplayerSession.SetSessionChangeSubscription Method**, passing the session change type for which to be notified.</span><span class="sxs-lookup"><span data-stu-id="99ede-136">Make calls for each user to the **MultiplayerSession.SetSessionChangeSubscription Method**, passing the session change type for which to be notified.</span></span>
7.  <span data-ttu-id="99ede-137">Now write the session to MPSD as described in **How to: Update a Multiplayer Session**.</span><span class="sxs-lookup"><span data-stu-id="99ede-137">Now write the session to MPSD as described in **How to: Update a Multiplayer Session**.</span></span>

<span data-ttu-id="99ede-138">次のフロー チャートは、この手順で説明するイベントにサブスクライブしてマルチプレイヤーを開始する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="99ede-138">The following flow chart illustrates how to start Multplayer by subscribing to the events described in this procedure.</span></span>

![](../../images/multiplayer/Multiplayer_2015_Start_Multiplayer.png)


### <a name="parsing-duplicate-session-change-notifications"></a><span data-ttu-id="99ede-139">重複するセッション変更通知の解析</span><span class="sxs-lookup"><span data-stu-id="99ede-139">Parsing duplicate session change notifications</span></span>

<span data-ttu-id="99ede-140">When there are multiple users subscribed to notifications for the same session, every change to that session will trigger a shoulder tap for each user.</span><span class="sxs-lookup"><span data-stu-id="99ede-140">When there are multiple users subscribed to notifications for the same session, every change to that session will trigger a shoulder tap for each user.</span></span> <span data-ttu-id="99ede-141">All but one of these will be duplicates.</span><span class="sxs-lookup"><span data-stu-id="99ede-141">All but one of these will be duplicates.</span></span> <span data-ttu-id="99ede-142">While it's still recommended that a title subscribe every user in a session to notifications, a title should ignore any changes that it's already been notified of; you can do this using the Branch and ChangeNumber properties.</span><span class="sxs-lookup"><span data-stu-id="99ede-142">While it's still recommended that a title subscribe every user in a session to notifications, a title should ignore any changes that it's already been notified of; you can do this using the Branch and ChangeNumber properties.</span></span>

<span data-ttu-id="99ede-143">To detect multiple shoulder taps, a title should:</span><span class="sxs-lookup"><span data-stu-id="99ede-143">To detect multiple shoulder taps, a title should:</span></span>

-   <span data-ttu-id="99ede-144">For each **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property** value seen, store the latest **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property**.</span><span class="sxs-lookup"><span data-stu-id="99ede-144">For each **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property** value seen, store the latest **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property**.</span></span>
-   <span data-ttu-id="99ede-145">If a shoulder tap has a higher **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** than the last seen for that **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property**, process it and update the latest **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property**.</span><span class="sxs-lookup"><span data-stu-id="99ede-145">If a shoulder tap has a higher **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** than the last seen for that **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property**, process it and update the latest **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property**.</span></span>
-   <span data-ttu-id="99ede-146">If a shoulder tap does not have a higher **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** for that **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property**, skip it.</span><span class="sxs-lookup"><span data-stu-id="99ede-146">If a shoulder tap does not have a higher **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** for that **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property**, skip it.</span></span> <span data-ttu-id="99ede-147">That change has already been handled.</span><span class="sxs-lookup"><span data-stu-id="99ede-147">That change has already been handled.</span></span>

| <span data-ttu-id="99ede-148">Note</span><span class="sxs-lookup"><span data-stu-id="99ede-148">Note</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-149">**RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** values need to be tracked by **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property**, not by session.</span><span class="sxs-lookup"><span data-stu-id="99ede-149">**RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** values need to be tracked by **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property**, not by session.</span></span> <span data-ttu-id="99ede-150">It's possible for the **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property** value to change (and the **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** to reset) within the lifetime of a session.</span><span class="sxs-lookup"><span data-stu-id="99ede-150">It's possible for the **RealTimeActivityMultiplayerSessionChangeEventArgs.Branch Property** value to change (and the **RealTimeActivityMultiplayerSessionChangeEventArgs.ChangeNumber Property** to reset) within the lifetime of a session.</span></span> |

## <a name="create-an-mpsd-session"></a><span data-ttu-id="99ede-151">MPSD セッションの作成</span><span class="sxs-lookup"><span data-stu-id="99ede-151">Create an MPSD session</span></span>


| <span data-ttu-id="99ede-152">注意</span><span class="sxs-lookup"><span data-stu-id="99ede-152">Note</span></span>                                                                                                                                                                                                                           |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-153">By default, an MPSD session is created when the first member joins it.</span><span class="sxs-lookup"><span data-stu-id="99ede-153">By default, an MPSD session is created when the first member joins it.</span></span> <span data-ttu-id="99ede-154">If your title logic expects the title to exist or not exist at join time, it can pass an appropriate write mode value to the write method during the session update.</span><span class="sxs-lookup"><span data-stu-id="99ede-154">If your title logic expects the title to exist or not exist at join time, it can pass an appropriate write mode value to the write method during the session update.</span></span> |



<span data-ttu-id="99ede-155">The title must do the following to create a new session:</span><span class="sxs-lookup"><span data-stu-id="99ede-155">The title must do the following to create a new session:</span></span>

1.  <span data-ttu-id="99ede-156">Create a new **XboxLiveContext Class** object.</span><span class="sxs-lookup"><span data-stu-id="99ede-156">Create a new **XboxLiveContext Class** object.</span></span> <span data-ttu-id="99ede-157">Your title creates this object once, stores it, and reuses it as required throughout the source code.</span><span class="sxs-lookup"><span data-stu-id="99ede-157">Your title creates this object once, stores it, and reuses it as required throughout the source code.</span></span> <span data-ttu-id="99ede-158">Especially when working with session subscriptions, it is necessary to use exactly the same context.</span><span class="sxs-lookup"><span data-stu-id="99ede-158">Especially when working with session subscriptions, it is necessary to use exactly the same context.</span></span>
2.  <span data-ttu-id="99ede-159">Create a new **MultiplayerSession Class** object to prepare all the session data that the MPSD needs to create a new session.</span><span class="sxs-lookup"><span data-stu-id="99ede-159">Create a new **MultiplayerSession Class** object to prepare all the session data that the MPSD needs to create a new session.</span></span>
3.  <span data-ttu-id="99ede-160">Make required changes before writing the session to MPSD.</span><span class="sxs-lookup"><span data-stu-id="99ede-160">Make required changes before writing the session to MPSD.</span></span> <span data-ttu-id="99ede-161">For example, when joining a member to the session with a call to **MultiplayerSession.Join Method**, the client adds hidden local request data that tells MPSD to join upon the call to update the session.</span><span class="sxs-lookup"><span data-stu-id="99ede-161">For example, when joining a member to the session with a call to **MultiplayerSession.Join Method**, the client adds hidden local request data that tells MPSD to join upon the call to update the session.</span></span>
4.  <span data-ttu-id="99ede-162">When finished making local changes, write them to MPSD as described in **How to: Update a Multiplayer Session**.</span><span class="sxs-lookup"><span data-stu-id="99ede-162">When finished making local changes, write them to MPSD as described in **How to: Update a Multiplayer Session**.</span></span>
5.  <span data-ttu-id="99ede-163">Receive the new **MultiplayerSession** object from MPSD, with many fields filled in.</span><span class="sxs-lookup"><span data-stu-id="99ede-163">Receive the new **MultiplayerSession** object from MPSD, with many fields filled in.</span></span>
6.  <span data-ttu-id="99ede-164">Use the new session object going forward, and discard the old copy, which contains a hidden request to create a new session.</span><span class="sxs-lookup"><span data-stu-id="99ede-164">Use the new session object going forward, and discard the old copy, which contains a hidden request to create a new session.</span></span>

### <a name="example"></a><span data-ttu-id="99ede-165">例</span><span class="sxs-lookup"><span data-stu-id="99ede-165">Example</span></span>

    void Example_MultiplayerService_CreateSession()
    {
      XboxLiveContext^ xboxLiveContext = ref new Microsoft::Xbox::Services::XboxLiveContext(User::Users->GetAt(0));

      // These from XDP web portal
      MultiplayerSessionReference^ multiplayerSessionReference = ref new MultiplayerSessionReference(
        "c83c597b-7377-4886-99e3-2b5818fa5e4f", // serviceConfigurationId
        "team-deathmatch", // sessionTemplateName
        "mySession" // sessionName
        );

      MultiplayerSession^ multiplayerSession = ref new MultiplayerSession(
        xboxLiveContext,
        multiplayerSessionReference
        );

      auto asyncOp = xboxLiveContext->MultiplayerService->WriteSessionAsync(
        multiplayerSession,
        MultiplayerSessionWriteMode::CreateNew
        );

      create_task(asyncOp)
      .then([](MultiplayerSession^ newMultiplayerSession)
      {
        // Throw away stale multiplayerSession, and use newMultiplayerSession from now on
      });
    }


## <a name="set-an-arbiter-for-an-mpsd-session"></a><span data-ttu-id="99ede-166">MPSD セッションのアービターの設定</span><span class="sxs-lookup"><span data-stu-id="99ede-166">Set an arbiter for an MPSD session</span></span>




<span data-ttu-id="99ede-167">タイトルは、次の手順を使用して、作成済みのセッションのアービターを設定します。</span><span class="sxs-lookup"><span data-stu-id="99ede-167">The title uses the following procedure to set an arbiter for a session that has already been created.</span></span>

| <span data-ttu-id="99ede-168">Note</span><span class="sxs-lookup"><span data-stu-id="99ede-168">Note</span></span>                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-169">Device tokens for the members (potential hosts) are not available until the members have joined the session and included their secure device addresses.</span><span class="sxs-lookup"><span data-stu-id="99ede-169">Device tokens for the members (potential hosts) are not available until the members have joined the session and included their secure device addresses.</span></span> |

1.  <span data-ttu-id="99ede-170">Retrieve the device tokens for host candidates from the MPSD by using the **MultiplayerSession.Members Property**.</span><span class="sxs-lookup"><span data-stu-id="99ede-170">Retrieve the device tokens for host candidates from the MPSD by using the **MultiplayerSession.Members Property**.</span></span>

| <span data-ttu-id="99ede-171">Note</span><span class="sxs-lookup"><span data-stu-id="99ede-171">Note</span></span>                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="99ede-172">If the session was created by SmartMatch matchmaking, your clients can use the host candidates available from MPSD through the **MultiplayerSession.HostCandidates Property**.</span><span class="sxs-lookup"><span data-stu-id="99ede-172">If the session was created by SmartMatch matchmaking, your clients can use the host candidates available from MPSD through the **MultiplayerSession.HostCandidates Property**.</span></span> |

2.  <span data-ttu-id="99ede-173">Select the required host from the list of host candidates.</span><span class="sxs-lookup"><span data-stu-id="99ede-173">Select the required host from the list of host candidates.</span></span>
3.  <span data-ttu-id="99ede-174">Call the **MultiplayerSession.SetHostDeviceToken Method** to set the device token in the local cache of the MPSD.</span><span class="sxs-lookup"><span data-stu-id="99ede-174">Call the **MultiplayerSession.SetHostDeviceToken Method** to set the device token in the local cache of the MPSD.</span></span> <span data-ttu-id="99ede-175">If the call to set the host device token succeeds, the local device token replaces the host's token.</span><span class="sxs-lookup"><span data-stu-id="99ede-175">If the call to set the host device token succeeds, the local device token replaces the host's token.</span></span>
4.  <span data-ttu-id="99ede-176">If an HTTP/412 status code is received when trying to set the host device token, query the session data and see if the host device token is for the local console.</span><span class="sxs-lookup"><span data-stu-id="99ede-176">If an HTTP/412 status code is received when trying to set the host device token, query the session data and see if the host device token is for the local console.</span></span> <span data-ttu-id="99ede-177">If it is not for the local console, another console has been designated as the arbiter.</span><span class="sxs-lookup"><span data-stu-id="99ede-177">If it is not for the local console, another console has been designated as the arbiter.</span></span>

| <span data-ttu-id="99ede-178">Note</span><span class="sxs-lookup"><span data-stu-id="99ede-178">Note</span></span>                                                                                                                                                                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-179">Your client should handle the HTTP/412 status code separately from other HTTP codes, since HTTP/412 does not indicate a standard failure.</span><span class="sxs-lookup"><span data-stu-id="99ede-179">Your client should handle the HTTP/412 status code separately from other HTTP codes, since HTTP/412 does not indicate a standard failure.</span></span> <span data-ttu-id="99ede-180">For more about the status code, see [Multiplayer Session Status Codes](multiplayer-session-status-codes.md).</span><span class="sxs-lookup"><span data-stu-id="99ede-180">For more about the status code, see [Multiplayer Session Status Codes](multiplayer-session-status-codes.md).</span></span> |

5.  <span data-ttu-id="99ede-181">Update the session in MPSD, as described in **How to: Update a Multiplayer Session**.</span><span class="sxs-lookup"><span data-stu-id="99ede-181">Update the session in MPSD, as described in **How to: Update a Multiplayer Session**.</span></span>

| <span data-ttu-id="99ede-182">Note</span><span class="sxs-lookup"><span data-stu-id="99ede-182">Note</span></span>                                                                                                                                                                                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-183">If you have no better algorithm, the client can implement a greedy algorithm in which each host candidate attempts to set itself as the host if nobody else has done it yet.</span><span class="sxs-lookup"><span data-stu-id="99ede-183">If you have no better algorithm, the client can implement a greedy algorithm in which each host candidate attempts to set itself as the host if nobody else has done it yet.</span></span> <span data-ttu-id="99ede-184">詳しくは、「[セッション アービター](mpsd-session-details.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="99ede-184">For more information, see [Session Arbiter](mpsd-session-details.md).</span></span> |

## <a name="manage-title-activation"></a><span data-ttu-id="99ede-185">タイトルのアクティベーションの管理</span><span class="sxs-lookup"><span data-stu-id="99ede-185">Manage title activation</span></span>

<span data-ttu-id="99ede-186">Xbox One は、プロトコル アクティベーション時に **CoreApplicationView.Activated イベント**を発生させます。</span><span class="sxs-lookup"><span data-stu-id="99ede-186">Xbox One fires the **CoreApplicationView.Activated Event** during protocol activation.</span></span> <span data-ttu-id="99ede-187">In the context of the multiplayer API, this event is fired when a user accepts an invite or joins another user.</span><span class="sxs-lookup"><span data-stu-id="99ede-187">In the context of the multiplayer API, this event is fired when a user accepts an invite or joins another user.</span></span> <span data-ttu-id="99ede-188">These actions trigger an activation that the title must react to by bringing the joining user into game play with the target user.</span><span class="sxs-lookup"><span data-stu-id="99ede-188">These actions trigger an activation that the title must react to by bringing the joining user into game play with the target user.</span></span>

| <span data-ttu-id="99ede-189">Note</span><span class="sxs-lookup"><span data-stu-id="99ede-189">Note</span></span>                                                                                       |
|---------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-190">Your title should expect new activation arguments at any time and should never be coded against length.</span><span class="sxs-lookup"><span data-stu-id="99ede-190">Your title should expect new activation arguments at any time and should never be coded against length.</span></span> |

<span data-ttu-id="99ede-191">The title must perform the following main steps to handle title activation.</span><span class="sxs-lookup"><span data-stu-id="99ede-191">The title must perform the following main steps to handle title activation.</span></span>

1.  <span data-ttu-id="99ede-192">Set up an event handler for the **CoreApplicationView.Activated Event**.</span><span class="sxs-lookup"><span data-stu-id="99ede-192">Set up an event handler for the **CoreApplicationView.Activated Event**.</span></span> <span data-ttu-id="99ede-193">This handler triggers every time protocol activation occurs, even if the title is already running.</span><span class="sxs-lookup"><span data-stu-id="99ede-193">This handler triggers every time protocol activation occurs, even if the title is already running.</span></span>
2.  <span data-ttu-id="99ede-194">At title activation, begin a session and subscribe for session change notifications.</span><span class="sxs-lookup"><span data-stu-id="99ede-194">At title activation, begin a session and subscribe for session change notifications.</span></span> <span data-ttu-id="99ede-195">See **How to: Subscribe for MPSD Session Change Notifications**.</span><span class="sxs-lookup"><span data-stu-id="99ede-195">See **How to: Subscribe for MPSD Session Change Notifications**.</span></span>
3.  <span data-ttu-id="99ede-196">Join the user to the session as active.</span><span class="sxs-lookup"><span data-stu-id="99ede-196">Join the user to the session as active.</span></span> <span data-ttu-id="99ede-197">See **How to: Join an MPSD Session from a Title Activation**.</span><span class="sxs-lookup"><span data-stu-id="99ede-197">See **How to: Join an MPSD Session from a Title Activation**.</span></span>
4.  <span data-ttu-id="99ede-198">Set the lobby session as the activity session, exposed through the profile UI.</span><span class="sxs-lookup"><span data-stu-id="99ede-198">Set the lobby session as the activity session, exposed through the profile UI.</span></span> <span data-ttu-id="99ede-199">See **How to: Set the User's Current Activity**.</span><span class="sxs-lookup"><span data-stu-id="99ede-199">See **How to: Set the User's Current Activity**.</span></span>
5.  <span data-ttu-id="99ede-200">Join the user to the game session as active.</span><span class="sxs-lookup"><span data-stu-id="99ede-200">Join the user to the game session as active.</span></span> <span data-ttu-id="99ede-201">Now the user can connect to peers and enter game play or the lobby.</span><span class="sxs-lookup"><span data-stu-id="99ede-201">Now the user can connect to peers and enter game play or the lobby.</span></span>

<span data-ttu-id="99ede-202">次のフロー チャートは、タイトルのアクティベーションを処理する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="99ede-202">The following flow chart illustrates how to handle title activation.</span></span>

![](../../images/multiplayer/Multiplayer_2015_OnActivation.png)

## <a name="make-the-user-joinable"></a><span data-ttu-id="99ede-203">ユーザーを参加可能にする</span><span class="sxs-lookup"><span data-stu-id="99ede-203">Make the user joinable</span></span>

<span data-ttu-id="99ede-204">ユーザーを参加可能にするには、タイトルで次の手順を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="99ede-204">To make the user joinable, the title must do the following:</span></span>

1.  <span data-ttu-id="99ede-205">Create a session object, and modify the attributes as required.</span><span class="sxs-lookup"><span data-stu-id="99ede-205">Create a session object, and modify the attributes as required.</span></span>
2.  <span data-ttu-id="99ede-206">Join the user to the session as active.</span><span class="sxs-lookup"><span data-stu-id="99ede-206">Join the user to the session as active.</span></span> <span data-ttu-id="99ede-207">See **How to: Join an MPSD Session from a Title Activation**.</span><span class="sxs-lookup"><span data-stu-id="99ede-207">See **How to: Join an MPSD Session from a Title Activation**.</span></span>
3.  <span data-ttu-id="99ede-208">Determine if the user has been designated as the session arbiter.</span><span class="sxs-lookup"><span data-stu-id="99ede-208">Determine if the user has been designated as the session arbiter.</span></span>
4.  <span data-ttu-id="99ede-209">If the user is not the arbiter, go to step 7.</span><span class="sxs-lookup"><span data-stu-id="99ede-209">If the user is not the arbiter, go to step 7.</span></span>
5.  <span data-ttu-id="99ede-210">If the user is the arbiter, call the **MultiplayerSession.SetHostDeviceToken Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-210">If the user is the arbiter, call the **MultiplayerSession.SetHostDeviceToken Method**.</span></span>
6.  <span data-ttu-id="99ede-211">Attempt to write the session using a call to the **MultiplayerService.TryWriteSessionAsync Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-211">Attempt to write the session using a call to the **MultiplayerService.TryWriteSessionAsync Method**.</span></span>
7.  <span data-ttu-id="99ede-212">Set the session as the active session.</span><span class="sxs-lookup"><span data-stu-id="99ede-212">Set the session as the active session.</span></span> <span data-ttu-id="99ede-213">See **How to: Set the User's Current Activity**.</span><span class="sxs-lookup"><span data-stu-id="99ede-213">See **How to: Set the User's Current Activity**.</span></span>

<span data-ttu-id="99ede-214">次のフロー チャートは、ゲーム中に他のプレイヤーによってユーザーが参加できるようにするための手順を示します。</span><span class="sxs-lookup"><span data-stu-id="99ede-214">The following flow chart illustrates the steps to take to allow a user to be joined by other players during a game.</span></span>

![](../../images/multiplayer/Multiplayer_2015_Become_Joinable.png)

## <a name="send-game-invites"></a><span data-ttu-id="99ede-215">ゲームへの招待の送信</span><span class="sxs-lookup"><span data-stu-id="99ede-215">Send game invites</span></span>

<span data-ttu-id="99ede-216">タイトルでは、次の方法でプレイヤーがゲームへの招待を送信することを可能にできます。</span><span class="sxs-lookup"><span data-stu-id="99ede-216">The title can enable a player to send game invites in the following ways:</span></span>

-   <span data-ttu-id="99ede-217">Send the invites for the lobby session.</span><span class="sxs-lookup"><span data-stu-id="99ede-217">Send the invites for the lobby session.</span></span>
-   <span data-ttu-id="99ede-218">Send the invites using the generic Xbox platform invite UI with the game session reference.</span><span class="sxs-lookup"><span data-stu-id="99ede-218">Send the invites using the generic Xbox platform invite UI with the game session reference.</span></span>

<span data-ttu-id="99ede-219">To send game invites for a player, the title must do the following:</span><span class="sxs-lookup"><span data-stu-id="99ede-219">To send game invites for a player, the title must do the following:</span></span>

1.  <span data-ttu-id="99ede-220">Make the inviting game player joinable.</span><span class="sxs-lookup"><span data-stu-id="99ede-220">Make the inviting game player joinable.</span></span> <span data-ttu-id="99ede-221">See **How to: Make the User Joinable**.</span><span class="sxs-lookup"><span data-stu-id="99ede-221">See **How to: Make the User Joinable**.</span></span>
2.  <span data-ttu-id="99ede-222">Determine if the invites are to be sent via the lobby session or using the invite UI.</span><span class="sxs-lookup"><span data-stu-id="99ede-222">Determine if the invites are to be sent via the lobby session or using the invite UI.</span></span>
3.  <span data-ttu-id="99ede-223">If using the lobby session, send the invites using a call to **MultiplayerService.SendInvitesAsync Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-223">If using the lobby session, send the invites using a call to **MultiplayerService.SendInvitesAsync Method**.</span></span> <span data-ttu-id="99ede-224">This method might require the building of an in-game UI roster using the **SystemUI.ShowPeoplePickerAsync Method** or the **PartyChat.GetPartyChatViewAsync Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-224">This method might require the building of an in-game UI roster using the **SystemUI.ShowPeoplePickerAsync Method** or the **PartyChat.GetPartyChatViewAsync Method**.</span></span>
4.  <span data-ttu-id="99ede-225">If using the invite UI, call the **SystemUI.ShowSendGameInvitesAsync Method** to show the invite UI.</span><span class="sxs-lookup"><span data-stu-id="99ede-225">If using the invite UI, call the **SystemUI.ShowSendGameInvitesAsync Method** to show the invite UI.</span></span>
5.  <span data-ttu-id="99ede-226">Handle the **RealTimeActivityService.MultiplayerSessionChanged Event** for the local player after the remote player joins.</span><span class="sxs-lookup"><span data-stu-id="99ede-226">Handle the **RealTimeActivityService.MultiplayerSessionChanged Event** for the local player after the remote player joins.</span></span>
6.  <span data-ttu-id="99ede-227">For the remote player, implement title activation code.</span><span class="sxs-lookup"><span data-stu-id="99ede-227">For the remote player, implement title activation code.</span></span> <span data-ttu-id="99ede-228">See **How to: Manage Title Activation**.</span><span class="sxs-lookup"><span data-stu-id="99ede-228">See **How to: Manage Title Activation**.</span></span>

<span data-ttu-id="99ede-229">次のフロー チャートは、招待を送信する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="99ede-229">The following flow chart illustrates how to send invites.</span></span>

![](../../images/multiplayer/Multiplayer_2015_Send_Invites.png)

## <a name="join-a-game-session-from-a-lobby-session"></a><span data-ttu-id="99ede-230">ロビー セッションからゲーム セッションへの参加</span><span class="sxs-lookup"><span data-stu-id="99ede-230">Join a game session from a lobby session</span></span>

<span data-ttu-id="99ede-231">Windows 10 デバイスのゲームプレイ セッションでは、大規模なセッションでない場合、`userAuthorizationStyle` 機能を **true** に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="99ede-231">Gameplay sessions on Windows 10 devices must have the `userAuthorizationStyle` capability set to **true** if they are not large sessions.</span></span> <span data-ttu-id="99ede-232">つまり、`joinRestriction` プロパティを "none" にすることはできません。これは、セッションへの一般からの直接参加はできないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="99ede-232">This means that the `joinRestriction` property cannot be "none", which means that the session can't be publicly joinable directly.</span></span>

<span data-ttu-id="99ede-233">一般的なシナリオでは、ロビー セッションを作成してプレイヤーを集め、それらのプレイヤーをゲームプレイ セッションまたはマッチメイキング セッションに移動します。</span><span class="sxs-lookup"><span data-stu-id="99ede-233">A common scenario is to create a lobby session to gather players, and then move those players into a gameplay session or matchmaking session.</span></span> <span data-ttu-id="99ede-234">ただし、ゲームプレイ セッションが一般から参加不可能な場合、ゲーム クライアントは `joinRestriction` 設定を満たしていない限りゲームプレイ セッションに参加できません。この制限は、このようなシナリオには厳しすぎる場合がほとんどです。</span><span class="sxs-lookup"><span data-stu-id="99ede-234">But if the gameplay session is not publicly joinable, then the game clients will not be able to join the gameplay session unless they meet the `joinRestriction` setting, which is too restrictive in most cases for this scenario.</span></span>

<span data-ttu-id="99ede-235">これを解決するには、転送ハンドルを使ってロビー セッションとゲーム セッションをリンクします。</span><span class="sxs-lookup"><span data-stu-id="99ede-235">The solution is use a transfer handle to link the lobby session and the game session.</span></span>  <span data-ttu-id="99ede-236">タイトルでは、次の操作でこれを実行できます。</span><span class="sxs-lookup"><span data-stu-id="99ede-236">The title can do this by doing the following:</span></span>

1. <span data-ttu-id="99ede-237">ゲーム セッションの作成時に、`multiplayer_service::set_transfer_handle(gameSessionRef, lobbySessionRef)` API を使って、ロビー セッションとゲーム セッションをリンクする転送ハンドルを作成します。</span><span class="sxs-lookup"><span data-stu-id="99ede-237">When you create the game session, use the `multiplayer_service::set_transfer_handle(gameSessionRef, lobbySessionRef)` API to create a transfer handle that links the lobby session and the game session.</span></span>
2. <span data-ttu-id="99ede-238">ゲーム セッションのセッション参照の代わりに、転送ハンドルの GUID をロビー セッションに格納します。</span><span class="sxs-lookup"><span data-stu-id="99ede-238">Store the transfer handle GUID in the lobby session instead of the game session's session reference.</span></span>
3. <span data-ttu-id="99ede-239">タイトルでロビー セッションからゲーム セッションにメンバーを移動するとき、各クライアントでは、ロビー セッションから転送ハンドルを使い、`multiplayer_service::write_session_by_handle(multiplayerSession, multiplayerSessionWriteMode, handleId)` API を呼び出してゲーム セッションに参加します。</span><span class="sxs-lookup"><span data-stu-id="99ede-239">When the title wants to move members from the lobby session to the game session, each client would use the transfer handle from the lobby session to join the game session by using the `multiplayer_service::write_session_by_handle(multiplayerSession, multiplayerSessionWriteMode, handleId)` API.</span></span>
4. <span data-ttu-id="99ede-240">MPSD は、ロビー セッションを検索し、転送ハンドルを使ってゲーム セッションに参加しようとしているユーザーがロビー セッションにも存在することを確認します。</span><span class="sxs-lookup"><span data-stu-id="99ede-240">MPSD looks up the lobby session to verify that the members attempting to join the game session by using the transfer handle are also in the lobby session.</span></span>
5. <span data-ttu-id="99ede-241">ロビー セッションに存在するメンバーであれば、ゲーム セッションにアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="99ede-241">If the members are in the lobby session, they will be able to access the game session.</span></span>

## <a name="join-an-mpsd-session-from-a-title-activation"></a><span data-ttu-id="99ede-242">タイトルのアクティベーションからの MPSD セッションへの参加</span><span class="sxs-lookup"><span data-stu-id="99ede-242">Join an MPSD session from a title activation</span></span>

<span data-ttu-id="99ede-243">When a user chooses to join a friend's activity or accept an invite using Xbox shell UI, the title is activated with parameters that indicate what session the user would like to join.</span><span class="sxs-lookup"><span data-stu-id="99ede-243">When a user chooses to join a friend's activity or accept an invite using Xbox shell UI, the title is activated with parameters that indicate what session the user would like to join.</span></span> <span data-ttu-id="99ede-244">The title must handle this activation and add the user to the corresponding session.</span><span class="sxs-lookup"><span data-stu-id="99ede-244">The title must handle this activation and add the user to the corresponding session.</span></span>

<span data-ttu-id="99ede-245">Here are the steps the title should follow:</span><span class="sxs-lookup"><span data-stu-id="99ede-245">Here are the steps the title should follow:</span></span>

1.  <span data-ttu-id="99ede-246">Implement an event handler for the **CoreApplicationView.Activated Event**.</span><span class="sxs-lookup"><span data-stu-id="99ede-246">Implement an event handler for the **CoreApplicationView.Activated Event**.</span></span> <span data-ttu-id="99ede-247">This event notifies of activations for the title.</span><span class="sxs-lookup"><span data-stu-id="99ede-247">This event notifies of activations for the title.</span></span>
2.  <span data-ttu-id="99ede-248">When the handler fires, examine the **IActivatedEventArgs.Kind Property**.</span><span class="sxs-lookup"><span data-stu-id="99ede-248">When the handler fires, examine the **IActivatedEventArgs.Kind Property**.</span></span> <span data-ttu-id="99ede-249">If it is set to Protocol, cast the event arguments to **ProtocolActivatedEventArgs Class**.</span><span class="sxs-lookup"><span data-stu-id="99ede-249">If it is set to Protocol, cast the event arguments to **ProtocolActivatedEventArgs Class**.</span></span>
3.  <span data-ttu-id="99ede-250">Examine the **ProtocolActivatedEventArgs** object.</span><span class="sxs-lookup"><span data-stu-id="99ede-250">Examine the **ProtocolActivatedEventArgs** object.</span></span> <span data-ttu-id="99ede-251">If the URI indicated in the **ProtocolActivatedEventArgs.Uri Property** matches either inviteHandleAccept (corresponding to an accepted invite) or activityHandleJoin (corresponding to a join via shell UI), parse the query string of the URI, which is formatted as a normal URI query string with key/value pairs, extracting the following fields:</span><span class="sxs-lookup"><span data-stu-id="99ede-251">If the URI indicated in the **ProtocolActivatedEventArgs.Uri Property** matches either inviteHandleAccept (corresponding to an accepted invite) or activityHandleJoin (corresponding to a join via shell UI), parse the query string of the URI, which is formatted as a normal URI query string with key/value pairs, extracting the following fields:</span></span>
    -   <span data-ttu-id="99ede-252">For an accepted invite:</span><span class="sxs-lookup"><span data-stu-id="99ede-252">For an accepted invite:</span></span>
        1.  <span data-ttu-id="99ede-253">handle</span><span class="sxs-lookup"><span data-stu-id="99ede-253">handle</span></span>
        2.  <span data-ttu-id="99ede-254">invitedXuid</span><span class="sxs-lookup"><span data-stu-id="99ede-254">invitedXuid</span></span>
        3.  <span data-ttu-id="99ede-255">senderXuid</span><span class="sxs-lookup"><span data-stu-id="99ede-255">senderXuid</span></span>
    -   <span data-ttu-id="99ede-256">For a join:</span><span class="sxs-lookup"><span data-stu-id="99ede-256">For a join:</span></span>
        1.  <span data-ttu-id="99ede-257">handle</span><span class="sxs-lookup"><span data-stu-id="99ede-257">handle</span></span>
        2.  <span data-ttu-id="99ede-258">joinerXuid</span><span class="sxs-lookup"><span data-stu-id="99ede-258">joinerXuid</span></span>
        3.  <span data-ttu-id="99ede-259">joineeXuid</span><span class="sxs-lookup"><span data-stu-id="99ede-259">joineeXuid</span></span>

4.  <span data-ttu-id="99ede-260">Start the title's multiplayer code, which should include calling the **RealTimeActivityService.EnableMultiplayerSubscriptions Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-260">Start the title's multiplayer code, which should include calling the **RealTimeActivityService.EnableMultiplayerSubscriptions Method**.</span></span>
5.  <span data-ttu-id="99ede-261">Create a local **MultiplayerSession Class** object, using the **MultiplayerSession Constructor (XboxLiveContext)**.</span><span class="sxs-lookup"><span data-stu-id="99ede-261">Create a local **MultiplayerSession Class** object, using the **MultiplayerSession Constructor (XboxLiveContext)**.</span></span>
6.  <span data-ttu-id="99ede-262">Call the **MultiplayerSession.Join Method (String, Boolean, Boolean)** to join the session.</span><span class="sxs-lookup"><span data-stu-id="99ede-262">Call the **MultiplayerSession.Join Method (String, Boolean, Boolean)** to join the session.</span></span> <span data-ttu-id="99ede-263">Use the following parameter settings so that the join is set as active:</span><span class="sxs-lookup"><span data-stu-id="99ede-263">Use the following parameter settings so that the join is set as active:</span></span>
    -   <span data-ttu-id="99ede-264">*memberCustomConstantsJson* = null</span><span class="sxs-lookup"><span data-stu-id="99ede-264">*memberCustomConstantsJson* = null</span></span>
    -   <span data-ttu-id="99ede-265">*initializeRequested* = false</span><span class="sxs-lookup"><span data-stu-id="99ede-265">*initializeRequested* = false</span></span>
    -   <span data-ttu-id="99ede-266">*joinWithActiveStatus* = true</span><span class="sxs-lookup"><span data-stu-id="99ede-266">*joinWithActiveStatus* = true</span></span>

7.  <span data-ttu-id="99ede-267">Call the **MultiplayerSession.SetSessionChangeSubscription Method** to be shoulder-tapped when the session changes after joining.</span><span class="sxs-lookup"><span data-stu-id="99ede-267">Call the **MultiplayerSession.SetSessionChangeSubscription Method** to be shoulder-tapped when the session changes after joining.</span></span>
8.  <span data-ttu-id="99ede-268">Call the **MultiplayerService.WriteSessionByHandleAsync Method**, using the handle acquired as described in step 3.</span><span class="sxs-lookup"><span data-stu-id="99ede-268">Call the **MultiplayerService.WriteSessionByHandleAsync Method**, using the handle acquired as described in step 3.</span></span> <span data-ttu-id="99ede-269">ユーザーはセッションのメンバーになっているので、セッション内のデータを使用してゲームに接続できます。</span><span class="sxs-lookup"><span data-stu-id="99ede-269">Now the user is a member of the session, and can use data in the session to connect to the game.</span></span>

## <a name="set-the-users-current-activity"></a><span data-ttu-id="99ede-270">ユーザーの現在のアクティビティの設定</span><span class="sxs-lookup"><span data-stu-id="99ede-270">Set the user's current activity</span></span>

<span data-ttu-id="99ede-271">ユーザーの現在のアクティビティは、タイトルの Xbox ダッシュボードのユーザー エクスペリエンスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="99ede-271">The user's current activity is displayed in Xbox dashboard user experiences for the title.</span></span> <span data-ttu-id="99ede-272">Activity for a user can be set through a session or through title activation.</span><span class="sxs-lookup"><span data-stu-id="99ede-272">Activity for a user can be set through a session or through title activation.</span></span> <span data-ttu-id="99ede-273">In the latter case, the user enters a session through matchmaking or by starting a game.</span><span class="sxs-lookup"><span data-stu-id="99ede-273">In the latter case, the user enters a session through matchmaking or by starting a game.</span></span>

| <span data-ttu-id="99ede-274">Note</span><span class="sxs-lookup"><span data-stu-id="99ede-274">Note</span></span>                                                                                                                                                  |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-275">Activity set through a session can be deleted with a call to the **MultiplayerService.ClearActivityAsync Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-275">Activity set through a session can be deleted with a call to the **MultiplayerService.ClearActivityAsync Method**.</span></span> |

<span data-ttu-id="99ede-276">To set a session as the user's current activity, the title calls the **MultiplayerService.SetActivityAsync Method**, passing the session reference for the session.</span><span class="sxs-lookup"><span data-stu-id="99ede-276">To set a session as the user's current activity, the title calls the **MultiplayerService.SetActivityAsync Method**, passing the session reference for the session.</span></span>

<span data-ttu-id="99ede-277">タイトルのアクティベーションを通じてユーザーの現在のアクティビティを設定するには、「**方法: タイトルのアクティベーションからの MPSD セッションへの参加**」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="99ede-277">To set the user's current activity through title activation, see **How to: Join an MPSD Session from a Title Activation**.</span></span>

## <a name="update-an-mpsd-session"></a><span data-ttu-id="99ede-278">MPSD セッションの更新</span><span class="sxs-lookup"><span data-stu-id="99ede-278">Update an MPSD session</span></span>

| <span data-ttu-id="99ede-279">注意</span><span class="sxs-lookup"><span data-stu-id="99ede-279">Note</span></span>                                                                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="99ede-280">When your title updates an existing session using the multiplayer API, remember that it is working with a local copy, until it makes a call to write the session.</span><span class="sxs-lookup"><span data-stu-id="99ede-280">When your title updates an existing session using the multiplayer API, remember that it is working with a local copy, until it makes a call to write the session.</span></span> |

<span data-ttu-id="99ede-281">To update an existing session, the title must:</span><span class="sxs-lookup"><span data-stu-id="99ede-281">To update an existing session, the title must:</span></span>

1.  <span data-ttu-id="99ede-282">Make changes to the current session as required, for example, by calling the **MultiplayerSession.Leave Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-282">Make changes to the current session as required, for example, by calling the **MultiplayerSession.Leave Method**.</span></span>
2.  <span data-ttu-id="99ede-283">When all changes are made, write the local changes to MPSD, using any of these methods:</span><span class="sxs-lookup"><span data-stu-id="99ede-283">When all changes are made, write the local changes to MPSD, using any of these methods:</span></span>

    -   **<span data-ttu-id="99ede-284">MultiplayerService.WriteSessionAsync Method</span><span class="sxs-lookup"><span data-stu-id="99ede-284">MultiplayerService.WriteSessionAsync Method</span></span>**
    -   <span data-ttu-id="99ede-285">**MultiplayerService.WriteSessionByHandleAsync Method**.</span><span class="sxs-lookup"><span data-stu-id="99ede-285">**MultiplayerService.WriteSessionByHandleAsync Method**.</span></span>
    -   **<span data-ttu-id="99ede-286">MultiplayerService.TryWriteSessionAsync Method</span><span class="sxs-lookup"><span data-stu-id="99ede-286">MultiplayerService.TryWriteSessionAsync Method</span></span>**
    -   **<span data-ttu-id="99ede-287">MultiplayerService.TryWriteSessionByHandleAsync Method</span><span class="sxs-lookup"><span data-stu-id="99ede-287">MultiplayerService.TryWriteSessionByHandleAsync Method</span></span>**

    <span data-ttu-id="99ede-288">Set the write mode to **SynchronizedUpdate** if writing to a shared portion that other titles can also modify.</span><span class="sxs-lookup"><span data-stu-id="99ede-288">Set the write mode to **SynchronizedUpdate** if writing to a shared portion that other titles can also modify.</span></span> <span data-ttu-id="99ede-289">See [Synchronization of Session Updates](multiplayer-session-directory.md) for more information.</span><span class="sxs-lookup"><span data-stu-id="99ede-289">See [Synchronization of Session Updates](multiplayer-session-directory.md) for more information.</span></span>

    <span data-ttu-id="99ede-290">The write method writes the join to the server and gets the latest session, from which to discover other session members and the secure device addresses (SDAs) of their consoles.</span><span class="sxs-lookup"><span data-stu-id="99ede-290">The write method writes the join to the server and gets the latest session, from which to discover other session members and the secure device addresses (SDAs) of their consoles.</span></span> <span data-ttu-id="99ede-291">For more information about establishing a network connection among these consoles, see **Introduction to Winsock on Xbox One**.</span><span class="sxs-lookup"><span data-stu-id="99ede-291">For more information about establishing a network connection among these consoles, see **Introduction to Winsock on Xbox One**.</span></span>

3.  <span data-ttu-id="99ede-292">Discard the old local session object, and use the newly retrieved session object so that future actions are based on the latest known session state.</span><span class="sxs-lookup"><span data-stu-id="99ede-292">Discard the old local session object, and use the newly retrieved session object so that future actions are based on the latest known session state.</span></span>

## <a name="leave-an-mpsd-session"></a><span data-ttu-id="99ede-293">MPSD セッションからの退出</span><span class="sxs-lookup"><span data-stu-id="99ede-293">Leave an MPSD session</span></span>

<span data-ttu-id="99ede-294">ユーザーがセッションから退出できるようにするには、タイトルで次の手順を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="99ede-294">To allow a user to leave a session, the title must do the following.</span></span>

1.  <span data-ttu-id="99ede-295">Call the **MultiplayerSession.Leave Method** for the game session.</span><span class="sxs-lookup"><span data-stu-id="99ede-295">Call the **MultiplayerSession.Leave Method** for the game session.</span></span>
2.  <span data-ttu-id="99ede-296">Update the game session in MPSD, as described in **How to: Update a Multiplayer Session**.</span><span class="sxs-lookup"><span data-stu-id="99ede-296">Update the game session in MPSD, as described in **How to: Update a Multiplayer Session**.</span></span>
3.  <span data-ttu-id="99ede-297">If necessary, call **Leave** method for the lobby session, and update that session.</span><span class="sxs-lookup"><span data-stu-id="99ede-297">If necessary, call **Leave** method for the lobby session, and update that session.</span></span>
4.  <span data-ttu-id="99ede-298">If necessary for the lobby session, shut down the multiplayer API by unregistering the **RealTimeActivityService.MultiplayerSubscriptionsLost Event** and the **RealTimeActivityService.MultiplayerSessionChanged Event**.</span><span class="sxs-lookup"><span data-stu-id="99ede-298">If necessary for the lobby session, shut down the multiplayer API by unregistering the **RealTimeActivityService.MultiplayerSubscriptionsLost Event** and the **RealTimeActivityService.MultiplayerSessionChanged Event**.</span></span>

<span data-ttu-id="99ede-299">次のフロー チャートは、セッションから退出して、シャットダウンする方法を示します。</span><span class="sxs-lookup"><span data-stu-id="99ede-299">The following flow chart illustrates how to leave the session and shut down.</span></span>

![](../../images/multiplayer/Multiplayer_2015_Shut_Down.png)

## <a name="fill-open-session-slots-during-matchmaking"></a><span data-ttu-id="99ede-300">マッチメイキング中に空きセッション スロットを埋める</span><span class="sxs-lookup"><span data-stu-id="99ede-300">Fill open session slots during matchmaking</span></span>

<span data-ttu-id="99ede-301">マッチメイキング中にチケット セッションの空きスロットを埋めるには、タイトルで次のような手順に従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="99ede-301">To fill open slots in a ticket session during matchmaking, the title must follow steps similar to the following:</span></span>

1.  <span data-ttu-id="99ede-302">Access the latest session state for the ticket session created during matchmaking.</span><span class="sxs-lookup"><span data-stu-id="99ede-302">Access the latest session state for the ticket session created during matchmaking.</span></span>
2.  <span data-ttu-id="99ede-303">Add available players for game play from the lobby session.</span><span class="sxs-lookup"><span data-stu-id="99ede-303">Add available players for game play from the lobby session.</span></span>
3.  <span data-ttu-id="99ede-304">Determine if the ticket session is full.</span><span class="sxs-lookup"><span data-stu-id="99ede-304">Determine if the ticket session is full.</span></span>
4.  <span data-ttu-id="99ede-305">If the session is full, continue game play.</span><span class="sxs-lookup"><span data-stu-id="99ede-305">If the session is full, continue game play.</span></span>
5.  <span data-ttu-id="99ede-306">If the session is not yet full, create the match ticket as described in **How to: Create a Match Ticket**.</span><span class="sxs-lookup"><span data-stu-id="99ede-306">If the session is not yet full, create the match ticket as described in **How to: Create a Match Ticket**.</span></span> <span data-ttu-id="99ede-307">Be sure to create the ticket with the *preserveSession* parameter set to Always.</span><span class="sxs-lookup"><span data-stu-id="99ede-307">Be sure to create the ticket with the *preserveSession* parameter set to Always.</span></span>
6.  <span data-ttu-id="99ede-308">Continue with matchmaking.</span><span class="sxs-lookup"><span data-stu-id="99ede-308">Continue with matchmaking.</span></span> <span data-ttu-id="99ede-309">See [Using SmartMatch Matchmaking](using-smartmatch-matchmaking.md).</span><span class="sxs-lookup"><span data-stu-id="99ede-309">See [Using SmartMatch Matchmaking](using-smartmatch-matchmaking.md).</span></span>

<span data-ttu-id="99ede-310">次のフロー チャートは、マッチメイキング中に空きセッション スロットを埋める方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="99ede-310">The following flow chart illustrates how to fill open session slots during matchmaking.</span></span>

![](../../images/multiplayer/Multiplayer_2015_Fill_Open_Slots.png)

## <a name="create-a-match-ticket"></a><span data-ttu-id="99ede-311">マッチ チケットの作成</span><span class="sxs-lookup"><span data-stu-id="99ede-311">Create a match ticket</span></span>

<span data-ttu-id="99ede-312">マッチ チケットを作成するには、マッチメイキング スカウトは次の処理を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="99ede-312">To create a match ticket, the matchmaking scout must:</span></span>

1.  <span data-ttu-id="99ede-313">Call the **MatchmakingService.CreateMatchTicketAsync Method**, passing in a reference to the ticket session.</span><span class="sxs-lookup"><span data-stu-id="99ede-313">Call the **MatchmakingService.CreateMatchTicketAsync Method**, passing in a reference to the ticket session.</span></span> <span data-ttu-id="99ede-314">The method reads the ticket session from MPSD, and starts matchmaking for the users in the session.</span><span class="sxs-lookup"><span data-stu-id="99ede-314">The method reads the ticket session from MPSD, and starts matchmaking for the users in the session.</span></span> <span data-ttu-id="99ede-315">Internally the method calls the **POST (/serviceconfigs/{scid}/hoppers/{hoppername})**.</span><span class="sxs-lookup"><span data-stu-id="99ede-315">Internally the method calls the **POST (/serviceconfigs/{scid}/hoppers/{hoppername})**.</span></span>
2.  <span data-ttu-id="99ede-316">Set the *preserveSession* parameter to Never if the matchmaking service is to match the members of the session into a new session or another existing session.</span><span class="sxs-lookup"><span data-stu-id="99ede-316">Set the *preserveSession* parameter to Never if the matchmaking service is to match the members of the session into a new session or another existing session.</span></span> <span data-ttu-id="99ede-317">Set the *preserveSession* parameter to Always to allow the title to reuse an existing game session as a ticket session to continue game play.</span><span class="sxs-lookup"><span data-stu-id="99ede-317">Set the *preserveSession* parameter to Always to allow the title to reuse an existing game session as a ticket session to continue game play.</span></span> <span data-ttu-id="99ede-318">The matchmaking service can then ensure that the submitted session is preserved and any matched players are added to that session.</span><span class="sxs-lookup"><span data-stu-id="99ede-318">The matchmaking service can then ensure that the submitted session is preserved and any matched players are added to that session.</span></span>

3.  <span data-ttu-id="99ede-319">Use the **CreateMatchTicketResponse.EstimatedWaitTime Property** returned in the **CreateMatchTicketResponse Class** object to set user expectations of matchmaking time.</span><span class="sxs-lookup"><span data-stu-id="99ede-319">Use the **CreateMatchTicketResponse.EstimatedWaitTime Property** returned in the **CreateMatchTicketResponse Class** object to set user expectations of matchmaking time.</span></span>
4.  <span data-ttu-id="99ede-320">Use the **CreateMatchTicketResponse.MatchTicketId Property** returned in the response object to cancel matchmaking for the session if needed, by deleting the ticket.</span><span class="sxs-lookup"><span data-stu-id="99ede-320">Use the **CreateMatchTicketResponse.MatchTicketId Property** returned in the response object to cancel matchmaking for the session if needed, by deleting the ticket.</span></span> <span data-ttu-id="99ede-321">チケットの削除には **MatchmakingService.DeleteMatchTicketAsync メソッド**を使用します。</span><span class="sxs-lookup"><span data-stu-id="99ede-321">Ticket deletion uses the **MatchmakingService.DeleteMatchTicketAsync Method**.</span></span>

## <a name="get-match-ticket-status"></a><span data-ttu-id="99ede-322">マッチ チケットのステータスの取得</span><span class="sxs-lookup"><span data-stu-id="99ede-322">Get match ticket status</span></span>

<span data-ttu-id="99ede-323">タイトルがマッチ チケットのステータスを取得するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="99ede-323">Your title should do the following to retrieve match ticket status:</span></span>

1.  <span data-ttu-id="99ede-324">Obtain the **MultiplayerSession Class** object for the ticket session.</span><span class="sxs-lookup"><span data-stu-id="99ede-324">Obtain the **MultiplayerSession Class** object for the ticket session.</span></span>
2.  <span data-ttu-id="99ede-325">Use the **MultiplayerSession.MatchmakingServer Property** to access the **MatchmakingServer Class** object used in matchmaking.</span><span class="sxs-lookup"><span data-stu-id="99ede-325">Use the **MultiplayerSession.MatchmakingServer Property** to access the **MatchmakingServer Class** object used in matchmaking.</span></span>
3.  <span data-ttu-id="99ede-326">Check the **MatchmakingServer** object to determine the status of the matchmaking process, the typical wait time for the session, and the target session reference, if a match has been found.</span><span class="sxs-lookup"><span data-stu-id="99ede-326">Check the **MatchmakingServer** object to determine the status of the matchmaking process, the typical wait time for the session, and the target session reference, if a match has been found.</span></span>
